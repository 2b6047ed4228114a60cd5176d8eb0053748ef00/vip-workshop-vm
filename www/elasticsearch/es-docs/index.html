<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Reference</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><script>var eucookie = true;</script><link rel="shortcut icon" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/favicon.ico" /><meta property="og:locale" content="en_US" /><meta property="og:type" content="article" /><meta property="og:title" content="Resources | Elasticsearch" /><meta property="og:url" content="/guide" /><meta property="og:site_name" content="" /><link rel="alternate" type="application/rss+xml" title=" Â» Elasticsearch Resources Comments Feed" href="/resources/feed/" /><link rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1386286315" type="text/css" media="all" /><script type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1386264369"></script><script type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/comment-reply.min.js?ver=3.5.2"></script><link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.elasticsearch.org/xmlrpc.php?rsd" /><link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.elasticsearch.org/wp-includes/wlwmanifest.xml" /><link rel="stylesheet" id="custom-css-css" type="text/css" href="http://www.elasticsearch.org/?custom-css=1&amp;csblog=1&amp;cscache=6&amp;csrev=34" /><script src="//fast.wistia.com/static/iframe-api-v1.js"></script><script type="text/javascript">
      jQuery(function() {
        jQuery('div.navheader+div').css('minHeight',jQuery('div.toc').height()+'px');
        jQuery('article.guide_content a[id]').each(function() { this.href='#'+this.id });
      });
    </script><link rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><img src="http://ad.retargeter.com/seg?add=1235131&amp;t=2" width="1" height="1" style="position:absolute; visibility:hidden;" /><script type="text/javascript">if(jQuery('body').data('cookie') != "eu" || jQuery.cookie('allowCookies')){
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-12395217-2']);
        _gaq.push(['_trackPageview']);
        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    }</script><!--[if lt IE 8]>
        <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
      <![endif]--><header><div class="container"><div id="header-inner"><h1 id="header-logo"><a class="faux" href="http://www.elasticsearch.org">Elasticsearch</a></h1><nav role="navigation" id="main-nav-container"><ul id="top-nav" class="menu"><li id="menu-item-7" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7"><a href="/overview/">Overview</a><ul class="sub-menu"><li id="menu-item-68760" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68760"><a href="/overview/">Elasticsearch</a></li><li id="menu-item-68758" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68758"><a href="/overview/kibana/">Kibana</a></li><li id="menu-item-68756" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68756"><a href="/overview/kibana/installation/">Kibana Installation</a></li><li id="menu-item-68757" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68757"><a href="/overview/kibana/support/">Kibana Support</a></li><li id="menu-item-68759" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68759"><a href="/overview/logstash/">Logstash</a></li><li id="menu-item-74019" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-74019"><a href="/overview/hadoop/">Hadoop</a></li></ul></li><li id="menu-item-55" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-53 current_page_item menu-item-55"><a href="/resources/">Resources</a><ul class="sub-menu"><li id="menu-item-4841" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4841 current-menu-item"><a href="/guide/">Guide</a></li><li id="menu-item-4843" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4843"><a href="/videos/">Videos</a></li></ul></li><li id="menu-item-657" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-657"><a href="/community/">Community</a></li><li id="menu-item-68802" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68802"><a href="/case-studies/">Case Studies</a></li><li id="menu-item-45" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-45"><a href="/blog/">Blog</a></li><li id="menu-item-12" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12"><a target="_blank" href="http://elasticsearch.com">Company</a></li></ul></nav><div class="slide-trigger navigation" id="nav-trigger"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div><a class="btn btn-primary" href="/download/">Download</a><hr /><ul id="sub_nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4841"><a href="/guide/">Guide</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4843"><a href="/videos/">Videos</a></li></ul></div></div></header><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section id="search_container" class="active"><form id="blog_search" role="search" action="/" method="get"><div class="blog_search_wrapper"><input id="s" name="s" class="search_term" type="text" placeholder="search" autocomplete="off" tabindex="1" /><input type="submit" class="search_submit" value=" " /><ul id="results"></ul></div></form></section><section class="full_width guide"><article class="guide_content"><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="id-1"></a>Reference</h1></div></div><hr /></div><div class="toc"><dl class="toc"><dt><span class="part"><a href="#setup">Setup</a></span></dt><dd><dl><dt><span class="chapter"><a href="#setup-configuration">Configuration</a></span></dt><dt><span class="chapter"><a href="#setup-service">Running As a Service on Linux</a></span></dt><dt><span class="chapter"><a href="#setup-service-win">Running as a Service on Windows</a></span></dt><dt><span class="chapter"><a href="#setup-dir-layout">Directory Layout</a></span></dt><dt><span class="chapter"><a href="#setup-repositories">Repositories</a></span></dt></dl></dd><dt><span class="part"><a href="#breaking-changes">Breaking changes in 1.0</a></span></dt><dd><dl><dt><span class="chapter"><a href="#_system_and_settings">System and settings</a></span></dt><dt><span class="chapter"><a href="#_stats_and_info_apis">Stats and Info APIs</a></span></dt><dt><span class="chapter"><a href="#_indices_apis">Indices APIs</a></span></dt><dt><span class="chapter"><a href="#_index_request">Index request</a></span></dt><dt><span class="chapter"><a href="#_search_requests">Search requests</a></span></dt><dt><span class="chapter"><a href="#_multi_fields">Multi-fields</a></span></dt><dt><span class="chapter"><a href="#_stopwords">Stopwords</a></span></dt><dt><span class="chapter"><a href="#_dates_without_years">Dates without years</a></span></dt><dt><span class="chapter"><a href="#_parameters">Parameters</a></span></dt><dt><span class="chapter"><a href="#_return_values">Return values</a></span></dt><dt><span class="chapter"><a href="#_deprecations">Deprecations</a></span></dt><dt><span class="chapter"><a href="#_percolator">Percolator</a></span></dt></dl></dd><dt><span class="part"><a href="#api-conventions">API Conventions</a></span></dt><dd><dl><dt><span class="chapter"><a href="#multi-index">Multiple Indices</a></span></dt><dt><span class="chapter"><a href="#common-options">Common options</a></span></dt><dt><span class="chapter"><a href="#url-access-control">URL-based access control</a></span></dt></dl></dd><dt><span class="part"><a href="#docs">Document APIs</a></span></dt><dd><dl><dt><span class="chapter"><a href="#docs-index_">Index API</a></span></dt><dt><span class="chapter"><a href="#docs-get">Get API</a></span></dt><dt><span class="chapter"><a href="#docs-delete">Delete API</a></span></dt><dt><span class="chapter"><a href="#docs-update">Update API</a></span></dt><dt><span class="chapter"><a href="#docs-multi-get">Multi Get API</a></span></dt><dt><span class="chapter"><a href="#docs-bulk">Bulk API</a></span></dt><dt><span class="chapter"><a href="#docs-delete-by-query">Delete By Query API</a></span></dt><dt><span class="chapter"><a href="#docs-bulk-udp">Bulk UDP API</a></span></dt><dt><span class="chapter"><a href="#docs-termvectors">Term Vectors</a></span></dt><dt><span class="chapter"><a href="#docs-multi-termvectors">Multi termvectors API</a></span></dt></dl></dd><dt><span class="part"><a href="#search">Search APIs</a></span></dt><dd><dl><dt><span class="chapter"><a href="#search-search">Search</a></span></dt><dt><span class="chapter"><a href="#search-uri-request">URI Search</a></span></dt><dt><span class="chapter"><a href="#search-request-body">Request Body Search</a></span></dt><dd><dl><dt><span class="section"><a href="#search-request-query">Query</a></span></dt><dt><span class="section"><a href="#search-request-from-size">From / Size</a></span></dt><dt><span class="section"><a href="#search-request-sort">Sort</a></span></dt><dt><span class="section"><a href="#search-request-source-filtering">Source filtering</a></span></dt><dt><span class="section"><a href="#search-request-fields">Fields</a></span></dt><dt><span class="section"><a href="#search-request-script-fields">Script Fields</a></span></dt><dt><span class="section"><a href="#search-request-fielddata-fields">Field Data Fields</a></span></dt><dt><span class="section"><a href="#search-request-post-filter">Post filter</a></span></dt><dt><span class="section"><a href="#search-request-highlighting">Highlighting</a></span></dt><dt><span class="section"><a href="#search-request-rescore">Rescoring</a></span></dt><dt><span class="section"><a href="#search-request-search-type">Search Type</a></span></dt><dt><span class="section"><a href="#search-request-scroll">Scroll</a></span></dt><dt><span class="section"><a href="#search-request-preference">Preference</a></span></dt><dt><span class="section"><a href="#search-request-explain">Explain</a></span></dt><dt><span class="section"><a href="#search-request-version">Version</a></span></dt><dt><span class="section"><a href="#search-request-index-boost">Index Boost</a></span></dt><dt><span class="section"><a href="#search-request-min-score">min_score</a></span></dt><dt><span class="section"><a href="#search-request-named-queries-and-filters">Named Queries and Filters</a></span></dt></dl></dd><dt><span class="chapter"><a href="#search-template">Search Template</a></span></dt><dt><span class="chapter"><a href="#search-facets">Facets</a></span></dt><dd><dl><dt><span class="section"><a href="#search-facets-terms-facet">Terms Facet</a></span></dt><dt><span class="section"><a href="#search-facets-range-facet">Range Facets</a></span></dt><dt><span class="section"><a href="#search-facets-histogram-facet">Histogram Facets</a></span></dt><dt><span class="section"><a href="#search-facets-date-histogram-facet">Date Histogram Facet</a></span></dt><dt><span class="section"><a href="#search-facets-filter-facet">Filter Facets</a></span></dt><dt><span class="section"><a href="#search-facets-query-facet">Query Facets</a></span></dt><dt><span class="section"><a href="#search-facets-statistical-facet">Statistical Facet</a></span></dt><dt><span class="section"><a href="#search-facets-terms-stats-facet">Terms Stats Facet</a></span></dt><dt><span class="section"><a href="#search-facets-geo-distance-facet">Geo Distance Facets</a></span></dt></dl></dd><dt><span class="chapter"><a href="#search-aggregations">Aggregations</a></span></dt><dd><dl><dt><span class="section"><a href="#search-aggregations-metrics-min-aggregation">Min</a></span></dt><dt><span class="section"><a href="#search-aggregations-metrics-max-aggregation">Max</a></span></dt><dt><span class="section"><a href="#search-aggregations-metrics-sum-aggregation">Sum</a></span></dt><dt><span class="section"><a href="#search-aggregations-metrics-avg-aggregation">Avg</a></span></dt><dt><span class="section"><a href="#search-aggregations-metrics-stats-aggregation">Stats</a></span></dt><dt><span class="section"><a href="#search-aggregations-metrics-extendedstats-aggregation">Extended Stats</a></span></dt><dt><span class="section"><a href="#search-aggregations-metrics-valuecount-aggregation">Value Count</a></span></dt><dt><span class="section"><a href="#search-aggregations-metrics-percentile-aggregation">Percentiles</a></span></dt><dt><span class="section"><a href="#search-aggregations-metrics-cardinality-aggregation">Cardinality</a></span></dt><dt><span class="section"><a href="#search-aggregations-bucket-global-aggregation">Global</a></span></dt><dt><span class="section"><a href="#search-aggregations-bucket-filter-aggregation">Filter</a></span></dt><dt><span class="section"><a href="#search-aggregations-bucket-missing-aggregation">Missing</a></span></dt><dt><span class="section"><a href="#search-aggregations-bucket-nested-aggregation">Nested</a></span></dt><dt><span class="section"><a href="#search-aggregations-bucket-terms-aggregation">Terms</a></span></dt><dt><span class="section"><a href="#search-aggregations-bucket-significantterms-aggregation">Significant Terms</a></span></dt><dt><span class="section"><a href="#search-aggregations-bucket-range-aggregation">Range</a></span></dt><dt><span class="section"><a href="#search-aggregations-bucket-daterange-aggregation">Date Range</a></span></dt><dt><span class="section"><a href="#search-aggregations-bucket-iprange-aggregation">IPv4 Range</a></span></dt><dt><span class="section"><a href="#search-aggregations-bucket-histogram-aggregation">Histogram</a></span></dt><dt><span class="section"><a href="#search-aggregations-bucket-datehistogram-aggregation">Date Histogram</a></span></dt><dt><span class="section"><a href="#search-aggregations-bucket-geodistance-aggregation">Geo Distance</a></span></dt><dt><span class="section"><a href="#search-aggregations-bucket-geohashgrid-aggregation">GeoHash grid</a></span></dt></dl></dd><dt><span class="chapter"><a href="#search-suggesters">Suggesters</a></span></dt><dd><dl><dt><span class="section"><a href="#search-suggesters-term">Term suggester</a></span></dt><dt><span class="section"><a href="#search-suggesters-phrase">Phrase Suggester</a></span></dt><dt><span class="section"><a href="#search-suggesters-completion">Completion Suggester</a></span></dt></dl></dd><dt><span class="chapter"><a href="#suggester-context">Context Suggester</a></span></dt><dt><span class="chapter"><a href="#search-multi-search">Multi Search API</a></span></dt><dt><span class="chapter"><a href="#search-count">Count API</a></span></dt><dt><span class="chapter"><a href="#search-validate">Validate API</a></span></dt><dt><span class="chapter"><a href="#search-explain">Explain API</a></span></dt><dt><span class="chapter"><a href="#search-percolate">Percolator</a></span></dt><dt><span class="chapter"><a href="#search-more-like-this">More Like This API</a></span></dt></dl></dd><dt><span class="part"><a href="#indices">Indices APIs</a></span></dt><dd><dl><dt><span class="chapter"><a href="#indices-create-index">Create Index</a></span></dt><dt><span class="chapter"><a href="#indices-delete-index">Delete Index</a></span></dt><dt><span class="chapter"><a href="#indices-exists">Indices Exists</a></span></dt><dt><span class="chapter"><a href="#indices-open-close">Open / Close Index API</a></span></dt><dt><span class="chapter"><a href="#indices-put-mapping">Put Mapping</a></span></dt><dt><span class="chapter"><a href="#indices-get-mapping">Get Mapping</a></span></dt><dt><span class="chapter"><a href="#indices-get-field-mapping">Get Field Mapping</a></span></dt><dt><span class="chapter"><a href="#indices-types-exists">Types Exists</a></span></dt><dt><span class="chapter"><a href="#indices-delete-mapping">Delete Mapping</a></span></dt><dt><span class="chapter"><a href="#indices-aliases">Index Aliases</a></span></dt><dt><span class="chapter"><a href="#indices-update-settings">Update Indices Settings</a></span></dt><dt><span class="chapter"><a href="#indices-get-settings">Get Settings</a></span></dt><dt><span class="chapter"><a href="#indices-analyze">Analyze</a></span></dt><dt><span class="chapter"><a href="#indices-templates">Index Templates</a></span></dt><dt><span class="chapter"><a href="#indices-warmers">Warmers</a></span></dt><dt><span class="chapter"><a href="#indices-status">Status</a></span></dt><dt><span class="chapter"><a href="#indices-stats">Indices Stats</a></span></dt><dt><span class="chapter"><a href="#indices-segments">Indices Segments</a></span></dt><dt><span class="chapter"><a href="#indices-recovery">Indices Recovery</a></span></dt><dt><span class="chapter"><a href="#indices-clearcache">Clear Cache</a></span></dt><dt><span class="chapter"><a href="#indices-flush">Flush</a></span></dt><dt><span class="chapter"><a href="#indices-refresh">Refresh</a></span></dt><dt><span class="chapter"><a href="#indices-optimize">Optimize</a></span></dt><dt><span class="chapter"><a href="#indices-gateway-snapshot">Gateway Snapshot</a></span></dt></dl></dd><dt><span class="part"><a href="#cat">cat APIs</a></span></dt><dd><dl><dt><span class="chapter"><a href="#cat-alias">Aliases</a></span></dt><dt><span class="chapter"><a href="#cat-allocation">Allocation</a></span></dt><dt><span class="chapter"><a href="#cat-count">Count</a></span></dt><dt><span class="chapter"><a href="#cat-health">Health</a></span></dt><dt><span class="chapter"><a href="#cat-indices">Indices</a></span></dt><dt><span class="chapter"><a href="#cat-master">Master</a></span></dt><dt><span class="chapter"><a href="#cat-nodes">Nodes</a></span></dt><dt><span class="chapter"><a href="#cat-pending-tasks">Cluster Pending Tasks</a></span></dt><dt><span class="chapter"><a href="#cat-recovery">Recovery</a></span></dt><dt><span class="chapter"><a href="#cat-thread-pool">Thread pool</a></span></dt><dt><span class="chapter"><a href="#cat-shards">Shards</a></span></dt><dd><dl><dt><span class="section"><a href="#index-pattern">Index pattern</a></span></dt><dt><span class="section"><a href="#relocation">Relocation</a></span></dt><dt><span class="section"><a href="#states">Shard states</a></span></dt></dl></dd><dt><span class="chapter"><a href="#cat-plugins">Plugins</a></span></dt></dl></dd><dt><span class="part"><a href="#cluster">Cluster APIs</a></span></dt><dd><dl><dt><span class="chapter"><a href="#cluster-health">Cluster Health</a></span></dt><dt><span class="chapter"><a href="#cluster-state">Cluster State</a></span></dt><dt><span class="chapter"><a href="#cluster-stats">Cluster Stats</a></span></dt><dt><span class="chapter"><a href="#cluster-pending">Pending cluster tasks</a></span></dt><dt><span class="chapter"><a href="#cluster-reroute">Cluster Reroute</a></span></dt><dt><span class="chapter"><a href="#cluster-update-settings">Cluster Update Settings</a></span></dt><dt><span class="chapter"><a href="#cluster-nodes-stats">Nodes Stats</a></span></dt><dt><span class="chapter"><a href="#cluster-nodes-info">Nodes Info</a></span></dt><dt><span class="chapter"><a href="#cluster-nodes-hot-threads">Nodes hot_threads</a></span></dt><dt><span class="chapter"><a href="#cluster-nodes-shutdown">Nodes Shutdown</a></span></dt></dl></dd><dt><span class="part"><a href="#query-dsl">Query DSL</a></span></dt><dd><dl><dt><span class="chapter"><a href="#query-dsl-queries">Queries</a></span></dt><dd><dl><dt><span class="section"><a href="#query-dsl-match-query">Match Query</a></span></dt><dt><span class="section"><a href="#query-dsl-multi-match-query">Multi Match Query</a></span></dt><dt><span class="section"><a href="#query-dsl-bool-query">Bool Query</a></span></dt><dt><span class="section"><a href="#query-dsl-boosting-query">Boosting Query</a></span></dt><dt><span class="section"><a href="#query-dsl-common-terms-query">Common Terms Query</a></span></dt><dt><span class="section"><a href="#query-dsl-constant-score-query">Constant Score Query</a></span></dt><dt><span class="section"><a href="#query-dsl-dis-max-query">Dis Max Query</a></span></dt><dt><span class="section"><a href="#query-dsl-filtered-query">Filtered Query</a></span></dt><dt><span class="section"><a href="#query-dsl-flt-query">Fuzzy Like This Query</a></span></dt><dt><span class="section"><a href="#query-dsl-flt-field-query">Fuzzy Like This Field Query</a></span></dt><dt><span class="section"><a href="#query-dsl-function-score-query">Function Score Query</a></span></dt><dt><span class="section"><a href="#query-dsl-fuzzy-query">Fuzzy Query</a></span></dt><dt><span class="section"><a href="#query-dsl-geo-shape-query">GeoShape Query</a></span></dt><dt><span class="section"><a href="#query-dsl-has-child-query">Has Child Query</a></span></dt><dt><span class="section"><a href="#query-dsl-has-parent-query">Has Parent Query</a></span></dt><dt><span class="section"><a href="#query-dsl-ids-query">Ids Query</a></span></dt><dt><span class="section"><a href="#query-dsl-indices-query">Indices Query</a></span></dt><dt><span class="section"><a href="#query-dsl-match-all-query">Match All Query</a></span></dt><dt><span class="section"><a href="#query-dsl-mlt-query">More Like This Query</a></span></dt><dt><span class="section"><a href="#query-dsl-mlt-field-query">More Like This Field Query</a></span></dt><dt><span class="section"><a href="#query-dsl-nested-query">Nested Query</a></span></dt><dt><span class="section"><a href="#query-dsl-prefix-query">Prefix Query</a></span></dt><dt><span class="section"><a href="#query-dsl-query-string-query">Query String Query</a></span></dt><dt><span class="section"><a href="#query-dsl-simple-query-string-query">Simple Query String Query</a></span></dt><dt><span class="section"><a href="#query-dsl-range-query">Range Query</a></span></dt><dt><span class="section"><a href="#query-dsl-regexp-query">Regexp Query</a></span></dt><dt><span class="section"><a href="#query-dsl-span-first-query">Span First Query</a></span></dt><dt><span class="section"><a href="#query-dsl-span-multi-term-query">Span Multi Term Query</a></span></dt><dt><span class="section"><a href="#query-dsl-span-near-query">Span Near Query</a></span></dt><dt><span class="section"><a href="#query-dsl-span-not-query">Span Not Query</a></span></dt><dt><span class="section"><a href="#query-dsl-span-or-query">Span Or Query</a></span></dt><dt><span class="section"><a href="#query-dsl-span-term-query">Span Term Query</a></span></dt><dt><span class="section"><a href="#query-dsl-term-query">Term Query</a></span></dt><dt><span class="section"><a href="#query-dsl-terms-query">Terms Query</a></span></dt><dt><span class="section"><a href="#query-dsl-top-children-query">Top Children Query</a></span></dt><dt><span class="section"><a href="#query-dsl-wildcard-query">Wildcard Query</a></span></dt><dt><span class="section"><a href="#query-dsl-minimum-should-match">Minimum Should Match</a></span></dt><dt><span class="section"><a href="#query-dsl-multi-term-rewrite">Multi Term Query Rewrite</a></span></dt><dt><span class="section"><a href="#query-dsl-template-query">Template Query</a></span></dt></dl></dd><dt><span class="chapter"><a href="#query-dsl-filters">Filters</a></span></dt><dd><dl><dt><span class="section"><a href="#query-dsl-and-filter">And Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-bool-filter">Bool Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-exists-filter">Exists Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-geo-bounding-box-filter">Geo Bounding Box Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-geo-distance-filter">Geo Distance Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-geo-distance-range-filter">Geo Distance Range Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-geo-polygon-filter">Geo Polygon Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-geo-shape-filter">GeoShape Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-geohash-cell-filter">Geohash Cell Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-has-child-filter">Has Child Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-has-parent-filter">Has Parent Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-ids-filter">Ids Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-indices-filter">Indices Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-limit-filter">Limit Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-match-all-filter">Match All Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-missing-filter">Missing Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-nested-filter">Nested Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-not-filter">Not Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-or-filter">Or Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-prefix-filter">Prefix Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-query-filter">Query Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-range-filter">Range Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-regexp-filter">Regexp Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-script-filter">Script Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-term-filter">Term Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-terms-filter">Terms Filter</a></span></dt><dt><span class="section"><a href="#query-dsl-type-filter">Type Filter</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#mapping">Mapping</a></span></dt><dd><dl><dt><span class="chapter"><a href="#mapping-fields">Fields</a></span></dt><dd><dl><dt><span class="section"><a href="#mapping-uid-field"><code class="literal">_uid</code></a></span></dt><dt><span class="section"><a href="#mapping-id-field"><code class="literal">_id</code></a></span></dt><dt><span class="section"><a href="#mapping-type-field">Type Field</a></span></dt><dt><span class="section"><a href="#mapping-source-field"><code class="literal">_source</code></a></span></dt><dt><span class="section"><a href="#mapping-all-field"><code class="literal">_all</code></a></span></dt><dt><span class="section"><a href="#mapping-analyzer-field"><code class="literal">_analyzer</code></a></span></dt><dt><span class="section"><a href="#mapping-boost-field"><code class="literal">_boost</code></a></span></dt><dt><span class="section"><a href="#mapping-parent-field"><code class="literal">_parent</code></a></span></dt><dt><span class="section"><a href="#mapping-routing-field"><code class="literal">_routing</code></a></span></dt><dt><span class="section"><a href="#mapping-index-field"><code class="literal">_index</code></a></span></dt><dt><span class="section"><a href="#mapping-size-field"><code class="literal">_size</code></a></span></dt><dt><span class="section"><a href="#mapping-timestamp-field"><code class="literal">_timestamp</code></a></span></dt><dt><span class="section"><a href="#mapping-ttl-field"><code class="literal">_ttl</code></a></span></dt></dl></dd><dt><span class="chapter"><a href="#mapping-types">Types</a></span></dt><dd><dl><dt><span class="section"><a href="#mapping-core-types">Core Types</a></span></dt><dt><span class="section"><a href="#mapping-array-type">Array Type</a></span></dt><dt><span class="section"><a href="#mapping-object-type">Object Type</a></span></dt><dt><span class="section"><a href="#mapping-root-object-type">Root Object Type</a></span></dt><dt><span class="section"><a href="#mapping-nested-type">Nested Type</a></span></dt><dt><span class="section"><a href="#mapping-ip-type">IP Type</a></span></dt><dt><span class="section"><a href="#mapping-geo-point-type">Geo Point Type</a></span></dt><dt><span class="section"><a href="#mapping-geo-shape-type">Geo Shape Type</a></span></dt><dt><span class="section"><a href="#mapping-attachment-type">Attachment Type</a></span></dt></dl></dd><dt><span class="chapter"><a href="#mapping-date-format">Date Format</a></span></dt><dt><span class="chapter"><a href="#mapping-dynamic-mapping">Dynamic Mapping</a></span></dt><dt><span class="chapter"><a href="#mapping-conf-mappings">Config Mappings</a></span></dt><dt><span class="chapter"><a href="#mapping-meta">Meta</a></span></dt></dl></dd><dt><span class="part"><a href="#analysis">Analysis</a></span></dt><dd><dl><dt><span class="chapter"><a href="#analysis-analyzers">Analyzers</a></span></dt><dd><dl><dt><span class="section"><a href="#analysis-standard-analyzer">Standard Analyzer</a></span></dt><dt><span class="section"><a href="#analysis-simple-analyzer">Simple Analyzer</a></span></dt><dt><span class="section"><a href="#analysis-whitespace-analyzer">Whitespace Analyzer</a></span></dt><dt><span class="section"><a href="#analysis-stop-analyzer">Stop Analyzer</a></span></dt><dt><span class="section"><a href="#analysis-keyword-analyzer">Keyword Analyzer</a></span></dt><dt><span class="section"><a href="#analysis-pattern-analyzer">Pattern Analyzer</a></span></dt><dt><span class="section"><a href="#analysis-lang-analyzer">Language Analyzers</a></span></dt><dt><span class="section"><a href="#analysis-snowball-analyzer">Snowball Analyzer</a></span></dt><dt><span class="section"><a href="#analysis-custom-analyzer">Custom Analyzer</a></span></dt></dl></dd><dt><span class="chapter"><a href="#analysis-tokenizers">Tokenizers</a></span></dt><dd><dl><dt><span class="section"><a href="#analysis-standard-tokenizer">Standard Tokenizer</a></span></dt><dt><span class="section"><a href="#analysis-edgengram-tokenizer">Edge NGram Tokenizer</a></span></dt><dt><span class="section"><a href="#analysis-keyword-tokenizer">Keyword Tokenizer</a></span></dt><dt><span class="section"><a href="#analysis-letter-tokenizer">Letter Tokenizer</a></span></dt><dt><span class="section"><a href="#analysis-lowercase-tokenizer">Lowercase Tokenizer</a></span></dt><dt><span class="section"><a href="#analysis-ngram-tokenizer">NGram Tokenizer</a></span></dt><dt><span class="section"><a href="#analysis-whitespace-tokenizer">Whitespace Tokenizer</a></span></dt><dt><span class="section"><a href="#analysis-pattern-tokenizer">Pattern Tokenizer</a></span></dt><dt><span class="section"><a href="#analysis-uaxurlemail-tokenizer">UAX Email URL Tokenizer</a></span></dt><dt><span class="section"><a href="#analysis-pathhierarchy-tokenizer">Path Hierarchy Tokenizer</a></span></dt></dl></dd><dt><span class="chapter"><a href="#analysis-tokenfilters">Token Filters</a></span></dt><dd><dl><dt><span class="section"><a href="#analysis-standard-tokenfilter">Standard Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-asciifolding-tokenfilter">ASCII Folding Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-length-tokenfilter">Length Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-lowercase-tokenfilter">Lowercase Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-uppercase-tokenfilter">Uppercase Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-ngram-tokenfilter">NGram Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-edgengram-tokenfilter">Edge NGram Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-porterstem-tokenfilter">Porter Stem Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-shingle-tokenfilter">Shingle Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-stop-tokenfilter">Stop Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-word-delimiter-tokenfilter">Word Delimiter Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-stemmer-tokenfilter">Stemmer Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-stemmer-override-tokenfilter">Stemmer Override Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-keyword-marker-tokenfilter">Keyword Marker Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-keyword-repeat-tokenfilter">Keyword Repeat Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-kstem-tokenfilter">KStem Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-snowball-tokenfilter">Snowball Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-phonetic-tokenfilter">Phonetic Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-synonym-tokenfilter">Synonym Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-compound-word-tokenfilter">Compound Word Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-reverse-tokenfilter">Reverse Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-elision-tokenfilter">Elision Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-truncate-tokenfilter">Truncate Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-unique-tokenfilter">Unique Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-pattern-capture-tokenfilter">Pattern Capture Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-pattern_replace-tokenfilter">Pattern Replace Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-trim-tokenfilter">Trim Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-limit-token-count-tokenfilter">Limit Token Count Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-hunspell-tokenfilter">Hunspell Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-common-grams-tokenfilter">Common Grams Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-normalization-tokenfilter">Normalization Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-delimited-payload-tokenfilter">Delimited Payload Token Filter</a></span></dt><dt><span class="section"><a href="#analysis-keep-words-tokenfilter">Keep Words Token Filter</a></span></dt></dl></dd><dt><span class="chapter"><a href="#analysis-charfilters">Character Filters</a></span></dt><dd><dl><dt><span class="section"><a href="#analysis-mapping-charfilter">Mapping Char Filter</a></span></dt><dt><span class="section"><a href="#analysis-htmlstrip-charfilter">HTML Strip Char Filter</a></span></dt><dt><span class="section"><a href="#analysis-pattern-replace-charfilter">Pattern Replace Char Filter</a></span></dt></dl></dd><dt><span class="chapter"><a href="#analysis-icu-plugin">ICU Analysis Plugin</a></span></dt></dl></dd><dt><span class="part"><a href="#modules">Modules</a></span></dt><dd><dl><dt><span class="chapter"><a href="#modules-cluster">Cluster</a></span></dt><dt><span class="chapter"><a href="#modules-discovery">Discovery</a></span></dt><dd><dl><dt><span class="section"><a href="#modules-discovery-azure">Azure Discovery</a></span></dt><dt><span class="section"><a href="#modules-discovery-ec2">EC2 Discovery</a></span></dt><dt><span class="section"><a href="#modules-discovery-gce">Google Compute Engine Discovery</a></span></dt><dt><span class="section"><a href="#modules-discovery-zen">Zen Discovery</a></span></dt></dl></dd><dt><span class="chapter"><a href="#modules-gateway">Gateway</a></span></dt><dd><dl><dt><span class="section"><a href="#modules-gateway-local">Local Gateway</a></span></dt><dt><span class="section"><a href="#modules-gateway-fs">Shared FS Gateway</a></span></dt><dt><span class="section"><a href="#modules-gateway-hadoop">Hadoop Gateway</a></span></dt><dt><span class="section"><a href="#modules-gateway-s3">S3 Gateway</a></span></dt></dl></dd><dt><span class="chapter"><a href="#modules-http">HTTP</a></span></dt><dt><span class="chapter"><a href="#modules-indices">Indices</a></span></dt><dt><span class="chapter"><a href="#modules-memcached">memcached</a></span></dt><dt><span class="chapter"><a href="#modules-network">Network Settings</a></span></dt><dt><span class="chapter"><a href="#modules-node">Node</a></span></dt><dt><span class="chapter"><a href="#modules-tribe">Tribe node</a></span></dt><dt><span class="chapter"><a href="#modules-plugins">Plugins</a></span></dt><dt><span class="chapter"><a href="#modules-scripting">Scripting</a></span></dt><dt><span class="chapter"><a href="#modules-advanced-scripting">Text scoring in scripts</a></span></dt><dt><span class="chapter"><a href="#modules-threadpool">Thread Pool</a></span></dt><dt><span class="chapter"><a href="#modules-thrift">Thrift</a></span></dt><dt><span class="chapter"><a href="#modules-transport">Transport</a></span></dt><dt><span class="chapter"><a href="#modules-snapshots">Snapshot And Restore</a></span></dt></dl></dd><dt><span class="part"><a href="#index-modules">Index Modules</a></span></dt><dd><dl><dt><span class="chapter"><a href="#index-modules-analysis">Analysis</a></span></dt><dt><span class="chapter"><a href="#index-modules-allocation">Index Shard Allocation</a></span></dt><dt><span class="chapter"><a href="#index-modules-slowlog">Index Slow Log</a></span></dt><dt><span class="chapter"><a href="#index-modules-merge">Merge</a></span></dt><dt><span class="chapter"><a href="#index-modules-store">Store</a></span></dt><dt><span class="chapter"><a href="#index-modules-mapper">Mapper</a></span></dt><dt><span class="chapter"><a href="#index-modules-translog">Translog</a></span></dt><dt><span class="chapter"><a href="#index-modules-cache">Cache</a></span></dt><dt><span class="chapter"><a href="#index-modules-fielddata">Field data</a></span></dt><dt><span class="chapter"><a href="#fielddata-formats">Field data formats</a></span></dt><dt><span class="chapter"><a href="#index-modules-codec">Codec module</a></span></dt><dt><span class="chapter"><a href="#index-modules-similarity">Similarity module</a></span></dt></dl></dd><dt><span class="part"><a href="#testing">Testing</a></span></dt><dd><dl><dt><span class="chapter"><a href="#testing-framework">Java Testing Framework</a></span></dt><dd><dl><dt><span class="section"><a href="#why-randomized-testing">why randomized testing?</a></span></dt><dt><span class="section"><a href="#using-elasticsearch-test-classes">Using the elasticsearch test classes</a></span></dt><dt><span class="section"><a href="#unit-tests">unit tests</a></span></dt><dt><span class="section"><a href="#integration-tests">integration tests</a></span></dt><dt><span class="section"><a href="#randomized-testing">Randomized testing</a></span></dt><dt><span class="section"><a href="#assertions">Assertions</a></span></dt></dl></dd></dl></dd><dt><span class="glossary"><a href="#glossary">Glossary of terms</a></span></dt></dl></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="setup"></a>Setup</h1></div></div></div><div class="partintro"><div></div><p>This section includes information on how to setup <span class="strong"><strong>elasticsearch</strong></span> and
get it running. If you havenât already, <a class="ulink" href="http://www.elasticsearch.org/download" target="_top">download</a> it, and
then check the <a class="link" href="#setup-installation" title="Installation">installation</a> docs.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Elasticsearch can also be installed from our repositories using <code class="literal">apt</code> or <code class="literal">yum</code>.
See <a class="xref" href="#setup-repositories" title="Repositories"><em>Repositories</em></a>.</p></div></div><h2><a id="setup-installation"></a>Installation</h2><p>After <a class="ulink" href="/download" target="_top">downloading</a> the latest release and extracting it,
<span class="strong"><strong>elasticsearch</strong></span> can be started using:</p><pre class="programlisting prettyprint lang-sh">$ bin/elasticsearch</pre><p>Under *nix system, the command will start the process in the foreground.
To run it in the background, add the <code class="literal">-d</code> switch to it:</p><pre class="programlisting prettyprint lang-sh">$ bin/elasticsearch -d</pre><p>Elasticsearch is built using Java, and requires at least
<a class="ulink" href="http://java.sun.com/javase/downloads/index.jsp" target="_top">Java 6</a> in order to run.
The version of Java that will be used can be set by setting the
<code class="literal">JAVA_HOME</code> environment variable.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>*NIX</strong></p></div></div></div><p>There are added features when using the <code class="literal">elasticsearch</code> shell script.
The first, which was explained earlier, is the ability to easily run the
process either in the foreground or the background.</p><p>Another feature is the ability to pass <code class="literal">-X</code> and <code class="literal">-D</code> or getopt long style
configuration parameters directly to the script. When set, all override
anything set using either <code class="literal">JAVA_OPTS</code> or <code class="literal">ES_JAVA_OPTS</code>. For example:</p><pre class="programlisting prettyprint lang-sh">$ bin/elasticsearch -Xmx2g -Xms2g -Des.index.store.type=memory --node.name=my-node</pre></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="setup-configuration"></a>Configuration</h2></div></div></div><h3><a id="_environment_variables"></a>Environment Variables</h3><p>Within the scripts, Elasticsearch comes with built in <code class="literal">JAVA_OPTS</code> passed
to the JVM started. The most important setting for that is the <code class="literal">-Xmx</code> to
control the maximum allowed memory for the process, and <code class="literal">-Xms</code> to
control the minimum allocated memory for the process (<span class="emphasis"><em>in general, the
more memory allocated to the process, the better</em></span>).</p><p>Most times it is better to leave the default <code class="literal">JAVA_OPTS</code> as they are,
and use the <code class="literal">ES_JAVA_OPTS</code> environment variable in order to set / change
JVM settings or arguments.</p><p>The <code class="literal">ES_HEAP_SIZE</code> environment variable allows to set the heap memory
that will be allocated to elasticsearch java process. It will allocate
the same value to both min and max values, though those can be set
explicitly (not recommended) by setting <code class="literal">ES_MIN_MEM</code> (defaults to
<code class="literal">256m</code>), and <code class="literal">ES_MAX_MEM</code> (defaults to <code class="literal">1gb</code>).</p><p>It is recommended to set the min and max memory to the same value, and
enable <a class="link" href="#setup-configuration-memory" title="Memory Settings"><code class="literal">mlockall</code></a>.</p><h3><a id="system"></a>System Configuration</h3><h4><a id="file-descriptors"></a>File Descriptors</h4><p>Make sure to increase the number of open files descriptors on the
machine (or for the user running elasticsearch). Setting it to 32k or
even 64k is recommended.</p><p>In order to test how many open files the process can open, start it with
<code class="literal">-Des.max-open-files</code> set to <code class="literal">true</code>. This will print the number of open
files the process can open on startup.</p><p>Alternatively, you can retrieve the <code class="literal">max_file_descriptors</code> for each node
using the <a class="xref" href="#cluster-nodes-info" title="Nodes Info"><em>Nodes Info</em></a> API, with:</p><pre class="programlisting prettyprint lang-js">curl localhost:9200/_nodes/process?pretty</pre><h4><a id="setup-configuration-memory"></a>Memory Settings</h4><p>There is an option to use
<a class="ulink" href="http://opengroup.org/onlinepubs/007908799/xsh/mlockall.html" target="_top">mlockall</a> to
try to lock the process address space so it wonât be swapped. For this
to work, the <code class="literal">bootstrap.mlockall</code> should be set to <code class="literal">true</code> and it is
recommended to set both the min and max memory allocation to be the
same. Note: This option is only available on Linux/Unix operating
systems.</p><p>In order to see if this works or not, set the <code class="literal">common.jna</code> logging to
DEBUG level. A solution to "Unknown mlockall error 0" can be to set
<code class="literal">ulimit -l unlimited</code>.</p><p>Note, <code class="literal">mlockall</code> might cause the JVM or shell
session to exit if it fails to allocate the memory (because not enough
memory is available on the machine).</p><h3><a id="settings"></a>Elasticsearch Settings</h3><p><span class="strong"><strong>elasticsearch</strong></span> configuration files can be found under <code class="literal">ES_HOME/config</code>
folder. The folder comes with two files, the <code class="literal">elasticsearch.yml</code> for
configuring Elasticsearch different
<a class="link" href="#modules" title="Modules">modules</a>, and <code class="literal">logging.yml</code> for
configuring the Elasticsearch logging.</p><p>The configuration format is <a class="ulink" href="http://www.yaml.org/" target="_top">YAML</a>. Here is an
example of changing the address all network based modules will use to
bind and publish to:</p><pre class="programlisting prettyprint lang-yaml">network :
    host : 10.0.0.4</pre><h4><a id="paths"></a>Paths</h4><p>In production use, you will almost certainly want to change paths for
data and log files:</p><pre class="programlisting prettyprint lang-yaml">path:
  logs: /var/log/elasticsearch
  data: /var/data/elasticsearch</pre><h4><a id="cluster-name"></a>Cluster name</h4><p>Also, donât forget to give your production cluster a name, which is used
to discover and auto-join other nodes:</p><pre class="programlisting prettyprint lang-yaml">cluster:
  name: &lt;NAME OF YOUR CLUSTER&gt;</pre><h4><a id="node-name"></a>Node name</h4><p>You may also want to change the default node name for each node to
something like the display hostname. By default Elasticsearch will
randomly pick a Marvel character name from a list of around 3000 names
when your node starts up.</p><pre class="programlisting prettyprint lang-yaml">node:
  name: &lt;NAME OF YOUR NODE&gt;</pre><p>Internally, all settings are collapsed into "namespaced" settings. For
example, the above gets collapsed into <code class="literal">node.name</code>. This means that
its easy to support other configuration formats, for example,
<a class="ulink" href="http://www.json.org" target="_top">JSON</a>. If JSON is a preferred configuration format,
simply rename the <code class="literal">elasticsearch.yml</code> file to <code class="literal">elasticsearch.json</code> and
add:</p><h4><a id="styles"></a>Configuration styles</h4><pre class="programlisting prettyprint lang-yaml">{
    "network" : {
        "host" : "10.0.0.4"
    }
}</pre><p>It also means that its easy to provide the settings externally either
using the <code class="literal">ES_JAVA_OPTS</code> or as parameters to the <code class="literal">elasticsearch</code>
command, for example:</p><pre class="programlisting prettyprint lang-sh">$ elasticsearch -Des.network.host=10.0.0.4</pre><p>Another option is to set <code class="literal">es.default.</code> prefix instead of <code class="literal">es.</code> prefix,
which means the default setting will be used only if not explicitly set
in the configuration file.</p><p>Another option is to use the <code class="literal">${...}</code> notation within the configuration
file which will resolve to an environment setting, for example:</p><pre class="programlisting prettyprint lang-js">{
    "network" : {
        "host" : "${ES_NET_HOST}"
    }
}</pre><p>The location of the configuration file can be set externally using a
system property:</p><pre class="programlisting prettyprint lang-sh">$ elasticsearch -Des.config=/path/to/config/file</pre><h3><a id="configuration-index-settings"></a>Index Settings</h3><p>Indices created within the cluster can provide their own settings. For
example, the following creates an index with memory based storage
instead of the default file system based one (the format can be either
YAML or JSON):</p><pre class="programlisting prettyprint lang-sh">$ curl -XPUT http://localhost:9200/kimchy/ -d \
'
index :
    store:
        type: memory
'</pre><p>Index level settings can be set on the node level as well, for example,
within the <code class="literal">elasticsearch.yml</code> file, the following can be set:</p><pre class="programlisting prettyprint lang-yaml">index :
    store:
        type: memory</pre><p>This means that every index that gets created on the specific node
started with the mentioned configuration will store the index in memory
<span class="strong"><strong>unless the index explicitly sets it</strong></span>. In other words, any index level
settings override what is set in the node configuration. Of course, the
above can also be set as a "collapsed" setting, for example:</p><pre class="programlisting prettyprint lang-sh">$ elasticsearch -Des.index.store.type=memory</pre><p>All of the index level configuration can be found within each
<a class="link" href="#index-modules" title="Index Modules">index module</a>.</p><h3><a id="logging"></a>Logging</h3><p>Elasticsearch uses an internal logging abstraction and comes, out of the
box, with <a class="ulink" href="http://logging.apache.org/log4j/" target="_top">log4j</a>. It tries to simplify
log4j configuration by using <a class="ulink" href="http://www.yaml.org/" target="_top">YAML</a> to configure it,
and the logging configuration file is <code class="literal">config/logging.yml</code> file.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="setup-service"></a>Running As a Service on Linux</h2></div></div></div><p>In order to run elasticsearch as a service on your operating system, the provided packages try to make it as easy as possible for you to start and stop elasticsearch during reboot and upgrades.</p><h3><a id="_linux"></a>Linux</h3><p>Currently our build automatically creates a debian package and an RPM package, which is available on the download page. The package itself does not have any dependencies, but you have to make sure that you installed a JDK.</p><p>Each package features a configuration file, which allows you to set the following parameters</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">ES_USER</code>
</p>
</td><td valign="top">
<p>
The user to run as, defaults to <code class="literal">elasticsearch</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">ES_GROUP</code>
</p>
</td><td valign="top">
<p>
The group to run as, defaults to <code class="literal">elasticsearch</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">ES_HEAP_SIZE</code>
</p>
</td><td valign="top">
<p>
The heap size to start with
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">ES_HEAP_NEWSIZE</code>
</p>
</td><td valign="top">
<p>
The size of the new generation heap
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">ES_DIRECT_SIZE</code>
</p>
</td><td valign="top">
<p>
The maximum size of the direct memory
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">MAX_OPEN_FILES</code>
</p>
</td><td valign="top">
<p>
Maximum number of open files, defaults to <code class="literal">65535</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">MAX_LOCKED_MEMORY</code>
</p>
</td><td valign="top">
<p>
Maximum locked memory size. Set to "unlimited" if you use the bootstrap.mlockall option in elasticsearch.yml. You must also set ES_HEAP_SIZE.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">MAX_MAP_COUNT</code>
</p>
</td><td valign="top">
<p>
Maximum number of memory map areas a process may have. If you use <code class="literal">mmapfs</code> as index store type, make sure this is set to a high value. For more information, check the <a class="ulink" href="https://github.com/torvalds/linux/blob/master/Documentation/sysctl/vm.txt" target="_top">linux kernel documentation</a> about <code class="literal">max_map_count</code>. This is set via <code class="literal">sysctl</code> before starting elasticsearch. Defaults to <code class="literal">65535</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">LOG_DIR</code>
</p>
</td><td valign="top">
<p>
Log directory, defaults to <code class="literal">/var/log/elasticsearch</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">DATA_DIR</code>
</p>
</td><td valign="top">
<p>
Data directory, defaults to <code class="literal">/var/lib/elasticsearch</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">WORK_DIR</code>
</p>
</td><td valign="top">
<p>
Work directory, defaults to <code class="literal">/tmp/elasticsearch</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">CONF_DIR</code>
</p>
</td><td valign="top">
<p>
Configuration file directory (which needs to include <code class="literal">elasticsearch.yml</code> and <code class="literal">logging.yml</code> files), defaults to <code class="literal">/etc/elasticsearch</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">CONF_FILE</code>
</p>
</td><td valign="top">
<p>
Path to configuration file, defaults to <code class="literal">/etc/elasticsearch/elasticsearch.yml</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">ES_JAVA_OPTS</code>
</p>
</td><td valign="top">
<p>
Any additional java options you may want to apply. This may be useful, if you need to set the <code class="literal">node.name</code> property, but do not want to change the <code class="literal">elasticsearch.yml</code> configuration file, because it is distributed via a provisioning system like puppet or chef. Example: <code class="literal">ES_JAVA_OPTS="-Des.node.name=search-01"</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">RESTART_ON_UPGRADE</code>
</p>
</td><td valign="top">
<p>
Configure restart on package upgrade, defaults to <code class="literal">false</code>. This means you will have to restart your elasticsearch instance after installing a package manually. The reason for this is to ensure, that upgrades in a cluster do not result in a continouos shard reallocation resulting in high network traffic and reducing the response times of your cluster.
</p>
</td></tr></tbody></table></div><h4><a id="_debian_ubuntu"></a>Debian/Ubuntu</h4><p>The debian package ships with everything you need as it uses standard debian tools like update <code class="literal">update-rc.d</code> to define the runlevels it runs on. The init script is placed at <code class="literal">/etc/init.d/elasticsearch</code> is you would expect it. The configuration file is placed at <code class="literal">/etc/default/elasticsearch</code>.</p><p>The debian package does not start up the service by default. The reason for this is to prevent the instance to accidentally join a cluster, without being configured appropriately. After installing using <code class="literal">dpkg -i</code> you can use the following commands to ensure, that elasticsearch starts when the system is booted and then start up elasticsearch:</p><pre class="programlisting prettyprint lang-sh">sudo update-rc.d elasticsearch defaults 95 10
sudo /etc/init.d/elasticsearch start</pre><h5><a id="_installing_the_oracle_jdk"></a>Installing the oracle JDK</h5><p>The usual recommendation is to run the Oracle JDK with elasticsearch. However Ubuntu and Debian only ship the OpenJDK due to license issues. You can easily install the oracle installer package though. In case you are missing the <code class="literal">add-apt-repository</code> command under Debian GNU/Linux, make sure have at least Debian Wheezy and the package <code class="literal">python-software-properties</code> installed</p><pre class="programlisting prettyprint lang-sh">sudo add-apt-repository ppa:webupd8team/java
sudo apt-get update
sudo apt-get install oracle-java7-installer
java -version</pre><p>The last command should verify a successful installation of the Oracle JDK.</p><h4><a id="_rpm_based_distributions"></a>RPM based distributions</h4><h5><a id="_using_chkconfig"></a>Using chkconfig</h5><p>Some RPM based distributions are using <code class="literal">chkconfig</code> to enable and disable services. The init script is located at <code class="literal">/etc/init.d/elasticsearch</code>, where as the configuration file is placed at <code class="literal">/etc/sysconfig/elasticsearch</code>. Like the debian package the RPM package is not started by default after installation, you have to do this manually by entering the following commands</p><pre class="programlisting prettyprint lang-sh">sudo /sbin/chkconfig --add elasticsearch
sudo service elasticsearch start</pre><h5><a id="_using_systemd"></a>Using systemd</h5><p>Distributions like SUSE do not use the <code class="literal">chkconfig</code> tool to register services, but rather <code class="literal">systemd</code> and its command <code class="literal">/bin/systemctl</code> to start and stop services (at least in newer versions, otherwise use the <code class="literal">chkconfig</code> commands above). The configuration file is also placed at <code class="literal">/etc/sysconfig/elasticsearch</code>. After installing the RPM, you have to change the systemd configuration and then start up elasticsearch</p><pre class="programlisting prettyprint lang-sh">sudo /bin/systemctl daemon-reload
sudo /bin/systemctl enable elasticsearch.service
sudo /bin/systemctl start elasticsearch.service</pre><p>Also note that changing the <code class="literal">MAX_MAP_COUNT</code> setting in <code class="literal">/etc/sysconfig/elasticsearch</code> does not have any effect, you will have to change it in <code class="literal">/usr/lib/sysctl.d/elasticsearch.conf</code> in order to have it applied at startup.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="setup-service-win"></a>Running as a Service on Windows</h2></div></div></div><p>Windows users can configure Elasticsearch to run as a service to run in the background or start automatically
at startup without any user interaction.
This can be achieved through <code class="literal">service.bat</code> script under <code class="literal">bin/</code> folder which allows one to install,
remove, manage or configure the service and potentially start and stop the service, all from the command-line.</p><pre class="programlisting prettyprint lang-sh">c:\elasticsearch-0.90.5\bin&gt;service

Usage: service.bat install|remove|start|stop|manager [SERVICE_ID]</pre><p>The script requires one parameter (the command to execute) followed by an optional one indicating the service
id (useful when installing multiple Elasticsearch services).</p><p>The commands available are:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">install</code>
</p>
</td><td valign="top">
<p>
Install Elasticsearch as a service
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">remove</code>
</p>
</td><td valign="top">
<p>
Remove the installed Elasticsearch service (and stop the service if started)
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">start</code>
</p>
</td><td valign="top">
<p>
Start the Elasticsearch service (if installed)
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">stop</code>
</p>
</td><td valign="top">
<p>
Stop the Elasticsearch service (if started)
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">manager</code>
</p>
</td><td valign="top">
<p>
Start a GUI for managing the installed service
</p>
</td></tr></tbody></table></div><p>Note that the environment configuration options available during the installation are copied and will be used during
the service lifecycle. This means any changes made to them after the installation will not be picked up unless
the service is reinstalled.</p><p>Based on the architecture of the available JDK/JRE (set through <code class="literal">JAVA_HOME</code>), the appropriate 64-bit(x64) or 32-bit(x86)
service will be installed. This information is made available during install:</p><pre class="programlisting prettyprint lang-sh">c:\elasticsearch-0.90.5\bin&gt;service install
Installing service      :  "elasticsearch-service-x64"
Using JAVA_HOME (64-bit):  "c:\jvm\jdk1.7"
The service 'elasticsearch-service-x64' has been installed.</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>While a JRE can be used for the Elasticsearch service, due to its use of a client VM (as oppose to a server JVM which
offers better performance for long-running applications) its usage is discouraged and a warning will be issued.</p></div></div><h3><a id="_customizing_service_settings"></a>Customizing service settings</h3><p>There are two ways to customize the service settings:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Manager GUI
</span></dt><dd>
accessible through <code class="literal">manager</code> command, the GUI offers insight into the installed service including its status, startup type,
JVM, start and stop settings among other things. Simply invoking <code class="literal">service.bat</code> from the command-line with the aforementioned option
will open up the manager window:
</dd></dl></div><div class="informalfigure"><div class="mediaobject" align="center"><img src="images/service-manager-win.png" align="middle" alt="Windows Service Manager GUI" /></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Customizing <code class="literal">service.bat</code>
</span></dt><dd>
at its core, <code class="literal">service.bat</code> relies on <a class="ulink" href="http://commons.apache.org/proper/commons-daemon/" target="_top">Apache Commons Daemon</a> project
to install the services. For full flexibility such as customizing the user under which the service runs, one can modify the installation
parameters to tweak all the parameters accordingly. Do note that this requires reinstalling the service for the new settings to be applied.
</dd></dl></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="setup-dir-layout"></a>Directory Layout</h2></div></div></div><p>The directory layout of an installation is as follows:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top">Type </th><th align="left" valign="top">Description </th><th align="left" valign="top">Default Location </th><th align="left" valign="top">Setting</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>home</strong></span></p></td><td align="left" valign="top"><p>Home of elasticsearch installation</p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p><code class="literal">path.home</code></p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>bin</strong></span></p></td><td align="left" valign="top"><p>Binary scripts including <code class="literal">elasticsearch</code> to start a node</p></td><td align="left" valign="top"><p><code class="literal">{path.home}/bin</code></p></td><td align="left" valign="top"><p></p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>conf</strong></span></p></td><td align="left" valign="top"><p>Configuration files including <code class="literal">elasticsearch.yml</code></p></td><td align="left" valign="top"><p><code class="literal">{path.home}/config</code></p></td><td align="left" valign="top"><p><code class="literal">path.conf</code></p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>data</strong></span></p></td><td align="left" valign="top"><p>The location of the data files of each index / shard allocated
on the node. Can hold multiple locations.</p></td><td align="left" valign="top"><p><code class="literal">{path.home}/data</code></p></td><td align="left" valign="top"><p><code class="literal">path.data</code></p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>work</strong></span></p></td><td align="left" valign="top"><p>Temporal files that are used by different nodes.</p></td><td align="left" valign="top"><p><code class="literal">{path.home}/work</code></p></td><td align="left" valign="top"><p><code class="literal">path.work</code></p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>logs</strong></span></p></td><td align="left" valign="top"><p>Log files location</p></td><td align="left" valign="top"><p><code class="literal">{path.home}/logs</code></p></td><td align="left" valign="top"><p><code class="literal">path.logs</code></p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>plugins</strong></span></p></td><td align="left" valign="top"><p>Plugin files location. Each plugin will be contained in a subdirectory.</p></td><td align="left" valign="top"><p><code class="literal">{path.home}/plugins</code></p></td><td align="left" valign="top"><p><code class="literal">path.plugins</code></p></td></tr></tbody></table></div><p>The multiple data locations allows to stripe it. The striping is simple,
placing whole files in one of the locations, and deciding where to place
the file based on the value of the <code class="literal">index.store.distributor</code> setting:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">least_used</code> (default) always selects the directory with the most
available space
</li><li class="listitem">
<code class="literal">random</code> selects directories at random. The probability of selecting
a particular directory is proportional to amount of available space in
this directory.
</li></ul></div><p>Note, there are no multiple copies of the same data, in that, its
similar to RAID 0. Though simple, it should provide a good solution for
people that donât want to mess with RAID. Here is how it is configured:</p><pre class="screen">path.data: /mnt/first,/mnt/second</pre><p>Or the in an array format:</p><pre class="screen">path.data: ["/mnt/first", "/mnt/second"]</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="setup-repositories"></a>Repositories</h2></div></div></div><p>We also have repositories available for APT and YUM based distributions.</p><p>We have split the major versions in separate urls to avoid accidental upgrades across major version.
For all 0.90.x releases use 0.90 as version number, for 1.0.x use 1.0, etc.</p><h3><a id="_apt"></a>APT</h3><p>Download and install the Public Signing Key</p><pre class="programlisting prettyprint lang-sh">wget -O - http://packages.elasticsearch.org/GPG-KEY-elasticsearch | apt-key add -</pre><p>Add the following to your /etc/apt/sources.list to enable the repository</p><pre class="programlisting prettyprint lang-sh">deb http://packages.elasticsearch.org/elasticsearch/0.90/debian stable main</pre><p>Run apt-get update and the repository is ready for use.</p><h3><a id="_yum"></a>YUM</h3><p>Download and install the Public Signing Key</p><pre class="programlisting prettyprint lang-sh">rpm --import http://packages.elasticsearch.org/GPG-KEY-elasticsearch</pre><p>Add the following in your /etc/yum.repos.d/ directory</p><pre class="programlisting prettyprint lang-sh">[elasticsearch-0.90]
name=Elasticsearch repository for 0.90.x packages
baseurl=http://packages.elasticsearch.org/elasticsearch/0.90/centos
gpgcheck=1
gpgkey=http://packages.elasticsearch.org/GPG-KEY-elasticsearch
enabled=1</pre><p>And your repository is ready for use.</p></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="breaking-changes"></a>Breaking changes in 1.0</h1></div></div></div><div class="partintro"><div></div><p>This section discusses the changes that you need to be aware of when migrating
your application to Elasticsearch 1.0.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_system_and_settings"></a>System and settings</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Elasticsearch now runs in the foreground by default.  There is no more <code class="literal">-f</code>
  flag on the command line.  Instead, to run elasticsearch as a daemon, use
  the <code class="literal">-d</code> flag:
</li></ul></div><pre class="programlisting prettyprint lang-sh">./bin/elasticsearch -d</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Command line settings can now be passed without the <code class="literal">-Des.</code> prefix, for
  instance:
</li></ul></div><pre class="programlisting prettyprint lang-sh">./bin/elasticsearch --node.name=search_1 --cluster.name=production</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Elasticsearch on 64 bit Linux now uses <a class="link" href="#mmapfs" title="MMap FS"><code class="literal">mmapfs</code></a> by default.  Make
  sure that you set <a class="link" href="#setup-service" title="Running As a Service on Linux"><code class="literal">MAX_MAP_COUNT</code></a> to a sufficiently high
  number.  The RPM and Debian packages default this value to <code class="literal">262144</code>.
</li><li class="listitem">
The RPM and Debian packages no longer start Elasticsearch by default.
</li><li class="listitem"><p class="simpara">
The <code class="literal">cluster.routing.allocation</code> settings (<code class="literal">disable_allocation</code>,
  <code class="literal">disable_new_allocation</code> and <code class="literal">disable_replica_location</code>) have been
  <a class="link" href="#modules-cluster" title="Cluster">replaced by the single setting</a>:
</p><pre class="programlisting prettyprint lang-yaml">cluster.routing.allocation.enable: all|primaries|new_primaries|none</pre></li></ul></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_stats_and_info_apis"></a>Stats and Info APIs</h2></div></div></div><p>The <a class="link" href="#cluster-state" title="Cluster State"><code class="literal">cluster_state</code></a>, <a class="link" href="#cluster-nodes-info" title="Nodes Info"><code class="literal">nodes_info</code></a>,
<a class="link" href="#cluster-nodes-stats" title="Nodes Stats"><code class="literal">nodes_stats</code></a> and <a class="link" href="#indices-stats" title="Indices Stats"><code class="literal">indices_stats</code></a>
APIs have all been changed to make their format more RESTful and less clumsy.</p><p>For instance, if you just want the <code class="literal">nodes</code> section of the the <code class="literal">cluster_state</code>,
instead of:</p><pre class="programlisting prettyprint lang-sh">GET /_cluster/state?filter_metadata&amp;filter_routing_table&amp;filter_blocks</pre><p>you now use:</p><pre class="programlisting prettyprint lang-sh">GET /_cluster/state/nodes</pre><p>Simliarly for the <code class="literal">nodes_stats</code> API, if you want the <code class="literal">transport</code> and <code class="literal">http</code>
metrics only, instead of:</p><pre class="programlisting prettyprint lang-sh">GET /_nodes/stats?clear&amp;transport&amp;http</pre><p>you now use:</p><pre class="programlisting prettyprint lang-sh">GET /_nodes/stats/transport,http</pre><p>See the links above for full details.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_indices_apis"></a>Indices APIs</h2></div></div></div><p>The <code class="literal">mapping</code>, <code class="literal">alias</code>, <code class="literal">settings</code>, and <code class="literal">warmer</code> index APIs are all similar
but there are subtle differences in the order of the URL and the response
body.  For instance, adding a mapping and a warmer look slightly different:</p><pre class="programlisting prettyprint lang-sh">PUT /{index}/{type}/_mapping
PUT /{index}/_warmer/{name}</pre><p>These URLs have been unified as:</p><pre class="programlisting prettyprint lang-sh">PUT /{indices}/_mapping/{type}
PUT /{indices}/_alias/{name}
PUT /{indices}/_warmer/{name}

GET /{indices}/_mapping/{types}
GET /{indices}/_alias/{names}
GET /{indices}/_settings/{names}
GET /{indices}/_warmer/{names}

DELETE /{indices}/_mapping/{types}
DELETE /{indices}/_alias/{names}
DELETE /{indices}/_warmer/{names}</pre><p>All of the <code class="literal">{indices}</code>, <code class="literal">{types}</code> and <code class="literal">{names}</code> parameters can be replaced by:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">_all</code>, <code class="literal">*</code> or blank (ie left out altogether), all of which mean âallâ
</li><li class="listitem">
wildcards like <code class="literal">test*</code>
</li><li class="listitem">
comma-separated lists: <code class="literal">index_1,test_*</code>
</li></ul></div><p>The only exception is <code class="literal">DELETE</code> which doesnât accept blank (missing)
parameters. If you want to delete something, you should be specific.</p><p>Similarly, the return values for <code class="literal">GET</code> have been unified with the following
rules:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Only return values that exist.  If you try to <code class="literal">GET</code> a mapping which doesnât
  exist, then the result will be an empty object: <code class="literal">{}</code>. We no longer throw a
  <code class="literal">404</code> if the requested mapping/warmer/alias/setting doesnât exist.
</li><li class="listitem"><p class="simpara">
The response format always has the index name, then the section, then the
  element name, for instance:
</p><pre class="programlisting prettyprint lang-json">{
    "my_index": {
        "mappings": {
            "my_type": {...}
        }
    }
}</pre><p class="simpara">This is a breaking change for the <code class="literal">get_mapping</code> API.</p></li></ul></div><p>In the future we will also provide plural versions to allow putting multiple mappings etc in a single request.</p><p>See <a class="link" href="#indices-put-mapping" title="Put Mapping"><code class="literal">put-mapping</code></a>, <a class="link" href="#indices-get-mapping" title="Get Mapping"><code class="literal">get-
mapping</code></a>, <a class="link" href="#indices-get-field-mapping" title="Get Field Mapping"><code class="literal">get-field-mapping</code></a>,
<a class="link" href="#indices-delete-mapping" title="Delete Mapping"><code class="literal">delete-mapping</code></a>,
<a class="link" href="#indices-update-settings" title="Update Indices Settings"><code class="literal">update-settings</code></a>, <a class="link" href="#indices-get-settings" title="Get Settings"><code class="literal">get-settings</code></a>,
<a class="link" href="#indices-warmers" title="Warmers"><code class="literal">warmers</code></a>, and <a class="link" href="#indices-aliases" title="Index Aliases"><code class="literal">aliases</code></a> for more details.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_index_request"></a>Index request</h2></div></div></div><p>Previously a document could be indexed as itself, or wrapped in an outer
object which specified the <code class="literal">type</code> name:</p><pre class="programlisting prettyprint lang-json">PUT /my_index/my_type/1
{
  "my_type": {
     ... doc fields ...
  }
}</pre><p>This led to some ambiguity when a document also included a field with the same
name as the <code class="literal">type</code>.  We no longer accept the outer <code class="literal">type</code> wrapper, but this
behaviour can be reenabled on an index-by-index basis with the setting:
<code class="literal">index.mapping.allow_type_wrapper</code>.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_search_requests"></a>Search requests</h2></div></div></div><p>While the <code class="literal">search</code> API takes a top-level <code class="literal">query</code> parameter, the
<a class="link" href="#search-count" title="Count API"><code class="literal">count</code></a>, <a class="link" href="#docs-delete-by-query" title="Delete By Query API"><code class="literal">delete-by-query</code></a> and
<a class="link" href="#search-validate" title="Validate API"><code class="literal">validate-query</code></a> requests expected the whole body to be a
query. These now <span class="emphasis"><em>require</em></span> a top-level <code class="literal">query</code> parameter:</p><pre class="programlisting prettyprint lang-json">GET /_count
{
    "query": {
        "match": {
            "title": "Interesting stuff"
        }
    }
}</pre><p>Also, the top-level <code class="literal">filter</code> parameter in search has been renamed to
<a class="link" href="#search-request-post-filter" title="Post filter"><code class="literal">post_filter</code></a>, to indicate that it should not
be used as the primary way to filter search results (use a
<a class="link" href="#query-dsl-filtered-query" title="Filtered Query"><code class="literal">filtered</code> query</a> instead), but only to filter
results AFTER facets/aggregations have been calculated.</p><p>This example counts the top colors in all matching docs, but only returns docs
with color <code class="literal">red</code>:</p><pre class="programlisting prettyprint lang-json">GET /_search
{
    "query": {
        "match_all": {}
    },
    "aggs": {
        "colors": {
            "terms": { "field": "color" }
        }
    },
    "post_filter": {
        "term": {
            "color": "red"
        }
    }
}</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_multi_fields"></a>Multi-fields</h2></div></div></div><p>Multi-fields are dead! Long live multi-fields!  Well, the field type
<code class="literal">multi_field</code> has been removed.  Instead, any of the core field types
(excluding <code class="literal">object</code> and <code class="literal">nested</code>) now accept a <code class="literal">fields</code> parameter.  Itâs the
same thing, but nicer. Instead of:</p><pre class="programlisting prettyprint lang-json">"title": {
    "type": "multi_field",
    "fields": {
        "title": { "type": "string" },
        "raw":   { "type": "string", "index": "not_analyzed" }
    }
}</pre><p>you can now write:</p><pre class="programlisting prettyprint lang-json">"title": {
    "type": "string",
    "fields": {
        "raw":   { "type": "string", "index": "not_analyzed" }
    }
}</pre><p>Existing multi-fields will be upgraded to the new format automatically.</p><p>Also, instead of having to use the arcane <code class="literal">path</code> and <code class="literal">index_name</code> parameters
in order to index multiple fields into a single âcustom <code class="literal">_all</code> fieldâ, you
can now use the <a class="link" href="#copy-to" title="Copy to field"><code class="literal">copy_to</code> parameter</a>.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_stopwords"></a>Stopwords</h2></div></div></div><p>Previously, the <a class="link" href="#analysis-standard-analyzer" title="Standard Analyzer"><code class="literal">standard</code></a> and
<a class="link" href="#analysis-pattern-analyzer" title="Pattern Analyzer"><code class="literal">pattern</code></a> analyzers used the list of English stopwords
by default, which caused some hard to debug indexing issues.  Now they are set to
use the empty stopwords list (ie <code class="literal">_none_</code>) instead.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_dates_without_years"></a>Dates without years</h2></div></div></div><p>When dates are specified without a year, for example: <code class="literal">Dec 15 10:00:00</code> they
are treated as dates in 2000 during indexing and range searchesâ¦ except for
the upper included bound <code class="literal">lte</code> where they were treated as dates in 1970!  Now,
all <a class="ulink" href="https://github.com/elasticsearch/elasticsearch/issues/4451" target="_top">dates without years</a>
use <code class="literal">1970</code> as the default.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_parameters"></a>Parameters</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Geo queries used to use <code class="literal">miles</code> as the default unit.  And we
  <a class="ulink" href="http://en.wikipedia.org/wiki/Mars_Climate_Orbiter" target="_top">all know what
  happened at NASA</a> because of that decision.  The new default unit is
  <a class="ulink" href="https://github.com/elasticsearch/elasticsearch/issues/4515" target="_top"><code class="literal">meters</code></a>.
</li><li class="listitem">
For all queries that support <span class="emphasis"><em>fuzziness</em></span>, the <code class="literal">min_similarity</code>, <code class="literal">fuzziness</code>
  and <code class="literal">edit_distance</code> parameters have been unified as the single parameter
  <code class="literal">fuzziness</code>.  See <a class="xref" href="#fuzziness" title="Fuzziness">the section called âFuzzinessâ</a> for details of accepted values.
</li><li class="listitem">
The <code class="literal">ignore_missing</code> parameter has been replaced by the <code class="literal">expand_wildcards</code>,
  <code class="literal">ignore_unavailable</code> and <code class="literal">allow_no_indices</code> parameters, all of which have
  sensible defaults.  See <a class="link" href="#multi-index" title="Multiple Indices">the multi-index docs</a> for more.
</li><li class="listitem"><p class="simpara">
An index name (or pattern) is now required for destructive operations like
  deleting indices:
</p><pre class="programlisting prettyprint lang-sh"># v0.90 - delete all indices:
DELETE /

# v1.0 - delete all indices:
DELETE /_all
DELETE /*</pre><p class="simpara">Setting <code class="literal">action.destructive_requires_name</code> to <code class="literal">true</code> provides further safety
by disabling wildcard expansion on destructive actions.</p></li></ul></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_return_values"></a>Return values</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The <code class="literal">ok</code> return value has been removed from all response bodies as it added
  no useful information.
</li><li class="listitem">
The <code class="literal">found</code>, <code class="literal">not_found</code> and <code class="literal">exists</code> return values have been unified as
  <code class="literal">found</code> on all relevant APIs.
</li><li class="listitem"><p class="simpara">
Field values, in response to the <a class="link" href="#search-request-fields" title="Fields"><code class="literal">fields</code></a>
  parameter, are now always returned as arrays.  A field could have single or
  multiple values, which meant that sometimes they were returned as scalars
  and sometimes as arrays.  By always returning arrays, this simplifies user
  code.  The only exception to this rule is when <code class="literal">fields</code> is used to retrieve
  metadata like the <code class="literal">routing</code> value, which are always singular.  Metadata
  fields are always returned as scalars.
</p><p class="simpara">The <code class="literal">fields</code> parameter is intended to be used for retrieving stored fields,
rather than for fields extracted from the <code class="literal">_source</code>. That means that it can no
longer be used to return whole objects and it no longer accepts the
<code class="literal">_source.fieldname</code> format. For these you should use the
<a class="link" href="#search-request-source-filtering" title="Source filtering"><code class="literal">_source</code>  <code class="literal">_source_include</code> and <code class="literal">_source_exclude</code></a>
parameters instead.</p></li><li class="listitem"><p class="simpara">
Settings, like <code class="literal">index.analysis.analyzer.default</code> are now returned as proper
  nested JSON objects, which makes them easier to work with programatically:
</p><pre class="programlisting prettyprint lang-json">{
    "index": {
        "analysis": {
            "analyzer": {
                "default": xxx
            }
        }
    }
}</pre><p class="simpara">You can choose to return them in flattened format by passing <code class="literal">?flat_settings</code>
in the query string.</p></li><li class="listitem">
The <a class="link" href="#indices-analyze" title="Analyze"><code class="literal">analyze</code></a> API no longer supports the text response
  format, but does support JSON and YAML.
</li></ul></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_deprecations"></a>Deprecations</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The <code class="literal">text</code> query has been removed.  Use the
  <a class="link" href="#query-dsl-match-query" title="Match Query"><code class="literal">match</code></a> query instead.
</li><li class="listitem">
The <code class="literal">field</code> query has been removed.  Use the
  <a class="link" href="#query-dsl-query-string-query" title="Query String Query"><code class="literal">query_string</code></a> query instead.
</li><li class="listitem">
Per-document boosting with the <a class="link" href="#mapping-boost-field" title="_boost"><code class="literal">_boost</code></a> field has
  been removed.  You can use the
  <a class="link" href="#function-score-instead-of-boost" title="Function score instead of boost"><code class="literal">function_score</code></a> instead.
</li><li class="listitem">
The <code class="literal">path</code> parameter in mappings has been deprecated. Use the
  <a class="link" href="#copy-to" title="Copy to field"><code class="literal">copy_to</code></a> parameter instead.
</li><li class="listitem">
The <code class="literal">custom_score</code> and <code class="literal">custom_boost_score</code> is no longer supported. You can
  use <a class="link" href="#query-dsl-function-score-query" title="Function Score Query"><code class="literal">function_score</code></a> instead.
</li></ul></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_percolator"></a>Percolator</h2></div></div></div><p>The percolator has been redesigned and because of this the dedicated <code class="literal">_percolator</code> index is no longer used by the percolator,
but instead the percolator works with a dedicated <code class="literal">.percolator</code> type. Read the <a class="ulink" href="http://www.elasticsearch.org/blog/percolator-redesign-blog-post/" target="_top">redesigned percolator</a>
blog post for the reasons why the percolator has been redesigned.</p><p>Elasticsearch will <span class="strong"><strong>not</strong></span> delete the <code class="literal">_percolator</code> index when upgrading, only the percolate api will not use the queries
stored in the <code class="literal">_percolator</code> index. In order to use the already stored queries, you can just re-index the queries from the
<code class="literal">_percolator</code> index into any index under the reserved <code class="literal">.percolator</code> type. The format in which the percolate queries
were stored has <span class="strong"><strong>not</strong></span> been changed. So a simple script that does a scan search to retrieve all the percolator queries
and then does a bulk request into another index should be sufficient.</p></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="api-conventions"></a>API Conventions</h1></div></div></div><div class="partintro"><div></div><p>The <span class="strong"><strong>elasticsearch</strong></span> REST APIs are exposed using:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="link" href="#modules-http" title="HTTP">JSON over HTTP</a>,
</li><li class="listitem">
<a class="link" href="#modules-thrift" title="Thrift">thrift</a>,
</li><li class="listitem">
<a class="link" href="#modules-memcached" title="memcached">memcached</a>.
</li></ul></div><p>The conventions listed in this chapter can be applied throughout the REST
API, unless otherwise specified.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="#multi-index" title="Multiple Indices"><em>Multiple Indices</em></a>
</li><li class="listitem">
<a class="xref" href="#common-options" title="Common options"><em>Common options</em></a>
</li></ul></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="multi-index"></a>Multiple Indices</h2></div></div></div><p>Most APIs that refer to an <code class="literal">index</code> parameter support execution across multiple indices,
using simple <code class="literal">test1,test2,test3</code> notation (or <code class="literal">_all</code> for all indices). It also
support wildcards, for example: <code class="literal">test*</code>, and the ability to "add" (<code class="literal">+</code>)
and "remove" (<code class="literal">-</code>), for example: <code class="literal">+test*,-test3</code>.</p><p>All multi indices API support the following url query string parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">ignore_unavailable</code>
</span></dt><dd>
Controls whether to ignore if any specified indices are unavailable, this
includes indices that donât exist or closed indices. Either <code class="literal">true</code> or <code class="literal">false</code>
can be specified.
</dd><dt><span class="term">
<code class="literal">allow_no_indices</code>
</span></dt><dd>
Controls whether to fail if a wildcard indices expressions results into no
concrete indices. Either <code class="literal">true</code> or <code class="literal">false</code> can be specified. For example if
the wildcard expression <code class="literal">foo*</code> is specified and no indices are available that
start with <code class="literal">foo</code> then depending on this setting the request will fail. This
setting is also applicable when <code class="literal">_all</code>, <code class="literal">*</code> or no index has been specified.
</dd><dt><span class="term">
<code class="literal">expand_wildcards</code>
</span></dt><dd>
Controls to what kind of concrete indices wildcard indices expression expand
to. If <code class="literal">open</code> is specified then the wildcard expression if expanded to only
open indices and if <code class="literal">closed</code> is specified then the wildcard expression if
expanded only to closed indices. Also both values (<code class="literal">open,closed</code>) can be
specified to expand to all indices.
</dd></dl></div><p>The defaults settings for the above parameters depend on the api being used.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Single index APIs such as the <a class="xref" href="#docs" title="Document APIs">Document APIs</a> and the
<a class="link" href="#indices-aliases" title="Index Aliases">single-index <code class="literal">alias</code> APIs</a> do not support multiple indices.</p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="common-options"></a>Common options</h2></div></div></div><p>The following options can be applied to all of the REST APIs.</p><h3><a id="_pretty_results"></a>Pretty Results</h3><p>When appending <code class="literal">?pretty=true</code> to any request made, the JSON returned
will be pretty formatted (use it for debugging only!). Another option is
to set <code class="literal">format=yaml</code> which will cause the result to be returned in the
(sometimes) more readable yaml format.</p><h3><a id="_human_readable_output"></a>Human readable output</h3><p>Statistics are returned in a format suitable for humans
(eg <code class="literal">"exists_time": "1h"</code> or <code class="literal">"size": "1kb"</code>) and for computers
(eg <code class="literal">"exists_time_in_millis": 3600000`</code> or <code class="literal">"size_in_bytes": 1024</code>).
The human readable values can be turned off by adding <code class="literal">?human=false</code>
to the query string. This makes sense when the stats results are
being consumed by a monitoring tool, rather than intended for human
consumption.  The default for the <code class="literal">human</code> flag is
<code class="literal">false</code>. <span class="added">
      [<span class="version">1.00.Beta</span>]
      <span class="detail">Added in 1.00.Beta. Previously defaulted to <code class="literal">true</code>.</span></span></p><h3><a id="_flat_settings"></a>Flat Settings</h3><p>The <code class="literal">flat_settings</code> flag affects rendering of the lists of settings. When
flat_settings` flag is <code class="literal">true</code> settings are returned in a flat format:</p><pre class="programlisting prettyprint lang-js">{
  "persistent" : { },
  "transient" : {
    "discovery.zen.minimum_master_nodes" : "1"
  }
}</pre><p>When the <code class="literal">flat_settings</code> flag is <code class="literal">false</code> settings are returned in a more
human readable structured format:</p><pre class="programlisting prettyprint lang-js">{
  "persistent" : { },
  "transient" : {
    "discovery" : {
      "zen" : {
        "minimum_master_nodes" : "1"
      }
    }
  }
}</pre><p>By default the <code class="literal">flat_settings</code> is set to <code class="literal">false</code>.</p><h3><a id="_parameters_2"></a>Parameters</h3><p>Rest parameters (when using HTTP, map to HTTP URL parameters) follow the
convention of using underscore casing.</p><h3><a id="_boolean_values"></a>Boolean Values</h3><p>All REST APIs parameters (both request parameters and JSON body) support
providing boolean "false" as the values: <code class="literal">false</code>, <code class="literal">0</code>, <code class="literal">no</code> and <code class="literal">off</code>.
All other values are considered "true". Note, this is not related to
fields within a document indexed treated as boolean fields.</p><h3><a id="_number_values"></a>Number Values</h3><p>All REST APIs support providing numbered parameters as <code class="literal">string</code> on top
of supporting the native JSON number types.</p><h3><a id="time-units"></a>Time units</h3><p>Whenever durations need to be specified, eg for a <code class="literal">timeout</code> parameter, the duration
can be specified as a whole number representing time in milliseconds, or as a time value like <code class="literal">2d</code> for 2 days.  The supported units are:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">y</code>
</p>
</td><td valign="top">
<p>
Year
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">M</code>
</p>
</td><td valign="top">
<p>
Month
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">w</code>
</p>
</td><td valign="top">
<p>
Week
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">h</code>
</p>
</td><td valign="top">
<p>
Hour
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">m</code>
</p>
</td><td valign="top">
<p>
Minute
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">s</code>
</p>
</td><td valign="top">
<p>
Second
</p>
</td></tr></tbody></table></div><h3><a id="distance-units"></a>Distance Units</h3><p>Wherever distances need to be specified, such as the <code class="literal">distance</code> parameter in
the <a class="xref" href="#query-dsl-geo-distance-filter" title="Geo Distance Filter">Geo Distance Filter</a>) or the <code class="literal">precision</code> parameter in the
<a class="xref" href="#query-dsl-geohash-cell-filter" title="Geohash Cell Filter">Geohash Cell Filter</a>, the default unit if none is specified is
the meter. Distances can be specified in other units, such as <code class="literal">"1km"</code> or
<code class="literal">"2mi"</code> (2 miles).</p><p>The full list of units is listed below:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
Mile
</p>
</td><td valign="top">
<p>
<code class="literal">mi</code> or <code class="literal">miles</code>
</p>
</td></tr><tr><td valign="top">
<p>
Yard
</p>
</td><td valign="top">
<p>
<code class="literal">yd</code> or <code class="literal">yards</code>
</p>
</td></tr><tr><td valign="top">
<p>
Feet
</p>
</td><td valign="top">
<p>
<code class="literal">ft</code> or <code class="literal">feet</code>
</p>
</td></tr><tr><td valign="top">
<p>
Inch
</p>
</td><td valign="top">
<p>
<code class="literal">in</code> or <code class="literal">inch</code>
</p>
</td></tr><tr><td valign="top">
<p>
Kilometer
</p>
</td><td valign="top">
<p>
<code class="literal">km</code> or <code class="literal">kilometers</code>
</p>
</td></tr><tr><td valign="top">
<p>
Meter
</p>
</td><td valign="top">
<p>
<code class="literal">m</code> or <code class="literal">meters</code>
</p>
</td></tr><tr><td valign="top">
<p>
Centimeter
</p>
</td><td valign="top">
<p>
<code class="literal">cm</code> or <code class="literal">centimeters</code>
</p>
</td></tr><tr><td valign="top">
<p>
Millimeter
</p>
</td><td valign="top">
<p>
<code class="literal">mm</code> or <code class="literal">millimeters</code>
</p>
</td></tr><tr><td valign="top">
<p>
Nautical mile
</p>
</td><td valign="top">
<p>
<code class="literal">NM</code>, <code class="literal">nmi</code> or <code class="literal">nauticalmiles</code>
</p>
</td></tr></tbody></table></div><h3><a id="fuzziness"></a>Fuzziness</h3><p>Some queries and APIs support parameters to allow inexact <span class="emphasis"><em>fuzzy</em></span> matching,
using the <code class="literal">fuzziness</code> parameter. The <code class="literal">fuzziness</code> parameter is context
sensitive which means that it depends on the type of the field being queried:</p><h4><a id="_numeric_date_and_ipv4_fields"></a>Numeric, date and IPv4 fields</h4><p>When querying numeric, date and IPv4 fields, <code class="literal">fuzziness</code> is interpreted as a
`+/- margin. It behaves like a <a class="xref" href="#query-dsl-range-query" title="Range Query">Range Query</a> where:</p><pre class="literallayout">-fuzziness &lt;= field value &lt;= +fuzziness</pre><p>The <code class="literal">fuzziness</code> parameter should be set to a numeric value, eg <code class="literal">2</code> or <code class="literal">2.0</code>. A
<code class="literal">date</code> field interprets a long as milliseconds, but also accepts a string
containing a time valueâââ<code class="literal">"1h"</code>âââas explained in <a class="xref" href="#time-units" title="Time units">the section called âTime unitsâ</a>. An <code class="literal">ip</code>
field accepts a long or another IPv4 address (which will be converted into a
long).</p><h4><a id="_string_fields"></a>String fields</h4><p>When querying <code class="literal">string</code> fields, <code class="literal">fuzziness</code> is interpreted as a
<a class="ulink" href="http://en.wikipedia.org/wiki/Levenshtein_distance" target="_top">Levenshtein Edit Distance</a>âââthe number of one character changes that need to be made to one string to
make it the same as another string.</p><p>The <code class="literal">fuzziness</code> parameter can be specified as:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">0</code>, <code class="literal">1</code>, <code class="literal">2</code>
</span></dt><dd>
the maximum allowed Levenshtein Edit Distance (or number of edits)
</dd><dt><span class="term">
<code class="literal">AUTO</code>
</span></dt><dd><p class="simpara">generates an edit distance based on the length of the term. For lengths:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">0..1</code>
</span></dt><dd>
must match exactly
</dd><dt><span class="term">
<code class="literal">1..4</code>
</span></dt><dd>
one edit allowed
</dd><dt><span class="term">
<code class="literal">&gt;4</code>
</span></dt><dd>
two edits allowed
</dd></dl></div><p class="simpara"><code class="literal">AUTO</code> should generally be the preferred value for <code class="literal">fuzziness</code>.</p></dd><dt><span class="term">
<code class="literal">0.0..1.0</code>
</span></dt><dd>
converted into an edit distance using the formula: <code class="literal">length(term) * (1.0 -
fuzziness)</code>, eg a <code class="literal">fuzziness</code> of <code class="literal">0.6</code> with a term of length 10 would result
in an edit distance of <code class="literal">4</code>. Note: in all APIs except for the
<a class="xref" href="#query-dsl-flt-query" title="Fuzzy Like This Query">Fuzzy Like This Query</a>, the maximum allowed edit distance is <code class="literal">2</code>.
</dd></dl></div><h3><a id="_result_casing"></a>Result Casing</h3><p>All REST APIs accept the <code class="literal">case</code> parameter. When set to <code class="literal">camelCase</code>, all
field names in the result will be returned in camel casing, otherwise,
underscore casing will be used. Note, this does not apply to the source
document indexed.</p><h3><a id="_jsonp"></a>JSONP</h3><p>All REST APIs accept a <code class="literal">callback</code> parameter resulting in a
<a class="ulink" href="http://en.wikipedia.org/wiki/JSONP" target="_top">JSONP</a> result.</p><h3><a id="_request_body_in_query_string"></a>Request body in query string</h3><p>For libraries that donât accept a request body for non-POST requests,
you can pass the request body as the <code class="literal">source</code> query string parameter
instead.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="url-access-control"></a>URL-based access control</h2></div></div></div><p>Many users use a proxy with URL-based access control to secure access to
Elasticsearch indices. For <a class="link" href="#search-multi-search" title="Multi Search API">multi-search</a>,
<a class="link" href="#docs-multi-get" title="Multi Get API">multi-get</a> and <a class="link" href="#docs-bulk" title="Bulk API">bulk</a> requests, the user has
the choice of specifying an index in the URL and on each individual request
within the request body. This can make URL-based access control challenging.</p><p>To prevent the user from overriding the index which has been specified in the
URL, add this setting to the <code class="literal">config.yml</code> file:</p><pre class="literallayout">rest.action.multi.allow_explicit_index: false</pre><p>The default value is <code class="literal">true</code>, but when set to <code class="literal">false</code>, Elasticsearch will
reject requests that have an explicit index specified in the request body.</p></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="docs"></a>Document APIs</h1></div></div></div><div class="partintro"><div></div><p>This section describes the following CRUD APIs:</p><div class="itemizedlist"><p class="title"><strong>Single document APIs</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="#docs-index_" title="Index API"><em>Index API</em></a>
</li><li class="listitem">
<a class="xref" href="#docs-get" title="Get API"><em>Get API</em></a>
</li><li class="listitem">
<a class="xref" href="#docs-delete" title="Delete API"><em>Delete API</em></a>
</li><li class="listitem">
<a class="xref" href="#docs-update" title="Update API"><em>Update API</em></a>
</li></ul></div><div class="itemizedlist"><p class="title"><strong>Multi-document APIs</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="#docs-multi-get" title="Multi Get API"><em>Multi Get API</em></a>
</li><li class="listitem">
<a class="xref" href="#docs-bulk" title="Bulk API"><em>Bulk API</em></a>
</li><li class="listitem">
<a class="xref" href="#docs-bulk-udp" title="Bulk UDP API"><em>Bulk UDP API</em></a>
</li><li class="listitem">
<a class="xref" href="#docs-delete-by-query" title="Delete By Query API"><em>Delete By Query API</em></a>
</li></ul></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>All CRUD APIs are single-index APIs. The <code class="literal">index</code> parameter accepts a single
index name, or an <code class="literal">alias</code> which points to a single index.</p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-index_"></a>Index API</h2></div></div></div><p>The index API adds or updates a typed JSON document in a specific index,
making it searchable. The following example inserts the JSON document
into the "twitter" index, under a type called "tweet" with an id of 1:</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT 'http://localhost:9200/twitter/tweet/1' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</pre><p>The result of the above index operation is:</p><pre class="programlisting prettyprint lang-js">{
    "_index" : "twitter",
    "_type" : "tweet",
    "_id" : "1",
    "_version" : 1,
    "created" : true
}</pre><h3><a id="index-creation"></a>Automatic Index Creation</h3><p>The index operation automatically creates an index if it has not been
created before (check out the
<a class="link" href="#indices-create-index" title="Create Index">create index API</a> for manually
creating an index), and also automatically creates a
dynamic type mapping for the specific type if one has not yet been
created (check out the <a class="link" href="#indices-put-mapping" title="Put Mapping">put mapping</a>
API for manually creating a type mapping).</p><p>The mapping itself is very flexible and is schema-free. New fields and
objects will automatically be added to the mapping definition of the
type specified. Check out the <a class="link" href="#mapping" title="Mapping">mapping</a>
section for more information on mapping definitions.</p><p>Note that the format of the JSON document can also include the type (very handy
when using JSON mappers) if the <code class="literal">index.mapping.allow_type_wrapper</code> setting is
set to true, for example:</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/twitter' -d '{
  "settings": {
    "index": {
      "mapping.allow_type_wrapper": true
    }
  }
}'
{"acknowledged":true}

$ curl -XPUT 'http://localhost:9200/twitter/tweet/1' -d '{
    "tweet" : {
        "user" : "kimchy",
        "post_date" : "2009-11-15T14:12:12",
        "message" : "trying out Elasticsearch"
    }
}'</pre><p>Automatic index creation can be disabled by setting
<code class="literal">action.auto_create_index</code> to <code class="literal">false</code> in the config file of all nodes.
Automatic mapping creation can be disabled by setting
<code class="literal">index.mapper.dynamic</code> to <code class="literal">false</code> in the config files of all nodes (or
on the specific index settings).</p><p>Automatic index creation can include a pattern based white/black list,
for example, set <code class="literal">action.auto_create_index</code> to <code class="literal">+aaa*,-bbb*,+ccc*,-*</code> (+
meaning allowed, and - meaning disallowed).</p><h3><a id="index-versioning"></a>Versioning</h3><p>Each indexed document is given a version number. The associated
<code class="literal">version</code> number is returned as part of the response to the index API
request. The index API optionally allows for
<a class="ulink" href="http://en.wikipedia.org/wiki/Optimistic_concurrency_control" target="_top">optimistic
concurrency control</a> when the <code class="literal">version</code> parameter is specified. This
will control the version of the document the operation is intended to be
executed against. A good example of a use case for versioning is
performing a transactional read-then-update. Specifying a <code class="literal">version</code> from
the document initially read ensures no changes have happened in the
meantime (when reading in order to update, it is recommended to set
<code class="literal">preference</code> to <code class="literal">_primary</code>). For example:</p><pre class="programlisting prettyprint lang-js">curl -XPUT 'localhost:9200/twitter/tweet/1?version=2' -d '{
    "message" : "elasticsearch now has versioning support, double cool!"
}'</pre><p><span class="strong"><strong>NOTE:</strong></span> versioning is completely real time, and is not affected by the
near real time aspects of search operations. If no version is provided,
then the operation is executed without any version checks.</p><p>By default, internal versioning is used that starts at 1 and increments
with each update, deletes included. Optionally, the version number can be
supplemented with an external value (for example, if maintained in a
database). To enable this functionality, <code class="literal">version_type</code> should be set to
<code class="literal">external</code>. The value provided must be a numeric, long value greater than 0,
and less than around 9.2e+18. When using the external version type, instead
of checking for a matching version number, the system checks to see if
the version number passed to the index request is greater than the
version of the currently stored document. If true, the document will be
indexed and the new version number used. If the value provided is less
than or equal to the stored documentâs version number, a version
conflict will occur and the index operation will fail.</p><p>A nice side effect is that there is no need to maintain strict ordering
of async indexing operations executed as a result of changes to a source
database, as long as version numbers from the source database are used.
Even the simple case of updating the elasticsearch index using data from
a database is simplified if external versioning is used, as only the
latest version will be used if the index operations are out of order for
whatever reason.</p><h4><a id="_version_types"></a>Version types</h4><p>Next to the <code class="literal">internal</code> &amp; <code class="literal">external</code> version types explained above, Elasticsearch
also supports other types for specific use cases. Here is an overview of
the different version types and their semantics.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">internal</code>
</span></dt><dd>
only index the document if the given version is identical to the version
of the stored document.
</dd><dt><span class="term">
<code class="literal">external</code> or <code class="literal">external_gt</code>
</span></dt><dd>
only index the document if the given version is strictly higher
than the version of the stored document <span class="strong"><strong>or</strong></span> if there is no existing document. The given
version will be used as the new version and will be stored with the new document.
</dd><dt><span class="term">
<code class="literal">external_gte</code>
</span></dt><dd>
only index the document if the given version is <span class="strong"><strong>equal</strong></span> or higher
than the version of the stored document. If there is no existing document
the operation will succeed as well. The given version will be used as the new version
and will be stored with the new document.
</dd><dt><span class="term">
<code class="literal">force</code>
</span></dt><dd>
the document will be indexed regardless of the version of the stored document or if there
is no existing document. The given version will be used as the new version and will be stored
with the new document. This version type is typically used for correcting errors.
</dd></dl></div><p><span class="strong"><strong>NOTE</strong></span>: The <code class="literal">external_gte</code> &amp; <code class="literal">force</code> version types are meant for special use cases and should be used
with care. If used incorrectly, they can result in loss of data.</p><h3><a id="operation-type"></a>Operation Type</h3><p>The index operation also accepts an <code class="literal">op_type</code> that can be used to force
a <code class="literal">create</code> operation, allowing for "put-if-absent" behavior. When
<code class="literal">create</code> is used, the index operation will fail if a document by that id
already exists in the index.</p><p>Here is an example of using the <code class="literal">op_type</code> parameter:</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT 'http://localhost:9200/twitter/tweet/1?op_type=create' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</pre><p>Another option to specify <code class="literal">create</code> is to use the following uri:</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT 'http://localhost:9200/twitter/tweet/1/_create' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</pre><h3><a id="_automatic_id_generation"></a>Automatic ID Generation</h3><p>The index operation can be executed without specifying the id. In such a
case, an id will be generated automatically. In addition, the <code class="literal">op_type</code>
will automatically be set to <code class="literal">create</code>. Here is an example (note the
<span class="strong"><strong>POST</strong></span> used instead of <span class="strong"><strong>PUT</strong></span>):</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/twitter/tweet/' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</pre><p>The result of the above index operation is:</p><pre class="programlisting prettyprint lang-js">{
    "_index" : "twitter",
    "_type" : "tweet",
    "_id" : "6a8ca01c-7896-48e9-81cc-9f70661fcb32",
    "_version" : 1,
    "created" : true
}</pre><h3><a id="index-routing"></a>Routing</h3><p>By default, shard placement â or <code class="literal">routing</code> â is controlled by using a
hash of the documentâs id value. For more explicit control, the value
fed into the hash function used by the router can be directly specified
on a per-operation basis using the <code class="literal">routing</code> parameter. For example:</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/twitter/tweet?routing=kimchy' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</pre><p>In the example above, the "tweet" document is routed to a shard based on
the <code class="literal">routing</code> parameter provided: "kimchy".</p><p>When setting up explicit mapping, the <code class="literal">_routing</code> field can be optionally
used to direct the index operation to extract the routing value from the
document itself. This does come at the (very minimal) cost of an
additional document parsing pass. If the <code class="literal">_routing</code> mapping is defined,
and set to be <code class="literal">required</code>, the index operation will fail if no routing
value is provided or extracted.</p><h3><a id="parent-children"></a>Parents &amp; Children</h3><p>A child document can be indexed by specifying its parent when indexing.
For example:</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT localhost:9200/blogs/blog_tag/1122?parent=1111 -d '{
    "tag" : "something"
}'</pre><p>When indexing a child document, the routing value is automatically set
to be the same as its parent, unless the routing value is explicitly
specified using the <code class="literal">routing</code> parameter.</p><h3><a id="index-timestamp"></a>Timestamp</h3><p>A document can be indexed with a <code class="literal">timestamp</code> associated with it. The
<code class="literal">timestamp</code> value of a document can be set using the <code class="literal">timestamp</code>
parameter. For example:</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT localhost:9200/twitter/tweet/1?timestamp=2009-11-15T14%3A12%3A12 -d '{
    "user" : "kimchy",
    "message" : "trying out Elasticsearch",
}'</pre><p>If the <code class="literal">timestamp</code> value is not provided externally or in the <code class="literal">_source</code>,
the <code class="literal">timestamp</code> will be automatically set to the date the document was
processed by the indexing chain. More information can be found on the
<a class="link" href="#mapping-timestamp-field" title="_timestamp">_timestamp mapping page</a>.</p><h3><a id="index-ttl"></a>TTL</h3><p>A document can be indexed with a <code class="literal">ttl</code> (time to live) associated with
it. Expired documents will be expunged automatically. The expiration
date that will be set for a document with a provided <code class="literal">ttl</code> is relative
to the <code class="literal">timestamp</code> of the document, meaning it can be based on the time
of indexing or on any time provided. The provided <code class="literal">ttl</code> must be strictly
positive and can be a number (in milliseconds) or any valid time value
as shown in the following examples:</p><pre class="programlisting prettyprint lang-js">curl -XPUT 'http://localhost:9200/twitter/tweet/1?ttl=86400000' -d '{
    "user": "kimchy",
    "message": "Trying out elasticsearch, so far so good?"
}'</pre><pre class="programlisting prettyprint lang-js">curl -XPUT 'http://localhost:9200/twitter/tweet/1?ttl=1d' -d '{
    "user": "kimchy",
    "message": "Trying out elasticsearch, so far so good?"
}'</pre><pre class="programlisting prettyprint lang-js">curl -XPUT 'http://localhost:9200/twitter/tweet/1' -d '{
    "_ttl": "1d",
    "user": "kimchy",
    "message": "Trying out elasticsearch, so far so good?"
}'</pre><p>More information can be found on the
<a class="link" href="#mapping-ttl-field" title="_ttl">_ttl mapping page</a>.</p><h3><a id="index-distributed"></a>Distributed</h3><p>The index operation is directed to the primary shard based on its route
(see the Routing section above) and performed on the actual node
containing this shard. After the primary shard completes the operation,
if needed, the update is distributed to applicable replicas.</p><h3><a id="index-consistency"></a>Write Consistency</h3><p>To prevent writes from taking place on the "wrong" side of a network
partition, by default, index operations only succeed if a quorum
(&gt;replicas/2+1) of active shards are available. This default can be
overridden on a node-by-node basis using the <code class="literal">action.write_consistency</code>
setting. To alter this behavior per-operation, the <code class="literal">consistency</code> request
parameter can be used.</p><p>Valid write consistency values are <code class="literal">one</code>, <code class="literal">quorum</code>, and <code class="literal">all</code>.</p><h3><a id="index-replication"></a>Asynchronous Replication</h3><p>By default, the index operation only returns after all shards within the
replication group have indexed the document (sync replication). To
enable asynchronous replication, causing the replication process to take
place in the background, set the <code class="literal">replication</code> parameter to <code class="literal">async</code>.
When asynchronous replication is used, the index operation will return
as soon as the operation succeeds on the primary shard.</p><h3><a id="index-refresh"></a>Refresh</h3><p>To refresh the index immediately after the operation occurs, so that the
document appears in search results immediately, the <code class="literal">refresh</code> parameter
can be set to <code class="literal">true</code>. Setting this option to <code class="literal">true</code> should <span class="strong"><strong>ONLY</strong></span> be
done after careful thought and verification that it does not lead to
poor performance, both from an indexing and a search standpoint. Note,
getting a document using the get API is completely realtime.</p><h3><a id="timeout"></a>Timeout</h3><p>The primary shard assigned to perform the index operation might not be
available when the index operation is executed. Some reasons for this
might be that the primary shard is currently recovering from a gateway
or undergoing relocation. By default, the index operation will wait on
the primary shard to become available for up to 1 minute before failing
and responding with an error. The <code class="literal">timeout</code> parameter can be used to
explicitly specify how long it waits. Here is an example of setting it
to 5 minutes:</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT 'http://localhost:9200/twitter/tweet/1?timeout=5m' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-get"></a>Get API</h2></div></div></div><p>The get API allows to get a typed JSON document from the index based on
its id. The following example gets a JSON document from an index called
twitter, under a type called tweet, with id valued 1:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/1'</pre><p>The result of the above get operation is:</p><pre class="programlisting prettyprint lang-js">{
    "_index" : "twitter",
    "_type" : "tweet",
    "_id" : "1",
    "_version" : 1,
    "found": true,
    "_source" : {
        "user" : "kimchy",
        "postDate" : "2009-11-15T14:12:12",
        "message" : "trying out Elasticsearch"
    }
}</pre><p>The above result includes the <code class="literal">_index</code>, <code class="literal">_type</code>, <code class="literal">_id</code> and <code class="literal">_version</code>
of the document we wish to retrieve, including the actual <code class="literal">_source</code>
of the document if it could be found (as indicated by the <code class="literal">found</code>
field in the response).</p><p>The API also allows to check for the existence of a document using
<code class="literal">HEAD</code>, for example:</p><pre class="programlisting prettyprint lang-js">curl -XHEAD -i 'http://localhost:9200/twitter/tweet/1'</pre><h3><a id="realtime"></a>Realtime</h3><p>By default, the get API is realtime, and is not affected by the refresh
rate of the index (when data will become visible for search).</p><p>In order to disable realtime GET, one can either set <code class="literal">realtime</code>
parameter to <code class="literal">false</code>, or globally default it to by setting the
<code class="literal">action.get.realtime</code> to <code class="literal">false</code> in the node configuration.</p><p>When getting a document, one can specify <code class="literal">fields</code> to fetch from it. They
will, when possible, be fetched as stored fields (fields mapped as
stored in the mapping). When using realtime GET, there is no notion of
stored fields (at least for a period of time, basically, until the next
flush), so they will be extracted from the source itself (note, even if
source is not enabled). It is a good practice to assume that the fields
will be loaded from source when using realtime GET, even if the fields
are stored.</p><h3><a id="type"></a>Optional Type</h3><p>The get API allows for <code class="literal">_type</code> to be optional. Set it to <code class="literal">_all</code> in order
to fetch the first document matching the id across all types.</p><h3><a id="get-source-filtering"></a>Source filtering</h3><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.0.0.Beta1.</p></div></div><p>By default, the get operation returns the contents of the <code class="literal">_source</code> field unless
you have used the <code class="literal">fields</code> parameter or if the <code class="literal">_source</code> field is disabled.
You can turn off <code class="literal">_source</code> retrieval by using the <code class="literal">_source</code> parameter:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/1?_source=false'</pre><p>If you only need one or two fields from the complete <code class="literal">_source</code>, you can use the <code class="literal">_source_include</code>
&amp; <code class="literal">_source_exclude</code> parameters to include or filter out that parts you need. This can be especially helpful
with large documents where partial retrieval can save on network overhead. Both parameters take a comma separated list
of fields or wildcard expressions. Example:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/1?_source_include=*.id&amp;_source_exclude=entities'</pre><p>If you only want to specify includes, you can use a shorter notation:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/1?_source=*.id,retweeted'</pre><h3><a id="get-fields"></a>Fields</h3><p>The get operation allows specifying a set of stored fields that will be
returned by passing the <code class="literal">fields</code> parameter. For example:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/1?fields=title,content'</pre><p>For backward compatibility, if the requested fields are not stored, they will be fetched
from the <code class="literal">_source</code> (parsed and extracted). This functionality has been replaced by the
<a class="link" href="#get-source-filtering" title="Source filtering">source filtering</a> parameter.</p><p>Field values fetched from the document it self are always returned as an array. Metadata fields like <code class="literal">_routing</code> and
<code class="literal">_parent</code> fields are never returned as an array.</p><p>Also only leaf fields can be returned via the <code class="literal">field</code> option. So object fields canât be returned and such requests
will fail.</p><h3><a id="_source"></a>Getting the _source directly</h3><p>Use the <code class="literal">/{index}/{type}/{id}/_source</code> endpoint to get
just the <code class="literal">_source</code> field of the document,
without any additional content around it. For example:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/1/_source'</pre><p>You can also use the same source filtering parameters to control which parts of the <code class="literal">_source</code> will be returned:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/1/_source?_source_include=*.id&amp;_source_exclude=entities'</pre><p>Note, there is also a HEAD variant for the _source endpoint to efficiently test for document existence.
Curl example:</p><pre class="programlisting prettyprint lang-js">curl -XHEAD -i 'http://localhost:9200/twitter/tweet/1/_source'</pre><h3><a id="get-routing"></a>Routing</h3><p>When indexing using the ability to control the routing, in order to get
a document, the routing value should also be provided. For example:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/1?routing=kimchy'</pre><p>The above will get a tweet with id 1, but will be routed based on the
user. Note, issuing a get without the correct routing, will cause the
document not to be fetched.</p><h3><a id="preference"></a>Preference</h3><p>Controls a <code class="literal">preference</code> of which shard replicas to execute the get
request on. By default, the operation is randomized between the shard
replicas.</p><p>The <code class="literal">preference</code> can be set to:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">_primary</code>
</span></dt><dd>
        The operation will go and be executed only on the primary
        shards.
</dd><dt><span class="term">
<code class="literal">_local</code>
</span></dt><dd>
        The operation will prefer to be executed on a local
        allocated shard if possible.
</dd><dt><span class="term">
Custom (string) value
</span></dt><dd>
        A custom value will be used to guarantee that
        the same shards will be used for the same custom value. This can help
        with "jumping values" when hitting different shards in different refresh
        states. A sample value can be something like the web session id, or the
        user name.
</dd></dl></div><h3><a id="get-refresh"></a>Refresh</h3><p>The <code class="literal">refresh</code> parameter can be set to <code class="literal">true</code> in order to refresh the
relevant shard before the get operation and make it searchable. Setting
it to <code class="literal">true</code> should be done after careful thought and verification that
this does not cause a heavy load on the system (and slows down
indexing).</p><h3><a id="get-distributed"></a>Distributed</h3><p>The get operation gets hashed into a specific shard id. It then gets
redirected to one of the replicas within that shard id and returns the
result. The replicas are the primary shard and its replicas within that
shard id group. This means that the more replicas we will have, the
better GET scaling we will have.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-delete"></a>Delete API</h2></div></div></div><p>The delete API allows to delete a typed JSON document from a specific
index based on its id. The following example deletes the JSON document
from an index called twitter, under a type called tweet, with id valued
1:</p><pre class="programlisting prettyprint lang-js">$ curl -XDELETE 'http://localhost:9200/twitter/tweet/1'</pre><p>The result of the above delete operation is:</p><pre class="programlisting prettyprint lang-js">{
    "found" : true,
    "_index" : "twitter",
    "_type" : "tweet",
    "_id" : "1",
    "_version" : 2
}</pre><h3><a id="delete-versioning"></a>Versioning</h3><p>Each document indexed is versioned. When deleting a document, the
<code class="literal">version</code> can be specified to make sure the relevant document we are
trying to delete is actually being deleted and it has not changed in the
meantime. Every write operation executed on a document, deletes included,
causes its version to be incremented.</p><h3><a id="delete-routing"></a>Routing</h3><p>When indexing using the ability to control the routing, in order to
delete a document, the routing value should also be provided. For
example:</p><pre class="programlisting prettyprint lang-js">$ curl -XDELETE 'http://localhost:9200/twitter/tweet/1?routing=kimchy'</pre><p>The above will delete a tweet with id 1, but will be routed based on the
user. Note, issuing a delete without the correct routing, will cause the
document to not be deleted.</p><p>Many times, the routing value is not known when deleting a document. For
those cases, when specifying the <code class="literal">_routing</code> mapping as <code class="literal">required</code>, and
no routing value is specified, the delete will be broadcasted
automatically to all shards.</p><h3><a id="delete-parent"></a>Parent</h3><p>The <code class="literal">parent</code> parameter can be set, which will basically be the same as
setting the routing parameter.</p><p>Note that deleting a parent document does not automatically delete its
children. One way of deleting all child documents given a parentâs id is
to perform a <a class="link" href="#docs-delete-by-query" title="Delete By Query API">delete by query</a> on the child
index with the automatically generated (and indexed)
field _parent, which is in the format parent_type#parent_id.</p><h3><a id="delete-index-creation"></a>Automatic index creation</h3><p>The delete operation automatically creates an index if it has not been
created before (check out the <a class="link" href="#indices-create-index" title="Create Index">create index API</a>
for manually creating an index), and also automatically creates a
dynamic type mapping for the specific type if it has not been created
before (check out the <a class="link" href="#indices-put-mapping" title="Put Mapping">put mapping</a>
API for manually creating type mapping).</p><h3><a id="delete-distributed"></a>Distributed</h3><p>The delete operation gets hashed into a specific shard id. It then gets
redirected into the primary shard within that id group, and replicated
(if needed) to shard replicas within that id group.</p><h3><a id="delete-replication"></a>Replication Type</h3><p>The replication of the operation can be done in an asynchronous manner
to the replicas (the operation will return once it has be executed on
the primary shard). The <code class="literal">replication</code> parameter can be set to <code class="literal">async</code>
(defaults to <code class="literal">sync</code>) in order to enable it.</p><h3><a id="delete-consistency"></a>Write Consistency</h3><p>Control if the operation will be allowed to execute based on the number
of active shards within that partition (replication group). The values
allowed are <code class="literal">one</code>, <code class="literal">quorum</code>, and <code class="literal">all</code>. The parameter to set it is
<code class="literal">consistency</code>, and it defaults to the node level setting of
<code class="literal">action.write_consistency</code> which in turn defaults to <code class="literal">quorum</code>.</p><p>For example, in a N shards with 2 replicas index, there will have to be
at least 2 active shards within the relevant partition (<code class="literal">quorum</code>) for
the operation to succeed. In a N shards with 1 replica scenario, there
will need to be a single shard active (in this case, <code class="literal">one</code> and <code class="literal">quorum</code>
is the same).</p><h3><a id="delete-refresh"></a>Refresh</h3><p>The <code class="literal">refresh</code> parameter can be set to <code class="literal">true</code> in order to refresh the
relevant shard after the delete operation has occurred and make it
searchable. Setting it to <code class="literal">true</code> should be done after careful thought
and verification that this does not cause a heavy load on the system
(and slows down indexing).</p><h3><a id="delete-timeout"></a>Timeout</h3><p>The primary shard assigned to perform the delete operation might not be
available when the delete operation is executed. Some reasons for this
might be that the primary shard is currently recovering from a gateway
or undergoing relocation. By default, the delete operation will wait on
the primary shard to become available for up to 1 minute before failing
and responding with an error. The <code class="literal">timeout</code> parameter can be used to
explicitly specify how long it waits. Here is an example of setting it
to 5 minutes:</p><pre class="programlisting prettyprint lang-js">$ curl -XDELETE 'http://localhost:9200/twitter/tweet/1?timeout=5m'</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-update"></a>Update API</h2></div></div></div><p>The update API allows to update a document based on a script provided.
The operation gets the document (collocated with the shard) from the
index, runs the script (with optional script language and parameters),
and index back the result (also allows to delete, or ignore the
operation). It uses versioning to make sure no updates have happened
during the "get" and "reindex".</p><p>Note, this operation still means full reindex of the document, it just
removes some network roundtrips and reduces chances of version conflicts
between the get and the index. The <code class="literal">_source</code> field need to be enabled
for this feature to work.</p><p>For example, lets index a simple doc:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test/type1/1 -d '{
    "counter" : 1,
    "tags" : ["red"]
}'</pre><p>Now, we can execute a script that would increment the counter:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : "ctx._source.counter += count",
    "params" : {
        "count" : 4
    }
}'</pre><p>We can also add a tag to the list of tags (note, if the tag exists, it
will still add it, since its a list):</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : "ctx._source.tags += tag",
    "params" : {
        "tag" : "blue"
    }
}'</pre><p>We can also add a new field to the document:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : "ctx._source.text = \"some text\""
}'</pre><p>We can also remove a field from the document:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : "ctx._source.remove(\"text\")"
}'</pre><p>And, we can delete the doc if the tags contain blue, or ignore (noop):</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : "ctx._source.tags.contains(tag) ? ctx.op = \"delete\" : ctx.op = \"none\"",
    "params" : {
        "tag" : "blue"
    }
}'</pre><p><span class="strong"><strong>Note</strong></span>: Be aware of MVEL and handling of ternary operators and
assignments. Assignment operations have lower precedence than the
ternary operator. Compare the following statements:</p><pre class="programlisting prettyprint lang-js">// Will NOT update the tags array
ctx._source.tags.contains(tag) ? ctx.op = \"none\" : ctx._source.tags += tag
// Will update
ctx._source.tags.contains(tag) ? (ctx.op = \"none\") : ctx._source.tags += tag
// Also works
if (ctx._source.tags.contains(tag)) { ctx.op = \"none\" } else { ctx._source.tags += tag }</pre><p>The update API also support passing a partial document,
which will be merged into the existing document (simple recursive merge,
inner merging of objects, replacing core "keys/values" and arrays). For
example:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "doc" : {
        "name" : "new_name"
    }
}'</pre><p>If both <code class="literal">doc</code> and <code class="literal">script</code> is specified, then <code class="literal">doc</code> is ignored. Best is
to put your field pairs of the partial document in the script itself.</p><p>There is also support for <code class="literal">upsert</code>. If the document does
not already exists, the content of the <code class="literal">upsert</code> element will be used to
index the fresh doc:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : "ctx._source.counter += count",
    "params" : {
        "count" : 4
    },
    "upsert" : {
        "counter" : 1
    }
}'</pre><p>Last it also supports <code class="literal">doc_as_upsert</code>. So that the
provided document will be inserted if the document does not already
exist. This will reduce the amount of data that needs to be sent to
elasticsearch.</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "doc" : {
        "name" : "new_name"
    },
    "doc_as_upsert" : true
}'</pre><p>The update operation supports similar parameters as the index API,
including:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">routing</code>
</p>
</td><td valign="top">
<p>
Sets the routing that will be used to route the
                document to the relevant shard.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">parent</code>
</p>
</td><td valign="top">
<p>
Simply sets the routing.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">timeout</code>
</p>
</td><td valign="top">
<p>
Timeout waiting for a shard to become available.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">replication</code>
</p>
</td><td valign="top">
<p>
The replication type for the delete/index operation
                (sync or async).
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">consistency</code>
</p>
</td><td valign="top">
<p>
The write consistency of the index/delete operation.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">refresh</code>
</p>
</td><td valign="top">
<p>
Refresh the index immediately after the operation occurs,
                so that the updated document appears in search results
                immediately.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">fields</code>
</p>
</td><td valign="top">
<p>
return the relevant fields from the updated document.
                Support <code class="literal">_source</code> to return the full updated
                source.
</p>
</td></tr></tbody></table></div><p>And also support <code class="literal">retry_on_conflict</code> which controls how many times to
retry if there is a version conflict between getting the document and
indexing / deleting it. Defaults to <code class="literal">0</code>.</p><p>It also allows to update the <code class="literal">ttl</code> of a document using <code class="literal">ctx._ttl</code> and
timestamp using <code class="literal">ctx._timestamp</code>. Note that if the timestamp is not
updated and not extracted from the <code class="literal">_source</code> it will be set to the
update date.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-multi-get"></a>Multi Get API</h2></div></div></div><p>Multi GET API allows to get multiple documents based on an index, type
(optional) and id (and possibly routing). The response includes a <code class="literal">docs</code>
array with all the fetched documents, each element similar in structure
to a document provided by the <a class="link" href="#docs-get" title="Get API">get</a>
API. Here is an example:</p><pre class="programlisting prettyprint lang-js">curl 'localhost:9200/_mget' -d '{
    "docs" : [
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "1"
        },
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "2"
        }
    ]
}'</pre><p>The <code class="literal">mget</code> endpoint can also be used against an index (in which case it
is not required in the body):</p><pre class="programlisting prettyprint lang-js">curl 'localhost:9200/test/_mget' -d '{
    "docs" : [
        {
            "_type" : "type",
            "_id" : "1"
        },
        {
            "_type" : "type",
            "_id" : "2"
        }
    ]
}'</pre><p>And type:</p><pre class="programlisting prettyprint lang-js">curl 'localhost:9200/test/type/_mget' -d '{
    "docs" : [
        {
            "_id" : "1"
        },
        {
            "_id" : "2"
        }
    ]
}'</pre><p>In which case, the <code class="literal">ids</code> element can directly be used to simplify the
request:</p><pre class="programlisting prettyprint lang-js">curl 'localhost:9200/test/type/_mget' -d '{
    "ids" : ["1", "2"]
}'</pre><h3><a id="mget-source-filtering"></a>Source filtering</h3><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.0.0.Beta1.</p></div></div><p>By default, the <code class="literal">_source</code> field will be returned for every document (if stored).
Similar to the <a class="link" href="#get-source-filtering" title="Source filtering">get</a> API, you can retrieve only parts of
the <code class="literal">_source</code> (or not at all) by using the <code class="literal">_source</code> parameter. You can also use
the url parameters <code class="literal">_source</code>,<code class="literal">_source_include</code> &amp; <code class="literal">_source_exclude</code> to specify defaults,
which will be used when there are no per-document instructions.</p><p>For example:</p><pre class="programlisting prettyprint lang-js">curl 'localhost:9200/_mget' -d '{
    "docs" : [
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "1",
            "_source" : false
        },
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "2",
            "_source" : ["field3", "field4"]
        },
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "3",
            "_source" : {
                "include": ["user"],
                "_exclude": ["user.location"]
            }
        }
    ]
}'</pre><h3><a id="mget-fields"></a>Fields</h3><p>Specific stored fields can be specified to be retrieved per document to get, similar to the <a class="link" href="#get-fields" title="Fields">fields</a> parameter of the Get API.
For example:</p><pre class="programlisting prettyprint lang-js">curl 'localhost:9200/_mget' -d '{
    "docs" : [
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "1",
            "fields" : ["field1", "field2"]
        },
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "2",
            "fields" : ["field3", "field4"]
        }
    ]
}'</pre><h3><a id="mget-routing"></a>Routing</h3><p>You can specify also specify routing value as a parameter:</p><pre class="programlisting prettyprint lang-js">curl 'localhost:9200/_mget?routing=key1' -d '{
    "docs" : [
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "1",
            "_routing" : "key2"
        },
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "2"
        }
    ]
}'</pre><p>In this example, document <code class="literal">test/type/2</code> will be fetch from shard corresponding to routing key <code class="literal">key1</code> but
document <code class="literal">test/type/1</code> will be fetch from shard corresponding to routing key <code class="literal">key2</code>.</p><h3><a id="mget-security"></a>Security</h3><p>See <a class="xref" href="#url-access-control" title="URL-based access control"><em>URL-based access control</em></a></p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-bulk"></a>Bulk API</h2></div></div></div><p>The bulk API makes it possible to perform many index/delete operations
in a single API call. This can greatly increase the indexing speed. The
REST API endpoint is <code class="literal">/_bulk</code>, and it expects the following JSON
structure:</p><pre class="programlisting prettyprint lang-js">action_and_meta_data\n
optional_source\n
action_and_meta_data\n
optional_source\n
....
action_and_meta_data\n
optional_source\n</pre><p><span class="strong"><strong>NOTE</strong></span>: the final line of data must end with a newline character <code class="literal">\n</code>.</p><p>The possible actions are <code class="literal">index</code>, <code class="literal">create</code>, <code class="literal">delete</code> and <code class="literal">update</code>.
<code class="literal">index</code> and <code class="literal">create</code> expect a source on the next
line, and have the same semantics as the <code class="literal">op_type</code> parameter to the
standard index API (i.e. create will fail if a document with the same
index and type exists already, whereas index will add or replace a
document as necessary). <code class="literal">delete</code> does not expect a source on the
following line, and has the same semantics as the standard delete API.
<code class="literal">update</code> expects that the partial doc, upsert and script and its options
are specified on the next line.</p><p>If youâre providing text file input to <code class="literal">curl</code>, you <span class="strong"><strong>must</strong></span> use the
<code class="literal">--data-binary</code> flag instead of plain <code class="literal">-d</code>. The latter doesnât preserve
newlines. Example:</p><pre class="programlisting prettyprint lang-js">$ cat requests
{ "index" : { "_index" : "test", "_type" : "type1", "_id" : "1" } }
{ "field1" : "value1" }
$ curl -s -XPOST localhost:9200/_bulk --data-binary @requests; echo
{"took":7,"items":[{"create":{"_index":"test","_type":"type1","_id":"1","_version":1}}]}</pre><p>Because this format uses literal <code class="literal">\n</code>'s as delimiters, please be sure
that the JSON actions and sources are not pretty printed. Here is an
example of a correct sequence of bulk commands:</p><pre class="programlisting prettyprint lang-js">{ "index" : { "_index" : "test", "_type" : "type1", "_id" : "1" } }
{ "field1" : "value1" }
{ "delete" : { "_index" : "test", "_type" : "type1", "_id" : "2" } }
{ "create" : { "_index" : "test", "_type" : "type1", "_id" : "3" } }
{ "field1" : "value3" }
{ "update" : {"_id" : "1", "_type" : "type1", "_index" : "index1"} }
{ "doc" : {"field2" : "value2"} }</pre><p>In the above example <code class="literal">doc</code> for the <code class="literal">update</code> action is a partial
document, that will be merged with the already stored document.</p><p>The endpoints are <code class="literal">/_bulk</code>, <code class="literal">/{index}/_bulk</code>, and <code class="literal">{index}/type/_bulk</code>.
When the index or the index/type are provided, they will be used by
default on bulk items that donât provide them explicitly.</p><p>A note on the format. The idea here is to make processing of this as
fast as possible. As some of the actions will be redirected to other
shards on other nodes, only <code class="literal">action_meta_data</code> is parsed on the
receiving node side.</p><p>Client libraries using this protocol should try and strive to do
something similar on the client side, and reduce buffering as much as
possible.</p><p>The response to a bulk action is a large JSON structure with the
individual results of each action that was performed. The failure of a
single action does not affect the remaining actions.</p><p>There is no "correct" number of actions to perform in a single bulk
call. You should experiment with different settings to find the optimum
size for your particular workload.</p><p>If using the HTTP API, make sure that the client does not send HTTP
chunks, as this will slow things down.</p><h3><a id="bulk-versioning"></a>Versioning</h3><p>Each bulk item can include the version value using the
<code class="literal">_version</code>/<code class="literal">version</code> field. It automatically follows the behavior of the
index / delete operation based on the <code class="literal">_version</code> mapping. It also
support the <code class="literal">version_type</code>/<code class="literal">_version_type</code> (see <a class="link" href="#index-versioning" title="Versioning">versioning</a>)</p><h3><a id="bulk-routing"></a>Routing</h3><p>Each bulk item can include the routing value using the
<code class="literal">_routing</code>/<code class="literal">routing</code> field. It automatically follows the behavior of the
index / delete operation based on the <code class="literal">_routing</code> mapping.</p><h3><a id="bulk-parent"></a>Parent</h3><p>Each bulk item can include the parent value using the <code class="literal">_parent</code>/<code class="literal">parent</code>
field. It automatically follows the behavior of the index / delete
operation based on the <code class="literal">_parent</code> / <code class="literal">_routing</code> mapping.</p><h3><a id="bulk-timestamp"></a>Timestamp</h3><p>Each bulk item can include the timestamp value using the
<code class="literal">_timestamp</code>/<code class="literal">timestamp</code> field. It automatically follows the behavior of
the index operation based on the <code class="literal">_timestamp</code> mapping.</p><h3><a id="bulk-ttl"></a>TTL</h3><p>Each bulk item can include the ttl value using the <code class="literal">_ttl</code>/<code class="literal">ttl</code> field.
It automatically follows the behavior of the index operation based on
the <code class="literal">_ttl</code> mapping.</p><h3><a id="bulk-consistency"></a>Write Consistency</h3><p>When making bulk calls, you can require a minimum number of active
shards in the partition through the <code class="literal">consistency</code> parameter. The values
allowed are <code class="literal">one</code>, <code class="literal">quorum</code>, and <code class="literal">all</code>. It defaults to the node level
setting of <code class="literal">action.write_consistency</code>, which in turn defaults to
<code class="literal">quorum</code>.</p><p>For example, in a N shards with 2 replicas index, there will have to be
at least 2 active shards within the relevant partition (<code class="literal">quorum</code>) for
the operation to succeed. In a N shards with 1 replica scenario, there
will need to be a single shard active (in this case, <code class="literal">one</code> and <code class="literal">quorum</code>
is the same).</p><h3><a id="bulk-refresh"></a>Refresh</h3><p>The <code class="literal">refresh</code> parameter can be set to <code class="literal">true</code> in order to refresh the
relevant shards immediately after the bulk operation has occurred and
make it searchable, instead of waiting for the normal refresh interval
to expire. Setting it to <code class="literal">true</code> can trigger additional load, and may
slow down indexing.</p><h3><a id="bulk-update"></a>Update</h3><p>When using <code class="literal">update</code> action <code class="literal">_retry_on_conflict</code> can be used as field in
the action itself (not in the extra payload line), to specify how many
times an update should be retried in the case of a version conflict.</p><p>The <code class="literal">update</code> action payload, supports the following options: <code class="literal">doc</code>
(partial document), <code class="literal">upsert</code>, <code class="literal">doc_as_upsert</code>, <code class="literal">script</code>, <code class="literal">params</code> (for
script), <code class="literal">lang</code> (for script). See update documentation for details on
the options. Curl example with update actions:</p><pre class="programlisting prettyprint lang-js">{ "update" : {"_id" : "1", "_type" : "type1", "_index" : "index1", "_retry_on_conflict" : 3} }
{ "doc" : {"field" : "value"} }
{ "update" : { "_id" : "0", "_type" : "type1", "_index" : "index1", "_retry_on_conflict" : 3} }
{ "script" : "ctx._source.counter += param1", "lang" : "js", "params" : {"param1" : 1}, "upsert" : {"counter" : 1}}
{ "update" : {"_id" : "2", "_type" : "type1", "_index" : "index1", "_retry_on_conflict" : 3} }
{ "doc" : {"field" : "value"}, "doc_as_upsert" : true }</pre><h3><a id="bulk-security"></a>Security</h3><p>See <a class="xref" href="#url-access-control" title="URL-based access control"><em>URL-based access control</em></a></p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-delete-by-query"></a>Delete By Query API</h2></div></div></div><p>The delete by query API allows to delete documents from one or more
indices and one or more types based on a query. The query can either be
provided using a simple query string as a parameter, or using the
<a class="link" href="#query-dsl" title="Query DSL">Query DSL</a> defined within the request
body. Here is an example:</p><pre class="programlisting prettyprint lang-js">$ curl -XDELETE 'http://localhost:9200/twitter/tweet/_query?q=user:kimchy'

$ curl -XDELETE 'http://localhost:9200/twitter/tweet/_query' -d '{
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}
'</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The query being sent in the body must be nested in a <code class="literal">query</code> key, same as
the <a class="link" href="#search-search" title="Search">search api</a> works <span class="added">
      [<span class="version">1.0.0.RC1</span>]
      <span class="detail">Added in 1.0.0.RC1. The query was previously the top-level object.</span></span>.</p></div></div><p>Both above examples end up doing the same thing, which is delete all
tweets from the twitter index for a certain user. The result of the
commands is:</p><pre class="programlisting prettyprint lang-js">{
    "_indices" : {
        "twitter" : {
            "_shards" : {
                "total" : 5,
                "successful" : 5,
                "failed" : 0
            }
        }
    }
}</pre><p>Note, delete by query bypasses versioning support. Also, it is not
recommended to delete "large chunks of the data in an index", many
times, itâs better to simply reindex into a new index.</p><h3><a id="multiple-indices"></a>Multiple Indices and Types</h3><p>The delete by query API can be applied to multiple types within an
index, and across multiple indices. For example, we can delete all
documents across all types within the twitter index:</p><pre class="programlisting prettyprint lang-js">$ curl -XDELETE 'http://localhost:9200/twitter/_query?q=user:kimchy'</pre><p>We can also delete within specific types:</p><pre class="programlisting prettyprint lang-js">$ curl -XDELETE 'http://localhost:9200/twitter/tweet,user/_query?q=user:kimchy'</pre><p>We can also delete all tweets with a certain tag across several indices
(for example, when each user has his own index):</p><pre class="programlisting prettyprint lang-js">$ curl -XDELETE 'http://localhost:9200/kimchy,elasticsearch/_query?q=tag:wow'</pre><p>Or even delete across all indices:</p><pre class="programlisting prettyprint lang-js">$ curl -XDELETE 'http://localhost:9200/_all/_query?q=tag:wow'</pre><h3><a id="delete-by-query-parameters"></a>Request Parameters</h3><p>When executing a delete by query using the query parameter <code class="literal">q</code>, the
query passed is a query string using Lucene query parser. There are
additional parameters that can be passed:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Name </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>df</p></td><td align="left" valign="top"><p>The default field to use when no field prefix is defined within the
query.</p></td></tr><tr><td align="left" valign="top"><p>analyzer</p></td><td align="left" valign="top"><p>The analyzer name to be used when analyzing the query string.</p></td></tr><tr><td align="left" valign="top"><p>default_operator</p></td><td align="left" valign="top"><p>The default operator to be used, can be <code class="literal">AND</code> or
<code class="literal">OR</code>. Defaults to <code class="literal">OR</code>.</p></td></tr></tbody></table></div><h3><a id="request-body"></a>Request Body</h3><p>The delete by query can use the <a class="link" href="#query-dsl" title="Query DSL">Query DSL</a> within its body in order to express the query that should be
executed and delete all documents. The body content can also be passed
as a REST parameter named <code class="literal">source</code>.</p><h3><a id="delete-by-query-distributed"></a>Distributed</h3><p>The delete by query API is broadcast across all primary shards, and from
there, replicated across all shards replicas.</p><h3><a id="delete-by-query-routing"></a>Routing</h3><p>The routing value (a comma separated list of the routing values) can be
specified to control which shards the delete by query request will be
executed on.</p><h3><a id="replication-type"></a>Replication Type</h3><p>The replication of the operation can be done in an asynchronous manner
to the replicas (the operation will return once it has be executed on
the primary shard). The <code class="literal">replication</code> parameter can be set to <code class="literal">async</code>
(defaults to <code class="literal">sync</code>) in order to enable it.</p><h3><a id="delete-by-query-consistency"></a>Write Consistency</h3><p>Control if the operation will be allowed to execute based on the number
of active shards within that partition (replication group). The values
allowed are <code class="literal">one</code>, <code class="literal">quorum</code>, and <code class="literal">all</code>. The parameter to set it is
<code class="literal">consistency</code>, and it defaults to the node level setting of
<code class="literal">action.write_consistency</code> which in turn defaults to <code class="literal">quorum</code>.</p><p>For example, in a N shards with 2 replicas index, there will have to be
at least 2 active shards within the relevant partition (<code class="literal">quorum</code>) for
the operation to succeed. In a N shards with 1 replica scenario, there
will need to be a single shard active (in this case, <code class="literal">one</code> and <code class="literal">quorum</code>
is the same).</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-bulk-udp"></a>Bulk UDP API</h2></div></div></div><p>A Bulk UDP service is a service listening over UDP for bulk format
requests. The idea is to provide a low latency UDP service that allows
to easily index data that is not of critical nature.</p><p>The Bulk UDP service is disabled by default, but can be enabled by
setting <code class="literal">bulk.udp.enabled</code> to <code class="literal">true</code>.</p><p>The bulk UDP service performs internal bulk aggregation of the data and
then flushes it based on several parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">bulk.udp.bulk_actions</code>
</span></dt><dd>
         The number of actions to flush a bulk after,
        defaults to <code class="literal">1000</code>.
</dd><dt><span class="term">
<code class="literal">bulk.udp.bulk_size</code>
</span></dt><dd>
         The size of the current bulk request to flush
        the request once exceeded, defaults to <code class="literal">5mb</code>.
</dd><dt><span class="term">
<code class="literal">bulk.udp.flush_interval</code>
</span></dt><dd>
         An interval after which the current
        request is flushed, regardless of the above limits. Defaults to <code class="literal">5s</code>.
</dd><dt><span class="term">
<code class="literal">bulk.udp.concurrent_requests</code>
</span></dt><dd>
         The number on max in flight bulk
        requests allowed. Defaults to <code class="literal">4</code>.
</dd></dl></div><p>The allowed network settings are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">bulk.udp.host</code>
</span></dt><dd>
        The host to bind to, defaults to <code class="literal">network.host</code>
        which defaults to any.
</dd><dt><span class="term">
<code class="literal">bulk.udp.port</code>
</span></dt><dd>
        The port to use, defaults to <code class="literal">9700-9800</code>.
</dd><dt><span class="term">
<code class="literal">bulk.udp.receive_buffer_size</code>
</span></dt><dd>
        The receive buffer size, defaults to <code class="literal">10mb</code>.
</dd></dl></div><p>Here is an example of how it can be used:</p><pre class="programlisting prettyprint lang-js">&gt; cat bulk.txt
{ "index" : { "_index" : "test", "_type" : "type1" } }
{ "field1" : "value1" }
{ "index" : { "_index" : "test", "_type" : "type1" } }
{ "field1" : "value1" }</pre><pre class="programlisting prettyprint lang-js">&gt; cat bulk.txt | nc -w 0 -u localhost 9700</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-termvectors"></a>Term Vectors</h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.0.0.Beta1.</p></div></div><p>Returns information and statistics on terms in the fields of a
particular document as stored in the index.</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/1/_termvector?pretty=true'</pre><p>Optionally, you can specify the fields for which the information is
retrieved either with a parameter in the url</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/1/_termvector?fields=text,...'</pre><p>or adding by adding the requested fields in the request body (see
example below).</p><h3><a id="_return_values_2"></a>Return values</h3><p>Three types of values can be requested: <span class="emphasis"><em>term information</em></span>, <span class="emphasis"><em>term statistics</em></span>
and <span class="emphasis"><em>field statistics</em></span>. By default, all term information and field
statistics are returned for all fields but no term statistics.</p><h4><a id="_term_information"></a>Term information</h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
term frequency in the field (always returned)
</li><li class="listitem">
term positions (<code class="literal">positions</code> : true)
</li><li class="listitem">
start and end offsets (<code class="literal">offsets</code> : true)
</li><li class="listitem">
term payloads (<code class="literal">payloads</code> : true), as base64 encoded bytes
</li></ul></div><p>If the requested information wasnât stored in the index, it will be
omitted without further warning. See <a class="link" href="#mapping-types" title="Types">type mapping</a>
for how to configure your index to store term vectors.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>Start and end offsets assume UTF-16 encoding is being used. If you want to use
these offsets in order to get the original text that produced this token, you
should make sure that the string you are taking a sub-string of is also encoded
using UTF-16.</p></div></div><h4><a id="_term_statistics"></a>Term statistics</h4><p>Setting <code class="literal">term_statistics</code> to <code class="literal">true</code> (default is <code class="literal">false</code>) will
return</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
total term frequency (how often a term occurs in all documents)
</li><li class="listitem">
document frequency (the number of documents containing the current
   term)
</li></ul></div><p>By default these values are not returned since term statistics can
have a serious performance impact.</p><h4><a id="_field_statistics"></a>Field statistics</h4><p>Setting <code class="literal">field_statistics</code> to <code class="literal">false</code> (default is <code class="literal">true</code>) will
omit :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
document count (how many documents contain this field)
</li><li class="listitem">
sum of document frequencies (the sum of document frequencies for all
   terms in this field)
</li><li class="listitem">
sum of total term frequencies (the sum of total term frequencies of
   each term in this field)
</li></ul></div><h3><a id="_behaviour"></a>Behaviour</h3><p>The term and field statistics are not accurate. Deleted documents
are not taken into account. The information is only retrieved for the
shard the requested document resides in. The term and field statistics
are therefore only useful as relative measures whereas the absolute
numbers have no meaning in this context.</p><h3><a id="_example"></a>Example</h3><p>First, we create an index that stores term vectors, payloads etc. :</p><pre class="programlisting prettyprint lang-js">curl -s -XPUT 'http://localhost:9200/twitter/' -d '{
  "mappings": {
    "tweet": {
      "properties": {
        "text": {
          "type": "string",
          "term_vector": "with_positions_offsets_payloads",
          "store" : true,
          "index_analyzer" : "fulltext_analyzer"
         },
         "fullname": {
          "type": "string",
          "term_vector": "with_positions_offsets_payloads",
          "index_analyzer" : "fulltext_analyzer"
        }
      }
    }
  },
  "settings" : {
    "index" : {
      "number_of_shards" : 1,
      "number_of_replicas" : 0
    },
    "analysis": {
      "analyzer": {
        "fulltext_analyzer": {
          "type": "custom",
          "tokenizer": "whitespace",
          "filter": [
            "lowercase",
            "type_as_payload"
          ]
        }
      }
    }
  }
}'</pre><p>Second, we add some documents:</p><pre class="programlisting prettyprint lang-js">curl -XPUT 'http://localhost:9200/twitter/tweet/1?pretty=true' -d '{
  "fullname" : "John Doe",
  "text" : "twitter test test test "
}'

curl -XPUT 'http://localhost:9200/twitter/tweet/2?pretty=true' -d '{
  "fullname" : "Jane Doe",
  "text" : "Another twitter test ..."
}'</pre><p>The following request returns all information and statistics for field
<code class="literal">text</code> in document <code class="literal">1</code> (John Doe):</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/1/_termvector?pretty=true' -d '{
  "fields" : ["text"],
  "offsets" : true,
  "payloads" : true,
  "positions" : true,
  "term_statistics" : true,
  "field_statistics" : true
}'</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    "_id": "1",
    "_index": "twitter",
    "_type": "tweet",
    "_version": 1,
    "found": true,
    "term_vectors": {
        "text": {
            "field_statistics": {
                "doc_count": 2,
                "sum_doc_freq": 6,
                "sum_ttf": 8
            },
            "terms": {
                "test": {
                    "doc_freq": 2,
                    "term_freq": 3,
                    "tokens": [
                        {
                            "end_offset": 12,
                            "payload": "d29yZA==",
                            "position": 1,
                            "start_offset": 8
                        },
                        {
                            "end_offset": 17,
                            "payload": "d29yZA==",
                            "position": 2,
                            "start_offset": 13
                        },
                        {
                            "end_offset": 22,
                            "payload": "d29yZA==",
                            "position": 3,
                            "start_offset": 18
                        }
                    ],
                    "ttf": 4
                },
                "twitter": {
                    "doc_freq": 2,
                    "term_freq": 1,
                    "tokens": [
                        {
                            "end_offset": 7,
                            "payload": "d29yZA==",
                            "position": 0,
                            "start_offset": 0
                        }
                    ],
                    "ttf": 2
                }
            }
        }
    }
}</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-multi-termvectors"></a>Multi termvectors API</h2></div></div></div><p>Multi termvectors API allows to get multiple termvectors based on an index, type and id. The response includes a <code class="literal">docs</code>
array with all the fetched termvectors, each element having the structure
provided by the <a class="link" href="#docs-termvectors" title="Term Vectors">termvectors</a>
API. Here is an example:</p><pre class="programlisting prettyprint lang-js">curl 'localhost:9200/_mtermvectors' -d '{
{
   "docs": [
      {
         "_index": "testidx",
         "_type": "test",
         "_id": "2",
         "term_statistics": true
      },
      {
         "_index": "testidx",
         "_type": "test",
         "_id": "1",
         "fields": [
            "text"
         ]
      }
   ]
}'</pre><p>See the <a class="link" href="#docs-termvectors" title="Term Vectors">termvectors</a> API for a description of possible parameters.</p><p>The <code class="literal">_mtermvectors</code> endpoint can also be used against an index (in which case it
is not required in the body):</p><pre class="programlisting prettyprint lang-js">curl 'localhost:9200/testidx/_mtermvectors' -d '{
   "docs": [
      {
         "_type": "test",
         "_id": "2",
         "fields": [
            "text"
         ],
         "term_statistics": true
      },
      {
         "_type": "test",
         "_id": "1"
      }
   ]
}'</pre><p>And type:</p><pre class="programlisting prettyprint lang-js">curl 'localhost:9200/testidx/test/_mtermvectors' -d '{
   "docs": [
      {
         "_id": "2",
         "fields": [
            "text"
         ],
         "term_statistics": true
      },
      {
         "_id": "1"
      }
   ]
}'</pre><p>If all requested documents are on same index and have same type and also the parameters are the same, the request can be simplified:</p><pre class="programlisting prettyprint lang-js">curl 'localhost:9200/testidx/test/_mtermvectors' -d '{
    "ids" : ["1", "2"],
    "parameters": {
        "fields": [
                "text"
        ],
        "term_statistics": true,
        â¦
    }
}'</pre><p>Parameters can aslo be set by passing them as uri parameters (see <a class="link" href="#docs-termvectors" title="Term Vectors">termvectors</a>). uri parameters are the default parameters and are overwritten by any parameter setting defined in the body.</p></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="search"></a>Search APIs</h1></div></div></div><div class="partintro"><div></div><p>Most search APIs are <a class="link" href="#search-multi-index-type" title="Multi-Index, Multi-Type">multi-index, multi-type</a>, with the
exception of the <a class="xref" href="#search-explain" title="Explain API"><em>Explain API</em></a> endpoints.</p><h2><a id="search-routing"></a>Routing</h2><p>When executing a search, it will be broadcasted to all the index/indices
shards (round robin between replicas). Which shards will be searched on
can be controlled by providing the <code class="literal">routing</code> parameter. For example,
when indexing tweets, the routing value can be the user name:</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/twitter/tweet?routing=kimchy' -d '{
    "user" : "kimchy",
    "postDate" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}
'</pre><p>In such a case, if we want to search only on the tweets for a specific
user, we can specify it as the routing, resulting in the search hitting
only the relevant shard:</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/twitter/tweet/_search?routing=kimchy' -d '{
    "query": {
        "filtered" : {
            "query" : {
                "query_string" : {
                    "query" : "some query string here"
                }
            },
            "filter" : {
                "term" : { "user" : "kimchy" }
            }
        }
    }
}
'</pre><p>The routing parameter can be multi valued represented as a comma
separated string. This will result in hitting the relevant shards where
the routing values match to.</p><h2><a id="stats-groups"></a>Stats Groups</h2><p>A search can be associated with stats groups, which maintains a
statistics aggregation per group. It can later be retrieved using the
<a class="link" href="#indices-stats" title="Indices Stats">indices stats</a> API
specifically. For example, here is a search body request that associate
the request with two different groups:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "stats" : ["group1", "group2"]
}</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-search"></a>Search</h2></div></div></div><p>The search API allows to execute a search query and get back search hits
that match the query. The query can either be provided using a simple
<a class="link" href="#search-uri-request" title="URI Search">query string as a parameter</a>, or using a
<a class="link" href="#search-request-body" title="Request Body Search">request body</a>.</p><h3><a id="search-multi-index-type"></a>Multi-Index, Multi-Type</h3><p>All search APIs can be applied across multiple types within an index, and
across multiple indices with support for the
<a class="link" href="#multi-index" title="Multiple Indices">multi index syntax</a>. For
example, we can search on all documents across all types within the
twitter index:</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/twitter/_search?q=user:kimchy'</pre><p>We can also search within specific types:</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/twitter/tweet,user/_search?q=user:kimchy'</pre><p>We can also search all tweets with a certain tag across several indices
(for example, when each user has his own index):</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/kimchy,elasticsearch/tweet/_search?q=tag:wow'</pre><p>Or we can search all tweets across all available indices using <code class="literal">_all</code>
placeholder:</p><pre class="programlisting prettyprint lang-js">$ curl - XGET 'http://localhost:9200/_all/tweet/_search?q=tag:wow'</pre><p>Or even search across all indices and all types:</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_search?q=tag:wow'</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-uri-request"></a>URI Search</h2></div></div></div><p>A search request can be executed purely using a URI by providing request
parameters. Not all search options are exposed when executing a search
using this mode, but it can be handy for quick "curl tests". Here is an
example:</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/twitter/tweet/_search?q=user:kimchy'</pre><p>And here is a sample response:</p><pre class="programlisting prettyprint lang-js">{
    "_shards":{
        "total" : 5,
        "successful" : 5,
        "failed" : 0
    },
    "hits":{
        "total" : 1,
        "hits" : [
            {
                "_index" : "twitter",
                "_type" : "tweet",
                "_id" : "1",
                "_source" : {
                    "user" : "kimchy",
                    "postDate" : "2009-11-15T14:12:12",
                    "message" : "trying out Elasticsearch"
                }
            }
        ]
    }
}</pre><h3><a id="_parameters_3"></a>Parameters</h3><p>The parameters allowed in the URI are:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Name </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">q</code></p></td><td align="left" valign="top"><p>The query string (maps to the <code class="literal">query_string</code> query, see
<a class="link" href="#query-dsl-query-string-query" title="Query String Query"><span class="emphasis"><em>Query String Query</em></span></a> for more details).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">df</code></p></td><td align="left" valign="top"><p>The default field to use when no field prefix is defined within the
query.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td align="left" valign="top"><p>The analyzer name to be used when analyzing the query string.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">default_operator</code></p></td><td align="left" valign="top"><p>The default operator to be used, can be <code class="literal">AND</code> or
<code class="literal">OR</code>. Defaults to <code class="literal">OR</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">explain</code></p></td><td align="left" valign="top"><p>For each hit, contain an explanation of how scoring of the
hits was computed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_source</code></p></td><td align="left" valign="top"><p><span class="added">
      [<span class="version">1.0.0.Beta1</span>]
      <span class="detail">Added in 1.0.0.Beta1.</span></span>Set to <code class="literal">false</code> to disable retrieval of the <code class="literal">_source</code> field. You can also retrieve
part of the document by using <code class="literal">_source_include</code> &amp; <code class="literal">_source_exclude</code> (see the <a class="link" href="#search-request-source-filtering" title="Source filtering">request body</a>
documentation for more details)</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">fields</code></p></td><td align="left" valign="top"><p>The selective stored fields of the document to return for each hit,
comma delimited. Not specifying any value will cause no fields to return.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">sort</code></p></td><td align="left" valign="top"><p>Sorting to perform. Can either be in the form of <code class="literal">fieldName</code>, or
<code class="literal">fieldName:asc</code>/<code class="literal">fieldName:desc</code>. The fieldName can either be an actual
field within the document, or the special <code class="literal">_score</code> name to indicate
sorting based on scores. There can be several <code class="literal">sort</code> parameters (order
is important).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">track_scores</code></p></td><td align="left" valign="top"><p>When sorting, set to <code class="literal">true</code> in order to still track
scores and return them as part of each hit.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">timeout</code></p></td><td align="left" valign="top"><p>A search timeout, bounding the search request to be executed
within the specified time value and bail with the hits accumulated up to
that point when expired. Defaults to no timeout.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">from</code></p></td><td align="left" valign="top"><p>The starting from index of the hits to return. Defaults to <code class="literal">0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">size</code></p></td><td align="left" valign="top"><p>The number of hits to return. Defaults to <code class="literal">10</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">search_type</code></p></td><td align="left" valign="top"><p>The type of the search operation to perform. Can be
<code class="literal">dfs_query_then_fetch</code>, <code class="literal">dfs_query_and_fetch</code>, <code class="literal">query_then_fetch</code>,
<code class="literal">query_and_fetch</code>, <code class="literal">count</code>, <code class="literal">scan</code>. Defaults to <code class="literal">query_then_fetch</code>. See
<a class="link" href="#search-request-search-type" title="Search Type"><span class="emphasis"><em>Search Type</em></span></a> for
more details on the different types of search that can be performed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">lowercase_expanded_terms</code></p></td><td align="left" valign="top"><p>Should terms be automatically lowercased or
not. Defaults to <code class="literal">true</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">analyze_wildcard</code></p></td><td align="left" valign="top"><p>Should wildcard and prefix queries be analyzed or
not. Defaults to <code class="literal">false</code>.</p></td></tr></tbody></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-body"></a>Request Body Search</h2></div></div></div><p>The search request can be executed with a search DSL, which includes the
<a class="link" href="#query-dsl" title="Query DSL">Query DSL</a>, within its body. Here is an
example:</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/twitter/tweet/_search' -d '{
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}
'</pre><p>And here is a sample response:</p><pre class="programlisting prettyprint lang-js">{
    "_shards":{
        "total" : 5,
        "successful" : 5,
        "failed" : 0
    },
    "hits":{
        "total" : 1,
        "hits" : [
            {
                "_index" : "twitter",
                "_type" : "tweet",
                "_id" : "1",
                "_source" : {
                    "user" : "kimchy",
                    "postDate" : "2009-11-15T14:12:12",
                    "message" : "trying out Elasticsearch"
                }
            }
        ]
    }
}</pre><h3><a id="_parameters_4"></a>Parameters</h3><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Name </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">timeout</code></p></td><td align="left" valign="top"><p>A search timeout, bounding the search request to be executed
within the specified time value and bail with the hits accumulated up to
that point when expired. Defaults to no timeout.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">from</code></p></td><td align="left" valign="top"><p>The starting from index of the hits to return. Defaults to <code class="literal">0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">size</code></p></td><td align="left" valign="top"><p>The number of hits to return. Defaults to <code class="literal">10</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">search_type</code></p></td><td align="left" valign="top"><p>The type of the search operation to perform. Can be
<code class="literal">dfs_query_then_fetch</code>, <code class="literal">dfs_query_and_fetch</code>, <code class="literal">query_then_fetch</code>,
<code class="literal">query_and_fetch</code>. Defaults to <code class="literal">query_then_fetch</code>. See
<a class="link" href="#search-request-search-type" title="Search Type"><span class="emphasis"><em>Search Type</em></span></a> for
more details on the different types of search that can be performed.</p></td></tr></tbody></table></div><p>Out of the above, the <code class="literal">search_type</code> is the one that can not be passed
within the search request body, and in order to set it, it must be
passed as a request REST parameter.</p><p>The rest of the search request should be passed within the body itself.
The body content can also be passed as a REST parameter named <code class="literal">source</code>.</p><p>Both HTTP GET and HTTP POST can be used to execute search with body.
Since not all clients support GET with body, POST is allowed as well.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-query"></a>Query</h2></div></div></div><p>The query element within the search request body allows to define a
query using the <a class="link" href="#query-dsl" title="Query DSL">Query DSL</a>.</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-from-size"></a>From / Size</h2></div></div></div><p>Pagination of results can be done by using the <code class="literal">from</code> and <code class="literal">size</code>
parameters. The <code class="literal">from</code> parameter defines the offset from the first
result you want to fetch. The <code class="literal">size</code> parameter allows you to configure
the maximum amount of hits to be returned.</p><p>Though <code class="literal">from</code> and <code class="literal">size</code> can be set as request parameters, they can also
be set within the search body. <code class="literal">from</code> defaults to <code class="literal">0</code>, and <code class="literal">size</code>
defaults to <code class="literal">10</code>.</p><pre class="programlisting prettyprint lang-js">{
    "from" : 0, "size" : 10,
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-sort"></a>Sort</h2></div></div></div><p>Allows to add one or more sort on specific fields. Each sort can be
reversed as well. The sort is defined on a per field level, with special
field name for <code class="literal">_score</code> to sort by score.</p><pre class="programlisting prettyprint lang-js">{
    "sort" : [
        { "post_date" : {"order" : "asc"}},
        "user",
        { "name" : "desc" },
        { "age" : "desc" },
        "_score"
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_sort_values"></a>Sort Values</h3></div></div></div><p>The sort values for each document returned are also returned as part of
the response.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_sort_mode_option"></a>Sort mode option</h3></div></div></div><p>Elasticsearch supports sorting by array or multi-valued fields. The <code class="literal">mode</code> option
controls what array value is picked for sorting the document it belongs
to. The <code class="literal">mode</code> option can have the following values:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">min</code>
</p>
</td><td valign="top">
<p>
Pick the lowest value.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max</code>
</p>
</td><td valign="top">
<p>
Pick the highest value.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">sum</code>
</p>
</td><td valign="top">
<p>
Use the sum of all values as sort value. Only applicable for
        number based array fields.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">avg</code>
</p>
</td><td valign="top">
<p>
Use the average of all values as sort value. Only applicable
        for number based array fields.
</p>
</td></tr></tbody></table></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_sort_mode_example_usage"></a>Sort mode example usage</h4></div></div></div><p>In the example below the field price has multiple prices per document.
In this case the result hits will be sort by price ascending based on
the average price per document.</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/_search' -d '{
   "query" : {
    ...
   },
   "sort" : [
      {"price" : {"order" : "asc", "mode" : "avg"}}
   ]
}'</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_sorting_within_nested_objects"></a>Sorting within nested objects.</h3></div></div></div><p>Elasticsearch also supports sorting by
fields that are inside one or more nested objects. The sorting by nested
field support has the following parameters on top of the already
existing sort options:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">nested_path</code>
</span></dt><dd>
    Defines the on what nested object to sort. The actual
    sort field must be a direct field inside this nested object. The default
    is to use the most immediate inherited nested object from the sort
    field.
</dd><dt><span class="term">
<code class="literal">nested_filter</code>
</span></dt><dd>
    A filter the inner objects inside the nested path
    should match with in order for its field values to be taken into account
    by sorting. Common case is to repeat the query / filter inside the
    nested filter or query. By default no <code class="literal">nested_filter</code> is active.
</dd></dl></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_nested_sorting_example"></a>Nested sorting example</h4></div></div></div><p>In the below example <code class="literal">offer</code> is a field of type <code class="literal">nested</code>. Because
<code class="literal">offer</code> is the closest inherited nested field, it is picked as
<code class="literal">nested_path</code>. Only the inner objects that have color blue will
participate in sorting.</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/_search' -d '{
   "query" : {
    ...
   },
   "sort" : [
       {
          "offer.price" : {
             "mode" :  "avg",
             "order" : "asc",
             "nested_filter" : {
                "term" : { "offer.color" : "blue" }
             }
          }
       }
    ]
}'</pre><p>Nested sorting is also supported when sorting by
scripts and sorting by geo distance.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_missing_values"></a>Missing Values</h3></div></div></div><p>The <code class="literal">missing</code> parameter specifies how docs which are missing
the field should be treated: The <code class="literal">missing</code> value can be
set to <code class="literal">_last</code>, <code class="literal">_first</code>, or a custom value (that
will be used for missing docs as the sort value). For example:</p><pre class="programlisting prettyprint lang-js">{
    "sort" : [
        { "price" : {"missing" : "_last"} },
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>If a nested inner object doesnât match with
the <code class="literal">nested_filter</code> then a missing value is used.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_ignoring_unmapped_fields"></a>Ignoring Unmapped Fields</h3></div></div></div><p>By default, the search request will fail if there is no mapping
associated with a field. The <code class="literal">ignore_unmapped</code> option allows to ignore
fields that have no mapping and not sort by them. Here is an example of
how it can be used:</p><pre class="programlisting prettyprint lang-js">{
    "sort" : [
        { "price" : {"ignore_unmapped" : true} },
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_geo_distance_sorting"></a>Geo Distance Sorting</h3></div></div></div><p>Allow to sort by <code class="literal">_geo_distance</code>. Here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "sort" : [
        {
            "_geo_distance" : {
                "pin.location" : [-70, 40],
                "order" : "asc",
                "unit" : "km"
            }
        }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre><p>Note: the geo distance sorting supports <code class="literal">sort_mode</code> options: <code class="literal">min</code>,
<code class="literal">max</code> and <code class="literal">avg</code>.</p><p>The following formats are supported in providing the coordinates:</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_lat_lon_as_properties"></a>Lat Lon as Properties</h4></div></div></div><pre class="programlisting prettyprint lang-js">{
    "sort" : [
        {
            "_geo_distance" : {
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                },
                "order" : "asc",
                "unit" : "km"
            }
        }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_lat_lon_as_string"></a>Lat Lon as String</h4></div></div></div><p>Format in <code class="literal">lat,lon</code>.</p><pre class="programlisting prettyprint lang-js">{
    "sort" : [
        {
            "_geo_distance" : {
                "pin.location" : "-70,40",
                "order" : "asc",
                "unit" : "km"
            }
        }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_geohash"></a>Geohash</h4></div></div></div><pre class="programlisting prettyprint lang-js">{
    "sort" : [
        {
            "_geo_distance" : {
                "pin.location" : "drm3btev3e86",
                "order" : "asc",
                "unit" : "km"
            }
        }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_lat_lon_as_array"></a>Lat Lon as Array</h4></div></div></div><p>Format in <code class="literal">[lon, lat]</code>, note, the order of lon/lat here in order to
conform with <a class="ulink" href="http://geojson.org/" target="_top">GeoJSON</a>.</p><pre class="programlisting prettyprint lang-js">{
    "sort" : [
        {
            "_geo_distance" : {
                "pin.location" : [-70, 40],
                "order" : "asc",
                "unit" : "km"
            }
        }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_based_sorting"></a>Script Based Sorting</h3></div></div></div><p>Allow to sort based on custom scripts, here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        ....
    },
    "sort" : {
        "_script" : {
            "script" : "doc['field_name'].value * factor",
            "type" : "number",
            "params" : {
                "factor" : 1.1
            },
            "order" : "asc"
        }
    }
}</pre><p>Note, it is recommended, for single custom based script based sorting,
to use <code class="literal">function_score</code> query instead as sorting based on score is faster.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_track_scores"></a>Track Scores</h3></div></div></div><p>When sorting on a field, scores are not computed. By setting
<code class="literal">track_scores</code> to true, scores will still be computed and tracked.</p><pre class="programlisting prettyprint lang-js">{
    "track_scores": true,
    "sort" : [
        { "post_date" : {"reverse" : true} },
        { "name" : "desc" },
        { "age" : "desc" }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_memory_considerations"></a>Memory Considerations</h3></div></div></div><p>When sorting, the relevant sorted field values are loaded into memory.
This means that per shard, there should be enough memory to contain
them. For string based types, the field sorted on should not be analyzed
/ tokenized. For numeric types, if possible, it is recommended to
explicitly set the type to six_hun types (like <code class="literal">short</code>, <code class="literal">integer</code> and
<code class="literal">float</code>).</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-source-filtering"></a>Source filtering</h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.0.0.Beta1.</p></div></div><p>Allows to control how the <code class="literal">_source</code> field is returned with every hit.</p><p>By default operations return the contents of the <code class="literal">_source</code> field unless
you have used the <code class="literal">fields</code> parameter or if the <code class="literal">_source</code> field is disabled.</p><p>You can turn off <code class="literal">_source</code> retrieval by using the <code class="literal">_source</code> parameter:</p><p>To disable <code class="literal">_source</code> retrieval set to <code class="literal">false</code>:</p><pre class="programlisting prettyprint lang-js">{
    "_source": false,
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre><p>The <code class="literal">_source</code> also accepts one or more wildcard patterns to control what parts of the <code class="literal">_source</code> should be returned:</p><p>For example:</p><pre class="programlisting prettyprint lang-js">{
    "_source": "obj.*",
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre><p>Or</p><pre class="programlisting prettyprint lang-js">{
    "_source": [ "obj1.*", "obj2.*" ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre><p>Finally, for complete control, you can specify both include and exclude patterns:</p><pre class="programlisting prettyprint lang-js">{
    "_source": {
        "include": [ "obj1.*", "obj2.*" ],
        "exclude": [ "*.description" ],
    }
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-fields"></a>Fields</h2></div></div></div><p>Allows to selectively load specific stored fields for each document represented
by a search hit.</p><pre class="programlisting prettyprint lang-js">{
    "fields" : ["user", "postDate"],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre><p><code class="literal">*</code> can be used to load all stored fields from the document.</p><p>An empty array will cause only the <code class="literal">_id</code> and <code class="literal">_type</code> for each hit to be
returned, for example:</p><pre class="programlisting prettyprint lang-js">{
    "fields" : [],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre><p>For backwards compatibility, if the fields parameter specifies fields which are not stored (<code class="literal">store</code> mapping set to
<code class="literal">false</code>), it will load the <code class="literal">_source</code> and extract it from it. This functionality has been replaced by the
<a class="link" href="#search-request-source-filtering" title="Source filtering">source filtering</a> parameter.</p><p>Field values fetched from the document it self are always returned as an array. Metadata fields like <code class="literal">_routing</code> and
<code class="literal">_parent</code> fields are never returned as an array.</p><p>Also only leaf fields can be returned via the <code class="literal">field</code> option. So object fields canât be returned and such requests
will fail.</p><p>Script fields can also be automatically detected and used as fields, so
things like <code class="literal">_source.obj1.field1</code> can be used, though not recommended, as
<code class="literal">obj1.field1</code> will work as well.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="partial"></a>Partial</h3></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><h4>Deprecated in 1.0.0Beta1.</h4><p>Replaced by <a class="xref" href="#search-request-source-filtering" title="Source filtering">Source filtering</a>.</p></div></div><p>When loading data from <code class="literal">_source</code>, partial fields can be used to use
wildcards to control what part of the <code class="literal">_source</code> will be loaded based on
<code class="literal">include</code> and <code class="literal">exclude</code> patterns. For example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "partial_fields" : {
        "partial1" : {
            "include" : "obj1.obj2.*",
        }
    }
}</pre><p>And one that will also exclude <code class="literal">obj1.obj3</code>:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "partial_fields" : {
        "partial1" : {
            "include" : "obj1.obj2.*",
            "exclude" : "obj1.obj3.*"
        }
    }
}</pre><p>Both <code class="literal">include</code> and <code class="literal">exclude</code> support multiple patterns:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "partial_fields" : {
        "partial1" : {
            "include" : ["obj1.obj2.*", "obj1.obj4.*"],
            "exclude" : "obj1.obj3.*"
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-script-fields"></a>Script Fields</h2></div></div></div><p>Allows to return a <a class="link" href="#modules-scripting" title="Scripting">script evaluation</a> (based on different fields) for each hit, for example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        ...
    },
    "script_fields" : {
        "test1" : {
            "script" : "doc['my_field_name'].value * 2"
        },
        "test2" : {
            "script" : "doc['my_field_name'].value * factor",
            "params" : {
                "factor"  : 2.0
            }
        }
    }
}</pre><p>Script fields can work on fields that are not stored (<code class="literal">my_field_name</code> in
the above case), and allow to return custom values to be returned (the
evaluated value of the script).</p><p>Script fields can also access the actual <code class="literal">_source</code> document indexed and
extract specific elements to be returned from it (can be an "object"
type). Here is an example:</p><pre class="programlisting prettyprint lang-js">    {
        "query" : {
            ...
        },
        "script_fields" : {
            "test1" : {
                "script" : "_source.obj1.obj2"
            }
        }
    }</pre><p>Note the <code class="literal">_source</code> keyword here to navigate the json-like model.</p><p>Itâs important to understand the difference between
<code class="literal">doc['my_field'].value</code> and <code class="literal">_source.my_field</code>. The first, using the doc
keyword, will cause the terms for that field to be loaded to memory
(cached), which will result in faster execution, but more memory
consumption. Also, the <code class="literal">doc[...]</code> notation only allows for simple valued
fields (canât return a json object from it) and make sense only on
non-analyzed or single term based fields.</p><p>The <code class="literal">_source</code> on the other hand causes the source to be loaded, parsed,
and then only the relevant part of the json is returned.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-fielddata-fields"></a>Field Data Fields</h2></div></div></div><p>Allows to return the field data representiation of a field for each hit, for
example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        ...
    },
    "fielddata_fields" : ["test1", "test2"]
}</pre><p>Field data fields can work on fields that are not stored.</p><p>Itâs important to understand that using the <code class="literal">fielddata_fields</code> parameter will
cause the terms for that field to be loaded to memory (cached), which will
result in more memory consumption.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-post-filter"></a>Post filter</h2></div></div></div><p>The <code class="literal">post_filter</code> allows any filter that it holds to be executed as last filter, because
of this the <code class="literal">post_filter</code> only has affect on the search hits and not facets.</p><p>There are several reasons why to specify filters as <code class="literal">post_filter</code>. One reason is to force
expensive filters to be executed as last filter, so that these filters only operate on the
docs that match with the rest of the query. An example of for what filter a post_filter
should be used for this reason is the <code class="literal">geo_distance</code> filter. The <code class="literal">geo_distance</code> filter is
in general an expensive filter to execute and to reduce the execution time for this filter,
one can choose to specify it as <code class="literal">post_filter</code>, so it runs on documents that are very likely
to be end up as matching documents.</p><p>Another important reason is when doing things like facet navigation,
sometimes only the hits are needed to be filtered by the chosen facet,
and all the facets should continue to be calculated based on the original query.
The <code class="literal">post_filter</code> element within the search request can be used to accomplish it.</p><p>Note, this is different compared to creating a <code class="literal">filtered</code> query with the
filter, since this will cause the facets to only process the filtered
results.</p><p>For example, letâs create two tweets, with two different tags:</p><pre class="programlisting prettyprint lang-js">curl -XPUT 'localhost:9200/twitter/tweet/1' -d '
{
    "message" : "something blue",
    "tag" : "blue"
}
'

curl -XPUT 'localhost:9200/twitter/tweet/2' -d '
{
    "message" : "something green",
    "tag" : "green"
}
'

curl -XPOST 'localhost:9200/_refresh'</pre><p>We can now search for something, and have a terms facet.</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/twitter/_search?pretty=true' -d '
{
    "query" : {
        "term" : { "message" : "something" }
    },
    "facets" : {
        "tag" : {
            "terms" : { "field" : "tag" }
        }
    }
}
'</pre><p>We get two hits, and the relevant facets with a count of 1 for both
<code class="literal">green</code> and <code class="literal">blue</code>. Now, letâs say the <code class="literal">green</code> facet is chosen, we can
simply add a filter for it:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/twitter/_search?pretty=true' -d '
{
    "query" : {
        "term" : { "message" : "something" }
    },
    "post_filter" : {
        "term" : { "tag" : "green" }
    },
    "facets" : {
        "tag" : {
            "terms" : { "field" : "tag" }
        }
    }
}
'</pre><p>And now, we get only 1 hit back, but the facets remain the same.</p><p>Note, if additional filters are required on specific facets, they can be
added as a <code class="literal">facet_filter</code> to the relevant facets.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-highlighting"></a>Highlighting</h2></div></div></div><p>Allows to highlight search results on one or more fields. The
implementation uses either the lucene <code class="literal">highlighter</code>, <code class="literal">fast-vector-highlighter</code>
or <code class="literal">postings-highlighter</code>. The following is an example of the  search request
body:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {}
        }
    }
}</pre><p>In the above case, the <code class="literal">content</code> field will be highlighted for each
search hit (there will be another element in each search hit, called
<code class="literal">highlight</code>, which includes the highlighted fields and the highlighted
fragments).</p><p>In order to perform highlighting, the actual content of the field is
required. If the field in question is stored (has <code class="literal">store</code> set to <code class="literal">true</code>
in the mapping) it will be used, otherwise, the actual <code class="literal">_source</code> will
be loaded and the relevant field will be extracted from it.</p><p>The field name supports wildcard notation. For example, using <code class="literal">comment_*</code>
will cause all fields that match the expression to be highlighted.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_postings_highlighter"></a>Postings highlighter</h3></div></div></div><p>If <code class="literal">index_options</code> is set to <code class="literal">offsets</code> in the mapping the postings highlighter
will be used instead of the plain highlighter. The postings highlighter:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Is faster since it doesnât require to reanalyze the text to be highlighted:
the larger the documents the better the performance gain should be
</li><li class="listitem">
Requires less disk space than term_vectors, needed for the fast vector
highlighter
</li><li class="listitem">
Breaks the text into sentences and highlights them. Plays really well with
natural languages, not as well with fields containing for instance html markup
</li><li class="listitem">
Treats the document as the whole corpus, and scores individual sentences as
if they were documents in this corpus, using the  BM25 algorithm
</li></ul></div><p>Here is an example of setting the <code class="literal">content</code> field to allow for
highlighting using the postings highlighter on it:</p><pre class="programlisting prettyprint lang-js">{
    "type_name" : {
        "content" : {"index_options" : "offsets"}
    }
}</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Note that the postings highlighter is meant to perform simple query terms
highlighting, regardless of their positions. That means that when used for
instance in combination with a phrase query, it will highlight all the terms
that the query is composed of, regardless of whether they are actually part of
a query match, effectively ignoring their positions.</p></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>The postings highlighter does support highlighting of multi term queries, like
prefix queries, wildcard queries and so on. On the other hand, this requires
the queries to be rewritten using a proper
<a class="link" href="#query-dsl-multi-term-rewrite" title="Multi Term Query Rewrite">rewrite method</a> that supports multi term
extraction, which is a potentially expensive operation.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_fast_vector_highlighter"></a>Fast vector highlighter</h3></div></div></div><p>If <code class="literal">term_vector</code> information is provided by setting <code class="literal">term_vector</code> to
<code class="literal">with_positions_offsets</code> in the mapping then the fast vector highlighter
will be used instead of the plain highlighter.  The fast vector highlighter:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Is faster especially for large fields (&gt; <code class="literal">1MB</code>)
</li><li class="listitem">
Can be customized with <code class="literal">boundary_chars</code>, <code class="literal">boundary_max_scan</code>, and
 <code class="literal">fragment_offset</code> (see <a class="link" href="#boundary-characters" title="Boundary Characters">below</a>)
</li><li class="listitem">
Requires setting <code class="literal">term_vector</code> to <code class="literal">with_positions_offsets</code> which
  increases the size of the index
</li><li class="listitem">
Can combine matches from multiple fields into one result.  See
  <code class="literal">matched_fields</code>
</li><li class="listitem">
Can assign different weights to matches at different positions allowing
  for things like phrase matches being sorted above term matches when
  highlighting a Boosting Query that boosts phrase matches over term matches
</li></ul></div><p>Here is an example of setting the <code class="literal">content</code> field to allow for
highlighting using the fast vector highlighter on it (this will cause
the index to be bigger):</p><pre class="programlisting prettyprint lang-js">{
    "type_name" : {
        "content" : {"term_vector" : "with_positions_offsets"}
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_force_highlighter_type"></a>Force highlighter type</h3></div></div></div><p>The <code class="literal">type</code> field allows to force a specific highlighter type. This is useful
for instance when needing to use the plain highlighter on a field that has
<code class="literal">term_vectors</code> enabled. The allowed values are: <code class="literal">plain</code>, <code class="literal">postings</code> and <code class="literal">fvh</code>.
The following is an example that forces the use of the plain highlighter:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {"type" : "plain"}
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_force_highlighting_on_source"></a>Force highlighting on source</h3></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.0.0.RC1.</p></div></div><p>Forces the highlighting to highlight fields based on the source even if fields are
stored separately. Defaults to <code class="literal">false</code>.</p><pre class="programlisting prettyprint lang-js">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {"force_source" : true}
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="tags"></a>Highlighting Tags</h3></div></div></div><p>By default, the highlighting will wrap highlighted text in <code class="literal">&lt;em&gt;</code> and
<code class="literal">&lt;/em&gt;</code>. This can be controlled by setting <code class="literal">pre_tags</code> and <code class="literal">post_tags</code>,
for example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {...},
    "highlight" : {
        "pre_tags" : ["&lt;tag1&gt;"],
        "post_tags" : ["&lt;/tag1&gt;"],
        "fields" : {
            "_all" : {}
        }
    }
}</pre><p>Using the fast vector highlighter there can be more tags, and the "importance"
is ordered.</p><pre class="programlisting prettyprint lang-js">{
    "query" : {...},
    "highlight" : {
        "pre_tags" : ["&lt;tag1&gt;", "&lt;tag2&gt;"],
        "post_tags" : ["&lt;/tag1&gt;", "&lt;/tag2&gt;"],
        "fields" : {
            "_all" : {}
        }
    }
}</pre><p>There are also built in "tag" schemas, with currently a single schema
called <code class="literal">styled</code> with the following <code class="literal">pre_tags</code>:</p><pre class="programlisting prettyprint lang-js">&lt;em class="hlt1"&gt;, &lt;em class="hlt2"&gt;, &lt;em class="hlt3"&gt;,
&lt;em class="hlt4"&gt;, &lt;em class="hlt5"&gt;, &lt;em class="hlt6"&gt;,
&lt;em class="hlt7"&gt;, &lt;em class="hlt8"&gt;, &lt;em class="hlt9"&gt;,
&lt;em class="hlt10"&gt;</pre><p>and <code class="literal">&lt;/em&gt;</code> as <code class="literal">post_tags</code>. If you think of more nice to have built in tag
schemas, just send an email to the mailing list or open an issue. Here
is an example of switching tag schemas:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {...},
    "highlight" : {
        "tags_schema" : "styled",
        "fields" : {
            "content" : {}
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_encoder"></a>Encoder</h3></div></div></div><p>An <code class="literal">encoder</code> parameter can be used to define how highlighted text will
be encoded. It can be either <code class="literal">default</code> (no encoding) or <code class="literal">html</code> (will
escape html, if you use html highlighting tags).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_highlighted_fragments"></a>Highlighted Fragments</h3></div></div></div><p>Each field highlighted can control the size of the highlighted fragment
in characters (defaults to <code class="literal">100</code>), and the maximum number of fragments
to return (defaults to <code class="literal">5</code>).
For example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {"fragment_size" : 150, "number_of_fragments" : 3}
        }
    }
}</pre><p>The <code class="literal">fragment_size</code> is ignored when using the postings highlighter, as it
outputs sentences regardless of their length.</p><p>On top of this it is possible to specify that highlighted fragments need
to be sorted by score:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {...},
    "highlight" : {
        "order" : "score",
        "fields" : {
            "content" : {"fragment_size" : 150, "number_of_fragments" : 3}
        }
    }
}</pre><p>If the <code class="literal">number_of_fragments</code> value is set to <code class="literal">0</code> then no fragments are
produced, instead the whole content of the field is returned, and of
course it is highlighted. This can be very handy if short texts (like
document title or address) need to be highlighted but no fragmentation
is required. Note that <code class="literal">fragment_size</code> is ignored in this case.</p><pre class="programlisting prettyprint lang-js">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "_all" : {},
            "bio.title" : {"number_of_fragments" : 0}
        }
    }
}</pre><p>When using <code class="literal">fast-vector-highlighter</code> one can use <code class="literal">fragment_offset</code>
parameter to control the margin to start highlighting from.</p><p>In the case where there is no matching fragment to highlight, the default is
to not return anything. Instead, we can return a snippet of text from the
beginning of the field by setting <code class="literal">no_match_size</code> (default <code class="literal">0</code>) to the length
of the text that you want returned. The actual length may be shorter than
specified as it tries to break on a word boundary. When using the postings
highlighter it is not possible to control the actual size of the snippet,
therefore the first sentence gets returned whenever <code class="literal">no_match_size</code> is
greater than <code class="literal">0</code>.</p><pre class="programlisting prettyprint lang-js">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {
                "fragment_size" : 150,
                "number_of_fragments" : 3,
                "no_match_size": 150
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_highlight_query"></a>Highlight query</h3></div></div></div><p>It is also possible to highlight against a query other than the search
query by setting <code class="literal">highlight_query</code>.  This is especially useful if you
use a rescore query because those are not taken into account by
highlighting by default.  Elasticsearch does not validate that
<code class="literal">highlight_query</code> contains the search query in any way so it is possible
to define it so legitimate query results arenât highlighted at all.
Generally it is better to include the search query in the
<code class="literal">highlight_query</code>.  Here is an example of including both the search
query and the rescore query in <code class="literal">highlight_query</code>.</p><pre class="programlisting prettyprint lang-js">{
    "fields": [ "_id" ],
    "query" : {
        "match": {
            "content": {
                "query": "foo bar"
            }
        }
    },
    "rescore": {
        "window_size": 50,
        "query": {
            "rescore_query" : {
                "match_phrase": {
                    "content": {
                        "query": "foo bar",
                        "phrase_slop": 1
                    }
                }
            },
            "rescore_query_weight" : 10
        }
    },
    "highlight" : {
        "order" : "score",
        "fields" : {
            "content" : {
                "fragment_size" : 150,
                "number_of_fragments" : 3,
                "highlight_query": {
                    "bool": {
                        "must": {
                            "match": {
                                "content": {
                                    "query": "foo bar"
                                }
                            }
                        },
                        "should": {
                            "match_phrase": {
                                "content": {
                                    "query": "foo bar",
                                    "phrase_slop": 1,
                                    "boost": 10.0
                                }
                            }
                        },
                        "minimum_should_match": 0
                    }
                }
            }
        }
    }
}</pre><p>Note that the score of text fragment in this case is calculated by the Lucene
highlighting framework. For implementation details you can check the
<code class="literal">ScoreOrderFragmentsBuilder.java</code> class. On the other hand when using the
postings highlighter the fragments are scored using, as mentioned above,
the BM25 algorithm.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="highlighting-settings"></a>Global Settings</h3></div></div></div><p>Highlighting settings can be set on a global level and then overridden
at the field level.</p><pre class="programlisting prettyprint lang-js">{
    "query" : {...},
    "highlight" : {
        "number_of_fragments" : 3,
        "fragment_size" : 150,
        "tag_schema" : "styled",
        "fields" : {
            "_all" : { "pre_tags" : ["&lt;em&gt;"], "post_tags" : ["&lt;/em&gt;"] },
            "bio.title" : { "number_of_fragments" : 0 },
            "bio.author" : { "number_of_fragments" : 0 },
            "bio.content" : { "number_of_fragments" : 5, "order" : "score" }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="field-match"></a>Require Field Match</h3></div></div></div><p><code class="literal">require_field_match</code> can be set to <code class="literal">true</code> which will cause a field to
be highlighted only if a query matched that field. <code class="literal">false</code> means that
terms are highlighted on all requested fields regardless if the query
matches specifically on them.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="boundary-characters"></a>Boundary Characters</h3></div></div></div><p>When highlighting a field using the fast vector highlighter,
<code class="literal">boundary_chars</code> can be configured to define what constitutes a boundary
for highlighting. Itâs a single string with each boundary character
defined in it. It defaults to <code class="literal">.,!? \t\n</code>.</p><p>The <code class="literal">boundary_max_scan</code> allows to control how far to look for boundary
characters, and defaults to <code class="literal">20</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="matched-fields"></a>Matched Fields</h3></div></div></div><p>The Fast Vector Highlighter can combine matches on multiple fields to
highlight a single field using <code class="literal">matched_fields</code>.  This is most
intuitive for multifields that analyze the same string in different
ways.  All <code class="literal">matched_fields</code> must have <code class="literal">term_vector</code> set to
<code class="literal">with_positions_offsets</code> but only the field to which the matches are
combined is loaded so only that field would benefit from having
<code class="literal">store</code> set to <code class="literal">yes</code>.</p><p>In the following examples <code class="literal">content</code> is analyzed by the <code class="literal">english</code>
analyzer and <code class="literal">content.plain</code> is analyzed by the <code class="literal">standard</code> analyzer.</p><pre class="programlisting prettyprint lang-js">{
    "query": {
        "query_string": {
            "query": "content.plain:running scissors",
            "fields": ["content"]
        }
    },
    "highlight": {
        "order": "score",
        "fields": {
            "content": {
                "matched_fields": ["content", "content.plain"],
                "type" : "fvh"
            }
        }
    }
}</pre><p>The above matches both "run with scissors" and "running with scissors"
and would highlight "running" and "scissors" but not "run". If both
phrases appear in a large document then "running with scissors" is
sorted above "run with scissors" in the fragments list because there
are more matches in that fragment.</p><pre class="programlisting prettyprint lang-js">{
    "query": {
        "query_string": {
            "query": "running scissors",
            "fields": ["content", "content.plain^10"]
        }
    },
    "highlight": {
        "order": "score",
        "fields": {
            "content": {
                "matched_fields": ["content", "content.plain"],
                "type" : "fvh"
            }
        }
    }
}</pre><p>The above highlights "run" as well as "running" and "scissors" but
still sorts "running with scissors" above "run with scissors" because
the plain match ("running") is boosted.</p><pre class="programlisting prettyprint lang-js">{
    "query": {
        "query_string": {
            "query": "running scissors",
            "fields": ["content", "content.plain^10"]
        }
    },
    "highlight": {
        "order": "score",
        "fields": {
            "content": {
                "matched_fields": ["content.plain"],
                "type" : "fvh"
            }
        }
    }
}</pre><p>The above query wouldnât highlight "run" or "scissor" but shows that
it is just fine not to list the field to which the matches are combined
(<code class="literal">content</code>) in the matched fields.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Technically it is also fine to add fields to <code class="literal">matched_fields</code> that
donât share the same underlying string as the field to which the matches
are combined.  The results might not make much sense and if one of the
matches is off the end of the text then the whole the query will fail.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>There is a small amount of overhead involved with setting
<code class="literal">matched_fields</code> to a non-empty array so always prefer</p><pre class="programlisting prettyprint lang-js">    "highlight": {
        "fields": {
            "content": {}
        }
    }</pre><p>to</p><pre class="programlisting prettyprint lang-js">    "highlight": {
        "fields": {
            "content": {
                "matched_fields": ["content"],
                "type" : "fvh"
            }
        }
    }</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="phrase-limit"></a>Phrase Limit</h3></div></div></div><p>The <code class="literal">fast-vector-highlighter</code> has a <code class="literal">phrase_limit</code> parameter that prevents
it from analyzing too many phrases and eating tons of memory.  It defaults
to 256 so only the first 256 matching phrases in the document scored
considered.  You can raise the limit with the <code class="literal">phrase_limit</code> parameter but
keep in mind that scoring more phrases consumes more time and memory.</p><p>If using <code class="literal">matched_fields</code> keep in mind that <code class="literal">phrase_limit</code> phrases per
matched field are considered.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-rescore"></a>Rescoring</h2></div></div></div><p>Rescoring can help to improve precision by reordering just the top (eg
100 - 500) documents returned by the
<a class="link" href="#search-request-query" title="Query"><code class="literal">query</code></a> and
<a class="link" href="#search-request-post-filter" title="Post filter"><code class="literal">post_filter</code></a> phases, using a
secondary (usually more costly) algorithm, instead of applying the
costly algorithm to all documents in the index.</p><p>A <code class="literal">rescore</code> request is executed on each shard before it returns its
results to be sorted by the node handling the overall search request.</p><p>Currently the rescore API has only one implementation: the query
rescorer, which uses a query to tweak the scoring. In the future,
alternative rescorers may be made available, for example, a pair-wise rescorer.</p><p><span class="strong"><strong>Note:</strong></span> the <code class="literal">rescore</code> phase is not executed when
<a class="link" href="#search-request-search-type" title="Search Type"><code class="literal">search_type</code></a> is set
to <code class="literal">scan</code> or <code class="literal">count</code>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_query_rescorer"></a>Query rescorer</h3></div></div></div><p>The query rescorer executes a second query only on the Top-K results
returned by the <a class="link" href="#search-request-query" title="Query"><code class="literal">query</code></a> and
<a class="link" href="#search-request-post-filter" title="Post filter"><code class="literal">post_filter</code></a> phases. The
number of docs which will be examined on each shard can be controlled by
the <code class="literal">window_size</code> parameter, which defaults to
<a class="link" href="#search-request-from-size" title="From / Size"><code class="literal">from</code> and <code class="literal">size</code></a>.</p><p>By default the scores from the original query and the rescore query are
combined linearly to produce the final <code class="literal">_score</code> for each document. The
relative importance of the original query and of the rescore query can
be controlled with the <code class="literal">query_weight</code> and <code class="literal">rescore_query_weight</code>
respectively. Both default to <code class="literal">1</code>.</p><p>For example:</p><pre class="programlisting prettyprint lang-js">curl -s -XPOST 'localhost:9200/_search' -d '{
   "query" : {
      "match" : {
         "field1" : {
            "operator" : "or",
            "query" : "the quick brown",
            "type" : "boolean"
         }
      }
   },
   "rescore" : {
      "window_size" : 50,
      "query" : {
         "rescore_query" : {
            "match" : {
               "field1" : {
                  "query" : "the quick brown",
                  "type" : "phrase",
                  "slop" : 2
               }
            }
         },
         "query_weight" : 0.7,
         "rescore_query_weight" : 1.2
      }
   }
}
'</pre><p>The way the scores are combined can be controled with the <code class="literal">score_mode</code>:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Score Mode </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">total</code></p></td><td align="left" valign="top"><p>Add the original score and the rescore query score.  The default.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">multiply</code></p></td><td align="left" valign="top"><p>Multiply the original score by the rescore query score.  Useful
for <a class="link" href="#query-dsl-function-score-query" title="Function Score Query"><code class="literal">function query</code></a> rescores.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">avg</code></p></td><td align="left" valign="top"><p>Average the original score and the rescore query score.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max</code></p></td><td align="left" valign="top"><p>Take the max of original score and the rescore query score.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">min</code></p></td><td align="left" valign="top"><p>Take the min of the original score and the rescore query score.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multiple_rescores"></a>Multiple Rescores</h3></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.1.0.</p></div></div><p>It is also possible to execute multiple rescores in sequence:</p><pre class="programlisting prettyprint lang-js">curl -s -XPOST 'localhost:9200/_search' -d '{
   "query" : {
      "match" : {
         "field1" : {
            "operator" : "or",
            "query" : "the quick brown",
            "type" : "boolean"
         }
      }
   },
   "rescore" : [ {
      "window_size" : 100,
      "query" : {
         "rescore_query" : {
            "match" : {
               "field1" : {
                  "query" : "the quick brown",
                  "type" : "phrase",
                  "slop" : 2
               }
            }
         },
         "query_weight" : 0.7,
         "rescore_query_weight" : 1.2
      }
   }, {
      "window_size" : 10,
      "query" : {
         "score_mode": "multiply",
         "rescore_query" : {
            "function_score" : {
               "script_score": {
                  "script": "log10(doc['numeric'].value + 2)"
               }
            }
         }
      }
   } ]
}
'</pre><p>The first one gets the results of the query then the second one gets the
results of the first, etc.  The second rescore will "see" the sorting done
by the first rescore so it is possible to use a large window on the first
rescore to pull documents into a smaller window for the second rescore.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-search-type"></a>Search Type</h2></div></div></div><p>There are different execution paths that can be done when executing a
distributed search. The distributed search operation needs to be
scattered to all the relevant shards and then all the results are
gathered back. When doing scatter/gather type execution, there are
several ways to do that, specifically with search engines.</p><p>One of the questions when executing a distributed search is how much
results to retrieve from each shard. For example, if we have 10 shards,
the 1st shard might hold the most relevant results from 0 till 10, with
other shards results ranking below it. For this reason, when executing a
request, we will need to get results from 0 till 10 from all shards,
sort them, and then return the results if we want to insure correct
results.</p><p>Another question, which relates to search engine, is the fact that each
shard stands on its own. When a query is executed on a specific shard,
it does not take into account term frequencies and other search engine
information from the other shards. If we want to support accurate
ranking, we would need to first execute the query against all shards and
gather the relevant term frequencies, and then, based on it, execute the
query.</p><p>Also, because of the need to sort the results, getting back a large
document set, or even scrolling it, while maintaing the correct sorting
behavior can be a very expensive operation. For large result set
scrolling without sorting, the <code class="literal">scan</code> search type (explained below) is
also available.</p><p>Elasticsearch is very flexible and allows to control the type of search
to execute on a <span class="strong"><strong>per search request</strong></span> basis. The type can be configured
by setting the <span class="strong"><strong>search_type</strong></span> parameter in the query string. The types
are:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="query-and-fetch"></a>Query And Fetch</h3></div></div></div><p>Parameter value: <span class="strong"><strong>query_and_fetch</strong></span>.</p><p>The most naive (and possibly fastest) implementation is to simply
execute the query on all relevant shards and return the results. Each
shard returns <code class="literal">size</code> results. Since each shard already returns <code class="literal">size</code>
hits, this type actually returns <code class="literal">size</code> times <code class="literal">number of shards</code> results
back to the caller.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="query-then-fetch"></a>Query Then Fetch</h3></div></div></div><p>Parameter value: <span class="strong"><strong>query_then_fetch</strong></span>.</p><p>The query is executed against all shards, but only enough information is
returned (<span class="strong"><strong>not the document content</strong></span>). The results are then sorted and
ranked, and based on it, <span class="strong"><strong>only the relevant shards</strong></span> are asked for the
actual document content. The return number of hits is exactly as
specified in <code class="literal">size</code>, since they are the only ones that are fetched. This
is very handy when the index has a lot of shards (not replicas, shard id
groups).</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This is the default setting, if you do not specify a <code class="literal">search_type</code>
      in your request.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="dfs-query-and-fetch"></a>Dfs, Query And Fetch</h3></div></div></div><p>Parameter value: <span class="strong"><strong>dfs_query_and_fetch</strong></span>.</p><p>Same as "Query And Fetch", except for an initial scatter phase which
goes and computes the distributed term frequencies for more accurate
scoring.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="dfs-query-then-fetch"></a>Dfs, Query Then Fetch</h3></div></div></div><p>Parameter value: <span class="strong"><strong>dfs_query_then_fetch</strong></span>.</p><p>Same as "Query Then Fetch", except for an initial scatter phase which
goes and computes the distributed term frequencies for more accurate
scoring.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="count"></a>Count</h3></div></div></div><p>Parameter value: <span class="strong"><strong>count</strong></span>.</p><p>A special search type that returns the count that matched the search
request without any docs (represented in <code class="literal">total_hits</code>), and possibly,
including facets as well. In general, this is preferable to the <code class="literal">count</code>
API as it provides more options.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="scan"></a>Scan</h3></div></div></div><p>Parameter value: <span class="strong"><strong>scan</strong></span>.</p><p>The <code class="literal">scan</code> search type allows to efficiently scroll a large result set.
Itâs used first by executing a search request with scrolling and a
query:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/_search?search_type=scan&amp;scroll=10m&amp;size=50' -d '
{
    "query" : {
        "match_all" : {}
    }
}
'</pre><p>The <code class="literal">scroll</code> parameter control the keep alive time of the scrolling
request and initiates the scrolling process. The timeout applies per
round trip (i.e. between the previous scan scroll request, to the next).</p><p>The response will include no hits, with two important results, the
<code class="literal">total_hits</code> will include the total hits that match the query, and the
<code class="literal">scroll_id</code> that allows to start the scroll process. From this stage,
the <code class="literal">_search/scroll</code> endpoint should be used to scroll the hits, feeding
the next scroll request with the previous search result <code class="literal">scroll_id</code>. For
example:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/_search/scroll?scroll=10m' -d 'c2NhbjsxOjBLMzdpWEtqU2IyZHlmVURPeFJOZnc7MzowSzM3aVhLalNiMmR5ZlVET3hSTmZ3OzU6MEszN2lYS2pTYjJkeWZVRE94Uk5mdzsyOjBLMzdpWEtqU2IyZHlmVURPeFJOZnc7NDowSzM3aVhLalNiMmR5ZlVET3hSTmZ3Ow=='</pre><p>Scroll requests will include a number of hits equal to the size
multiplied by the number of primary shards.</p><p>The "breaking" condition out of a scroll is when no hits has been
returned. The total_hits will be maintained between scroll requests.</p><p>Note, scan search type does not support sorting (either on score or a
field) or faceting.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="clear-scroll"></a>Clear scroll api</h4></div></div></div><p>Besides consuming the scroll search until no hits has been returned a scroll
search can also be aborted by deleting the <code class="literal">scroll_id</code>. This can be done via
the clear scroll api. When the <code class="literal">scroll_id</code> has been deleted all the
resources to keep the view open will be released. Example usage:</p><pre class="programlisting prettyprint lang-js">curl -XDELETE 'localhost:9200/_search/scroll/c2NhbjsxOjBLMzdpWEtqU2IyZHlmVURPeFJOZnc7MzowSzM3aVhLalNiMmR5ZlVET3hSTmZ3OzU6MEszN2lYS2pTYjJkeWZVRE94Uk5mdzsyOjBLMzdpWEtqU2IyZHlmVURPeFJOZnc7NDowSzM3aVhLalNiMmR5ZlVET3hSTmZ3Ow=='</pre><p>Multiple scroll ids can be specified in a comma separated manner.
If all scroll ids need to be cleared the reserved <code class="literal">_all</code> value can used instead of an actual <code class="literal">scroll_id</code>:</p><pre class="programlisting prettyprint lang-js">curl -XDELETE 'localhost:9200/_search/scroll/_all'</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-scroll"></a>Scroll</h2></div></div></div><p>A search request can be scrolled by specifying the <code class="literal">scroll</code> parameter.
The <code class="literal">scroll</code> parameter is a time value parameter (for example:
<code class="literal">scroll=5m</code>), indicating for how long the nodes that participate in the
search will maintain relevant resources in order to continue and support
it. This is very similar in its idea to opening a cursor against a
database.</p><p>A <code class="literal">scroll_id</code> is returned from the first search request (and from
continuous) scroll requests. The <code class="literal">scroll_id</code> should be used when
scrolling (along with the <code class="literal">scroll</code> parameter, to stop the scroll from
expiring). The scroll id can also be passed as part of the search
request body.</p><p><span class="strong"><strong>Note</strong></span>: the <code class="literal">scroll_id</code> changes for each scroll request and only the
most recent one should be used.</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/twitter/tweet/_search?scroll=5m' -d '{
    "query": {
        "query_string" : {
            "query" : "some query string here"
        }
    }
}
'</pre><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_search/scroll?scroll=5m&amp;scroll_id=c2Nhbjs2OzM0NDg1ODpzRlBLc0FXNlNyNm5JWUc1'</pre><p>Scrolling is not intended for real time user requests, it is intended
for cases like scrolling over large portions of data that exists within
elasticsearch to reindex it for example.</p><p>For more information on scrolling, see the
<a class="link" href="#search-request-search-type" title="Search Type">scan</a> search type.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-preference"></a>Preference</h2></div></div></div><p>Controls a <code class="literal">preference</code> of which shard replicas to execute the search
request on. By default, the operation is randomized between the shard
replicas.</p><p>The <code class="literal">preference</code> can be set to:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">_primary</code>
</p>
</td><td valign="top">
<p>
        The operation will go and be executed only on the primary
        shards.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">_primary_first</code>
</p>
</td><td valign="top">
<p>
        The operation will go and be executed on the primary
        shard, and if not available (failover), will execute on other shards.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">_local</code>
</p>
</td><td valign="top">
<p>
        The operation will prefer to be executed on a local
        allocated shard if possible.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">_only_node:xyz</code>
</p>
</td><td valign="top">
<p>
        Restricts the search to execute only on a node with
        the provided node id (<code class="literal">xyz</code> in this case).
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">_prefer_node:xyz</code>
</p>
</td><td valign="top">
<p>
        Prefers execution on the node with the provided
        node id (<code class="literal">xyz</code> in this case) if applicable.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">_shards:2,3</code>
</p>
</td><td valign="top">
<p>
        Restricts the operation to the specified shards. (<code class="literal">2</code>
        and <code class="literal">3</code> in this case). This preference can be combined with other
        preferences but it has to appear first: <code class="literal">_shards:2,3;_primary</code>
</p>
</td></tr><tr><td valign="top">
<p>
Custom (string) value
</p>
</td><td valign="top">
<p>
        A custom value will be used to guarantee that
        the same shards will be used for the same custom value. This can help
        with "jumping values" when hitting different shards in different refresh
        states. A sample value can be something like the web session id, or the
        user name.
</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-explain"></a>Explain</h2></div></div></div><p>Enables explanation for each hit on how its score was computed.</p><pre class="programlisting prettyprint lang-js">{
    "explain": true,
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-version"></a>Version</h2></div></div></div><p>Returns a version for each search hit.</p><pre class="programlisting prettyprint lang-js">{
    "version": true,
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-index-boost"></a>Index Boost</h2></div></div></div><p>Allows to configure different boost level per index when searching
across more than one indices. This is very handy when hits coming from
one index matter more than hits coming from another index (think social
graph where each user has an index).</p><pre class="programlisting prettyprint lang-js">{
    "indices_boost" : {
        "index1" : 1.4,
        "index2" : 1.3
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-min-score"></a>min_score</h2></div></div></div><p>Exclude documents which have a <code class="literal">_score</code> less than the minimum specified
in <code class="literal">min_score</code>:</p><pre class="programlisting prettyprint lang-js">{
    "min_score": 0.5,
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre><p>Note, most times, this does not make much sense, but is provided for
advanced use cases.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-named-queries-and-filters"></a>Named Queries and Filters</h2></div></div></div><p>Each filter and query can accept a <code class="literal">_name</code> in its top level definition.</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "bool" : {
                "should" : [
                    {"match" : { "name.first" : {"query" : "shay", "_name" : "first"} }},
                    {"match" : { "name.last" : {"query" : "banon", "_name" : "last"} }}
                ]
            }
        },
        "filter" : {
            "terms" : {
                "name.last" : ["banon", "kimchy"],
                "_name" : "test"
            }
        }
    }
}</pre><p>The search response will include for each hit the <code class="literal">matched_filters</code> it matched on. The tagging of queries and filters
only make sense for compound queries and filters (such as <code class="literal">bool</code> query and filter, <code class="literal">or</code> and <code class="literal">and</code> filter, <code class="literal">filtered</code> query etc.).</p><p>Note, the query filter had to be enhanced in order to support this. In
order to set a name, the <code class="literal">fquery</code> filter should be used, which wraps a
query (just so there will be a place to set a name for it), for example:</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "fquery" : {
                "query" : {
                    "term" : { "name.last" : "banon" }
                },
                "_name" : "test"
            }
        }
    }
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_named_queries"></a>Named queries</h3></div></div></div><p>The support for the <code class="literal">_name</code> option on queries as available from version <code class="literal">0.90.4</code> and the support on filters is available
also in versions before <code class="literal">0.90.4</code>.</p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-template"></a>Search Template</h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.1.0.</p></div></div><p>The <code class="literal">/_search/template</code> endpoint allows to use the mustache language to pre render search requests,
before they are executed and fill existing templates with template parameters.</p><pre class="programlisting prettyprint lang-js">GET /_search/template
{
    "template" : {
      "query": { "match" : { "{{my_field}}" : "{{my_value}}" } },
      "size" : "{{my_size}}"
    },
    "params" : {
        "my_field" : "foo",
        "my_value" : "bar",
        "my_size" : 5
    }
}</pre><p>For more information on how Mustache templating and what kind of templating you
can do with it check out the <a class="ulink" href="http://mustache.github.io/mustache.5.html" target="_top">online
documentation of the mustache project</a>.</p><h4><a id="_more_template_examples"></a>More template examples</h4><h5><a id="_filling_in_a_query_string_with_a_single_value"></a>Filling in a query string with a single value</h5><pre class="programlisting prettyprint lang-js">GET /_search/template
{
    "template": {
        "query": {
            "match": {
                "title": "{{query_string}}"
            }
        }
    },
    "params": {
        "query_string": "search for these words"
    }
}</pre><h5><a id="_passing_an_array_of_strings"></a>Passing an array of strings</h5><pre class="programlisting prettyprint lang-js">GET /_search/template
{
  "template": {
    "query": {
      "terms": {
        "status": [
          "{{#status}}",
          "{{.}}",
          "{{/status}}"
        ]
      }
    }
  },
  "params": {
    "status": [ "pending", "published" ]
  }
}</pre><p>which is rendered as:</p><pre class="programlisting prettyprint lang-js">{
"query": {
  "terms": {
    "status": [ "pending", "published" ]
  }
}</pre><h5><a id="_default_values"></a>Default values</h5><p>A default value is written as <code class="literal">{{var}}{{^var}}default{{/var}}</code> for instance:</p><pre class="programlisting prettyprint lang-js">{
  "template": {
    "query": {
      "range": {
        "line_no": {
          "gte": "{{start}}",
          "lte": "{{end}}{{^end}}20{{/end}}"
        }
      }
    }
  },
  "params": { ... }
}</pre><p>When <code class="literal">params</code> is <code class="literal">{ "start": 10, "end": 15 }</code> this query would be rendered as:</p><pre class="programlisting prettyprint lang-js">{
    "range": {
        "line_no": {
            "gte": "10",
            "lte": "15"
        }
  }
}</pre><p>But when <code class="literal">params</code> is <code class="literal">{ "start": 10 }</code> this query would use the default value
for <code class="literal">end</code>:</p><pre class="programlisting prettyprint lang-js">{
    "range": {
        "line_no": {
            "gte": "10",
            "lte": "20"
        }
    }
}</pre><h5><a id="_conditional_clauses"></a>Conditional clauses</h5><p>Conditional clauses cannot be expressed using the JSON form of the template.
Instead, the template <span class="strong"><strong>must</strong></span> be passed as a string.  For instance, letâs say
we wanted to run a <code class="literal">match</code> query on the <code class="literal">line</code> field, and optionally wanted
to filter by line numbers, where <code class="literal">start</code> and <code class="literal">end</code> are optional.</p><p>The <code class="literal">params</code> would look like:</p><pre class="programlisting prettyprint lang-js">{
    "params": {
        "text":      "words to search for",
        "line_no": { <a id="CO1-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            "start": 10, <a id="CO1-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
            "end":   20  <a id="CO1-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> <a href="#CO1-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> <a href="#CO1-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
All three of these elements are optional.
</p></td></tr></table></div><p>We could write the query as:</p><pre class="programlisting prettyprint lang-js">{
    "filtered": {
      "query": {
        "match": {
          "line": "{{text}}" <a id="CO2-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        }
      },
      "filter": {
        {{#line_no}} <a id="CO2-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
          "range": {
            "line_no": {
              {{#start}} <a id="CO2-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
                "gte": "{{start}}" <a id="CO2-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
                {{#end}},{{/end}} <a id="CO2-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
              {{/start}} <a id="CO2-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
              {{#end}} <a id="CO2-7"></a><span><img src="images/icons/callouts/7.png" alt="" /></span>
                "lte": "{{end}}" <a id="CO2-8"></a><span><img src="images/icons/callouts/8.png" alt="" /></span>
              {{/end}} &lt;/6&gt;
            }
          }
        {{/line_no}} <a id="CO2-9"></a><span><img src="images/icons/callouts/9.png" alt="" /></span>
      }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Fill in the value of param <code class="literal">text</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> <a href="#CO2-9"><span><img src="images/icons/callouts/9.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Include the <code class="literal">range</code> filter only if <code class="literal">line_no</code> is specified
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> <a href="#CO2-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Include the <code class="literal">gte</code> clause only if <code class="literal">line_no.start</code> is specified
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Fill in the value of param <code class="literal">line_no.start</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Add a comma after the <code class="literal">gte</code> clause only if <code class="literal">line_no.start</code>
    AND <code class="literal">line_no.end</code> are specified
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-7"><span><img src="images/icons/callouts/7.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Include the <code class="literal">lte</code> clause only if <code class="literal">line_no.end</code> is specified
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-8"><span><img src="images/icons/callouts/8.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Fill in the value of param <code class="literal">line_no.end</code>
</p></td></tr></table></div><p>As written above, this template is not valid JSON because it includes the
<span class="emphasis"><em>section</em></span> markers like <code class="literal">{{#line_no}}</code>.  For this reason, the template
can only be written as a string.</p><h5><a id="_pre_registered_template"></a>Pre-registered template</h5><p>You can register search templates by storing it in the <code class="literal">config/scripts</code> directory, in a file using the <code class="literal">.mustache</code> extension.
In order to execute the stored template, reference it by itâs name under the <code class="literal">template</code> key:</p><pre class="programlisting prettyprint lang-js">GET /_search/template
{
    "template": "storedTemplate" <a id="CO3-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>,
    "params": {
        "query_string": "search for these words"
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Name of the the query template in <code class="literal">config/scripts/</code>, i.e., <code class="literal">storedTemplate.mustache</code>.
</p></td></tr></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets"></a>Facets</h2></div></div></div><p>The usual purpose of a full-text search engine is to return a small
number of documents matching your query.</p><p><span class="emphasis"><em>Facets</em></span> provide aggregated data based on a search query. In the
simplest case, a
<a class="link" href="#search-facets-terms-facet" title="Terms Facet">terms facet</a>
can return <span class="emphasis"><em>facet counts</em></span> for various <span class="emphasis"><em>facet values</em></span> for a specific
<span class="emphasis"><em>field</em></span>. Elasticsearch supports more facet implementations, such as
<a class="link" href="#search-facets-statistical-facet" title="Statistical Facet">statistical</a>
or
<a class="link" href="#search-facets-date-histogram-facet" title="Date Histogram Facet">date histogram</a> facets.</p><p>The field used for facet calculations <span class="emphasis"><em>must</em></span> be of type numeric,
date/time or be analyzed as a single token â see the
<a class="link" href="#mapping" title="Mapping"><span class="emphasis"><em>Mapping</em></span></a> guide for details on the
analysis process.</p><p>You can give the facet a custom <span class="emphasis"><em>name</em></span> and return multiple facets in one
request.</p><p>Letâs try it out with a simple example. Suppose we have a number of
articles with a field called <code class="literal">tags</code>, preferably analyzed with the
<a class="link" href="#analysis-keyword-analyzer" title="Keyword Analyzer">keyword</a>
analyzer. The facet aggregation will return counts for the most popular
tags across the documents matching your query â or across all documents
in the index.</p><p>We will store some example data first:</p><pre class="programlisting prettyprint lang-js">curl -X DELETE "http://localhost:9200/articles"
curl -X POST "http://localhost:9200/articles/article" -d '{"title" : "One",   "tags" : ["foo"]}'
curl -X POST "http://localhost:9200/articles/article" -d '{"title" : "Two",   "tags" : ["foo", "bar"]}'
curl -X POST "http://localhost:9200/articles/article" -d '{"title" : "Three", "tags" : ["foo", "bar", "baz"]}'</pre><p>Now, letâs query the index for articles beginning with letter <code class="literal">T</code>
and retrieve a
<a class="link" href="#search-facets-terms-facet" title="Terms Facet"><span class="emphasis"><em>terms facet</em></span></a>
for the <code class="literal">tags</code> field. We will name the facet simply: <span class="emphasis"><em>tags</em></span>.</p><pre class="programlisting prettyprint lang-js">curl -X POST "http://localhost:9200/articles/_search?pretty=true" -d '
  {
    "query" : { "query_string" : {"query" : "T*"} },
    "facets" : {
      "tags" : { "terms" : {"field" : "tags"} }
    }
  }
'</pre><p>This request will return articles <code class="literal">Two</code> and <code class="literal">Three</code> (because
they match our query), as well as the <code class="literal">tags</code> facet:</p><pre class="programlisting prettyprint lang-js">"facets" : {
  "tags" : {
    "_type" : "terms",
    "missing" : 0,
    "total": 5,
    "other": 0,
    "terms" : [ {
      "term" : "foo",
      "count" : 2
    }, {
      "term" : "bar",
      "count" : 2
    }, {
      "term" : "baz",
      "count" : 1
    } ]
  }
}</pre><p>In the <code class="literal">terms</code> array, relevant <span class="emphasis"><em>terms</em></span> and <span class="emphasis"><em>counts</em></span> are returned. Youâll
probably want to display these to your users. The facet returns several
important counts:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">missing</code> : The number of documents which have no value for the
faceted field
</li><li class="listitem">
<code class="literal">total</code> : The total number of terms in the facet
</li><li class="listitem">
<code class="literal">other</code> : The number of terms not included in the returned facet
(effectively <code class="literal">other</code> = <code class="literal">total</code> - <code class="literal">terms</code> )
</li></ul></div><p>Notice, that the counts are scoped to the current query: <span class="emphasis"><em>foo</em></span> is
counted only twice (not three times), <span class="emphasis"><em>bar</em></span> is counted twice and <span class="emphasis"><em>baz</em></span>
once. Also note that terms are counted once per document, even if the
occur more frequently in that document.</p><p>Thatâs because the primary purpose of facets is to enable
<a class="ulink" href="http://en.wikipedia.org/wiki/Faceted_search" target="_top"><span class="emphasis"><em>faceted navigation</em></span></a>,
allowing the user to refine her query based on the insight from the
facet, i.e. restrict the search to a specific category, price or date
range. Facets can be used, however, for other purposes: computing
histograms, statistical aggregations, and more. See the blog about
<a class="ulink" href="/blog/data-visualization-with-elasticsearch-and-protovis/" target="_top">data visualization</a>.for inspiration.</p><h3><a id="_scope"></a>Scope</h3><p>As we have already mentioned, facet computation is restricted to the
scope of the current query, called <code class="literal">main</code>, by default. Facets can be
computed within the <code class="literal">global</code> scope as well, in which case it will return
values computed across all documents in the index:</p><pre class="programlisting prettyprint lang-js">{
    "facets" : {
        "my_facets" : {
            "terms" : { ... },
            "global" : true <a id="CO4-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">global</code> keyword can be used with any facet type.
</p></td></tr></table></div><p>Thereâs one <span class="strong"><strong>important distinction</strong></span> to keep in mind. While search
<span class="emphasis"><em>queries</em></span> restrict both the returned documents and facet counts, search
<span class="emphasis"><em>filters</em></span> restrict only returned documents â but <span class="emphasis"><em>not</em></span> facet counts.</p><p>If you need to restrict both the documents and facets, and youâre not
willing or able to use a query, you may use a <span class="emphasis"><em>facet filter</em></span>.</p><h3><a id="_facet_filter"></a>Facet Filter</h3><p>All facets can be configured with an additional filter (explained in the
<a class="link" href="#query-dsl" title="Query DSL">Query DSL</a> section), which <span class="emphasis"><em>will</em></span> reduce
the documents they use for computing results. An example with a <span class="emphasis"><em>term</em></span>
filter:</p><pre class="programlisting prettyprint lang-js">{
    "facets" : {
        "&lt;FACET NAME&gt;" : {
            "&lt;FACET TYPE&gt;" : {
                ...
            },
            "facet_filter" : {
                "term" : { "user" : "kimchy"}
            }
        }
    }
}</pre><p>Note that this is different from a facet of the
<a class="link" href="#search-facets-filter-facet" title="Filter Facets">filter</a> type.</p><h3><a id="_facets_with_the_emphasis_nested_emphasis_types"></a>Facets with the <span class="emphasis"><em>nested</em></span> types</h3><p><a class="link" href="#mapping-nested-type" title="Nested Type">Nested</a> mapping allows
for better support for "inner" documents faceting, especially when it
comes to multi valued key and value facets (like histograms, or term
stats).</p><p>What is it good for? First of all, this is the only way to use facets on
nested documents once they are used (possibly for other reasons). But,
there is also facet specific reason why nested documents can be used,
and thatâs the fact that facets working on different key and value field
(like term_stats, or histogram) can now support cases where both are
multi valued properly.</p><p>For example, letâs use the following mapping:</p><pre class="programlisting prettyprint lang-js">{
    "type1" : {
        "properties" : {
            "obj1" : {
                "type" : "nested"
            }
        }
    }
}</pre><p>And, here is a sample data:</p><pre class="programlisting prettyprint lang-js">{
    "obj1" : [
        {
            "name" : "blue",
            "count" : 4
        },
        {
            "name" : "green",
            "count" : 6
        }
    ]
}</pre><h4><a id="_all_nested_matching_root_documents"></a>All Nested Matching Root Documents</h4><p>Another option is to run the facet on all the nested documents matching
the root objects that the main query will end up producing. For example:</p><pre class="programlisting prettyprint lang-js">{
    "query": {
        "match_all": {}
    },
    "facets": {
        "facet1": {
            "terms_stats": {
                "key_field" : "name",
                "value_field": "count"
            },
            "nested": "obj1"
        }
    }
}</pre><p>The <code class="literal">nested</code> element provides the path to the nested document (can be a
multi level nested docs) that will be used.</p><p>Facet filter allows you to filter your facet on the nested object level.
It is important that these filters match on the nested object level and
not on the root document level. In the following example the
<code class="literal">terms_stats</code> only applies on nested objects with the name <span class="emphasis"><em>blue</em></span>.</p><pre class="programlisting prettyprint lang-js">{
    "query": {
        "match_all": {}
    },
    "facets": {
        "facet1": {
            "terms_stats": {
                "key_field" : "name",
                "value_field": "count"
            },
            "nested": "obj1",
            "facet_filter" : {
                "term" : {"name" : "blue"}
            }
        }
    }
}</pre><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-terms-facet"></a>Terms Facet</h2></div></div></div><p>Allow to specify field facets that return the N most frequent terms. For
example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "field" : "tag",
                "size" : 10
            }
        }
    }
}</pre><p>It is preferred to have the terms facet executed on a non analyzed
field, or a field without a large number of terms it breaks to.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_accuracy_control"></a>Accuracy Control</h3></div></div></div><p>The <code class="literal">size</code> parameter defines how many top terms should be returned out
of the overall terms list. By default, the node coordinating the
search process will ask each shard to provide its own top <code class="literal">size</code> terms
and once all shards respond, it will reduce the results to the final list
that will then be sent back to the client. This means that if the number
of unique terms is greater than <code class="literal">size</code>, the returned list is slightly off
and not accurate (it could be that the term counts are slightly off and it
could even be that a term that should have been in the top <code class="literal">size</code> entries
was not returned).</p><p>The higher the requested <code class="literal">size</code> is, the more accurate the results will be,
but also, the more expensive it will be to compute the final results (both
due to bigger priority queues that are managed on a shard level and due to
bigger data transfers between the nodes and the client). In an attempt to
minimize the extra work that comes with bigger requested <code class="literal">size</code> the
<code class="literal">shard_size</code> parameter was introduced. When defined, it will determine
how many terms the coordinating node will request from each shard. Once
all the shards responded, the coordinating node will then reduce them
to a final result which will be based on the <code class="literal">size</code> parameter - this way,
one can increase the accuracy of the returned terms and avoid the overhead
of streaming a big list of terms back to the client.</p><p>Note that <code class="literal">shard_size</code> cannot be smaller than <code class="literal">size</code>â¦ if thatâs the case
elasticsearch will override it and reset it to be equal to <code class="literal">size</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_ordering"></a>Ordering</h3></div></div></div><p>Allow to control the ordering of the terms facets, to be ordered by
<code class="literal">count</code>, <code class="literal">term</code>, <code class="literal">reverse_count</code> or <code class="literal">reverse_term</code>. The default is
<code class="literal">count</code>. Here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "field" : "tag",
                "size" : 10,
                "order" : "term"
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_all_terms"></a>All Terms</h3></div></div></div><p>Allow to get all the terms in the terms facet, ones that do not match a
hit, will have a count of 0. Note, this should not be used with fields
that have many terms.</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "field" : "tag",
                "all_terms" : true
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_excluding_terms"></a>Excluding Terms</h3></div></div></div><p>It is possible to specify a set of terms that should be excluded from
the terms facet request result:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : { }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "field" : "tag",
                "exclude" : ["term1", "term2"]
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_regex_patterns"></a>Regex Patterns</h3></div></div></div><p>The terms API allows to define regex expression that will control which
terms will be included in the faceted list, here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : { }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "field" : "tag",
                "regex" : "_regex expression here_",
                "regex_flags" : "DOTALL"
            }
        }
    }
}</pre><p>Check
<a class="ulink" href="http://download.oracle.com/javase/6/docs/api/java/util/regex/Pattern.html#field_summary" target="_top">Java
Pattern API</a> for more details about <code class="literal">regex_flags</code> options.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_term_scripts"></a>Term Scripts</h3></div></div></div><p>Allow to define a script for terms facet to process the actual term that
will be used in the term facet collection, and also optionally control
its inclusion or not.</p><p>The script can either return a boolean value, with <code class="literal">true</code> to include it
in the facet collection, and <code class="literal">false</code> to exclude it from the facet
collection.</p><p>Another option is for the script to return a <code class="literal">string</code> controlling the
term that will be used to count against. The script execution will
include the term variable which is the current field term used.</p><p>For example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "field" : "tag",
                "size" : 10,
                "script" : "term + 'aaa'"
            }
        }
    }
}</pre><p>And using the boolean feature:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "field" : "tag",
                "size" : 10,
                "script" : "term == 'aaa' ? true : false"
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multi_fields_2"></a>Multi Fields</h3></div></div></div><p>The term facet can be executed against more than one field, returning
the aggregation result across those fields. For example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "fields" : ["tag1", "tag2"],
                "size" : 10
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_field"></a>Script Field</h3></div></div></div><p>A script that provides the actual terms that will be processed for a
given doc. A <code class="literal">script_field</code> (or <code class="literal">script</code> which will be used when no
<code class="literal">field</code> or <code class="literal">fields</code> are provided) can be set to provide it.</p><p>As an example, a search request (that is quite "heavy") can be executed
and use either <code class="literal">_source</code> itself or <code class="literal">_fields</code> (for stored fields) without
needing to load the terms to memory (at the expense of much slower
execution of the search, and causing more IO load):</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "my_facet" : {
            "terms" : {
                "script_field" : "_source.my_field",
                "size" : 10
            }
        }
    }
}</pre><p>Or:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "my_facet" : {
            "terms" : {
                "script_field" : "_fields['my_field']",
                "size" : 10
            }
        }
    }
}</pre><p>Note also, that the above will use the whole field value as a single
term.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_index"></a>_index</h3></div></div></div><p>The term facet allows to specify a special field name called <code class="literal">_index</code>.
This will return a facet count of hits per <code class="literal">_index</code> the search was
executed on (relevant when a search request spans more than one index).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_memory_considerations_2"></a>Memory Considerations</h3></div></div></div><p>Term facet causes the relevant field values to be loaded into memory.
This means that per shard, there should be enough memory to contain
them. It is advisable to explicitly set the fields to be <code class="literal">not_analyzed</code>
or make sure the number of unique tokens a field can have is not large.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-range-facet"></a>Range Facets</h2></div></div></div><p><code class="literal">range</code> facet allows to specify a set of ranges and get both the number
of docs (count) that fall within each range, and aggregated data either
based on the field, or using another field. Here is a simple example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "range1" : {
            "range" : {
                "field" : "field_name",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 20, "to" : 70 },
                    { "from" : 70, "to" : 120 },
                    { "from" : 150 }
                ]
            }
        }
    }
}</pre><p>Another option which is a bit more DSL enabled is to provide the ranges
on the actual field name, for example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "range1" : {
            "range" : {
                "my_field" : [
                    { "to" : 50 },
                    { "from" : 20, "to" : 70 },
                    { "from" : 70, "to" : 120 },
                    { "from" : 150 }
                ]
            }
        }
    }
}</pre><p>The <code class="literal">range</code> facet always includes the <code class="literal">from</code> parameter and excludes the
<code class="literal">to</code> parameter for each range.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_key_and_value"></a>Key and Value</h3></div></div></div><p>The <code class="literal">range</code> facet allows to use a different field to check if its value
falls within a range, and another field to compute aggregated data per
range (like total). For example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "range1" : {
            "range" : {
                "key_field" : "field_name",
                "value_field" : "another_field_name",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 20, "to" : 70 },
                    { "from" : 70, "to" : 120 },
                    { "from" : 150 }
                ]
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_key_and_value"></a>Script Key and Value</h3></div></div></div><p>Sometimes, some munging of both the key and the value are needed. In the
key case, before it is checked if it falls within a range, and for the
value, when the statistical data is computed per range scripts can be
used. Here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "range1" : {
            "range" : {
                "key_script" : "doc['date'].date.minuteOfHour",
                "value_script" : "doc['num1'].value",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 20, "to" : 70 },
                    { "from" : 70, "to" : 120 },
                    { "from" : 150 }
                ]
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_date_ranges"></a>Date Ranges</h3></div></div></div><p>The range facet support also providing the range as string formatted
dates.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-histogram-facet"></a>Histogram Facets</h2></div></div></div><p>The histogram facet works with numeric data by building a histogram
across intervals of the field values. Each value is "rounded" into an
interval (or placed in a bucket), and statistics are provided per
interval/bucket (count and total). Here is a simple example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "histogram" : {
                "field" : "field_name",
                "interval" : 100
            }
        }
    }
}</pre><p>The above example will run a histogram facet on the <code class="literal">field_name</code> filed,
with an <code class="literal">interval</code> of <code class="literal">100</code> (so, for example, a value of <code class="literal">1055</code> will be
placed within the <code class="literal">1000</code> bucket).</p><p>The interval can also be provided as a time based interval (using the
time format). This mainly make sense when working on date fields or
field that represent absolute milliseconds, here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "histogram" : {
                "field" : "field_name",
                "time_interval" : "1.5h"
            }
        }
    }
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_key_and_value_2"></a>Key and Value</h3></div></div></div><p>The histogram facet allows to use a different key and value. The key is
used to place the hit/document within the appropriate bucket, and the
value is used to compute statistical data (for example, total). Here is
an example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "histogram" : {
                "key_field" : "key_field_name",
                "value_field" : "value_field_name",
                "interval" : 100
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_key_and_value_2"></a>Script Key and Value</h3></div></div></div><p>Sometimes, some munging of both the key and the value are needed. In the
key case, before it is rounded into a bucket, and for the value, when
the statistical data is computed per bucket
<a class="link" href="#modules-scripting" title="Scripting">scripts</a> can be used. Here
is an example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "histogram" : {
                "key_script" : "doc['date'].date.minuteOfHour",
                "value_script" : "doc['num1'].value"
            }
        }
    }
}</pre><p>In the above sample, we can use a date type field called <code class="literal">date</code> to get
the minute of hour from it, and the total will be computed based on
another field <code class="literal">num1</code>. Note, in this case, no <code class="literal">interval</code> was provided, so
the bucket will be based directly on the <code class="literal">key_script</code> (no rounding).</p><p>Parameters can also be provided to the different scripts (preferable if
the script is the same, with different values for a specific parameter,
like "factor"):</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "histogram" : {
                "key_script" : "doc['date'].date.minuteOfHour * factor1",
                "value_script" : "doc['num1'].value + factor2",
                "params" : {
                    "factor1" : 2,
                    "factor2" : 3
                }
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_memory_considerations_3"></a>Memory Considerations</h3></div></div></div><p>In order to implement the histogram facet, the relevant field values are
loaded into memory from the index. This means that per shard, there
should be enough memory to contain them. Since by default, dynamic
introduced types are <code class="literal">long</code> and <code class="literal">double</code>, one option to reduce the
memory footprint is to explicitly set the types for the relevant fields
to either <code class="literal">short</code>, <code class="literal">integer</code>, or <code class="literal">float</code> when possible.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-date-histogram-facet"></a>Date Histogram Facet</h2></div></div></div><p>A specific histogram facet that can work with <code class="literal">date</code> field types
enhancing it over the regular
<a class="link" href="#search-facets-histogram-facet" title="Histogram Facets">histogram facet</a>. Here is a quick example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "date_histogram" : {
                "field" : "field_name",
                "interval" : "day"
            }
        }
    }
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_interval"></a>Interval</h3></div></div></div><p>The <code class="literal">interval</code> allows to set the interval at which buckets will be
created for each hit. It allows for the constant values of <code class="literal">year</code>,
<code class="literal">quarter</code>, <code class="literal">month</code>, <code class="literal">week</code>, <code class="literal">day</code>, <code class="literal">hour</code>, <code class="literal">minute</code> ,<code class="literal">second</code>.</p><p>It also support time setting like <code class="literal">1.5h</code> (up to <code class="literal">w</code> for weeks).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_time_zone"></a>Time Zone</h3></div></div></div><p>By default, times are stored as UTC milliseconds since the epoch. Thus,
all computation and "bucketing" / "rounding" is done on UTC. It is
possible to provide a time zone (both pre rounding, and post rounding)
value, which will cause all computations to take the relevant zone into
account. The time returned for each bucket/entry is milliseconds since
the epoch of the provided time zone.</p><p>The parameters are <code class="literal">pre_zone</code> (pre rounding based on interval) and
<code class="literal">post_zone</code> (post rounding based on interval). The <code class="literal">time_zone</code> parameter
simply sets the <code class="literal">pre_zone</code> parameter. By default, those are set to
<code class="literal">UTC</code>.</p><p>The zone value accepts either a numeric value for the hours offset, for
example: <code class="literal">"time_zone" : -2</code>. It also accepts a format of hours and
minutes, like <code class="literal">"time_zone" : "-02:30"</code>. Another option is to provide a
time zone accepted as one of the values listed
<a class="ulink" href="http://joda-time.sourceforge.net/timezones.html" target="_top">here</a>.</p><p>Lets take an example. For <code class="literal">2012-04-01T04:15:30Z</code>, with a <code class="literal">pre_zone</code> of
<code class="literal">-08:00</code>. For <code class="literal">day</code> interval, the actual time by applying the time zone
and rounding falls under <code class="literal">2012-03-31</code>, so the returned value will be (in
millis) of <code class="literal">2012-03-31T00:00:00Z</code> (UTC). For <code class="literal">hour</code> interval, applying
the time zone results in <code class="literal">2012-03-31T20:15:30</code>, rounding it results in
<code class="literal">2012-03-31T20:00:00</code>, but, we want to return it in UTC (<code class="literal">post_zone</code> is
not set), so we convert it back to UTC: <code class="literal">2012-04-01T04:00:00Z</code>. Note, we
are consistent in the results, returning the rounded value in UTC.</p><p><code class="literal">post_zone</code> simply takes the result, and adds the relevant offset.</p><p>Sometimes, we want to apply the same conversion to UTC we did above for
<code class="literal">hour</code> also for <code class="literal">day</code> (and up) intervals. We can set
<code class="literal">pre_zone_adjust_large_interval</code> to <code class="literal">true</code>, which will apply the same
conversion done for <code class="literal">hour</code> interval in the example, to <code class="literal">day</code> and above
intervals (it can be set regardless of the interval, but only kick in
when using <code class="literal">day</code> and higher intervals).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_factor"></a>Factor</h3></div></div></div><p>The date histogram works on numeric values (since time is stored in
milliseconds since the epoch in UTC). But, sometimes, systems will store
a different resolution (like seconds since UTC) in a numeric field. The
<code class="literal">factor</code> parameter can be used to change the value in the field to
milliseconds to actual do the relevant rounding, and then be applied
again to get to the original unit. For example, when storing in a
numeric field seconds resolution, the <code class="literal">factor</code> can be set to <code class="literal">1000</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_pre_post_offset"></a>Pre / Post Offset</h3></div></div></div><p>Specific offsets can be provided for pre rounding and post rounding. The
<code class="literal">pre_offset</code> for pre rounding, and <code class="literal">post_offset</code> for post rounding. The
format is the date time format (<code class="literal">1h</code>, <code class="literal">1d</code>, â¦).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_value_field"></a>Value Field</h3></div></div></div><p>The date_histogram facet allows to use a different key (of type date)
which controls the bucketing, with a different value field which will
then return the total and mean for that field values of the hits within
the relevant bucket. For example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "date_histogram" : {
                "key_field" : "timestamp",
                "value_field" : "price",
                "interval" : "day"
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_value_field"></a>Script Value Field</h3></div></div></div><p>A script can be used to compute the value that will then be used to
compute the total and mean for a bucket. For example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "date_histogram" : {
                "key_field" : "timestamp",
                "value_script" : "doc['price'].value * 2",
                "interval" : "day"
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-filter-facet"></a>Filter Facets</h2></div></div></div><p>A filter facet (not to be confused with a
<a class="link" href="#search-facets" title="Facets">facet filter</a>) allows you to
return a count of the hits matching the filter. The filter itself can be
expressed using the <a class="link" href="#query-dsl" title="Query DSL">Query DSL</a>. For
example:</p><pre class="programlisting prettyprint lang-js">{
    "facets" : {
        "wow_facet" : {
            "filter" : {
                "term" : { "tag" : "wow" }
            }
        }
    }
}</pre><p>Note, filter facet filters are faster than query facet when using native
filters (non query wrapper ones).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-query-facet"></a>Query Facets</h2></div></div></div><p>A facet query allows to return a count of the hits matching the facet
query. The query itself can be expressed using the Query DSL. For
example:</p><pre class="programlisting prettyprint lang-js">{
    "facets" : {
        "wow_facet" : {
            "query" : {
                "term" : { "tag" : "wow" }
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-statistical-facet"></a>Statistical Facet</h2></div></div></div><p>Statistical facet allows to compute statistical data on a numeric
fields. The statistical data include count, total, sum of squares, mean
(average), minimum, maximum, variance, and standard deviation. Here is
an example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "stat1" : {
            "statistical" : {
                "field" : "num1"
            }
        }
    }
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_field_2"></a>Script field</h3></div></div></div><p>When using <code class="literal">field</code>, the numeric value of the field is used to compute
the statistical information. Sometimes, several fields values represent
the statistics we want to compute, or some sort of mathematical
evaluation. The script field allows to define a
<a class="link" href="#modules-scripting" title="Scripting">script</a> to evaluate, with
its value used to compute the statistical information. For example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "stat1" : {
            "statistical" : {
                "script" : "doc['num1'].value + doc['num2'].value"
            }
        }
    }
}</pre><p>Parameters can also be provided to the different scripts (preferable if
the script is the same, with different values for a specific parameter,
like "factor"):</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "stat1" : {
            "statistical" : {
                "script" : "(doc['num1'].value + doc['num2'].value) * factor",
                "params" : {
                    "factor" : 5
                }
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multi_field"></a>Multi Field</h3></div></div></div><p>The statistical facet can be executed against more than one field,
returning the aggregation result across those fields. For example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "stat1" : {
            "statistical" : {
                "fields" : ["num1", "num2"]
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_memory_considerations_4"></a>Memory Considerations</h3></div></div></div><p>In order to implement the statistical facet, the relevant field values
are loaded into memory from the index. This means that per shard, there
should be enough memory to contain them. Since by default, dynamic
introduced types are <code class="literal">long</code> and <code class="literal">double</code>, one option to reduce the
memory footprint is to explicitly set the types for the relevant fields
to either <code class="literal">short</code>, <code class="literal">integer</code>, or <code class="literal">float</code> when possible.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-terms-stats-facet"></a>Terms Stats Facet</h2></div></div></div><p>The <code class="literal">terms_stats</code> facet combines both the
<a class="link" href="#search-facets-terms-facet" title="Terms Facet">terms</a> and
<a class="link" href="#search-facets-statistical-facet" title="Statistical Facet">statistical</a>
allowing to compute stats computed on a field, per term value driven by
another field. For example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "tag_price_stats" : {
            "terms_stats" : {
                "key_field" : "tag",
                "value_field" : "price"
            }
        }
    }
}</pre><p>The <code class="literal">size</code> parameter controls how many facet entries will be returned.
It defaults to <code class="literal">10</code>. Setting it to 0 will return all terms matching the
hits (be careful not to return too many results).</p><p>One can also set <code class="literal">shard_size</code> (in addition to <code class="literal">size</code>) which will determine
how many term entries will be requested from each shard. When dealing
with field with high cardinality (at least higher than the requested <code class="literal">size</code>)
The greater <code class="literal">shard_size</code> is - the more accurate the result will be (and the
more expensive the overall facet computation will be). <code class="literal">shard_size</code> is there
to enable you to increase accuracy yet still avoid returning too many
terms_stats entries back to the client.</p><p>Ordering is done by setting <code class="literal">order</code>, with possible values of <code class="literal">term</code>,
<code class="literal">reverse_term</code>, <code class="literal">count</code>, <code class="literal">reverse_count</code>, <code class="literal">total</code>, <code class="literal">reverse_total</code>,
<code class="literal">min</code>, <code class="literal">reverse_min</code>, <code class="literal">max</code>, <code class="literal">reverse_max</code>, <code class="literal">mean</code>, <code class="literal">reverse_mean</code>.
Defaults to <code class="literal">count</code>.</p><p>The value computed can also be a script, using the <code class="literal">value_script</code>
instead of <code class="literal">value_field</code>, in which case the <code class="literal">lang</code> can control its
language, and <code class="literal">params</code> allow to provide custom parameters (as in other
scripted components).</p><p>Note, the terms stats can work with multi valued key fields, or multi
valued value fields, but not when both are multi valued (as ordering is
not maintained).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-geo-distance-facet"></a>Geo Distance Facets</h2></div></div></div><p>The geo_distance facet is a facet providing information for ranges of
distances from a provided geo_point including count of the number of
hits that fall within each range, and aggregation information (like
total).</p><p>Assuming the following sample doc:</p><pre class="programlisting prettyprint lang-js">{
    "pin" : {
        "location" : {
            "lat" : 40.12,
            "lon" : -71.34
        }
    }
}</pre><p>Here is an example that create a <code class="literal">geo_distance</code> facet from a
<code class="literal">pin.location</code> of 40,-70, and a set of ranges:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "geo1" : {
            "geo_distance" : {
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                },
                "ranges" : [
                    { "to" : 10 },
                    { "from" : 10, "to" : 20 },
                    { "from" : 20, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_accepted_formats"></a>Accepted Formats</h3></div></div></div><p>In much the same way the geo_point type can accept different
representation of the geo point, the filter can accept it as well:</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_lat_lon_as_properties_2"></a>Lat Lon As Properties</h4></div></div></div><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "geo1" : {
            "geo_distance" : {
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                },
                "ranges" : [
                    { "to" : 10 },
                    { "from" : 10, "to" : 20 },
                    { "from" : 20, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_lat_lon_as_array_2"></a>Lat Lon As Array</h4></div></div></div><p>Format in <code class="literal">[lon, lat]</code>, note, the order of lon/lat here in order to
conform with <a class="ulink" href="http://geojson.org/" target="_top">GeoJSON</a>.</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "geo1" : {
            "geo_distance" : {
                "pin.location" : [40, -70],
                "ranges" : [
                    { "to" : 10 },
                    { "from" : 10, "to" : 20 },
                    { "from" : 20, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_lat_lon_as_string_2"></a>Lat Lon As String</h4></div></div></div><p>Format in <code class="literal">lat,lon</code>.</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "geo1" : {
            "geo_distance" : {
                "pin.location" : "40, -70",
                "ranges" : [
                    { "to" : 10 },
                    { "from" : 10, "to" : 20 },
                    { "from" : 20, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_geohash_2"></a>Geohash</h4></div></div></div><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "geo1" : {
            "geo_distance" : {
                "pin.location" : "drm3btev3e86",
                "ranges" : [
                    { "to" : 10 },
                    { "from" : 10, "to" : 20 },
                    { "from" : 20, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_ranges"></a>Ranges</h3></div></div></div><p>When a <code class="literal">to</code> or <code class="literal">from</code> are not set, they are assumed to be unbounded.
Ranges are allowed to overlap, basically, each range is treated by
itself.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_options"></a>Options</h3></div></div></div><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Option </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">unit</code></p></td><td align="left" valign="top"><p>The unit the ranges are provided in. Defaults to <code class="literal">km</code>. Can also
be <code class="literal">mi</code>, <code class="literal">miles</code>, <code class="literal">in</code>, <code class="literal">inch</code>, <code class="literal">yd</code>, <code class="literal">yards</code>, <code class="literal">ft</code>, <code class="literal">feet</code>, <code class="literal">kilometers</code>, <code class="literal">mm</code>, <code class="literal">millimeters</code>, <code class="literal">cm</code>, <code class="literal">centimeters</code>, <code class="literal">m</code> or <code class="literal">meters</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">distance_type</code></p></td><td align="left" valign="top"><p>How to compute the distance. Can either be <code class="literal">arc</code>
(better precision), <code class="literal">sloppy_arc</code> (faster) or <code class="literal">plane</code> (fastest). Defaults to <code class="literal">sloppy_arc</code>.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_value_options"></a>Value Options</h3></div></div></div><p>On top of the count of hits falling within each range, aggregated data
can be provided (total) as well. By default, the aggregated data will
simply use the distance calculated, but the value can be extracted
either using a different numeric field, or a script. Here is an example
of using a different numeric field:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "geo1" : {
            "geo_distance" : {
                "pin.location" : "drm3btev3e86",
                "value_field" : "num1",
                "ranges" : [
                    { "to" : 10 },
                    { "from" : 10, "to" : 20 },
                    { "from" : 20, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre><p>And here is an example of using a script:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "geo1" : {
            "geo_distance" : {
                "pin.location" : "drm3btev3e86",
                "value_script" : "doc['num1'].value * factor",
                "params" : {
                    "factor" : 5
                }
                "ranges" : [
                    { "to" : 10 },
                    { "from" : 10, "to" : 20 },
                    { "from" : 20, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre><p>Note the params option, allowing to pass parameters to the script
(resulting in faster script execution instead of providing the values
within the script each time).</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><h4><code class="literal">geo_point</code> Type</h4><p>The facet <span class="strong"><strong>requires</strong></span> the <code class="literal">geo_point</code> type to be set on the relevant
field.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><h4>Multi Location Per Document</h4><p>The facet can work with multiple locations per document.</p></div></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations"></a>Aggregations</h2></div></div></div><p>Aggregations grew out of the <a class="link" href="#search-facets" title="Facets">facets</a> module and the long experience of how users use it
(and would like to use it) for real-time data analytics purposes. As such, it serves as the next generation
replacement for the functionality we currently refer to as "faceting".</p><p><a class="link" href="#search-facets" title="Facets">Facets</a> provide a great way to aggregate data within a document set context.
This context is defined by the executed query in combination with the different levels of filters that can be defined
(filtered queries, top-level filters, and facet level filters). While powerful, their implementation is not designed
from the ground up to support complex aggregations and is thus limited.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Are facets deprecated?</strong></p></div></div></div><p>As the functionality facets offer is a subset of the one offered by aggregations, over time, we would like to
see users move to aggregations for all realtime data analytics. That said, we are well aware that such
transitions/migrations take time, and for this reason we are keeping facets around for the time being.
Facets are not officially deprecated yet but are likely to be in the future.</p></div><p>The aggregations module breaks the barriers the current facet implementation put in place. The new name ("Aggregations")
also indicates the intention here - a generic yet extremely powerful framework for building aggregations - any types of
aggregations.</p><p>An aggregation can be seen as a <span class="emphasis"><em>unit-of-work</em></span> that builds analytic information over a set of documents. The context of
the execution defines what this document set is (e.g. a top-level aggregation executes within the context of the executed
query/filters of the search request).</p><p>There are many different types of aggregations, each with its own purpose and output. To better understand these types,
it is often easier to break them into two main families:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<span class="emphasis"><em>Bucketing</em></span>
</span></dt><dd>
                                A family of aggregations that build buckets, where each bucket is associated with a <span class="emphasis"><em>key</em></span> and a document
                                criterion. When the aggregation is executed, all the buckets criteria are evaluated on every document in
                                the context and when a criterion matches, the document is considered to "fall in" the relevant bucket.
                                By the end of the aggregation process, weâll end up with a list of buckets - each one with a set of
                                documents that "belong" to it.
</dd><dt><span class="term">
<span class="emphasis"><em>Metric</em></span>
</span></dt><dd>
                                Aggregations that keep track and compute metrics over a set of documents.
</dd></dl></div><p>The interesting part comes next. Since each bucket effectively defines a document set (all documents belonging to
the bucket), one can potentially associate aggregations on the bucket level, and those will execute within the context
of that bucket. This is where the real power of aggregations kicks in: <span class="strong"><strong>aggregations can be nested!</strong></span></p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Bucketing aggregations can have sub-aggregations (bucketing or metric). The sub-aggregations will be computed for
                the buckets which their parent aggregation generates. There is no hard limit on the level/depth of nested
                aggregations (one can nest an aggregation under a "parent" aggregation, which is itself a sub-aggregation of
                another higher-level aggregation).</p></div></div><h3><a id="_structuring_aggregations"></a>Structuring Aggregations</h3><p>The following snippet captures the basic structure of aggregations:</p><pre class="programlisting prettyprint lang-js">"aggregations" : {
    "&lt;aggregation_name&gt;" : {
        "&lt;aggregation_type&gt;" : {
            &lt;aggregation_body&gt;
        }
        [,"aggregations" : { [&lt;sub_aggregation&gt;]+ } ]?
    }
    [,"&lt;aggregation_name_2&gt;" : { ... } ]*
}</pre><p>The <code class="literal">aggregations</code> object (the key <code class="literal">aggs</code> can also be used) in the JSON holds the aggregations to be computed. Each aggregation
is associated with a logical name that the user defines (e.g. if the aggregation computes the average price, then it would
make sense to name it <code class="literal">avg_price</code>). These logical names will also be used to uniquely identify the aggregations in the
response. Each aggregation has a specific type (<code class="literal">&lt;aggregation_type&gt;</code> in the above snippet) and is typically the first
key within the named aggregation body. Each type of aggregation defines its own body, depending on the nature of the
aggregation (e.g. an <code class="literal">avg</code> aggregation on a specific field will define the field on which the average will be calculated).
At the same level of the aggregation type definition, one can optionally define a set of additional aggregations,
though this only makes sense if the aggregation you defined is of a bucketing nature. In this scenario, the
sub-aggregations you define on the bucketing aggregation level will be computed for all the buckets built by the
bucketing aggregation. For example, if you define a set of aggregations under the <code class="literal">range</code> aggregation, the
sub-aggregations will be computed for the range buckets that are defined.</p><h4><a id="_values_source"></a>Values Source</h4><p>Some aggregations work on values extracted from the aggregated documents. Typically, the values will be extracted from
a specific document field which is set using the <code class="literal">field</code> key for the aggregations. It is also possible to define a
<a class="link" href="#modules-scripting" title="Scripting"><code class="literal">script</code></a> which will generate the values (per document).</p><p>When both <code class="literal">field</code> and <code class="literal">script</code> settings are configured for the aggregation, the script will be treated as a
<code class="literal">value script</code>.  While normal scripts are evaluated on a document level (i.e. the script has access to all the data
associated with the document), value scripts are evaluated on the <span class="strong"><strong>value</strong></span> level. In this mode, the values are extracted
from the configured <code class="literal">field</code> and the <code class="literal">script</code> is used to apply a "transformation" over these value/s.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><a id="aggs-script-note"></a><p>When working with scripts, the <code class="literal">lang</code> and <code class="literal">params</code> settings can also be defined. The former defines the scripting
language which is used (assuming the proper language is available in Elasticsearch, either by default or as a plugin). The latter
enables defining all the "dynamic" expressions in the script as parameters, which enables the script to keep itself static
between calls (this will ensure the use of the cached compiled scripts in Elasticsearch).</p></div></div><p>Scripts can generate a single value or multiple values per document. When generating multiple values, one can use the
<code class="literal">script_values_sorted</code> settings to indicate whether these values are sorted or not. Internally, Elasticsearch can
perform optimizations when dealing with sorted values (for example, with the <code class="literal">min</code> aggregations, knowing the values are
sorted, Elasticsearch will skip the iterations over all the values and rely on the first value in the list to be the
minimum value among all other values associated with the same document).</p><h3><a id="_metrics_aggregations"></a>Metrics Aggregations</h3><p>The aggregations in this family compute metrics based on values extracted in one way or another from the documents that
are being aggregated. The values are typically extracted from the fields of the document (using the field data), but
can also be generated using scripts. Some aggregations output a single metric (e.g. <code class="literal">avg</code>) and are called <code class="literal">single-value
metrics aggregation</code>, others generate multiple metrics (e.g. <code class="literal">stats</code>) and are called <code class="literal">multi-value metrics aggregation</code>.
The distinction between single-value and multi-value metrics aggregations plays a role when these aggregations serve as
direct sub-aggregations of some bucket aggregations (some bucket aggregation enable you to sort the returned buckets based
on the metrics in each bucket).</p><h3><a id="_bucket_aggregations"></a>Bucket Aggregations</h3><p>Bucket aggregations donât calculate metrics over fields like the metrics aggregations do, but instead, they create
buckets of documents. Each bucket is associated with a criteria (depending on the aggregation type) which determines
whether or not a document in the current context "falls" into it. In other words, the buckets effectively define document
sets. In addition to the buckets themselves, the <code class="literal">bucket</code> aggregations also compute and return the number of documents
that "fell in" to each bucket.</p><p>Bucket aggregations, as opposed to <code class="literal">metrics</code> aggregations, can hold sub-aggregations. These sub-aggregations will be
aggregated for the buckets created by their "parent" bucket aggregation.</p><p>There are different bucket aggregators, each with a different "bucketing" strategy. Some define a single bucket, some
define fixed number of multiple buckets, and others dynamically create the buckets during the aggregation process.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-min-aggregation"></a>Min</h2></div></div></div><p>A <code class="literal">single-value</code> metrics aggregation that keeps track and returns the minimum value among numeric values extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</p><p>Computing the min price value across all documents:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "min_price" : { "min" : { "field" : "price" } }
    }
}</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations": {
        "min_price": {
            "value": 10
        }
    }
}</pre><p>As can be seen, the name of the aggregation (<code class="literal">min_price</code> above) also serves as the key by which the aggreagtion result can be retrieved from the returned response.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script"></a>Script</h3></div></div></div><p>Computing the min price value across all document, this time using a script:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "min_price" : { "min" : { "script" : "doc['price'].value" } }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_value_script"></a>Value Script</h3></div></div></div><p>Letâs say that the prices of the documents in our index are in USD, but we would like to compute the min in EURO (and for the sake of this example, lets say the conversion rate is 1.2). We can use a value script to apply the conversion rate to every value before it is aggregated:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "min_price_in_euros" : {
            "min" : {
                "field" : "price",
                "script" : "_value * conversion_rate",
                "params" : {
                    "conversion_rate" : 1.2
                }
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-max-aggregation"></a>Max</h2></div></div></div><p>A <code class="literal">single-value</code> metrics aggregation that keeps track and returns the maximum value among the numeric values extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</p><p>Computing the max price value across all documents</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "max_price" : { "max" : { "field" : "price" } }
    }
}</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations": {
        "max_price": {
            "value": 35
        }
    }
}</pre><p>As can be seen, the name of the aggregation (<code class="literal">max_price</code> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_2"></a>Script</h3></div></div></div><p>Computing the max price value across all document, this time using a script:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "max_price" : { "max" : { "script" : "doc['price'].value" } }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_value_script_2"></a>Value Script</h3></div></div></div><p>Letâs say that the prices of the documents in our index are in USD, but we would like to compute the max in EURO (and for the sake of this example, lets say the conversion rate is 1.2). We can use a value script to apply the conversion rate to every value before it is aggregated:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "max_price_in_euros" : {
            "max" : {
                "field" : "price",
                "script" : "_value * conversion_rate",
                "params" : {
                    "conversion_rate" : 1.2
                }
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-sum-aggregation"></a>Sum</h2></div></div></div><p>A <code class="literal">single-value</code> metrics aggregation that sums up numeric values that are extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</p><p>Assuming the data consists of documents representing stock ticks, where each tick holds the change in the stock price from the previous tick.</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "filtered" : {
            "query" : { "match_all" : {}},
            "filter" : {
                "range" : { "timestamp" : { "from" : "now/1d+9.5h", "to" : "now/1d+16h" }}
            }
        }
    },
    "aggs" : {
        "intraday_return" : { "sum" : { "field" : "change" } }
    }
}</pre><p>The above aggregation sums up all changes in the todayâs trading stock ticks which accounts for the intraday return. The aggregation type is <code class="literal">sum</code> and the <code class="literal">field</code> setting defines the numeric field of the documents of which values will be summed up. The above will return the following:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations": {
        "intraday_return": {
           "value": 2.18
        }
    }
}</pre><p>The name of the aggregation (<code class="literal">intraday_return</code> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_3"></a>Script</h3></div></div></div><p>Computing the intraday return based on a script:</p><pre class="programlisting prettyprint lang-js">{
    ...,

    "aggs" : {
        "intraday_return" : { "sum" : { "script" : "doc['change'].value" } }
    }
}</pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_value_script_3"></a>Value Script</h4></div></div></div><p>Computing the sum of squares over all stock tick changes:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        ...

        "aggs" : {
            "daytime_return" : {
                "sum" : {
                    "field" : "change",
                    "script" : "_value * _value" }
            }
        }
    }
}</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-avg-aggregation"></a>Avg</h2></div></div></div><p>A <code class="literal">single-value</code> metrics aggregation that computes the average of numeric values that are extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</p><p>Assuming the data consists of documents representing exams grades (between 0 and 100) of students</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "avg_grade" : { "avg" : { "field" : "grade" } }
    }
}</pre><p>The above aggregation computes the average grade over all documents. The aggregation type is <code class="literal">avg</code> and the <code class="literal">field</code> setting defines the numeric field of the documents the average will be computed on. The above will return the following:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations": {
        "avg_grade": {
            "value": 75
        }
    }
}</pre><p>The name of the aggregation (<code class="literal">avg_grade</code> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_4"></a>Script</h3></div></div></div><p>Computing the average grade based on a script:</p><pre class="programlisting prettyprint lang-js">{
    ...,

    "aggs" : {
        "avg_grade" : { "avg" : { "script" : "doc['grade'].value" } }
    }
}</pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_value_script_4"></a>Value Script</h4></div></div></div><p>It turned out that the exam was way above the level of the students and a grade correction needs to be applied. We can use value script to get the new average:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        ...

        "aggs" : {
            "avg_corrected_grade" : {
                "avg" : {
                    "field" : "grade",
                    "script" : "_value * correction",
                    "params" : {
                        "correction" : 1.2
                    }
                }
            }
        }
    }
}</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-stats-aggregation"></a>Stats</h2></div></div></div><p>A <code class="literal">multi-value</code> metrics aggregation that computes stats over numeric values extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</p><p>The stats that are returned consist of: <code class="literal">min</code>, <code class="literal">max</code>, <code class="literal">sum</code>, <code class="literal">count</code> and <code class="literal">avg</code>.</p><p>Assuming the data consists of documents representing exams grades (between 0 and 100) of students</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "grades_stats" : { "stats" : { "field" : "grade" } }
    }
}</pre><p>The above aggregation computes the grades statistics over all documents. The aggregation type is <code class="literal">stats</code> and the <code class="literal">field</code> setting defines the numeric field of the documents the stats will be computed on. The above will return the following:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations": {
        "grades_stats": {
            "count": 6,
            "min": 60,
            "max": 98,
            "avg": 78.5,
            "sum": 471
        }
    }
}</pre><p>The name of the aggregation (<code class="literal">grades_stats</code> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_5"></a>Script</h3></div></div></div><p>Computing the grades stats based on a script:</p><pre class="programlisting prettyprint lang-js">{
    ...,

    "aggs" : {
        "grades_stats" : { "stats" : { "script" : "doc['grade'].value" } }
    }
}</pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_value_script_5"></a>Value Script</h4></div></div></div><p>It turned out that the exam was way above the level of the students and a grade correction needs to be applied. We can use a value script to get the new stats:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        ...

        "aggs" : {
            "grades_stats" : {
                "stats" : {
                    "field" : "grade",
                    "script" : "_value * correction",
                    "params" : {
                        "correction" : 1.2
                    }
                }
            }
        }
    }
}</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-extendedstats-aggregation"></a>Extended Stats</h2></div></div></div><p>A <code class="literal">multi-value</code> metrics aggregation that computes stats over numeric values extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</p><p>The <code class="literal">extended_stats</code> aggregations is an extended version of the <a class="link" href="#search-aggregations-metrics-stats-aggregation" title="Stats"><code class="literal">stats</code></a> aggregation, where additional metrics are added such as <code class="literal">sum_of_squares</code>, <code class="literal">variance</code> and <code class="literal">std_deviation</code>.</p><p>Assuming the data consists of documents representing exams grades (between 0 and 100) of students</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "grades_stats" : { "extended_stats" : { "field" : "grade" } }
    }
}</pre><p>The above aggregation computes the grades statistics over all documents. The aggregation type is <code class="literal">extended_stats</code> and the <code class="literal">field</code> setting defines the numeric field of the documents the stats will be computed on. The above will return the following:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations": {
        "grades_stats": {
            "count": 6,
            "min": 72,
            "max": 117.6,
            "avg": 94.2,
            "sum": 565.2,
            "sum_of_squares": 54551.51999999999,
            "variance": 218.2799999999976,
            "std_deviation": 14.774302013969987
        }
    }
}</pre><p>The name of the aggregation (<code class="literal">grades_stats</code> above) also serves as the key by which the aggreagtion result can be retrieved from the returned response.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_6"></a>Script</h3></div></div></div><p>Computing the grades stats based on a script:</p><pre class="programlisting prettyprint lang-js">{
    ...,

    "aggs" : {
        "grades_stats" : { "extended_stats" : { "script" : "doc['grade'].value" } }
    }
}</pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_value_script_6"></a>Value Script</h4></div></div></div><p>It turned out that the exam was way above the level of the students and a grade correction needs to be applied. We can use value script to get the new stats:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        ...

        "aggs" : {
            "grades_stats" : {
                "extended_stats" : {
                    "field" : "grade",
                    "script" : "_value * correction",
                    "params" : {
                        "correction" : 1.2
                    }
                }
            }
        }
    }
}</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-valuecount-aggregation"></a>Value Count</h2></div></div></div><p>A <code class="literal">single-value</code> metrics aggregation that counts the number of values that are extracted from the aggregated documents.
These values can be extracted either from specific fields in the documents, or be generated by a provided script. Typically,
this aggregator will be used in conjunction with other single-value aggregations. For example, when computing the <code class="literal">avg</code>
one might be interested in the number of values the average is computed over.</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "grades_count" : { "value_count" : { "field" : "grade" } }
    }
}</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations": {
        "grades_count": {
            "value": 10
        }
    }
}</pre><p>The name of the aggregation (<code class="literal">grades_count</code> above) also serves as the key by which the aggregation result can be
retrieved from the returned response.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_7"></a>Script</h3></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.1.0.</p></div></div><p>Counting the values generated by a script:</p><pre class="programlisting prettyprint lang-js">{
    ...,

    "aggs" : {
        "grades_count" : { "value_count" : { "script" : "doc['grade'].value" } }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-percentile-aggregation"></a>Percentiles</h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.1.0.</p></div></div><p>A <code class="literal">multi-value</code> metrics aggregation that calculates one or more percentiles
over numeric values extracted from the aggregated documents.  These values
can be extracted either from specific numeric fields in the documents, or
be generated by a provided script.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><h4>Experimental!</h4><p>This feature is marked as experimental, and may be subject to change in the
future.  If you use this feature, please let us know your experience with it!</p></div></div><p>Percentiles show the point at which a certain percentage of observed values
occur.  For example, the 95th percentile is the value which is greater than 95%
of the observed values.</p><p>Percentiles are often used to find outliers.  In normal distributions, the
0.13th and 99.87th percentiles represents three standard deviations from the
mean.  Any data which falls outside three standard deviations is often considered
an anomaly.</p><p>When a range of percentiles are retrieved, they can be used to estimate the
data distribution and determine if the data is skewed, bimodal, etc.</p><p>Assume your data consists of website load times.  The average and median
load times are not overly useful to an administrator.  The max may be interesting,
but it can be easily skewed by a single slow response.</p><p>Letâs look at a range of percentiles representing load time:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "load_time_outlier" : {
            "percentiles" : {
                "field" : "load_time" <a id="CO5-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO5-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The field <code class="literal">load_time</code> must be a numeric field
</p></td></tr></table></div><p>By default, the <code class="literal">percentile</code> metric will generate a range of
percentiles: <code class="literal">[ 1, 5, 25, 50, 75, 95, 99 ]</code>.  The response will look like this:</p><pre class="programlisting prettyprint lang-js">{
    ...

   "aggregations": {
      "load_time_outlier": {
         "1.0": 15,
         "5.0": 20,
         "25.0": 23,
         "50.0": 25,
         "75.0": 29,
         "95.0": 60,
         "99.0": 150
      }
   }
}</pre><p>As you can see, the aggregation will return a calculated value for each percentile
in the default range.  If we assume response times are in milliseconds, it is
immediately obvious that the webpage normally loads in 15-30ms, but occasionally
spikes to 60-150ms.</p><p>Often, administrators are only interested in outliersâââthe extreme percentiles.
We can specify just the percents we are interested in (requested percentiles
must be a value between 0-100 inclusive):</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "load_time_outlier" : {
            "percentiles" : {
                "field" : "load_time",
                "percents" : [95, 99, 99.9] <a id="CO6-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO6-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Use the <code class="literal">percents</code> parameter to specify particular percentiles to calculate
</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_8"></a>Script</h3></div></div></div><p>The percentile metric supports scripting.  For example, if our load times
are in milliseconds but we want percentiles calculated in seconds, we could use
a script to convert them on-the-fly:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "load_time_outlier" : {
            "percentiles" : {
                "script" : "doc['load_time'].value / timeUnit", <a id="CO7-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                "params" : {
                    "timeUnit" : 1000   <a id="CO7-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
                }
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">field</code> parameter is replaced with a <code class="literal">script</code> parameter, which uses the
script to generate values which percentiles are calculated on
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Scripting supports parameterized input just like any other script
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_percentiles_are_usually_approximate"></a>Percentiles are (usually) approximate</h3></div></div></div><p>There are many different algorithms to calculate percentiles.  The naive
implementation simply stores all the values in a sorted array.  To find the 50th
percentile, you simply find the value that is at <code class="literal">my_array[count(my_array) * 0.5]</code>.</p><p>Clearly, the naive implementation does not scaleâââthe sorted array grows
linearly with the number of values in your dataset.  To calculate percentiles
across potentially billions of values in an Elasticsearch cluster, <span class="emphasis"><em>approximate</em></span>
percentiles are calculated.</p><p>The algorithm used by the <code class="literal">percentile</code> metric is called TDigest (introduced by
Ted Dunning in
<a class="ulink" href="https://github.com/tdunning/t-digest/blob/master/docs/t-digest-paper/histo.pdf" target="_top">Computing Accurate Quantiles using T-Digests</a>).</p><p>When using this metric, there are a few guidelines to keep in mind:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Accuracy is proportional to <code class="literal">q(1-q)</code>.  This means that extreme percentiles (e.g. 99%)
are more accurate than less extreme percentiles, such as the median
</li><li class="listitem">
For small sets of values, percentiles are highly accurate (and potentially
100% accurate if the data is small enough).
</li><li class="listitem">
As the quantity of values in a bucket grows, the algorithm begins to approximate
the percentiles.  It is effectively trading accuracy for memory savings.  The
exact level of inaccuracy is difficult to generalize, since it depends on your
data distribution and volume of data being aggregated
</li></ul></div><p>The following chart shows the relative error on a uniform distribution depending
on the number of collected values and the requested percentile:</p><p><span class="inlinemediaobject"><img src="images/percentiles_error.png" alt="images/percentiles_error.png" /></span></p><p>It shows how precision is better for extreme percentiles. The reason why error diminishes
for large number of values is that the law of large numbers makes the distribution of
values more and more uniform and the t-digest tree can do a better job at summarizing
it. It would not be the case on more skewed distributions.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_compression"></a>Compression</h3></div></div></div><p>Approximate algorithms must balance memory utilization with estimation accuracy.
This balance can be controlled using a <code class="literal">compression</code> parameter:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "load_time_outlier" : {
            "percentiles" : {
                "field" : "load_time",
                "compression" : 200 <a id="CO8-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Compression controls memory usage and approximation error
</p></td></tr></table></div><p>The TDigest algorithm uses a number of "nodes" to approximate percentilesâââthe
more nodes available, the higher the accuracy (and large memory footprint) proportional
to the volume of data.  The <code class="literal">compression</code> parameter limits the maximum number of
nodes to <code class="literal">100 * compression</code>.</p><p>Therefore, by increasing the compression value, you can increase the accuracy of
your percentiles at the cost of more memory.  Larger compression values also
make the algorithm slower since the underlying tree data structure grows in size,
resulting in more expensive operations.  The default compression value is
<code class="literal">100</code>.</p><p>A "node" uses roughly 48 bytes of memory, so under worst-case scenarios (large amount
of data which arrives sorted and in-order) the default settings will produce a
TDigest roughly 480KB in size.  In practice data tends to be more random and
the TDigest will use less memory.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-cardinality-aggregation"></a>Cardinality</h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.1.0.</p></div></div><p>A <code class="literal">single-value</code> metrics aggregation that calculates an approximate count of
distinct values. Values can be extracted either from specific fields in the
document or generated by a script.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><h4>Experimental!</h4><p>This feature is marked as experimental, and may be subject to change in the
future.  If you use this feature, please let us know your experience with it!</p></div></div><p>Assume you are indexing books and would like to count the unique authors that
match a query:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "author_count" : {
            "cardinality" : {
                "field" : "author"
            }
        }
    }
}</pre><p>This aggregation also supports the <code class="literal">precision_threshold</code> and <code class="literal">rehash</code> options:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "author_count" : {
            "cardinality" : {
                "field" : "author_hash",
                "precision_threshold": 100, <a id="CO9-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                "rehash": false <a id="CO9-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">precision_threshold</code> options allows to trade memory for accuracy, and
defines a unique count below which counts are expected to be close to
accurate. Above this value, counts might become a bit more fuzzy. The maximum
supported value is 40000, thresholds above this number will have the same
effect as a threshold of 40000.
Default value depends on the number of parent aggregations that multiple
create buckets (such as terms or histograms).
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
If you computed a hash on client-side, stored it into your documents and want
Elasticsearch to use them to compute counts using this hash function without
rehashing values, it is possible to specify <code class="literal">rehash: false</code>. Default value is
<code class="literal">true</code>. Please note that the hash must be indexed as a long when <code class="literal">rehash</code> is
false.
</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_counts_are_approximate"></a>Counts are approximate</h3></div></div></div><p>Computing exact counts requires loading values into a hash set and returning its
size. This doesnât scale when working on high-cardinality sets and/or large
values as the required memory usage and the need to communicate those
per-shard sets between nodes would utilize too many resources of the cluster.</p><p>This <code class="literal">cardinality</code> aggregation is based on the
<a class="ulink" href="http://static.googleusercontent.com/media/research.google.com/fr//pubs/archive/40671.pdf" target="_top">HyperLogLog++</a>
algorithm, which counts based on the hashes of the values with some interesting
properties:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
configurable precision, which decides on how to trade memory for accuracy,
</li><li class="listitem">
excellent accuracy on low-cardinality sets,
</li><li class="listitem">
fixed memory usage: no matter if there are tens or billions of unique values,
   memory usage only depends on the configured precision.
</li></ul></div><p>For a precision threshold of <code class="literal">c</code>, the implementation that we are using requires
about <code class="literal">c * 8</code> bytes.</p><p>The following chart shows how the error varies before and after the threshold:</p><p><span class="inlinemediaobject"><img src="images/cardinality_error.png" alt="images/cardinality_error.png" /></span></p><p>For all 3 thresholds, counts have been accurate up to the configured threshold
(although not guaranteed, this is likely to be the case). Please also note that
even with a threshold as low as 100, the error remains under under 5%, even when
counting millions of items.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_pre_computed_hashes"></a>Pre-computed hashes</h3></div></div></div><p>If you donât want Elasticsearch to re-compute hashes on every run of this
aggregation, it is possible to use pre-computed hashes, either by computing a
hash on client-side, indexing it and specifying <code class="literal">rehash: false</code>, or by using
the special <code class="literal">murmur3</code> field mapper, typically in the context of a <code class="literal">multi-field</code>
in the mapping:</p><pre class="programlisting prettyprint lang-js">{
    "author": {
        "type": "string",
        "fields": {
            "hash": {
                "type": "murmur3"
            }
        }
    }
}</pre><p>With such a mapping, Elasticsearch is going to compute hashes of the <code class="literal">author</code>
field at indexing time and store them in the <code class="literal">author.hash</code> field. This
way, unique counts can be computed using the cardinality aggregation by only
loading the hashes into memory, not the values of the <code class="literal">author</code> field, and
without computing hashes on the fly:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "author_count" : {
            "cardinality" : {
                "field" : "author.hash"
            }
        }
    }
}</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p><code class="literal">rehash</code> is automatically set to <code class="literal">false</code> when computing unique counts on
a <code class="literal">murmur3</code> field.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Pre-computing hashes is usually only useful on very large and/or
high-cardinality fields as it saves CPU and memory. However, on numeric
fields, hashing is very fast and storing the original values requires as much
or less memory than storing the hashes. This is also true on low-cardinality
string fields, especially given that those have an optimization in order to
make sure that hashes are computed at most once per unique value per segment.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_9"></a>Script</h3></div></div></div><p>The <code class="literal">cardinality</code> metric supports scripting, with a noticeable performance hit
however since hashes need to be computed on the fly.</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "author_count" : {
            "cardinality" : {
                "script": "doc['author.first_name'].value + ' ' + doc['author.last_name'].value"
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-global-aggregation"></a>Global</h2></div></div></div><p>Defines a single bucket of all the documents within the search execution context. This context is defined by the indices and the document types youâre searching on, but is <span class="strong"><strong>not</strong></span> influenced by the search query itself.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Global aggregators can only be placed as top level aggregators (it makes no sense to embed a global aggregator
        within another bucket aggregator)</p></div></div><p>Example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match" : { "title" : "shirt" }
    },
    "aggs" : {
        "all_products" : {
            "global" : {}, <a id="CO10-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            "aggs" : { <a id="CO10-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
                "avg_price" : { "avg" : { "field" : "price" } }
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">global</code> aggregation has an empty body
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The sub-aggregations that are registered for this <code class="literal">global</code> aggregation
</p></td></tr></table></div><p>The above aggregation demonstrates how one would compute aggregations (<code class="literal">avg_price</code> in this example) on all the documents in the search context, regardless of the query (in our example, it will compute the the average price over all products in our catalog, not just on the "shirts").</p><p>The response for the above aggreation:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations" : {
        "all_products" : {
            "doc_count" : 100, <a id="CO11-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            "avg_price" : {
                "value" : 56.3
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The number of documents that were aggregated (in our case, all documents within the search context)
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-filter-aggregation"></a>Filter</h2></div></div></div><p>Defines a single bucket of all the documents in the current document set context that match a specified filter. Often this will be used to narrow down the current aggregation context to a specific set of documents.</p><p>Example:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "in_stock_products" : {
            "filter" : { "range" : { "stock" : { "gt" : 0 } } },
            "aggs" : {
                "avg_price" : { "avg" : { "field" : "price" } }
            }
        }
    }
}</pre><p>In the above example, we calculate the average price of all the products that are currently in-stock.</p><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggs" : {
        "in_stock_products" : {
            "doc_count" : 100,
            "avg_price" : { "value" : 56.3 }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-missing-aggregation"></a>Missing</h2></div></div></div><p>A field data based single bucket aggregation, that creates a bucket of all documents in the current document set context that are missing a field value (effectively, missing a field or having the configured NULL value set). This aggregator will often be used in conjunction with other field data bucket aggregators (such as ranges) to return information for all the documents that could not be placed in any of the other buckets due to missing field data values.</p><p>Example:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "products_without_a_price" : {
            "missing" : { "field" : "price" }
        }
    }
}</pre><p>In the above example, we calculate the average price of all the products that are currently in-stock.</p><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggs" : {
        "products_without_a_price" : {
            "doc_count" : 10
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-nested-aggregation"></a>Nested</h2></div></div></div><p>A special single bucket aggregation that enables aggregating nested documents.</p><p>For example, lets say we have a index of products, and each product holds the list of resellers - each having its own
price for the product. The mapping could look like:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "product" : {
        "properties" : {
            "resellers" : { <a id="CO12-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                "type" : "nested"
                "properties" : {
                    "name" : { "type" : "string" },
                    "price" : { "type" : "double" }
                }
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">resellers</code> is an array that holds nested documents under the <code class="literal">product</code> object.
</p></td></tr></table></div><p>The following aggregations will return the minimum price products can be purchased in:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match" : { "name" : "led tv" }
    }
    "aggs" : {
        "resellers" : {
            "nested" : {
                "path" : "resellers"
            },
            "aggs" : {
                "min_price" : { "min" : { "field" : "resellers.price" } }
            }
        }
    }
}</pre><p>As you can see above, the nested aggregation requires the <code class="literal">path</code> of the nested documents within the top level documents.
Then one can define any type of aggregation over these nested documents.</p><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    "aggregations": {
        "resellers": {
            "min_price": {
                "value" : 350
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-terms-aggregation"></a>Terms</h2></div></div></div><p>A multi-bucket value source based aggregation where buckets are dynamically built - one per unique value.</p><p>Example:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "genders" : {
            "terms" : { "field" : "gender" }
        }
    }
}</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations" : {
        "genders" : {
            "buckets" : [
                {
                    "key" : "male",
                    "doc_count" : 10
                },
                {
                    "key" : "female",
                    "doc_count" : 10
                },
            ]
        }
    }
}</pre><p>By default, the <code class="literal">terms</code> aggregation will return the buckets for the top ten terms ordered by the <code class="literal">doc_count</code>. One can
change this default behaviour by setting the <code class="literal">size</code> parameter.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_size_amp_shard_size"></a>Size &amp; Shard Size</h3></div></div></div><p>The <code class="literal">size</code> parameter can be set to define how many term buckets should be returned out of the overall terms list. By
default, the node coordinating the search process will request each shard to provide its own top <code class="literal">size</code> term buckets
and once all shards respond, it will reduce the results to the final list that will then be returned to the client.
This means that if the number of unique terms is greater than <code class="literal">size</code>, the returned list is slightly off and not accurate
(it could be that the term counts are slightly off and it could even be that a term that should have been in the top
size buckets was not returned).</p><p>The higher the requested <code class="literal">size</code> is, the more accurate the results will be, but also, the more expensive it will be to
compute the final results (both due to bigger priority queues that are managed on a shard level and due to bigger data
transfers between the nodes and the client).</p><p>The <code class="literal">shard_size</code> parameter can be  used to minimize the extra work that comes with bigger requested <code class="literal">size</code>. When defined,
it will determine how many terms the coordinating node will request from each shard. Once all the shards responded, the
coordinating node will then reduce them to a final result which will be based on the <code class="literal">size</code> parameter - this way,
one can increase the accuracy of the returned terms and avoid the overhead of streaming a big list of buckets back to
the client.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p><code class="literal">shard_size</code> cannot be smaller than <code class="literal">size</code> (as it doesnât make much sense). When it is, elasticsearch will
        override it and reset it to be equal to <code class="literal">size</code>.</p></div></div><p><span class="added">
      [<span class="version">1.1.0</span>]
      <span class="detail">Added in 1.1.0.</span></span> It is possible to not limit the number of terms that are returned by setting <code class="literal">size</code> to <code class="literal">0</code>. Donât use this
on high-cardinality fields as this will kill both your CPU since terms need to be return sorted, and your network.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_order"></a>Order</h3></div></div></div><p>The order of the buckets can be customized by setting the <code class="literal">order</code> parameter. By default, the buckets are ordered by
their <code class="literal">doc_count</code> descending. It is also possible to change this behaviour as follows:</p><p>Ordering the buckets by their <code class="literal">doc_count</code> in an ascending manner:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "genders" : {
            "terms" : {
                "field" : "gender",
                "order" : { "_count" : "asc" }
            }
        }
    }
}</pre><p>Ordering the buckets alphabetically by their terms in an ascending manner:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "genders" : {
            "terms" : {
                "field" : "gender",
                "order" : { "_term" : "asc" }
            }
        }
    }
}</pre><p>Ordering the buckets by single value metrics sub-aggregation (identified by the aggregation name):</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "genders" : {
            "terms" : {
                "field" : "gender",
                "order" : { "avg_height" : "desc" }
            },
            "aggs" : {
                "avg_height" : { "avg" : { "field" : "height" } }
            }
        }
    }
}</pre><p>Ordering the buckets by multi value metrics sub-aggregation (identified by the aggregation name):</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "genders" : {
            "terms" : {
                "field" : "gender",
                "order" : { "height_stats.avg" : "desc" }
            },
            "aggs" : {
                "height_stats" : { "stats" : { "field" : "height" } }
            }
        }
    }
}</pre><p>It is also possible to order the buckets based on a "deeper" aggregation in the hierarchy. This is supported as long
as the aggregations path are of a single-bucket type, where the last aggregation in the path may either by a single-bucket
one or a metrics one. If itâs a single-bucket type, the order will be defined by the number of docs in the bucket (i.e. <code class="literal">doc_count</code>),
in case itâs a metrics one, the same rules as above apply (where the path must indicate the metric name to sort by in case of
a multi-value metrics aggregation, and in case of a single-value metrics aggregation the sort will be applied on that value).</p><p>The path must be defined in the following form:</p><pre class="screen">AGG_SEPARATOR       :=  '&gt;'
METRIC_SEPARATOR    :=  '.'
AGG_NAME            :=  &lt;the name of the aggregation&gt;
METRIC              :=  &lt;the name of the metric (in case of multi-value metrics aggregation)&gt;
PATH                :=  &lt;AGG_NAME&gt;[&lt;AGG_SEPARATOR&gt;&lt;AGG_NAME&gt;]*[&lt;METRIC_SEPARATOR&gt;&lt;METRIC&gt;]</pre><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "countries" : {
            "terms" : {
                "field" : "address.country",
                "order" : { "females&gt;height_stats.avg" : "desc" }
            },
            "aggs" : {
                "females" : {
                    "filter" : { "term" : { "gender" : { "female" }}},
                    "aggs" : {
                        "height_stats" : { "stats" : { "field" : "height" }}
                    }
                }
            }
        }
    }
}</pre><p>The above will sort the countries buckets based on the average height among the female population.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_minimum_document_count"></a>Minimum document count</h3></div></div></div><p>It is possible to only return terms that match more than a configured number of hits using the <code class="literal">min_doc_count</code> option:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "tags" : {
            "terms" : {
                "field" : "tag",
                "min_doc_count": 10
            }
        }
    }
}</pre><p>The above aggregation would only return tags which have been found in 10 hits or more. Default value is <code class="literal">1</code>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Setting <code class="literal">min_doc_count</code>=<code class="literal">0</code> will also return buckets for terms that didnât match any hit. However, some of
         the returned terms which have a document count of zero might only belong to deleted documents, so there is
         no warranty that a <code class="literal">match_all</code> query would find a positive document count for those terms.</p></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>When NOT sorting on <code class="literal">doc_count</code> descending, high values of <code class="literal">min_doc_count</code> may return a number of buckets
         which is less than <code class="literal">size</code> because not enough data was gathered from the shards. Missing buckets can be
         back by increasing <code class="literal">shard_size</code>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_10"></a>Script</h3></div></div></div><p>Generating the terms using a script:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "genders" : {
            "terms" : {
                "script" : "doc['gender'].value"
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_value_script_7"></a>Value Script</h3></div></div></div><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "genders" : {
            "terms" : {
                "field" : "gender",
                "script" : "'Gender: ' +_value"
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_filtering_values"></a>Filtering Values</h3></div></div></div><p>It is possible to filter the values for which buckets will be created. This can be done using the <code class="literal">include</code> and
<code class="literal">exclude</code> parameters which are based on regular expressions.</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "tags" : {
            "terms" : {
                "field" : "tags",
                "include" : ".*sport.*",
                "exclude" : "water_.*"
            }
        }
    }
}</pre><p>In the above example, buckets will be created for all the tags that has the word <code class="literal">sport</code> in them, except those starting
with <code class="literal">water_</code> (so the tag <code class="literal">water_sports</code> will no be aggregated). The <code class="literal">include</code> regular expression will determine what
values are "allowed" to be aggregated, while the <code class="literal">exclude</code> determines the values that should not be aggregated. When
both are defined, the <code class="literal">exclude</code> has precedence, meaning, the <code class="literal">include</code> is evaluated first and only then the <code class="literal">exclude</code>.</p><p>The regular expression are based on the Javaâ¢ <a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html" target="_top">Pattern</a>,
and as such, they it is also possible to pass in flags that will determine how the compiled regular expression will work:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "tags" : {
             "terms" : {
                 "field" : "tags",
                 "include" : {
                     "pattern" : ".*sport.*",
                     "flags" : "CANON_EQ|CASE_INSENSITIVE" <a id="CO13-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                 },
                 "exclude" : {
                     "pattern" : "water_.*",
                     "flags" : "CANON_EQ|CASE_INSENSITIVE"
                 }
             }
         }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO13-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
the flags are concatenated using the <code class="literal">|</code> character as a separator
</p></td></tr></table></div><p>The possible flags that can be used are:
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#CANON_EQ" target="_top"><code class="literal">CANON_EQ</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#CASE_INSENSITIVE" target="_top"><code class="literal">CASE_INSENSITIVE</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#COMMENTS" target="_top"><code class="literal">COMMENTS</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#DOTALL" target="_top"><code class="literal">DOTALL</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#LITERAL" target="_top"><code class="literal">LITERAL</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#MULTILINE" target="_top"><code class="literal">MULTILINE</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#UNICODE_CASE" target="_top"><code class="literal">UNICODE_CASE</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#UNICODE_CHARACTER_CLASS" target="_top"><code class="literal">UNICODE_CHARACTER_CLASS</code></a> and
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#UNIX_LINES" target="_top"><code class="literal">UNIX_LINES</code></a></p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_execution_hint"></a>Execution hint</h3></div></div></div><p>There are two mechanisms by which terms aggregations can be executed: either by using field values directly in order to aggregate
data per-bucket (<code class="literal">map</code>), or by using ordinals of the field values instead of the values themselves (<code class="literal">ordinals</code>). Although the
latter execution mode can be expected to be slightly faster, it is only available for use when the underlying data source exposes
those terms ordinals. Moreover, it may actually be slower if most field values are unique. Elasticsearch tries to have sensible
defaults when it comes to the execution mode that should be used, but in case you know that one execution mode may perform better
than the other one, you have the ability to "hint" it to Elasticsearch:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "tags" : {
             "terms" : {
                 "field" : "tags",
                 "execution_hint": "map" <a id="CO14-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
             }
         }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO14-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
the possible values are <code class="literal">map</code> and <code class="literal">ordinals</code>
</p></td></tr></table></div><p>Please note that Elasticsearch will ignore this execution hint if it is not applicable.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-significantterms-aggregation"></a>Significant Terms</h2></div></div></div><p>An aggregation that returns interesting or unusual occurrences of terms in a set.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><h4>Experimental!</h4><p>This feature is marked as experimental, and may be subject to change in the
future.  If you use this feature, please let us know your experience with it!</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.1.0.</p></div></div><div class="itemizedlist"><p class="title"><strong>Example use cases:</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
Suggesting "H5N1" when users search for "bird flu" in text
</li><li class="listitem">
Identifying the merchant that is the "common point of compromise" from the transaction history of credit card owners reporting loss
</li><li class="listitem">
Suggesting keywords relating to stock symbol $ATI for an automated news classifier
</li><li class="listitem">
Spotting the fraudulent doctor who is diagnosing more than his fair share of whiplash injuries
</li><li class="listitem">
Spotting the tire manufacturer who has a disproportionate number of blow-outs
</li></ul></div><p>In all these cases the terms being selected are not simply the most popular terms in a set.
They are the terms that have undergone a significant change in popularity measured between a <span class="emphasis"><em>foreground</em></span> and <span class="emphasis"><em>background</em></span> set.
If the term "H5N1" only exists in 5 documents in a 10 million document index and yet is found in 4 of the 100 documents that make up a userâs search results
that is significant and probably very relevant to their search. 5/10,000,000 vs 4/100 is a big swing in frequency.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_single_set_analysis"></a>Single-set analysis</h3></div></div></div><p>In the simplest case, the <span class="emphasis"><em>foreground</em></span> set of interest is the search results matched by a query and the <span class="emphasis"><em>background</em></span>
set used for statistical comparisons is the index or indices from which the results were gathered.</p><p>Example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "terms" : {"force" : [ "British Transport Police" ]}
    },
    "aggregations" : {
        "significantCrimeTypes" : {
            "significant_terms" : { "field" : "crime_type" }
        }
    }
}</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations" : {
        "significantCrimeTypes" : {
            "doc_count": 47347,
            "buckets" : [
                {
                    "key": "Bicycle theft",
                    "doc_count": 3640,
                    "score": 0.371235374214817,
                    "bg_count": 66799
                }
                ...
            ]
        }
    }
}</pre><p>When querying an index of all crimes from all police forces, what these results show is that the British Transport Police force
stand out as a force dealing with a disproportionately large number of bicycle thefts. Ordinarily, bicycle thefts represent only 1% of crimes (66799/5064554)
but for the British Transport Police, who handle crime on railways and stations, 7% of crimes (3640/47347) is
a bike theft. This is a significant seven-fold increase in frequency and so this anomaly was highlighted as the top crime type.</p><p>The problem with using a query to spot anomalies is it only gives us one subset to use for comparisons.
To discover all the other police forces' anomalies we would have to repeat the query for each of the different forces.</p><p>This can be a tedious way to look for unusual patterns in an index</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multi_set_analysis"></a>Multi-set analysis</h3></div></div></div><p>A simpler way to perform analysis across multiple categories is to use a parent-level aggregation to segment the data ready for analysis.</p><p>Example using a parent aggregation for segmentation:</p><pre class="programlisting prettyprint lang-js">{
    "aggregations": {
        "forces": {
            "terms": {"field": "force"},
            "aggregations": {
                "significantCrimeTypes": {
                    "significant_terms": {"field": "crime_type"}
                }
            }
        }
    }
}</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
 ...

 "aggregations": {
    "forces": {
        "buckets": [
            {
                "key": "Metropolitan Police Service",
                "doc_count": 894038,
                "significantCrimeTypes": {
                    "doc_count": 894038,
                    "buckets": [
                        {
                            "key": "Robbery",
                            "doc_count": 27617,
                            "score": 0.0599,
                            "bg_count": 53182
                        },
                        ...
                    ]
                }
            },
            {
                "key": "British Transport Police",
                "doc_count": 47347,
                "significantCrimeTypes": {
                    "doc_count": 47347,
                    "buckets": [
                        {
                            "key": "Bicycle theft",
                            "doc_count": 3640,
                            "score": 0.371,
                            "bg_count": 66799
                        },
                        ...
                    ]
                }
            }
        ]
    }
}</pre><p>Now we have anomaly detection for each of the police forces using a single request.</p><p>We can use other forms of top-level aggregations to segment our data, for example segmenting by geographic
area to identify unusual hot-spots of a particular crime type:</p><pre class="programlisting prettyprint lang-js">{
    "aggs": {
        "hotspots": {
            "geohash_grid" : {
                "field":"location",
                "precision":5,
            },
            "aggs": {
                "significantCrimeTypes": {
                    "significant_terms": {"field": "crime_type"}
                }
            }
        }
    }
}</pre><p>This example uses the <code class="literal">geohash_grid</code> aggregation to create result buckets that represent geographic areas, and inside each
bucket we can identify anomalous levels of a crime type in these tightly-focused areas e.g.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Airports exhibit unusual numbers of weapon confiscations
</li><li class="listitem">
Universities show uplifts of bicycle thefts
</li></ul></div><p>At a higher geohash_grid zoom-level with larger coverage areas we would start to see where an entire police-force may be
tackling an unusual volume of a particular crime type.</p><p>Obviously a time-based top-level segmentation would help identify current trends for each point in time
where a simple <code class="literal">terms</code> aggregation would typically show the very popular "constants" that persist across all time slots.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>How are the scores calculated?</strong></p></div></div></div><p>The numbers returned for scores are primarily intended for ranking different suggestions sensibly rather than something easily understood by end users.
The scores are derived from the doc frequencies in <span class="emphasis"><em>foreground</em></span> and <span class="emphasis"><em>background</em></span> sets. The <span class="emphasis"><em>absolute</em></span> change in popularity (foregroundPercent - backgroundPercent) would favour
common terms whereas the <span class="emphasis"><em>relative</em></span> change in popularity (foregroundPercent/ backgroundPercent) would favour rare terms.
Rare vs common is essentially a precision vs recall balance and so the absolute and relative changes are multiplied to provide a sweet spot between precision and recall.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_use_on_free_text_fields"></a>Use on free-text fields</h3></div></div></div><p>The significant_terms aggregation can be used effectively on tokenized free-text fields to suggest:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
keywords for refining end-user searches
</li><li class="listitem">
keywords for use in percolator queries
</li></ul></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>Picking a free-text field as the subject of a significant terms analysis can be expensive! It will attempt
to load every unique word into RAM. It is recommended to only use this on smaller indices.</p></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Use the <span class="emphasis"><em>"like this but not this"</em></span> pattern</strong></p></div></div></div><p>You can spot mis-categorized content by first searching a structured field e.g. <code class="literal">category:adultMovie</code> and use significant_terms on the
free-text "movie_description" field. Take the suggested words (Iâll leave them to your imagination) and then search for all movies NOT marked as category:adultMovie but containing these keywords.
You now have a ranked list of badly-categorized movies that you should reclassify or at least remove from the "familyFriendly" category.</p><p>The significance score from each term can also provide a useful <code class="literal">boost</code> setting to sort matches.
Using the <code class="literal">minimum_should_match</code> setting of the <code class="literal">terms</code> query with the keywords will help control the balance of precision/recall in the result set i.e
a high setting would have a small number of relevant results packed full of keywords and a setting of "1" would produce a more exhaustive results set with all documents containing <span class="emphasis"><em>any</em></span> keyword.</p></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p><strong>Show significant_terms in context.Â </strong>Free-text significant_terms are much more easily understood when viewed in context. Take the results of <code class="literal">significant_terms</code> suggestions from a
free-text field and use them in a <code class="literal">terms</code> query on the same field with a <code class="literal">highlight</code> clause to present users with example snippets of documents. When the terms
are presented unstemmed, highlighted, with the right case, in the right order and with some context, their significance/meaning is more readily apparent.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_limitations"></a>Limitations</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_single_emphasis_background_emphasis_comparison_base"></a>Single <span class="emphasis"><em>background</em></span> comparison base</h4></div></div></div><p>The above examples show how to select the <span class="emphasis"><em>foreground</em></span> set for analysis using a query or parent aggregation to filter but currently there is no means of specifying
a <span class="emphasis"><em>background</em></span> set other than the index from which all results are ultimately drawn. Sometimes it may prove useful to use a different
background set as the basis for comparisons e.g. to first select the tweets for the TV show "XFactor" and then look
for significant terms in a subset of that content which is from this week.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_significant_terms_must_be_indexed_values"></a>Significant terms must be indexed values</h4></div></div></div><p>Unlike the terms aggregation it is currently not possible to use script-generated terms for counting purposes.
Because of the way the significant_terms aggregation must consider both <span class="emphasis"><em>foreground</em></span> and <span class="emphasis"><em>background</em></span> frequencies
it would be prohibitively expensive to use a script on the entire index to obtain background frequencies for comparisons.
Also DocValues are not supported as sources of term data for similar reasons.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_no_analysis_of_floating_point_fields"></a>No analysis of floating point fields</h4></div></div></div><p>Floating point fields are currently not supported as the subject of significant_terms analysis.
While integer or long fields can be used to represent concepts like bank account numbers or category numbers which
can be interesting to track, floating point fields are usually used to represent quantities of something.
As such, individual floating point terms are not useful for this form of frequency analysis.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_as_a_parent_aggregation"></a>Use as a parent aggregation</h4></div></div></div><p>If there is the equivalent of a <code class="literal">match_all</code> query or no query criteria providing a subset of the index the significant_terms aggregation should not be used as the
top-most aggregation - in this scenario the <span class="emphasis"><em>foreground</em></span> set is exactly the same as the <span class="emphasis"><em>background</em></span> set and
so there is no difference in document frequencies to observe and from which to make sensible suggestions.</p><p>Another consideration is that  the significant_terms aggregation produces many candidate results at shard level
that are only later pruned on the reducing node once all statistics from all shards are merged. As a result,
it can be inefficient and costly in terms of RAM to embed large child aggregations under a significant_terms
aggregation that later discards many candidate terms. It is advisable in these cases to perform two searches - the first to provide a rationalized list of
significant_terms and then add this shortlist of terms to a second query to go back and fetch the required child aggregations.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_approximate_counts"></a>Approximate counts</h4></div></div></div><p>The counts of how many documents contain a term provided in results are based on summing the samples returned from each shard and
as such may be:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
low if certain shards did not provide figures for a given term in their top sample
</li><li class="listitem">
high when considering the background frequency as it may count occurrences found in deleted documents
</li></ul></div><p>Like most design decisions, this is the basis of a trade-off in which we have chosen to provide fast performance at the cost of some (typically small) inaccuracies.
However, the <code class="literal">size</code> and <code class="literal">shard size</code> settings covered in the next section provide tools to help control the accuracy levels.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_parameters_5"></a>Parameters</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_size_amp_shard_size_2"></a>Size &amp; Shard Size</h4></div></div></div><p>The <code class="literal">size</code> parameter can be set to define how many term buckets should be returned out of the overall terms list. By
default, the node coordinating the search process will request each shard to provide its own top term buckets
and once all shards respond, it will reduce the results to the final list that will then be returned to the client.
If the number of unique terms is greater than <code class="literal">size</code>, the returned list can be slightly off and not accurate
(it could be that the term counts are slightly off and it could even be that a term that should have been in the top
size buckets was not returned).</p><p>To ensure better accuracy a multiple of the final <code class="literal">size</code> is used as the number of terms to request from each shard
using a heuristic based on the number of shards. To take manual control of this setting the <code class="literal">shard_size</code> parameter
can be  used to control the volumes of candidate terms produced by each shard.</p><p>Low-frequency terms can turn out to be the most interesting ones once all results are combined so the
significant_terms aggregation can produce higher-quality results when the <code class="literal">shard_size</code> parameter is set to
values significantly higher than the <code class="literal">size</code> setting. This ensures that a bigger volume of promising candidate terms are given
a consolidated review by the reducing node before the final selection. Obviously large candidate term lists
will cause extra network traffic and RAM usage so this is  quality/cost trade off that needs to be balanced.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p><code class="literal">shard_size</code> cannot be smaller than <code class="literal">size</code> (as it doesnât make much sense). When it is, elasticsearch will
        override it and reset it to be equal to <code class="literal">size</code>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_minimum_document_count_2"></a>Minimum document count</h4></div></div></div><p>It is possible to only return terms that match more than a configured number of hits using the <code class="literal">min_doc_count</code> option:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "tags" : {
            "significant_terms" : {
                "field" : "tag",
                "min_doc_count": 10
            }
        }
    }
}</pre><p>The above aggregation would only return tags which have been found in 10 hits or more. Default value is <code class="literal">3</code>.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>Setting <code class="literal">min_doc_count</code> to <code class="literal">1</code> is generally not advised as it tends to return terms that
         are typos or other bizarre curiosities. Finding more than one instance of a term helps
         reinforce that, while still rare, the term was not the result of a one-off accident. The
         default value of 3 is used to provide a minimum weight-of-evidence.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_filtering_values_2"></a>Filtering Values</h4></div></div></div><p>It is possible (although rarely required) to filter the values for which buckets will be created. This can be done using the <code class="literal">include</code> and
<code class="literal">exclude</code> parameters which are based on regular expressions. This functionality mirrors the features
offered by the <code class="literal">terms</code> aggregation.</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "tags" : {
            "significant_terms" : {
                "field" : "tags",
                "include" : ".*sport.*",
                "exclude" : "water_.*"
            }
        }
    }
}</pre><p>In the above example, buckets will be created for all the tags that has the word <code class="literal">sport</code> in them, except those starting
with <code class="literal">water_</code> (so the tag <code class="literal">water_sports</code> will no be aggregated). The <code class="literal">include</code> regular expression will determine what
values are "allowed" to be aggregated, while the <code class="literal">exclude</code> determines the values that should not be aggregated. When
both are defined, the <code class="literal">exclude</code> has precedence, meaning, the <code class="literal">include</code> is evaluated first and only then the <code class="literal">exclude</code>.</p><p>The regular expression are based on the Javaâ¢ <a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html" target="_top">Pattern</a>,
and as such, they it is also possible to pass in flags that will determine how the compiled regular expression will work:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "tags" : {
             "terms" : {
                 "field" : "tags",
                 "include" : {
                     "pattern" : ".*sport.*",
                     "flags" : "CANON_EQ|CASE_INSENSITIVE" <a id="CO15-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                 },
                 "exclude" : {
                     "pattern" : "water_.*",
                     "flags" : "CANON_EQ|CASE_INSENSITIVE"
                 }
             }
         }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
the flags are concatenated using the <code class="literal">|</code> character as a separator
</p></td></tr></table></div><p>The possible flags that can be used are:
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#CANON_EQ" target="_top"><code class="literal">CANON_EQ</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#CASE_INSENSITIVE" target="_top"><code class="literal">CASE_INSENSITIVE</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#COMMENTS" target="_top"><code class="literal">COMMENTS</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#DOTALL" target="_top"><code class="literal">DOTALL</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#LITERAL" target="_top"><code class="literal">LITERAL</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#MULTILINE" target="_top"><code class="literal">MULTILINE</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#UNICODE_CASE" target="_top"><code class="literal">UNICODE_CASE</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#UNICODE_CHARACTER_CLASS" target="_top"><code class="literal">UNICODE_CHARACTER_CLASS</code></a> and
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#UNIX_LINES" target="_top"><code class="literal">UNIX_LINES</code></a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_execution_hint_2"></a>Execution hint</h4></div></div></div><p>There are two mechanisms by which terms aggregations can be executed: either by using field values directly in order to aggregate
data per-bucket (<code class="literal">map</code>), or by using ordinals of the field values instead of the values themselves (<code class="literal">ordinals</code>). Although the
latter execution mode can be expected to be slightly faster, it is only available for use when the underlying data source exposes
those terms ordinals. Moreover, it may actually be slower if most field values are unique. Elasticsearch tries to have sensible
defaults when it comes to the execution mode that should be used, but in case you know that an execution mode may perform better
than the other one, you have the ability to provide Elasticsearch with a hint:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "tags" : {
             "significant_terms" : {
                 "field" : "tags",
                 "execution_hint": "map" <a id="CO16-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
             }
         }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO16-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
the possible values are <code class="literal">map</code> and <code class="literal">ordinals</code>
</p></td></tr></table></div><p>Please note that Elasticsearch will ignore this execution hint if it is not applicable.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-range-aggregation"></a>Range</h2></div></div></div><p>A multi-bucket value source based aggregation that enables the user to define a set of ranges - each representing a bucket. During the aggregation process, the values extracted from each document will be checked against each bucket range and "bucket" the relevant/matching document.
Note that this aggregration includes the <code class="literal">from</code> value and excludes the <code class="literal">to</code> value for each range.</p><p>Example:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations": {
        "price_ranges" : {
            "buckets": [
                {
                    "to": 50,
                    "doc_count": 2
                },
                {
                    "from": 50,
                    "to": 100,
                    "doc_count": 4
                },
                {
                    "from": 100,
                    "doc_count": 4
                }
            ]
        }
    }
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_keyed_response"></a>Keyed Response</h3></div></div></div><p>Setting the <code class="literal">key</code> flag to <code class="literal">true</code> will associate a unique string key with each bucket and return the ranges as a hash rather than an array:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "keyed" : true,
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations": {
        "price_ranges" : {
            "buckets": {
                "*-50.0": {
                    "to": 50,
                    "doc_count": 2
                },
                "50.0-100.0": {
                    "from": 50,
                    "to": 100,
                    "doc_count": 4
                },
                "100.0-*": {
                    "from": 100,
                    "doc_count": 4
                }
            }
        }
    }
}</pre><p>It is also possible to customize the key for each range:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "keyed" : true,
                "ranges" : [
                    { "key" : "cheap", "to" : 50 },
                    { "key" : "average", "from" : 50, "to" : 100 },
                    { "key" : "expensive", "from" : 100 }
                ]
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_11"></a>Script</h3></div></div></div><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "script" : "doc['price'].value",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_value_script_8"></a>Value Script</h3></div></div></div><p>Lets say the product prices are in USD but we would like to get the price ranges in EURO. We can use value script to convert the prices prior the aggregation (assuming conversion rate of 0.8)</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "script" : "_value * conversion_rate",
                "params" : {
                    "conversion_rate" : 0.8
                },
                "ranges" : [
                    { "to" : 35 },
                    { "from" : 35, "to" : 70 },
                    { "from" : 70 }
                ]
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_sub_aggregations"></a>Sub Aggregations</h3></div></div></div><p>The following example, not only "bucket" the documents to the different buckets but also computes statistics over the prices in each price range</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            },
            "aggs" : {
                "price_stats" : {
                    "stats" : { "field" : "price" }
                }
            }
        }
    }
}</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    "aggregations": {
        "price_ranges" : {
            "buckets": [
                {
                    "to": 50,
                    "doc_count": 2,
                    "price_stats": {
                        "count": 2,
                        "min": 20,
                        "max": 47,
                        "avg": 33.5,
                        "sum": 67
                    }
                },
                {
                    "from": 50,
                    "to": 100,
                    "doc_count": 4,
                    "price_stats": {
                        "count": 4,
                        "min": 60,
                        "max": 98,
                        "avg": 82.5,
                        "sum": 330
                    }
                },
                {
                    "from": 100,
                    "doc_count": 4,
                    "price_stats": {
                        "count": 4,
                        "min": 134,
                        "max": 367,
                        "avg": 216,
                        "sum": 864
                    }
                }
            ]
        }
    }
}</pre><p>If a sub aggregation is also based on the same value source as the range aggregation (like the <code class="literal">stats</code> aggregation in the example above) it is possible to leave out the value source definition for it. The following will return the same response as above:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            },
            "aggs" : {
                "price_stats" : {
                    "stats" : {} <a id="CO17-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                }
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO17-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We donât need to specify the <code class="literal">price</code> as we "inherit" it by default from the parent <code class="literal">range</code> aggregation
</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-daterange-aggregation"></a>Date Range</h2></div></div></div><p>A range aggregation that is dedicated for date values. The main difference between this aggregation and the normal <a class="link" href="#search-aggregations-bucket-range-aggregation" title="Range">range</a> aggregation is that the <code class="literal">from</code> and <code class="literal">to</code> values can be expressed in Date Math expressions, and it is also possible to specify a date format by which the <code class="literal">from</code> and <code class="literal">to</code> response fields will be returned.
Note that this aggregration includes the <code class="literal">from</code> value and excludes the <code class="literal">to</code> value for each range.</p><p>Example:</p><pre class="programlisting prettyprint lang-js">{
    "aggs": {
        "range": {
            "date_range": {
                "field": "date",
                "format": "MM-yyy",
                "ranges": [
                    { "to": "now-10M/M" },
                    { "from": "now-10M/M" }
                ]
            }
        }
    }
}</pre><p>In the example above, we created two range buckets, the first will "bucket" all documents dated prior to 10 months ago and
the second will "bucket" all documents dated since 10 months ago</p><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations": {
        "range": {
            "buckets": [
                {
                    "to": 1.3437792E+12,
                    "to_as_string": "08-2012",
                    "doc_count": 7
                },
                {
                    "from": 1.3437792E+12,
                    "from_as_string": "08-2012",
                    "doc_count": 2
                }
            ]
        }
    }
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="date-format-pattern"></a>Date Format/Pattern</h3></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>this information was copied from <a class="ulink" href="http://joda-time.sourceforge.net/apidocs/org/joda/time/format/DateTimeFormat.html" target="_top">JodaDate</a></p></div></div><p>All ASCII letters are reserved as format pattern letters, which are defined as follows:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top">Symbol </th><th align="left" valign="top">Meaning                </th><th align="left" valign="top">Presentation       </th><th align="left" valign="top">Examples</th></tr></thead><tbody><tr><td align="left" valign="top"><p>G</p></td><td align="left" valign="top"><p>era</p></td><td align="left" valign="top"><p>text</p></td><td align="left" valign="top"><p>AD</p></td></tr><tr><td align="left" valign="top"><p>C</p></td><td align="left" valign="top"><p>century of era (&gt;=0)</p></td><td align="left" valign="top"><p>number</p></td><td align="left" valign="top"><p>20</p></td></tr><tr><td align="left" valign="top"><p>Y</p></td><td align="left" valign="top"><p>year of era (&gt;=0)</p></td><td align="left" valign="top"><p>year</p></td><td align="left" valign="top"><p>1996</p></td></tr><tr><td align="left" valign="top"><p>x</p></td><td align="left" valign="top"><p>weekyear</p></td><td align="left" valign="top"><p>year</p></td><td align="left" valign="top"><p>1996</p></td></tr><tr><td align="left" valign="top"><p>w</p></td><td align="left" valign="top"><p>week of weekyear</p></td><td align="left" valign="top"><p>number</p></td><td align="left" valign="top"><p>27</p></td></tr><tr><td align="left" valign="top"><p>e</p></td><td align="left" valign="top"><p>day of week</p></td><td align="left" valign="top"><p>number</p></td><td align="left" valign="top"><p>2</p></td></tr><tr><td align="left" valign="top"><p>E</p></td><td align="left" valign="top"><p>day of week</p></td><td align="left" valign="top"><p>text</p></td><td align="left" valign="top"><p>Tuesday; Tue</p></td></tr><tr><td align="left" valign="top"><p>y</p></td><td align="left" valign="top"><p>year</p></td><td align="left" valign="top"><p>year</p></td><td align="left" valign="top"><p>1996</p></td></tr><tr><td align="left" valign="top"><p>D</p></td><td align="left" valign="top"><p>day of year</p></td><td align="left" valign="top"><p>number</p></td><td align="left" valign="top"><p>189</p></td></tr><tr><td align="left" valign="top"><p>M</p></td><td align="left" valign="top"><p>month of year</p></td><td align="left" valign="top"><p>month</p></td><td align="left" valign="top"><p>July; Jul; 07</p></td></tr><tr><td align="left" valign="top"><p>d</p></td><td align="left" valign="top"><p>day of month</p></td><td align="left" valign="top"><p>number</p></td><td align="left" valign="top"><p>10</p></td></tr><tr><td align="left" valign="top"><p>a</p></td><td align="left" valign="top"><p>halfday of day</p></td><td align="left" valign="top"><p>text</p></td><td align="left" valign="top"><p>PM</p></td></tr><tr><td align="left" valign="top"><p>K</p></td><td align="left" valign="top"><p>hour of halfday (0~11)</p></td><td align="left" valign="top"><p>number</p></td><td align="left" valign="top"><p>0</p></td></tr><tr><td align="left" valign="top"><p>h</p></td><td align="left" valign="top"><p>clockhour of halfday (1~12)</p></td><td align="left" valign="top"><p>number</p></td><td align="left" valign="top"><p>12</p></td></tr><tr><td align="left" valign="top"><p>H</p></td><td align="left" valign="top"><p>hour of day (0~23)</p></td><td align="left" valign="top"><p>number</p></td><td align="left" valign="top"><p>0</p></td></tr><tr><td align="left" valign="top"><p>k</p></td><td align="left" valign="top"><p>clockhour of day (1~24)</p></td><td align="left" valign="top"><p>number</p></td><td align="left" valign="top"><p>24</p></td></tr><tr><td align="left" valign="top"><p>m</p></td><td align="left" valign="top"><p>minute of hour</p></td><td align="left" valign="top"><p>number</p></td><td align="left" valign="top"><p>30</p></td></tr><tr><td align="left" valign="top"><p>s</p></td><td align="left" valign="top"><p>second of minute</p></td><td align="left" valign="top"><p>number</p></td><td align="left" valign="top"><p>55</p></td></tr><tr><td align="left" valign="top"><p>S</p></td><td align="left" valign="top"><p>fraction of second</p></td><td align="left" valign="top"><p>number</p></td><td align="left" valign="top"><p>978</p></td></tr><tr><td align="left" valign="top"><p>z</p></td><td align="left" valign="top"><p>time zone</p></td><td align="left" valign="top"><p>text</p></td><td align="left" valign="top"><p>Pacific Standard Time; PST</p></td></tr><tr><td align="left" valign="top"><p>Z</p></td><td align="left" valign="top"><p>time zone offset/id</p></td><td align="left" valign="top"><p>zone</p></td><td align="left" valign="top"><p>-0800; -08:00; America/Los_Angeles</p></td></tr><tr><td align="left" valign="top"><p>'</p></td><td align="left" valign="top"><p>escape for text</p></td><td align="left" valign="top"><p>delimiter</p></td><td align="left" valign="top"><p>''</p></td></tr></tbody></table></div><p>The count of pattern letters determine the format.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Text
</span></dt><dd>
If the number of pattern letters is 4 or more, the full form is used; otherwise a short or abbreviated form is used if available.
</dd><dt><span class="term">
Number
</span></dt><dd>
The minimum number of digits. Shorter numbers are zero-padded to this amount.
</dd><dt><span class="term">
Year
</span></dt><dd>
Numeric presentation for year and weekyear fields are handled specially. For example, if the count of <span class="emphasis"><em>y</em></span> is 2, the year will be displayed as the zero-based year of the century, which is two digits.
</dd><dt><span class="term">
Month
</span></dt><dd>
3 or over, use text, otherwise use number.
</dd><dt><span class="term">
Zone
</span></dt><dd>
<span class="emphasis"><em>Z</em></span> outputs offset without a colon, <span class="emphasis"><em>ZZ</em></span> outputs the offset with a colon, <span class="emphasis"><em>ZZZ</em></span> or more outputs the zone id.
</dd><dt><span class="term">
Zone names
</span></dt><dd>
Time zone names (<span class="emphasis"><em>z</em></span>) cannot be parsed.
</dd></dl></div><p>Any characters in the pattern that are not in the ranges of [<span class="emphasis"><em>a</em></span>..<span class="emphasis"><em>z</em></span>] and [<span class="emphasis"><em>A</em></span>..<span class="emphasis"><em>Z</em></span>] will be treated as quoted text. For instance, characters like <span class="emphasis"><em>:</em></span>, <span class="emphasis"><em>.</em></span>, ' <span class="emphasis"><em>, '#</em></span> and <span class="emphasis"><em>?</em></span> will appear in the resulting time text even they are not embraced within single quotes.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-iprange-aggregation"></a>IPv4 Range</h2></div></div></div><p>Just like the dedicated <a class="link" href="#search-aggregations-bucket-daterange-aggregation" title="Date Range">date</a> range aggregation, there is also a dedicated range aggregation for IPv4 typed fields:</p><p>Example:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "ip_ranges" : {
            "ip_range" : {
                "field" : "ip",
                "ranges" : [
                    { "to" : "10.0.0.5" },
                    { "from" : "10.0.0.5" }
                ]
            }
        }
    }
}</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations": {
        "ip_ranges":
            "buckets" : [
                {
                    "to": 167772165,
                    "to_as_string": "10.0.0.5",
                    "doc_count": 4
                },
                {
                    "from": 167772165,
                    "from_as_string": "10.0.0.5",
                    "doc_count": 6
                }
            ]
        }
    }
}</pre><p>IP ranges can also be defined as CIDR masks:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "ip_ranges" : {
            "ip_range" : {
                "field" : "ip",
                "ranges" : [
                    { "mask" : "10.0.0.0/25" },
                    { "mask" : "10.0.0.127/25" }
                ]
            }
        }
    }
}</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    "aggregations": {
        "ip_ranges": {
            "buckets": [
                {
                    "key": "10.0.0.0/25",
                    "from": 1.6777216E+8,
                    "from_as_string": "10.0.0.0",
                    "to": 167772287,
                    "to_as_string": "10.0.0.127",
                    "doc_count": 127
                },
                {
                    "key": "10.0.0.127/25",
                    "from": 1.6777216E+8,
                    "from_as_string": "10.0.0.0",
                    "to": 167772287,
                    "to_as_string": "10.0.0.127",
                    "doc_count": 127
                }
            ]
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-histogram-aggregation"></a>Histogram</h2></div></div></div><p>A multi-bucket values source based aggregation that can be applied on numeric values extracted from the documents.
It dynamically builds fixed size (a.k.a. interval) buckets over the values. For example, if the documents have a field
that holds a price (numeric), we can configure this aggregation to dynamically build buckets with interval <code class="literal">5</code>
(in case of price it may represent $5). When the aggregation executes, the price field of every document will be
evaluated and will be rounded down to its closest bucket - for example, if the price is <code class="literal">32</code> and the bucket size is <code class="literal">5</code>
then the rounding will yield <code class="literal">30</code> and thus the document will "fall" into the bucket that is associated withe the key <code class="literal">30</code>.
To make this more formal, here is the rounding function that is used:</p><pre class="programlisting prettyprint lang-java">rem = value % interval
if (rem &lt; 0) {
    rem += interval
}
bucket_key = value - rem</pre><p>The following snippet "buckets" the products based on their <code class="literal">price</code> by interval of <code class="literal">50</code>:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50
            }
        }
    }
}</pre><p>And the following may be the response:</p><pre class="programlisting prettyprint lang-js">{
    "aggregations": {
        "prices" : {
            "buckets": [
                {
                    "key": 0,
                    "doc_count": 2
                },
                {
                    "key": 50,
                    "doc_count": 4
                },
                {
                    "key": 150,
                    "doc_count": 3
                }
            ]
        }
    }
}</pre><p>The response above shows that none of the aggregated products has a price that falls within the range of <code class="literal">[100 - 150)</code>.
By default, the response will only contain those buckets with a <code class="literal">doc_count</code> greater than 0. It is possible change that
and request buckets with either a higher minimum count or even 0 (in which case elasticsearch will "fill in the gaps"
and create buckets with zero documents). This can be configured using the <code class="literal">min_doc_count</code> setting:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "min_doc_count" : 0
            }
        }
    }
}</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    "aggregations": {
        "prices" : {
            "buckets": [
                {
                    "key": 0,
                    "doc_count": 2
                },
                {
                    "key": 50,
                    "doc_count": 4
                },
                {
                    "key" : 100,
                    "doc_count" : 0 <a id="CO18-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                },
                {
                    "key": 150,
                    "doc_count": 3
                }
            ]
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO18-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
No documents were found that belong in this bucket, yet it is still returned with zero <code class="literal">doc_count</code>.
</p></td></tr></table></div><p><a id="search-aggregations-bucket-histogram-aggregation-extended-bounds"></a>By default the date_/histogram returns all the buckets within the range of the data itself, that is, the documents with
the smallest values (on which with histogram) will determine the min bucket (the bucket with the smallest key) and the
documents with the highest values will determine the max bucket (the bucket with the highest key). Often, when when
requesting empty buckets (<code class="literal">"min_doc_count" : 0</code>), this causes a confusion, specifically, when the data is also filtered.</p><p>To understand why, letâs look at an example:</p><p>Lets say the youâre filtering your request to get all docs with values between <code class="literal">0</code> and <code class="literal">500</code>, in addition youâd like
to slice the data per price using a histogram with an interval of <code class="literal">50</code>. You also specify <code class="literal">"min_doc_count" : 0</code> as youâd
like to get all buckets even the empty ones. If it happens that all products (documents) have prices higher than <code class="literal">100</code>,
the first bucket youâll get will be the one with <code class="literal">100</code> as its key. This is confusing, as many times, youâd also like
to get those buckets between <code class="literal">0 - 100</code>.</p><p>With <code class="literal">extended_bounds</code> setting, you now can "force" the histogram aggregation to start building buckets on a specific
<code class="literal">min</code> values and also keep on building buckets up to a <code class="literal">max</code> value (even if there are no documents anymore). Using
<code class="literal">extended_bounds</code> only makes sense when <code class="literal">min_doc_count</code> is 0 (the empty buckets will never be returned if <code class="literal">min_doc_count</code>
is greater than 0).</p><p>Note that (as the name suggest) <code class="literal">extended_bounds</code> is <span class="strong"><strong>not</strong></span> filtering buckets. Meaning, if the <code class="literal">extended_bounds.min</code> is higher
than the values extracted from the documents, the documents will still dictate what the first bucket will be (and the
same goes for the <code class="literal">extended_bounds.max</code> and the last bucket). For filtering buckets, one should nest the histogram aggregation
under a range <code class="literal">filter</code> aggregation with the appropriate <code class="literal">from</code>/<code class="literal">to</code> settings.</p><p>Example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "filtered" : { "range" : { "price" : { "to" : "500" } } }
    },
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "min_doc_count" : 0,
                "extended_bounds" : {
                    "min" : 0,
                    "max" : 500
                }
            }
        }
    }
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_order_2"></a>Order</h3></div></div></div><p>By default the returned buckets are sorted by their <code class="literal">key</code> ascending, though the order behaviour can be controled
using the <code class="literal">order</code> setting.</p><p>Ordering the buckets by their key - descending:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "order" : { "_key" : "desc" }
            }
        }
    }
}</pre><p>Ordering the buckets by their <code class="literal">doc_count</code> - ascending:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "order" : { "_count" : "asc" }
            }
        }
    }
}</pre><p>If the histogram aggregation has a direct metrics sub-aggregation, the latter can determine the order of the buckets:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "order" : { "price_stats.min" : "asc" } <a id="CO19-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            },
            "aggs" : {
                "price_stats" : { "stats" : {} } <a id="CO19-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO19-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">{ "price_stats.min" : asc" }</code> will sort the buckets based on <code class="literal">min</code> value of their their <code class="literal">price_stats</code> sub-aggregation.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO19-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
There is no need to configure the <code class="literal">price</code> field for the <code class="literal">price_stats</code> aggregation as it will inherit it by default from its parent histogram aggregation.
</p></td></tr></table></div><p>It is also possible to order the buckets based on a "deeper" aggregation in the hierarchy. This is supported as long
as the aggregations path are of a single-bucket type, where the last aggregation in the path may either by a single-bucket
one or a metrics one. If itâs a single-bucket type, the order will be defined by the number of docs in the bucket (i.e. <code class="literal">doc_count</code>),
in case itâs a metrics one, the same rules as above apply (where the path must indicate the metric name to sort by in case of
a multi-value metrics aggregation, and in case of a single-value metrics aggregation the sort will be applied on that value).</p><p>The path must be defined in the following form:</p><pre class="screen">AGG_SEPARATOR       :=  '&gt;'
METRIC_SEPARATOR    :=  '.'
AGG_NAME            :=  &lt;the name of the aggregation&gt;
METRIC              :=  &lt;the name of the metric (in case of multi-value metrics aggregation)&gt;
PATH                :=  &lt;AGG_NAME&gt;[&lt;AGG_SEPARATOR&gt;&lt;AGG_NAME&gt;]*[&lt;METRIC_SEPARATOR&gt;&lt;METRIC&gt;]</pre><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "order" : { "promoted_products&gt;rating_stats.avg" : "desc" } <a id="CO20-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            },
            "aggs" : {
                "promoted_products" : {
                    "filter" : { "term" : { "promoted" : true }},
                    "aggs" : {
                        "rating_stats" : { "stats" : { "field" : "rating" }}
                    }
                }
            }
        }
    }
}</pre><p>The above will sort the buckets based on the avg rating among the promoted products</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_minimum_document_count_3"></a>Minimum document count</h3></div></div></div><p>It is possible to only return buckets that have a document count that is greater than or equal to a configured
limit through the <code class="literal">min_doc_count</code> option.</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "min_doc_count": 10
            }
        }
    }
}</pre><p>The above aggregation would only return buckets that contain 10 documents or more. Default value is <code class="literal">1</code>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The special value <code class="literal">0</code> can be used to add empty buckets to the response between the minimum and the maximum buckets.
Here is an example of what the response could look like:</p></div></div><pre class="programlisting prettyprint lang-js">{
    "aggregations": {
        "prices": {
            "buckets": {
                "0": {
                    "key": 0,
                    "doc_count": 2
                },
                "50": {
                    "key": 50,
                    "doc_count": 0
                },
                "150": {
                    "key": 150,
                    "doc_count": 3
                },
                "200": {
                    "key": 150,
                    "doc_count": 0
                },
                "250": {
                    "key": 150,
                    "doc_count": 0
                },
                "300": {
                    "key": 150,
                    "doc_count": 1
                }
            }
        }
   }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_response_format"></a>Response Format</h3></div></div></div><p>By default, the buckets are returned as an ordered array. It is also possible to request the response as a hash
instead keyed by the buckets keys:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "keyed" : true
            }
        }
    }
}</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    "aggregations": {
        "prices": {
            "buckets": {
                "0": {
                    "key": 0,
                    "doc_count": 2
                },
                "50": {
                    "key": 50,
                    "doc_count": 4
                },
                "150": {
                    "key": 150,
                    "doc_count": 3
                }
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-datehistogram-aggregation"></a>Date Histogram</h2></div></div></div><p>A multi-bucket aggregation similar to the <a class="link" href="#search-aggregations-bucket-histogram-aggregation" title="Histogram">histogram</a> except it can
only be applied on date values. Since dates are represented in elasticsearch internally as long values, it is possible
to use the normal <code class="literal">histogram</code> on dates as well, though accuracy will be compromised. The reason for this is in the fact
that time based intervals are not fixed (think of leap years and on the number of days in a month). For this reason,
we need a special support for time based data. From a functionality perspective, this histogram supports the same features
as the normal <a class="link" href="#search-aggregations-bucket-histogram-aggregation" title="Histogram">histogram</a>. The main difference is that the interval can be specified by date/time expressions.</p><p>Requesting bucket intervals of a month.</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "articles_over_time" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            }
        }
    }
}</pre><p>fractional values are allowed, for example 1.5 hours:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "articles_over_time" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "1.5h"
            }
        }
    }
}</pre><p>Available expressions for interval: <code class="literal">year</code>, <code class="literal">quarter</code>, <code class="literal">month</code>, <code class="literal">week</code>, <code class="literal">day</code>, <code class="literal">hour</code>, <code class="literal">minute</code>, <code class="literal">second</code></p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_time_zone_2"></a>Time Zone</h3></div></div></div><p>By default, times are stored as UTC milliseconds since the epoch. Thus, all computation and "bucketing" / "rounding" is
done on UTC. It is possible to provide a time zone (both pre rounding, and post rounding) value, which will cause all
computations to take the relevant zone into account. The time returned for each bucket/entry is milliseconds since the
epoch of the provided time zone.</p><p>The parameters are <code class="literal">pre_zone</code> (pre rounding based on interval) and <code class="literal">post_zone</code> (post rounding based on interval). The
<code class="literal">time_zone</code> parameter simply sets the <code class="literal">pre_zone</code> parameter. By default, those are set to <code class="literal">UTC</code>.</p><p>The zone value accepts either a numeric value for the hours offset, for example: <code class="literal">"time_zone" : -2</code>. It also accepts a
format of hours and minutes, like <code class="literal">"time_zone" : "-02:30"</code>. Another option is to provide a time zone accepted as one of
the values listed here.</p><p>Lets take an example. For <code class="literal">2012-04-01T04:15:30Z</code>, with a <code class="literal">pre_zone</code> of <code class="literal">-08:00</code>. For day interval, the actual time by
applying the time zone and rounding falls under <code class="literal">2012-03-31</code>, so the returned value will be (in millis) of
<code class="literal">2012-03-31T00:00:00Z</code> (UTC). For hour interval, applying the time zone results in <code class="literal">2012-03-31T20:15:30</code>, rounding it
results in <code class="literal">2012-03-31T20:00:00</code>, but, we want to return it in UTC (<code class="literal">post_zone</code> is not set), so we convert it back to
UTC: <code class="literal">2012-04-01T04:00:00Z</code>. Note, we are consistent in the results, returning the rounded value in UTC.</p><p><code class="literal">post_zone</code> simply takes the result, and adds the relevant offset.</p><p>Sometimes, we want to apply the same conversion to UTC we did above for hour also for day (and up) intervals. We can
set <code class="literal">pre_zone_adjust_large_interval</code> to <code class="literal">true</code>, which will apply the same conversion done for hour interval in the
example, to day and above intervals (it can be set regardless of the interval, but only kick in when using day and
higher intervals).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_factor_2"></a>Factor</h3></div></div></div><p>The date histogram works on numeric values (since time is stored in milliseconds since the epoch in UTC). But,
sometimes, systems will store a different resolution (like seconds since UTC) in a numeric field. The <code class="literal">factor</code>
parameter can be used to change the value in the field to milliseconds to actual do the relevant rounding, and then
be applied again to get to the original unit. For example, when storing in a numeric field seconds resolution, the
factor can be set to 1000.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_pre_post_offset_2"></a>Pre/Post Offset</h3></div></div></div><p>Specific offsets can be provided for pre rounding and post rounding. The <code class="literal">pre_offset</code> for pre rounding, and
<code class="literal">post_offset</code> for post rounding. The format is the date time format (<code class="literal">1h</code>, <code class="literal">1d</code>, etcâ¦).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_keys"></a>Keys</h3></div></div></div><p>Since internally, dates are represented as 64bit numbers, these numbers are returned as the bucket keys (each key
representing a date - milliseconds since the epoch). It is also possible to define a date format, which will result in
returning the dates as formatted strings next to the numeric key values:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "articles_over_time" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "1M",
                "format" : "yyyy-MM-dd" <a id="CO20-2"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO20-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> <a href="#CO20-2"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Supports expressive date <a class="link" href="#date-format-pattern" title="Date Format/Pattern">format pattern</a>
</p></td></tr></table></div><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    "aggregations": {
        "articles_over_time": {
            "buckets": [
                {
                    "key_as_string": "2013-02-02",
                    "key": 1328140800000,
                    "doc_count": 1
                },
                {
                    "key_as_string": "2013-03-02",
                    "key": 1330646400000,
                    "doc_count": 2
                },
                ...
            ]
        }
    }
}</pre><p>Like with the normal <a class="link" href="#search-aggregations-bucket-histogram-aggregation" title="Histogram">histogram</a>, both document level scripts and
value level scripts are supported. It is also possible to control the order of the returned buckets using the <code class="literal">order</code>
settings and filter the returned buckets based on a <code class="literal">min_doc_count</code> setting (by defaults to all buckets with
<code class="literal">min_doc_count &gt; 0</code> will be returned). This histogram also supports the <code class="literal">extended_bounds</code> settings, that enables extending
the bounds of the histogram beyond the data itself (to read more on why youâd want to do that please refer to the
explanation <a class="link" href="#search-aggregations-bucket-histogram-aggregation-extended-bounds">here</a>.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-geodistance-aggregation"></a>Geo Distance</h2></div></div></div><p>A multi-bucket aggregation that works on <code class="literal">geo_point</code> fields and conceptually works very similar to the <a class="link" href="#search-aggregations-bucket-range-aggregation" title="Range">range</a> aggregation. The user can define a point of origin and a set of distance range buckets. The aggregation evaluate the distance of each document value from the origin point and determines the buckets it belongs to based on the ranges (a document belongs to a bucket if the distance between the document and the origin falls within the distance range of the bucket).</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "rings_around_amsterdam" : {
            "geo_distance" : {
                "field" : "location",
                "origin" : "52.3760, 4.894",
                "ranges" : [
                    { "to" : 100 },
                    { "from" : 100, "to" : 300 },
                    { "from" : 300 }
                ]
            }
        }
    }
}</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    "aggregations": {
        "rings" : {
            "buckets": [
                {
                    "unit": "km",
                    "to": 100.0,
                    "doc_count": 3
                },
                {
                    "unit": "km",
                    "from": 100.0,
                    "to": 300.0,
                    "doc_count": 1
                },
                {
                    "unit": "km",
                    "from": 300.0,
                    "doc_count": 7
                }
            ]
        }
    }
}</pre><p>The specified field must be of type <code class="literal">geo_point</code> (which can only be set explicitly in the mappings). And it can also hold an array of <code class="literal">geo_point</code> fields, in which case all will be taken into account during aggregation. The origin point can accept all formats supported by the <code class="literal">geo_point</code> <a class="link" href="#mapping-geo-point-type" title="Geo Point Type">type</a>:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Object format: <code class="literal">{ "lat" : 52.3760, "lon" : 4.894 }</code> - this is the safest format as it is the most explicit about the <code class="literal">lat</code> &amp; <code class="literal">lon</code> values
</li><li class="listitem">
String format: <code class="literal">"52.3760, 4.894"</code> - where the first number is the <code class="literal">lat</code> and the second is the <code class="literal">lon</code>
</li><li class="listitem">
Array format: <code class="literal">[4.894, 52.3760]</code> - which is based on the <code class="literal">GeoJson</code> standard and where the first number is the <code class="literal">lon</code> and the second one is the <code class="literal">lat</code>
</li></ul></div><p>By default, the distance unit is <code class="literal">km</code> but it can also accept: <code class="literal">mi</code> (miles), <code class="literal">in</code> (inch), <code class="literal">yd</code> (yards), <code class="literal">m</code> (meters), <code class="literal">cm</code> (centimeters), <code class="literal">mm</code> (millimeters).</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "rings" : {
            "geo_distance" : {
                "field" : "location",
                "origin" : "52.3760, 4.894",
                "unit" : "mi", <a id="CO21-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                "ranges" : [
                    { "to" : 100 },
                    { "from" : 100, "to" : 300 },
                    { "from" : 300 }
                ]
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The distances will be computed as miles
</p></td></tr></table></div><p>There are two distance calculation modes: <code class="literal">sloppy_arc</code> (the default), <code class="literal">arc</code> (most accurate) and <code class="literal">plane</code> (fastest). The <code class="literal">arc</code> calculation is the most accurate one but also the more expensive one in terms of performance. The <code class="literal">sloppy_arc</code> is faster but less accurate. The <code class="literal">plane</code> is the fastest but least accurate distance function. Consider using <code class="literal">plane</code> when your search context is "narrow" and spans smaller geographical areas (like cities or even countries). <code class="literal">plane</code> may return higher error mergins for searches across very large areas (e.g. cross continent search). The distance calculation type can be set using the <code class="literal">distance_type</code> parameter:</p><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "rings" : {
            "geo_distance" : {
                "field" : "location",
                "origin" : "52.3760, 4.894",
                "distance_type" : "plane",
                "ranges" : [
                    { "to" : 100 },
                    { "from" : 100, "to" : 300 },
                    { "from" : 300 }
                ]
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-geohashgrid-aggregation"></a>GeoHash grid</h2></div></div></div><p>A multi-bucket aggregation that works on <code class="literal">geo_point</code> fields and groups points into buckets that represent cells in a grid.
The resulting grid can be sparse and only contains cells that have matching data. Each cell is labeled using a <a class="ulink" href="http://en.wikipedia.org/wiki/Geohash" target="_top">geohash</a> which is of user-definable precision.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
High precision geohashes have a long string length and represent cells that cover only a small area.
</li><li class="listitem">
Low precision geohashes have a short string length and represent cells that each cover a large area.
</li></ul></div><p>Geohashes used in this aggregation can have a choice of precision between 1 and 12.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>The highest-precision geohash of length 12 produces cells that cover less than a square metre of land and so high-precision requests can be very costly in terms of RAM and result sizes.
Please see the example below on how to first filter the aggregation to a smaller geographic area before requesting high-levels of detail.</p></div></div><p>The specified field must be of type <code class="literal">geo_point</code> (which can only be set explicitly in the mappings) and it can also hold an array of <code class="literal">geo_point</code> fields, in which case all points will be taken into account during aggregation.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_simple_low_precision_request"></a>Simple low-precision request</h3></div></div></div><pre class="programlisting prettyprint lang-js">{
    "aggregations" : {
        "myLarge-GrainGeoHashGrid" : {
            "geohash_grid" : {
                "field" : "location",
                "precision" : 3
            }
        }
    }
}</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    "aggregations": {
        "myLarge-GrainGeoHashGrid": {
            "buckets": [
                {
                    "key": "svz",
                    "doc_count": 10964
                },
                {
                    "key": "sv8",
                    "doc_count": 3198
                }
            ]
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_high_precision_requests"></a>High-precision requests</h3></div></div></div><p>When requesting detailed buckets (typically for displaying a "zoomed in" map) a filter like <a class="link" href="#query-dsl-geo-bounding-box-filter" title="Geo Bounding Box Filter">geo_bounding_box</a> should be applied to narrow the subject area otherwise potentially millions of buckets will be created and returned.</p><pre class="programlisting prettyprint lang-js">{
    "aggregations" : {
        "zoomedInView" : {
            "filter" : {
                "geo_bounding_box" : {
                    "location" : {
                        "top_left" : "51.73, 0.9",
                        "bottom_right" : "51.55, 1.1"
                    }
                }
            },
            "aggregations":{
                "zoom1":{
                    "geohash_grid" : {
                        "field":"location",
                        "precision":8,
                    }
                }
            }
        }
    }
 }</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_cell_dimensions_at_the_equator"></a>Cell dimensions at the equator</h3></div></div></div><p>The table below shows the metric dimensions for cells covered by various string lengths of geohash.
Cell dimensions vary with latitude and so the table is for the worst-case scenario at the equator.</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<span class="strong"><strong>GeoHash length</strong></span>
</p>
</td><td valign="top">
<p>
<span class="strong"><strong>Area width x height</strong></span>
</p>
</td></tr><tr><td valign="top">
<p>
1
</p>
</td><td valign="top">
<p>
5,009.4km x 4,992.6km
</p>
</td></tr><tr><td valign="top">
<p>
2
</p>
</td><td valign="top">
<p>
1,252.3km x 624.1km
</p>
</td></tr><tr><td valign="top">
<p>
3
</p>
</td><td valign="top">
<p>
156.5km x 156km
</p>
</td></tr><tr><td valign="top">
<p>
4
</p>
</td><td valign="top">
<p>
39.1km x 19.5km
</p>
</td></tr><tr><td valign="top">
<p>
5
</p>
</td><td valign="top">
<p>
4.9km x 4.9km
</p>
</td></tr><tr><td valign="top">
<p>
6
</p>
</td><td valign="top">
<p>
1.2km x 609.4m
</p>
</td></tr><tr><td valign="top">
<p>
7
</p>
</td><td valign="top">
<p>
152.9m x 152.4m
</p>
</td></tr><tr><td valign="top">
<p>
8
</p>
</td><td valign="top">
<p>
38.2m x 19m
</p>
</td></tr><tr><td valign="top">
<p>
9
</p>
</td><td valign="top">
<p>
4.8m x 4.8m
</p>
</td></tr><tr><td valign="top">
<p>
10
</p>
</td><td valign="top">
<p>
1.2m x 59.5cm
</p>
</td></tr><tr><td valign="top">
<p>
11
</p>
</td><td valign="top">
<p>
14.9cm x 14.9cm
</p>
</td></tr><tr><td valign="top">
<p>
12
</p>
</td><td valign="top">
<p>
3.7cm x 1.9cm
</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_options_2"></a>Options</h3></div></div></div><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
field
</p>
</td><td valign="top">
<p>
Mandatory. The name of the field indexed with GeoPoints.
</p>
</td></tr><tr><td valign="top">
<p>
precision
</p>
</td><td valign="top">
<p>
Optional. The string length of the geohashes used to define
                cells/buckets in the results. Defaults to 5.
</p>
</td></tr><tr><td valign="top">
<p>
size
</p>
</td><td valign="top">
<p>
Optional. The maximum number of geohash buckets to return
                (defaults to 10,000). When results are trimmed, buckets are
                prioritised based on the volumes of documents they contain.
                <span class="added">
      [<span class="version">1.1.0</span>]
      <span class="detail">Added in 1.1.0.</span></span> A value of <code class="literal">0</code> will return all buckets that
                contain a hit, use with caution as this could use a lot of CPU
                and network bandwith if there are many buckets.
</p>
</td></tr><tr><td valign="top">
<p>
shard_size
</p>
</td><td valign="top">
<p>
Optional. To allow for more accurate counting of the top cells
                returned in the final result the aggregation defaults to
                returning <code class="literal">max(10,(size x number-of-shards))</code> buckets from each
                shard. If this heuristic is undesirable, the number considered
                from each shard can be over-ridden using this parameter.
                <span class="added">
      [<span class="version">1.1.0</span>]
      <span class="detail">Added in 1.1.0.</span></span> A value of <code class="literal">0</code> makes the shard size unlimited.
</p>
</td></tr></tbody></table></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-suggesters"></a>Suggesters</h2></div></div></div><p>The suggest feature suggests similar looking terms based on a provided
text by using a suggester. Parts of the suggest feature are still under
development.</p><p>The suggest request part is either defined alongside the query part in a
<code class="literal">_search</code> request or via the REST <code class="literal">_suggest</code> endpoint.</p><pre class="programlisting prettyprint lang-js">curl -s -XPOST 'localhost:9200/_search' -d '{
  "query" : {
    ...
  },
  "suggest" : {
    ...
  }
}'</pre><p>Suggest requests executed against the <code class="literal">_suggest</code> endpoint should omit
the surrounding <code class="literal">suggest</code> element which is only used if the suggest
request is part of a search.</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/_suggest' -d '{
  "my-suggestion" : {
    "text" : "the amsterdma meetpu",
    "term" : {
      "field" : "body"
    }
  }
}'</pre><p>Several suggestions can be specified per request. Each suggestion is
identified with an arbitrary name. In the example below two suggestions
are requested. Both <code class="literal">my-suggest-1</code> and <code class="literal">my-suggest-2</code> suggestions use
the <code class="literal">term</code> suggester, but have a different <code class="literal">text</code>.</p><pre class="programlisting prettyprint lang-js">"suggest" : {
  "my-suggest-1" : {
    "text" : "the amsterdma meetpu",
    "term" : {
      "field" : "body"
    }
  },
  "my-suggest-2" : {
    "text" : "the rottredam meetpu",
    "term" : {
      "field" : "title",
    }
  }
}</pre><p>The below suggest response example includes the suggestion response for
<code class="literal">my-suggest-1</code> and <code class="literal">my-suggest-2</code>. Each suggestion part contains
entries. Each entry is effectively a token from the suggest text and
contains the suggestion entry text, the original start offset and length
in the suggest text and if found an arbitrary number of options.</p><pre class="programlisting prettyprint lang-js">{
  ...
  "suggest": {
    "my-suggest-1": [
      {
        "text" : "amsterdma",
        "offset": 4,
        "length": 9,
        "options": [
           ...
        ]
      },
      ...
    ],
    "my-suggest-2" : [
      ...
    ]
  }
  ...
}</pre><p>Each options array contains an option object that includes the
suggested text, its document frequency and score compared to the suggest
entry text. The meaning of the score depends on the used suggester. The
term suggesterâs score is based on the edit distance.</p><pre class="programlisting prettyprint lang-js">"options": [
  {
    "text": "amsterdam",
    "freq": 77,
    "score": 0.8888889
  },
  ...
]</pre><h3><a id="global-suggest"></a>Global suggest text</h3><p>To avoid repetition of the suggest text, it is possible to define a
global text. In the example below the suggest text is defined globally
and applies to the <code class="literal">my-suggest-1</code> and <code class="literal">my-suggest-2</code> suggestions.</p><pre class="programlisting prettyprint lang-js">"suggest" : {
  "text" : "the amsterdma meetpu"
  "my-suggest-1" : {
    "term" : {
      "field" : "title"
    }
  },
  "my-suggest-2" : {
    "term" : {
      "field" : "body"
    }
  }
}</pre><p>The suggest text can in the above example also be specified as
suggestion specific option. The suggest text specified on suggestion
level override the suggest text on the global level.</p><h3><a id="_other_suggest_example"></a>Other suggest example.</h3><p>In the below example we request suggestions for the following suggest
text: <code class="literal">devloping distibutd saerch engies</code> on the <code class="literal">title</code> field with a
maximum of 3 suggestions per term inside the suggest text. Note that in
this example we use the <code class="literal">count</code> search type. This isnât required, but a
nice optimization. The suggestions are gather in the <code class="literal">query</code> phase and
in the case that we only care about suggestions (so no hits) we donât
need to execute the <code class="literal">fetch</code> phase.</p><pre class="programlisting prettyprint lang-js">curl -s -XPOST 'localhost:9200/_search?search_type=count' -d '{
  "suggest" : {
    "my-title-suggestions-1" : {
      "text" : "devloping distibutd saerch engies",
      "term" : {
        "size" : 3,
        "field" : "title"
      }
    }
  }
}'</pre><p>The above request could yield the response as stated in the code example
below. As you can see if we take the first suggested options of each
suggestion entry we get <code class="literal">developing distributed search engines</code> as
result.</p><pre class="programlisting prettyprint lang-js">{
  ...
  "suggest": {
    "my-title-suggestions-1": [
      {
        "text": "devloping",
        "offset": 0,
        "length": 9,
        "options": [
          {
            "text": "developing",
            "freq": 77,
            "score": 0.8888889
          },
          {
            "text": "deloping",
            "freq": 1,
            "score": 0.875
          },
          {
            "text": "deploying",
            "freq": 2,
            "score": 0.7777778
          }
        ]
      },
      {
        "text": "distibutd",
        "offset": 10,
        "length": 9,
        "options": [
          {
            "text": "distributed",
            "freq": 217,
            "score": 0.7777778
          },
          {
            "text": "disributed",
            "freq": 1,
            "score": 0.7777778
          },
          {
            "text": "distribute",
            "freq": 1,
            "score": 0.7777778
          }
        ]
      },
      {
        "text": "saerch",
        "offset": 20,
        "length": 6,
        "options": [
          {
            "text": "search",
            "freq": 1038,
            "score": 0.8333333
          },
          {
            "text": "smerch",
            "freq": 3,
            "score": 0.8333333
          },
          {
            "text": "serch",
            "freq": 2,
            "score": 0.8
          }
        ]
      },
      {
        "text": "engies",
        "offset": 27,
        "length": 6,
        "options": [
          {
            "text": "engines",
            "freq": 568,
            "score": 0.8333333
          },
          {
            "text": "engles",
            "freq": 3,
            "score": 0.8333333
          },
          {
            "text": "eggies",
            "freq": 1,
            "score": 0.8333333
          }
        ]
      }
    ]
  }
  ...
}</pre><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-suggesters-term"></a>Term suggester</h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>In order to understand the format of suggestions, please
read the <a class="xref" href="#search-suggesters" title="Suggesters"><em>Suggesters</em></a> page first.</p></div></div><p>The <code class="literal">term</code> suggester suggests terms based on edit distance. The provided
suggest text is analyzed before terms are suggested. The suggested terms
are provided per analyzed suggest text token. The <code class="literal">term</code> suggester
doesnât take the query into account that is part of request.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_common_suggest_options"></a>Common suggest options:</h3></div></div></div><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">text</code>
</p>
</td><td valign="top">
<p>
    The suggest text. The suggest text is a required option that
    needs to be set globally or per suggestion.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">field</code>
</p>
</td><td valign="top">
<p>
    The field to fetch the candidate suggestions from. This is
    an required option that either needs to be set globally or per
    suggestion.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">analyzer</code>
</p>
</td><td valign="top">
<p>
    The analyzer to analyse the suggest text with. Defaults
    to the search analyzer of the suggest field.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">size</code>
</p>
</td><td valign="top">
<p>
    The maximum corrections to be returned per suggest text
    token.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">sort</code>
</p>
</td><td valign="top">
<p>
    Defines how suggestions should be sorted per suggest text
    term. Two possible values:
</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">score</code>:     Sort by sore first, then document frequency and
                    then the term itself.
</li><li class="listitem">
<code class="literal">frequency</code>: Sort by document frequency first, then similarity
                    score and then the term itself.
</li></ul></div>
</td></tr><tr><td valign="top">
<p>
<code class="literal">suggest_mode</code>
</p>
</td><td valign="top">
<p>
    The suggest mode controls what suggestions are
    included or controls for what suggest text terms, suggestions should be
    suggested. Three possible values can be specified:
</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">missing</code>:  Only suggest terms in the suggest text that arenât in
                    the index. This is the default.
</li><li class="listitem">
<code class="literal">popular</code>:  Only suggest suggestions that occur in more docs then
                    the original suggest text term.
</li><li class="listitem">
<code class="literal">always</code>:   Suggest any matching suggestions based on terms in the
                    suggest text.
</li></ul></div>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_other_term_suggest_options"></a>Other term suggest options:</h3></div></div></div><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">lowercase_terms</code>
</p>
</td><td valign="top">
<p>
    Lower cases the suggest text terms after text analysis.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max_edits</code>
</p>
</td><td valign="top">
<p>
    The maximum edit distance candidate suggestions can
    have in order to be considered as a suggestion. Can only be a value
    between 1 and 2. Any other value result in an bad request error being
    thrown. Defaults to 2.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">prefix_length</code>
</p>
</td><td valign="top">
<p>
    The number of minimal prefix characters that must
    match in order be a candidate suggestions. Defaults to 1. Increasing
    this number improves spellcheck performance. Usually misspellings donât
    occur in the beginning of terms. (Old name "prefix_len" is deprecated)
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">min_word_length</code>
</p>
</td><td valign="top">
<p>
    The minimum length a suggest text term must have in
    order to be included. Defaults to 4. (Old name "min_word_len" is deprecated)
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">shard_size</code>
</p>
</td><td valign="top">
<p>
    Sets the maximum number of suggestions to be retrieved
    from each individual shard. During the reduce phase only the top N
    suggestions are returned based on the <code class="literal">size</code> option. Defaults to the
    <code class="literal">size</code> option. Setting this to a value higher than the <code class="literal">size</code> can be
    useful in order to get a more accurate document frequency for spelling
    corrections at the cost of performance. Due to the fact that terms are
    partitioned amongst shards, the shard level document frequencies of
    spelling corrections may not be precise. Increasing this will make these
    document frequencies more precise.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max_inspections</code>
</p>
</td><td valign="top">
<p>
    A factor that is used to multiply with the
    <code class="literal">shards_size</code> in order to inspect more candidate spell corrections on
    the shard level. Can improve accuracy at the cost of performance.
    Defaults to 5.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">min_doc_freq</code>
</p>
</td><td valign="top">
<p>
    The minimal threshold in number of documents a
    suggestion should appear in. This can be specified as an absolute number
    or as a relative percentage of number of documents. This can improve
    quality by only suggesting high frequency terms. Defaults to 0f and is
    not enabled. If a value higher than 1 is specified then the number
    cannot be fractional. The shard level document frequencies are used for
    this option.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max_term_freq</code>
</p>
</td><td valign="top">
<p>
    The maximum threshold in number of documents a
    suggest text token can exist in order to be included. Can be a relative
    percentage number (e.g 0.4) or an absolute number to represent document
    frequencies. If an value higher than 1 is specified then fractional can
    not be specified. Defaults to 0.01f. This can be used to exclude high
    frequency terms from being spellchecked. High frequency terms are
    usually spelled correctly on top of this also improves the spellcheck
    performance. The shard level document frequencies are used for this
    option.
</p>
</td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-suggesters-phrase"></a>Phrase Suggester</h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>In order to understand the format of suggestions, please
read the <a class="xref" href="#search-suggesters" title="Suggesters"><em>Suggesters</em></a> page first.</p></div></div><p>The <code class="literal">term</code> suggester provides a very convenient API to access word
alternatives on token basis within a certain string distance. The API
allows accessing each token in the stream individually while
suggest-selection is left to the API consumer. Yet, often pre-selected
suggestions are required in order to present to the end-user. The
<code class="literal">phrase</code> suggester adds additional logic on top of the <code class="literal">term</code> suggester
to select entire corrected phrases instead of individual tokens weighted
based on <code class="literal">ngram-langugage</code> models. In practice it this suggester will be
able to make better decision about which tokens to pick based on
co-occurence and frequencies.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_api_example"></a>API Example</h3></div></div></div><p>The <code class="literal">phrase</code> request is defined along side the query part in the json
request:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/_search' -d {
  "suggest" : {
    "text" : "Xor the Got-Jewel",
    "simple_phrase" : {
      "phrase" : {
        "analyzer" : "body",
        "field" : "bigram",
        "size" : 1,
        "real_word_error_likelihood" : 0.95,
        "max_errors" : 0.5,
        "gram_size" : 2,
        "direct_generator" : [ {
          "field" : "body",
          "suggest_mode" : "always",
          "min_word_length" : 1
        } ],
        "highlight": {
          "pre_tag": "&lt;em&gt;",
          "post_tag": "&lt;/em&gt;"
        }
      }
    }
  }
}</pre><p>The response contains suggested scored by the most likely spell
correction first. In this case we got the expected correction
<code class="literal">xorr the god jewel</code> first while the second correction is less
conservative where only one of the errors is corrected. Note, the
request is executed with <code class="literal">max_errors</code> set to <code class="literal">0.5</code> so 50% of the terms
can contain misspellings (See parameter descriptions below).</p><pre class="programlisting prettyprint lang-js">  {
  "took" : 5,
  "timed_out" : false,
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "failed" : 0
  },
  "hits" : {
    "total" : 2938,
    "max_score" : 0.0,
    "hits" : [ ]
  },
  "suggest" : {
    "simple_phrase" : [ {
      "text" : "Xor the Got-Jewel",
      "offset" : 0,
      "length" : 17,
      "options" : [ {
        "text" : "xorr the god jewel",
        "highlighted": "&lt;em&gt;xorr&lt;/em&gt; the &lt;em&gt;god&lt;/em&gt; jewel",
        "score" : 0.17877324
      }, {
        "text" : "xor the god jewel",
        "highlighted": "xor the &lt;em&gt;god&lt;/em&gt; jewel",
        "score" : 0.14231323
      } ]
    } ]
  }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_basic_phrase_suggest_api_parameters"></a>Basic Phrase suggest API parameters</h3></div></div></div><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">field</code>
</p>
</td><td valign="top">
<p>
    the name of the field used to do n-gram lookups for the
    language model, the suggester will use this field to gain statistics to
    score corrections. This field is mandatory.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">gram_size</code>
</p>
</td><td valign="top">
<p>
    sets max size of the n-grams (shingles) in the <code class="literal">field</code>.
    If the field doesnât contain n-grams (shingles) this should be omitted
    or set to <code class="literal">1</code>. Note that Elasticsearch tries to detect the gram size
    based on the specified <code class="literal">field</code>. If the field uses a <code class="literal">shingle</code> filter the
    <code class="literal">gram_size</code> is set to the <code class="literal">max_shingle_size</code> if not explicitly set.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">real_word_error_likelihood</code>
</p>
</td><td valign="top">
<p>
    the likelihood of a term being a
    misspelled even if the term exists in the dictionary. The default it
    <code class="literal">0.95</code> corresponding to 5% or the real words are misspelled.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">confidence</code>
</p>
</td><td valign="top">
<p>
    The confidence level defines a factor applied to the
    input phrases score which is used as a threshold for other suggest
    candidates. Only candidates that score higher than the threshold will be
    included in the result. For instance a confidence level of <code class="literal">1.0</code> will
    only return suggestions that score higher than the input phrase. If set
    to <code class="literal">0.0</code> the top N candidates are returned. The default is <code class="literal">1.0</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max_errors</code>
</p>
</td><td valign="top">
<p>
    the maximum percentage of the terms that at most
    considered to be misspellings in order to form a correction. This method
    accepts a float value in the range <code class="literal">[0..1)</code> as a fraction of the actual
    query terms a number <code class="literal">&gt;=1</code> as an absolute number of query terms. The
    default is set to <code class="literal">1.0</code> which corresponds to that only corrections with
    at most 1 misspelled term are returned.  Note that setting this too high
    can negativly impact performance. Low values like <code class="literal">1</code> or <code class="literal">2</code> are recommended
    otherwise the time spend in suggest calls might exceed the time spend in
    query execution.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">separator</code>
</p>
</td><td valign="top">
<p>
    the separator that is used to separate terms in the
    bigram field. If not set the whitespace character is used as a
    separator.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">size</code>
</p>
</td><td valign="top">
<p>
    the number of candidates that are generated for each
    individual query term Low numbers like <code class="literal">3</code> or <code class="literal">5</code> typically produce good
    results. Raising this can bring up terms with higher edit distances. The
    default is <code class="literal">5</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">analyzer</code>
</p>
</td><td valign="top">
<p>
    Sets the analyzer to analyse to suggest text with.
    Defaults to the search analyzer of the suggest field passed via <code class="literal">field</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">shard_size</code>
</p>
</td><td valign="top">
<p>
    Sets the maximum number of suggested term to be
    retrieved from each individual shard. During the reduce phase, only the
    top N suggestions are returned based on the <code class="literal">size</code> option. Defaults to
    <code class="literal">5</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">text</code>
</p>
</td><td valign="top">
<p>
    Sets the text / query to provide suggestions for.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">highlight</code>
</p>
</td><td valign="top">
<p>
    Sets up suggestion highlighting.  If not provided then
    no <code class="literal">highlighted</code> field is returned.  If provided must
    contain exactly <code class="literal">pre_tag</code> and <code class="literal">post_tag</code> which are
    wrapped around the changed tokens.  If multiple tokens
    in a row are changed the entire phrase of changed tokens
    is wrapped rather than each token.
</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_smoothing_models"></a>Smoothing Models</h3></div></div></div><p>The <code class="literal">phrase</code> suggester supports multiple smoothing models to balance
weight between infrequent grams (grams (shingles) are not existing in
the index) and frequent grams (appear at least once in the index).</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">stupid_backoff</code>
</p>
</td><td valign="top">
<p>
    a simple backoff model that backs off to lower
    order n-gram models if the higher order count is <code class="literal">0</code> and discounts the
    lower order n-gram model by a constant factor. The default <code class="literal">discount</code> is
    <code class="literal">0.4</code>. Stupid Backoff is the default model.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">laplace</code>
</p>
</td><td valign="top">
<p>
    a smoothing model that uses an additive smoothing where a
    constant (typically <code class="literal">1.0</code> or smaller) is added to all counts to balance
    weights, The default <code class="literal">alpha</code> is <code class="literal">0.5</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">linear_interpolation</code>
</p>
</td><td valign="top">
<p>
    a smoothing model that takes the weighted
    mean of the unigrams, bigrams and trigrams based on user supplied
    weights (lambdas). Linear Interpolation doesnât have any default values.
    All parameters (<code class="literal">trigram_lambda</code>, <code class="literal">bigram_lambda</code>, <code class="literal">unigram_lambda</code>)
    must be supplied.
</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_candidate_generators"></a>Candidate Generators</h3></div></div></div><p>The <code class="literal">phrase</code> suggester uses candidate generators to produce a list of
possible terms per term in the given text. A single candidate generator
is similar to a <code class="literal">term</code> suggester called for each individual term in the
text. The output of the generators is subsequently scored in combination
with the candidates from the other terms to for suggestion candidates.</p><p>Currently only one type of candidate generator is supported, the
<code class="literal">direct_generator</code>. The Phrase suggest API accepts a list of generators
under the key <code class="literal">direct_generator</code> each of the generators in the list are
called per term in the original text.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_direct_generators"></a>Direct Generators</h3></div></div></div><p>The direct generators support the following parameters:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">field</code>
</p>
</td><td valign="top">
<p>
    The field to fetch the candidate suggestions from. This is
    an required option that either needs to be set globally or per
    suggestion.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">size</code>
</p>
</td><td valign="top">
<p>
    The maximum corrections to be returned per suggest text token.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">suggest_mode</code>
</p>
</td><td valign="top">
<p>
    The suggest mode controls what suggestions are
    included or controls for what suggest text terms, suggestions should be
    suggested. Three possible values can be specified:
</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">missing</code>: Only suggest terms in the suggest text that arenât in the
                  index. This is the default.
</li><li class="listitem">
<code class="literal">popular</code>: Only suggest suggestions that occur in more docs then the
                  original suggest text term.
</li><li class="listitem">
<code class="literal">always</code>: Suggest any matching suggestions based on terms in the
                 suggest text.
</li></ul></div>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max_edits</code>
</p>
</td><td valign="top">
<p>
    The maximum edit distance candidate suggestions can have
    in order to be considered as a suggestion. Can only be a value between 1
    and 2. Any other value result in an bad request error being thrown.
    Defaults to 2.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">prefix_length</code>
</p>
</td><td valign="top">
<p>
    The number of minimal prefix characters that must
    match in order be a candidate suggestions. Defaults to 1. Increasing
    this number improves spellcheck performance. Usually misspellings donât
    occur in the beginning of terms. (Old name "prefix_len" is deprecated)
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">min_word_length</code>
</p>
</td><td valign="top">
<p>
    The minimum length a suggest text term must have in
    order to be included. Defaults to 4. (Old name "min_word_len" is deprecated)
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max_inspections</code>
</p>
</td><td valign="top">
<p>
    A factor that is used to multiply with the
    <code class="literal">shards_size</code> in order to inspect more candidate spell corrections on
    the shard level. Can improve accuracy at the cost of performance.
    Defaults to 5.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">min_doc_freq</code>
</p>
</td><td valign="top">
<p>
    The minimal threshold in number of documents a
    suggestion should appear in. This can be specified as an absolute number
    or as a relative percentage of number of documents. This can improve
    quality by only suggesting high frequency terms. Defaults to 0f and is
    not enabled. If a value higher than 1 is specified then the number
    cannot be fractional. The shard level document frequencies are used for
    this option.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max_term_freq</code>
</p>
</td><td valign="top">
<p>
    The maximum threshold in number of documents a
    suggest text token can exist in order to be included. Can be a relative
    percentage number (e.g 0.4) or an absolute number to represent document
    frequencies. If an value higher than 1 is specified then fractional can
    not be specified. Defaults to 0.01f. This can be used to exclude high
    frequency terms from being spellchecked. High frequency terms are
    usually spelled correctly on top of this also improves the spellcheck
    performance. The shard level document frequencies are used for this
    option.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pre_filter</code>
</p>
</td><td valign="top">
<p>
    a filter (analyzer) that is applied to each of the
    tokens passed to this candidate generator. This filter is applied to the
    original token before candidates are generated.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">post_filter</code>
</p>
</td><td valign="top">
<p>
    a filter (analyzer) that is applied to each of the
    generated tokens before they are passed to the actual phrase scorer.
</p>
</td></tr></tbody></table></div><p>The following example shows a <code class="literal">phrase</code> suggest call with two generators,
the first one is using a field containing ordinary indexed terms and the
second one uses a field that uses terms indexed with a <code class="literal">reverse</code> filter
(tokens are index in reverse order). This is used to overcome the limitation
of the direct generators to require a constant prefix to provide
high-performance suggestions. The <code class="literal">pre_filter</code> and <code class="literal">post_filter</code> options
accept ordinary analyzer names.</p><pre class="programlisting prettyprint lang-js">curl -s -XPOST 'localhost:9200/_search' -d {
 "suggest" : {
    "text" : "Xor the Got-Jewel",
    "simple_phrase" : {
      "phrase" : {
        "analyzer" : "body",
        "field" : "bigram",
        "size" : 4,
        "real_word_error_likelihood" : 0.95,
        "confidence" : 2.0,
        "gram_size" : 2,
        "direct_generator" : [ {
          "field" : "body",
          "suggest_mode" : "always",
          "min_word_length" : 1
        }, {
          "field" : "reverse",
          "suggest_mode" : "always",
          "min_word_length" : 1,
          "pre_filter" : "reverse",
          "post_filter" : "reverse"
        } ]
      }
    }
  }
}</pre><p><code class="literal">pre_filter</code> and <code class="literal">post_filter</code> can also be used to inject synonyms after
candidates are generated. For instance for the query <code class="literal">captain usq</code> we
might generate a candidate <code class="literal">usa</code> for term <code class="literal">usq</code> which is a synonym for
<code class="literal">america</code> which allows to present <code class="literal">captain america</code> to the user if this
phrase scores high enough.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-suggesters-completion"></a>Completion Suggester</h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>In order to understand the format of suggestions, please
read the <a class="xref" href="#search-suggesters" title="Suggesters"><em>Suggesters</em></a> page first.</p></div></div><p>The <code class="literal">completion</code> suggester is a so-called prefix suggester. It does not
do spell correction like the <code class="literal">term</code> or <code class="literal">phrase</code> suggesters but allows
basic <code class="literal">auto-complete</code> functionality.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_why_another_suggester_why_not_prefix_queries"></a>Why another suggester? Why not prefix queries?</h3></div></div></div><p>The first question which comes to mind when reading about a prefix
suggestion is, why you should use it all, if you have prefix queries
already. The answer is simple: Prefix suggestions are fast.</p><p>The data structures are internally backed by Lucenes
<code class="literal">AnalyzingSuggester</code>, which uses FSTs to execute suggestions. Usually
these data structures are costly to create, stored in-memory and need to
be rebuilt every now and then to reflect changes in your indexed
documents. The <code class="literal">completion</code> suggester circumvents this by storing the
FST as part of your index during index time. This allows for really fast
loads and executions.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="completion-suggester-mapping"></a>Mapping</h3></div></div></div><p>In order to use this feature, you have to specify a special mapping for
this field, which enables the special storage of the field.</p><pre class="programlisting prettyprint lang-js">curl -X PUT localhost:9200/music
curl -X PUT localhost:9200/music/song/_mapping -d '{
  "song" : {
        "properties" : {
            "name" : { "type" : "string" },
            "suggest" : { "type" : "completion",
                          "index_analyzer" : "simple",
                          "search_analyzer" : "simple",
                          "payloads" : true
            }
        }
    }
}'</pre><p>Mapping supports the following parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">index_analyzer</code>
</span></dt><dd>
    The index analyzer to use, defaults to <code class="literal">simple</code>.
</dd><dt><span class="term">
<code class="literal">search_analyzer</code>
</span></dt><dd>
    The search analyzer to use, defaults to <code class="literal">simple</code>.
    In case you are wondering why we did not opt for the <code class="literal">standard</code>
    analyzer: We try to have easy to understand behaviour here, and if you
    index the field content <code class="literal">At the Drive-in</code>, you will not get any
    suggestions for <code class="literal">a</code>, nor for <code class="literal">d</code> (the first non stopword).
</dd><dt><span class="term">
<code class="literal">payloads</code>
</span></dt><dd>
    Enables the storing of payloads, defaults to <code class="literal">false</code>
</dd><dt><span class="term">
<code class="literal">preserve_separators</code>
</span></dt><dd>
    Preserves the separators, defaults to <code class="literal">true</code>.
    If disabled, you could find a field starting with <code class="literal">Foo Fighters</code>, if you
    suggest for <code class="literal">foof</code>.
</dd><dt><span class="term">
<code class="literal">preserve_position_increments</code>
</span></dt><dd>
    Enables position increments, defaults
    to <code class="literal">true</code>. If disabled and using stopwords analyzer, you could get a
    field starting with <code class="literal">The Beatles</code>, if you suggest for <code class="literal">b</code>. <span class="strong"><strong>Note</strong></span>: You
    could also achieve this by indexing two inputs, <code class="literal">Beatles</code> and
    <code class="literal">The Beatles</code>, no need to change a simple analyzer, if you are able to
    enrich your data.
</dd><dt><span class="term">
<code class="literal">max_input_length</code>
</span></dt><dd>
    Limits the length of a single input, defaults to <code class="literal">50</code> UTF-16 code points.
    This limit is only used at index time to reduce the total number of
    characters per input string in order to prevent massive inputs from
    bloating the underlying datastructure. The most usecases wonât be influenced
    by the default value since prefix completions hardly grow beyond prefixes longer
    than a handful of characters. (Old name "max_input_len" is deprecated)
</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="indexing"></a>Indexing</h3></div></div></div><pre class="programlisting prettyprint lang-js">curl -X PUT 'localhost:9200/music/song/1?refresh=true' -d '{
    "name" : "Nevermind",
    "suggest" : {
        "input": [ "Nevermind", "Nirvana" ],
        "output": "Nirvana - Nevermind",
        "payload" : { "artistId" : 2321 },
        "weight" : 34
    }
}'</pre><p>The following parameters are supported:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">input</code>
</span></dt><dd>
    The input to store, this can be a an array of strings or just
    a string. This field is mandatory.
</dd><dt><span class="term">
<code class="literal">output</code>
</span></dt><dd>
    The string to return, if a suggestion matches. This is very
    useful to normalize outputs (i.e. have them always in the format
    <code class="literal">artist - songname</code>). The result is de-duplicated if several documents
    have the same output, i.e. only one is returned as part of the
    suggest result. This is optional.
</dd><dt><span class="term">
<code class="literal">payload</code>
</span></dt><dd>
    An arbitrary JSON object, which is simply returned in the
    suggest option. You could store data like the id of a document, in order
    to load it from elasticsearch without executing another search (which
    might not yield any results, if <code class="literal">input</code> and <code class="literal">output</code> differ strongly).
</dd><dt><span class="term">
<code class="literal">weight</code>
</span></dt><dd>
    A positive integer, which defines a weight and allows you to
    rank your suggestions. This field is optional.
</dd></dl></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Even though you are losing most of the features of the
completion suggest, you can opt in for the shortest form, which even
allows you to use inside of multi fields. But keep in mind, that you will
not be able to use several inputs, an output, payloads or weights.</p></div></div><pre class="programlisting prettyprint lang-js">{
  "suggest" : "Nirvana"
}</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The suggest data structure might not reflect deletes on
documents immediately. You may need to do an <a class="xref" href="#indices-optimize" title="Optimize"><em>Optimize</em></a> for that.
You can call optimize with the <code class="literal">only_expunge_deletes=true</code> to only cater for deletes
or alternatively call a <a class="xref" href="#index-modules-merge" title="Merge"><em>Merge</em></a> operation.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="querying"></a>Querying</h3></div></div></div><p>Suggesting works as usual, except that you have to specify the suggest
type as <code class="literal">completion</code>.</p><pre class="programlisting prettyprint lang-js">curl -X POST 'localhost:9200/music/_suggest?pretty' -d '{
    "song-suggest" : {
        "text" : "n",
        "completion" : {
            "field" : "suggest"
        }
    }
}'

{
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "failed" : 0
  },
  "song-suggest" : [ {
    "text" : "n",
    "offset" : 0,
    "length" : 4,
    "options" : [ {
      "text" : "Nirvana - Nevermind",
      "score" : 34.0, "payload" : {"artistId":2321}
    } ]
  } ]
}</pre><p>As you can see, the payload is included in the response, if configured
appropriately. If you configured a weight for a suggestion, this weight
is used as <code class="literal">score</code>. Also the <code class="literal">text</code> field uses the <code class="literal">output</code> of your
indexed suggestion, if configured, otherwise the matched part of the
<code class="literal">input</code> field.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The completion suggester considers all documents in the index.
See <a class="xref" href="#suggester-context" title="Context Suggester"><em>Context Suggester</em></a> for an explanation of how to query a subset of
documents instead.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="fuzzy"></a>Fuzzy queries</h3></div></div></div><p>The completion suggester also supports fuzzy queries - this means,
you can actually have a typo in your search and still get results back.</p><pre class="programlisting prettyprint lang-js">curl -X POST 'localhost:9200/music/_suggest?pretty' -d '{
    "song-suggest" : {
        "text" : "n",
        "completion" : {
            "field" : "suggest",
            "fuzzy" : {
                "fuzziness" : 2
            }
        }
    }
}'</pre><p>The fuzzy query can take specific fuzzy parameters.
The following parameters are supported:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">fuzziness</code>
</p>
</td><td valign="top">
<p>
    The fuzziness factor, defaults to <code class="literal">AUTO</code>.
    See  <a class="xref" href="#fuzziness" title="Fuzziness">the section called âFuzzinessâ</a> for allowed settings.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">transpositions</code>
</p>
</td><td valign="top">
<p>
    Sets if transpositions should be counted
    as one or two changes, defaults to <code class="literal">true</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">min_length</code>
</p>
</td><td valign="top">
<p>
    Minimum length of the input before fuzzy
    suggestions are returned, defaults <code class="literal">3</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">prefix_length</code>
</p>
</td><td valign="top">
<p>
    Minimum length of the input, which is not
    checked for fuzzy alternatives, defaults to <code class="literal">1</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">unicode_aware</code>
</p>
</td><td valign="top">
<p>
    Sets all are measurements (like edit distance,
    transpositions and lengths) in unicode code points
    (actual letters) instead of bytes.
</p>
</td></tr></tbody></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>If you want to stick with the default values, but
      still use fuzzy, you can either use <code class="literal">fuzzy: {}</code>
      or <code class="literal">fuzzy: true</code>.</p></div></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="suggester-context"></a>Context Suggester</h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Coming in 1.2.0.</p></div></div><p>The context suggester is an extension to the suggest API of Elasticsearch. Namely the
suggester system provides a very fast way of searching documents by handling these
entirely in memory. But this special treatenment does not allow the handling of
traditional queries and filters, because those would have notable impact on the
performance. So the context extension is designed to take so-called context information
into account to specify a more accurate way of searching within the suggester system.
Instead of using the traditional query and filter system a predefined ``context`` is
configured to limit suggestions to a particular subset of suggestions.
Such a context is defined by a set of context mappings which can either be a simple
<span class="strong"><strong>category</strong></span> or a <span class="strong"><strong>geo location</strong></span>. The information used by the context suggester is
configured in the type mapping with the <code class="literal">context</code> parameter, which lists all of the
contexts that need to be specified in each document and in each suggestion request.
For instance:</p><pre class="programlisting prettyprint lang-js">PUT services/service/_mapping
{
    "service": {
        "properties": {
            "name": {
                "type" : "string"
            },
            "tag": {
                "type" : "string"
            },
            "suggest_field": {
                "type": "completion",
                "context": {
                    "color": { <a id="CO22-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                        "type": "category",
                        "path": "color_field"
                        "default": ["red", "green", "blue"]
                    },
                    "location": { <a id="CO22-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
                        "type": "geo",
                        "precision": "5m",
                        "neighbors": true,
                        "default": "u33"
                    }
                }
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO22-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
See <a class="xref" href="#suggester-context-category" title="Category Context">the section called âCategory Contextâ</a>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO22-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
See <a class="xref" href="#suggester-context-geo" title="Geo location Context">the section called âGeo location Contextâ</a>
</p></td></tr></table></div><p>However contexts are specified (as type <code class="literal">category</code> or <code class="literal">geo</code>, which are discussed below), each
context value generates a new sub-set of documents which can be queried by the completion
suggester. All three types accept a <code class="literal">default</code> parameter which provides a default value to use
if the corresponding context value is absent.</p><p>The basic structure of this element is that each field forms a new context and the fieldname
is used to reference this context information later on during indexing or querying. All context
mappings have the <code class="literal">default</code> and the <code class="literal">type</code> option in common. The value of the <code class="literal">default</code> field
is used, when ever no specific is provided for the certain context. Note that a context is
defined by at least one value. The <code class="literal">type</code> option defines the kind of information hold by this
context. These type will be explained further in the following sections.</p><h3><a id="suggester-context-category"></a>Category Context</h3><p>The <code class="literal">category</code> context allows you to specify one or more categories in the document at index time.
The document will be assigned to each named category, which can then be queried later. The category
type also allows to specify a field to extract the categories from. The <code class="literal">path</code> parameter is used to
specify this field of the documents that should be used. If the referenced field contains multiple
values, all these values will be used as alternative categories.</p><h4><a id="_category_mapping"></a>Category Mapping</h4><p>The mapping for a category is simply defined by its <code class="literal">default</code> values. These can either be
defined as list of <span class="strong"><strong>default</strong></span> categories:</p><pre class="programlisting prettyprint lang-js">"context": {
    "color": {
        "type": "category",
        "default": ["red", "orange"]
    }
}</pre><p>or as a single value</p><pre class="programlisting prettyprint lang-js">"context": {
    "color": {
        "type": "category",
        "default": "red"
    }
}</pre><p>or as reference to another field within the documents indexed:</p><pre class="programlisting prettyprint lang-js">"context": {
    "color": {
        "type": "category",
        "default": "red"
        "path": "color_field"
    }
}</pre><p>in this case the <span class="strong"><strong>default</strong></span> categories will only be used, if the given field does not
exist within the document. In the example above the categories are received from a
field named <code class="literal">color_field</code>. If this field does not exist a category <span class="strong"><strong>red</strong></span> is assumed for
the context <span class="strong"><strong>color</strong></span>.</p><h4><a id="_indexing_category_contexts"></a>Indexing category contexts</h4><p>Within a document the category is specified either as an <code class="literal">array</code> of values, a
single value or <code class="literal">null</code>. A list of values is interpreted as alternative categories. So
a document belongs to all the categories defined. If the category is <code class="literal">null</code> or remains
unset the categories will be retrieved from the documents field addressed by the <code class="literal">path</code>
parameter. If this value is not set or the field is missing, the default values of the
mapping will be assigned to the context.</p><pre class="programlisting prettyprint lang-js">PUT services/service/1
{
    "name": "knapsack",
    "suggest_field": {
        "input": ["knacksack", "backpack", "daypack"],
        "context": {
            "color": ["red", "yellow"]
        }
    }
}</pre><h4><a id="_category_query"></a>Category Query</h4><p>A query within a category works similar to the configuration. If the value is <code class="literal">null</code>
the mappings default categories will be used. Otherwise the suggestion takes place
for all documents that have at least one category in common with the query.</p><pre class="programlisting prettyprint lang-js">POST services/_suggest?pretty'
{
    "suggest" : {
        "text" : "m",
        "completion" : {
            "field" : "suggest_field",
            "size": 10,
            "context": {
                "color": "red"
            }
        }
    }
}</pre><h3><a id="suggester-context-geo"></a>Geo location Context</h3><p>A <code class="literal">geo</code> context allows you to limit results to those that lie within a certain distance
of a specified geolocation. At index time, a lat/long geo point is converted into a
geohash of a certain precision, which provides the context.</p><h4><a id="_geo_location_mapping"></a>Geo location Mapping</h4><p>The mapping for a geo context accepts four settings:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">precision</code>
</p>
</td><td valign="top">
<p>
This defines the precision of the geohash and can be specified as <code class="literal">5m</code>, <code class="literal">10km</code>,
               or as a raw geohash precision: <code class="literal">1</code>..<code class="literal">12</code>. Itâs also possible to setup multiple
               precisions by defining a list of precisions: <code class="literal">["5m", "10km"]</code>
               (default is a geohash level of 12)
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">neighbors</code>
</p>
</td><td valign="top">
<p>
Geohashes are rectangles, so a geolocation, which in reality is only 1 metre
               away from the specified point, may fall into the neighbouring rectangle. Set
               <code class="literal">neighbours</code> to <code class="literal">true</code> to include the neighbouring geohashes in the context.
               (default is <span class="strong"><strong>on</strong></span>)
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">path</code>
</p>
</td><td valign="top">
<p>
Optionally specify a field to use to look up the geopoint.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">default</code>
</p>
</td><td valign="top">
<p>
The geopoint to use if no geopoint has been specified.
</p>
</td></tr></tbody></table></div><p>Since all locations of this mapping are translated into geohashes, each location matches
a geohash cell. So some results that lie within the specified range but not in the same
cell as the query location will not match. To avoid this the <code class="literal">neighbors</code> option allows a
matching of cells that join the bordering regions of the documents location. This option
is turned on by default.
If a document or a query doesnât define a location a value to use instead can defined by
the <code class="literal">default</code> option. The value of this option supports all the ways a <code class="literal">geo_point</code> can be
defined. The <code class="literal">path</code> refers to another field within the document to retrieve the
location. If this field contains multiple values, the document will be linked to all these
locations.</p><pre class="programlisting prettyprint lang-js">"context": {
    "location": {
        "type": "geo",
        "precision": ["1km", "5m"],
        "neighbors": true,
        "path": "pin",
        "default": {
            "lat": 0.0,
            "lon": 0.0
        }
    }
}</pre><h4><a id="_geo_location_config"></a>Geo location Config</h4><p>Within a document a geo location retrieved from the mapping definition can be overridden
by another location. In this case the context mapped to a geo location supports all
variants of defining a <code class="literal">geo_point</code>.</p><pre class="programlisting prettyprint lang-js">PUT services/service/1
{
    "name": "some hotel 1",
    "suggest_field": {
        "input": ["my hotel", "this hotel"],
        "context": {
            "location": {
                    "lat": 0,
                    "lon": 0
            }
        }
    }
}</pre><h4><a id="_geo_location_query"></a>Geo location Query</h4><p>Like in the configuration, querying with a geo location in context, the geo location
query supports all representations of a <code class="literal">geo_point</code> to define the location. In this
simple case all precision values defined in the mapping will be applied to the given
location.</p><pre class="programlisting prettyprint lang-js">POST services/_suggest
{
    "suggest" : {
        "text" : "m",
        "completion" : {
            "field" : "suggest_field",
            "size": 10,
            "context": {
                "location": {
                    "lat": 0,
                    "lon": 0
                }
            }
        }
    }
}</pre><p>But it also possible to set a subset of the precisions set in the mapping, by using the
<code class="literal">precision</code> parameter. Like in the mapping, this parameter is allowed to be set to a
single precision value or a list of these.</p><pre class="programlisting prettyprint lang-js">POST services/_suggest
{
    "suggest" : {
        "text" : "m",
        "completion" : {
            "field" : "suggest_field",
            "size": 10,
            "context": {
                "location": {
                    "value": {
                        "lat": 0,
                        "lon": 0
                    },
                    "precision": "1km"
                }
            }
        }
    }
}</pre><p>A special form of the query is definied by an extension of the object representation of
the <code class="literal">geo_point</code>. Using this representation allows to set the <code class="literal">precision</code> parameter within
the location itself:</p><pre class="programlisting prettyprint lang-js">POST services/_suggest
{
    "suggest" : {
        "text" : "m",
        "completion" : {
            "field" : "suggest_field",
            "size": 10,
            "context": {
                "location": {
                        "lat": 0,
                        "lon": 0,
                        "precision": "1km"
                }
            }
        }
    }
}</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-multi-search"></a>Multi Search API</h2></div></div></div><p>The multi search API allows to execute several search requests within
the same API. The endpoint for it is <code class="literal">_msearch</code>.</p><p>The format of the request is similar to the bulk API format, and the
structure is as follows (the structure is specifically optimized to
reduce parsing if a specific search ends up redirected to another node):</p><pre class="programlisting prettyprint lang-js">header\n
body\n
header\n
body\n</pre><p>The header part includes which index / indices to search on, optional
(mapping) types to search on, the <code class="literal">search_type</code>, <code class="literal">preference</code>, and
<code class="literal">routing</code>. The body includes the typical search body request (including
the <code class="literal">query</code>, <code class="literal">facets</code>, <code class="literal">from</code>, <code class="literal">size</code>, and so on). Here is an example:</p><pre class="programlisting prettyprint lang-js">$ cat requests
{"index" : "test"}
{"query" : {"match_all" : {}}, "from" : 0, "size" : 10}
{"index" : "test", "search_type" : "count"}
{"query" : {"match_all" : {}}}
{}
{"query" : {"match_all" : {}}}

{"query" : {"match_all" : {}}}
{"search_type" : "count"}
{"query" : {"match_all" : {}}}

$ curl -XGET localhost:9200/_msearch --data-binary @requests; echo</pre><p>Note, the above includes an example of an empty header (can also be just
without any content) which is supported as well.</p><p>The response returns a <code class="literal">responses</code> array, which includes the search
response for each search request matching its order in the original
multi search request. If there was a complete failure for that specific
search request, an object with <code class="literal">error</code> message will be returned in place
of the actual search response.</p><p>The endpoint allows to also search against an index/indices and
type/types in the URI itself, in which case it will be used as the
default unless explicitly defined otherwise in the header. For example:</p><pre class="programlisting prettyprint lang-js">$ cat requests
{}
{"query" : {"match_all" : {}}, "from" : 0, "size" : 10}
{}
{"query" : {"match_all" : {}}}
{"index" : "test2"}
{"query" : {"match_all" : {}}}

$ curl -XGET localhost:9200/test/_msearch --data-binary @requests; echo</pre><p>The above will execute the search against the <code class="literal">test</code> index for all the
requests that donât define an index, and the last one will be executed
against the <code class="literal">test2</code> index.</p><p>The <code class="literal">search_type</code> can be set in a similar manner to globally apply to
all search requests.</p><h3><a id="msearch-security"></a>Security</h3><p>See <a class="xref" href="#url-access-control" title="URL-based access control"><em>URL-based access control</em></a></p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-count"></a>Count API</h2></div></div></div><p>The count API allows to easily execute a query and get the number of
matches for that query. It can be executed across one or more indices
and across one or more types. The query can either be provided using a
simple query string as a parameter, or using the
<a class="link" href="#query-dsl" title="Query DSL">Query DSL</a> defined within the request
body. Here is an example:</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/twitter/tweet/_count?q=user:kimchy'

$ curl -XGET 'http://localhost:9200/twitter/tweet/_count' -d '
{
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}'</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The query being sent in the body must be nested in a <code class="literal">query</code> key, same as
the <a class="link" href="#search-search" title="Search">search api</a> works <span class="added">
      [<span class="version">1.0.0.RC1</span>]
      <span class="detail">Added in 1.0.0.RC1. The query was previously the top-level object.</span></span>.</p></div></div><p>Both examples above do the same thing, which is count the number of
tweets from the twitter index for a certain user. The result is:</p><pre class="programlisting prettyprint lang-js">{
    "count" : 1,
    "_shards" : {
        "total" : 5,
        "successful" : 5,
        "failed" : 0
    }
}</pre><p>The query is optional, and when not provided, it will use <code class="literal">match_all</code> to
count all the docs.</p><h3><a id="_multi_index_multi_type"></a>Multi index, Multi type</h3><p>The count API can be applied to <a class="link" href="#search-multi-index-type" title="Multi-Index, Multi-Type">multiple types in multiple indices</a>.</p><h3><a id="_request_parameters"></a>Request Parameters</h3><p>When executing count using the query parameter <code class="literal">q</code>, the query passed is
a query string using Lucene query parser. There are additional
parameters that can be passed:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Name </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>df</p></td><td align="left" valign="top"><p>The default field to use when no field prefix is defined within the
query.</p></td></tr><tr><td align="left" valign="top"><p>analyzer</p></td><td align="left" valign="top"><p>The analyzer name to be used when analyzing the query string.</p></td></tr><tr><td align="left" valign="top"><p>default_operator</p></td><td align="left" valign="top"><p>The default operator to be used, can be <code class="literal">AND</code> or
<code class="literal">OR</code>. Defaults to <code class="literal">OR</code>.</p></td></tr></tbody></table></div><h3><a id="_request_body"></a>Request Body</h3><p>The count can use the <a class="link" href="#query-dsl" title="Query DSL">Query DSL</a> within
its body in order to express the query that should be executed. The body
content can also be passed as a REST parameter named <code class="literal">source</code>.</p><p>Both HTTP GET and HTTP POST can be used to execute count with body.
Since not all clients support GET with body, POST is allowed as well.</p><h3><a id="_distributed"></a>Distributed</h3><p>The count operation is broadcast across all shards. For each shard id
group, a replica is chosen and executed against it. This means that
replicas increase the scalability of count.</p><h3><a id="_routing"></a>Routing</h3><p>The routing value (a comma separated list of the routing values) can be
specified to control which shards the count request will be executed on.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-validate"></a>Validate API</h2></div></div></div><p>The validate API allows a user to validate a potentially expensive query
without executing it. The following example shows how it can be used:</p><pre class="programlisting prettyprint lang-js">curl -XPUT 'http://localhost:9200/twitter/tweet/1' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</pre><p>When the query is valid, the response contains <code class="literal">valid:true</code>:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/_validate/query?q=user:foo'
{"valid":true,"_shards":{"total":1,"successful":1,"failed":0}}</pre><p>Or, with a request body:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/_validate/query' -d '{
  "query" : {
    "filtered" : {
      "query" : {
        "query_string" : {
          "query" : "*:*"
        }
      },
      "filter" : {
        "term" : { "user" : "kimchy" }
      }
    }
  }
}'
{"valid":true,"_shards":{"total":1,"successful":1,"failed":0}}</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The query being sent in the body must be nested in a <code class="literal">query</code> key, same as
the <a class="link" href="#search-search" title="Search">search api</a> works <span class="added">
      [<span class="version">1.0.0.RC1</span>]
      <span class="detail">Added in 1.0.0.RC1. The query was previously the top-level object.</span></span>.</p></div></div><p>If the query is invalid, <code class="literal">valid</code> will be <code class="literal">false</code>. Here the query is
invalid because Elasticsearch knows the post_date field should be a date
due to dynamic mapping, and <span class="emphasis"><em>foo</em></span> does not correctly parse into a date:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/_validate/query?q=post_date:foo'
{"valid":false,"_shards":{"total":1,"successful":1,"failed":0}}</pre><p>An <code class="literal">explain</code> parameter can be specified to get more detailed information
about why a query failed:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/_validate/query?q=post_date:foo&amp;pretty=true&amp;explain=true'
{
  "valid" : false,
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "failed" : 0
  },
  "explanations" : [ {
    "index" : "twitter",
    "valid" : false,
    "error" : "org.elasticsearch.index.query.QueryParsingException: [twitter] Failed to parse; org.elasticsearch.ElasticsearchParseException: failed to parse date field [foo], tried both date format [dateOptionalTime], and timestamp number; java.lang.IllegalArgumentException: Invalid format: \"foo\""
  } ]
}</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-explain"></a>Explain API</h2></div></div></div><p>The explain api computes a score explanation for a query and a specific
document. This can give useful feedback whether a document matches or
didnât match a specific query.</p><p>The <code class="literal">index</code> and <code class="literal">type</code> parameters expect a single index and a single
type respectively.</p><h3><a id="_usage"></a>Usage</h3><p>Full query example:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/twitter/tweet/1/_explain' -d '{
      "query" : {
        "term" : { "message" : "search" }
      }
}'</pre><p>This will yield the following result:</p><pre class="programlisting prettyprint lang-js">{
  "matches" : true,
  "explanation" : {
    "value" : 0.15342641,
    "description" : "fieldWeight(message:search in 0), product of:",
    "details" : [ {
      "value" : 1.0,
      "description" : "tf(termFreq(message:search)=1)"
    }, {
      "value" : 0.30685282,
      "description" : "idf(docFreq=1, maxDocs=1)"
    }, {
      "value" : 0.5,
      "description" : "fieldNorm(field=message, doc=0)"
    } ]
  }
}</pre><p>There is also a simpler way of specifying the query via the <code class="literal">q</code>
parameter. The specified <code class="literal">q</code> parameter value is then parsed as if the
<code class="literal">query_string</code> query was used. Example usage of the <code class="literal">q</code> parameter in the
explain api:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/twitter/tweet/1/_explain?q=message:search'</pre><p>This will yield the same result as the previous request.</p><h3><a id="_all_parameters"></a>All parameters:</h3><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">_source</code>
</p>
</td><td valign="top">
<p>
    <span class="added">
      [<span class="version">1.0.0.Beta1</span>]
      <span class="detail">Added in 1.0.0.Beta1.</span></span> Set to <code class="literal">true</code> to retrieve the <code class="literal">_source</code> of the document explained. You can also
    retrieve part of the document by using <code class="literal">_source_include</code> &amp; <code class="literal">_source_exclude</code> (see <a class="link" href="#get-source-filtering" title="Source filtering">Get API</a> for more details)
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">fields</code>
</p>
</td><td valign="top">
<p>
    Allows to control which stored fields to return as part of the
    document explained.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">routing</code>
</p>
</td><td valign="top">
<p>
    Controls the routing in the case the routing was used
    during indexing.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">parent</code>
</p>
</td><td valign="top">
<p>
    Same effect as setting the routing parameter.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">preference</code>
</p>
</td><td valign="top">
<p>
    Controls on which shard the explain is executed.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">source</code>
</p>
</td><td valign="top">
<p>
    Allows the data of the request to be put in the query
    string of the url.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">q</code>
</p>
</td><td valign="top">
<p>
    The query string (maps to the query_string query).
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">df</code>
</p>
</td><td valign="top">
<p>
    The default field to use when no field prefix is defined within
    the query. Defaults to _all field.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">analyzer</code>
</p>
</td><td valign="top">
<p>
    The analyzer name to be used when analyzing the query
    string. Defaults to the analyzer of the _all field.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">analyze_wildcard</code>
</p>
</td><td valign="top">
<p>
    Should wildcard and prefix queries be analyzed or
    not. Defaults to false.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">lowercase_expanded_terms</code>
</p>
</td><td valign="top">
<p>
    Should terms be automatically lowercased
    or not. Defaults to true.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">lenient</code>
</p>
</td><td valign="top">
<p>
    If set to true will cause format based failures (like
    providing text to a numeric field) to be ignored. Defaults to false.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">default_operator</code>
</p>
</td><td valign="top">
<p>
    The default operator to be used, can be AND or
    OR. Defaults to OR.
</p>
</td></tr></tbody></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-percolate"></a>Percolator</h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.0.0.Beta1.</p></div></div><p>Traditionally you design documents based on your data and store them into an index and then define queries via the search api
in order to retrieve these documents. The percolator works in the opposite direction, first you store queries into an
index and then via the percolate api you define documents in order to retrieve these queries.</p><p>The reason that queries can be stored comes from the fact that in Elasticsearch both documents and queries are defined in
JSON. This allows you to embed queries into documents via the index api. Elasticsearch can extract the query from a
document and make it available to the percolate api. Since documents are also defines as json, you can define a document
in a request to the percolate api.</p><p>The percolator and most of its features work in realtime, so once a percolate query is indexed it can immediately be used
in the percolate api.</p><h3><a id="_sample_usage"></a>Sample usage</h3><p>Adding a query to the percolator:</p><pre class="programlisting prettyprint lang-js">curl -XPUT 'localhost:9200/my-index/.percolator/1' -d '{
    "query" : {
        "match" : {
            "message" : "bonsai tree"
        }
    }
}'</pre><p>Matching documents to the added queries:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/my-index/message/_percolate' -d '{
    "doc" : {
        "message" : "A new bonsai tree in the office"
    }
}'</pre><p>The above request will yield the following response:</p><pre class="programlisting prettyprint lang-js">{
    "took" : 19,
    "_shards" : {
        "total" : 5,
        "successful" : 5,
        "failed" : 0
    },
    "total" : 1,
    "matches" : [
        {
             "_index" : "my-index",
             "_id" : "1"
        }
    ]
}</pre><p>The percolate api returns matches that refer to percolate queries that have matched with the document defined in the percolate api.</p><h3><a id="_indexing_percolator_queries"></a>Indexing percolator queries</h3><p>Percolate queries are stored as documents in a specific format and in an arbitrary index under a reserved type with the
name <code class="literal">.percolator</code>. The query itself is placed as is in a json objects under the top level field <code class="literal">query</code>.</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
                "match" : {
                        "field" : "value"
                }
        }
}</pre><p>Since this is just an ordinary document, any field can be added to this document. This can be useful later on to only
percolate documents by specific queries.</p><pre class="programlisting prettyprint lang-js">{
        "query" : {
                "match" : {
                        "field" : "value"
                }
        },
        "priority" : "high"
}</pre><p>On top of this also a mapping type can be associated with the this query. This allows to control how certain queries
like range queries, shape filters and other query &amp; filters that rely on mapping settings get constructed. This is
important since the percolate queries are indexed into the <code class="literal">.percolator</code> type, and the queries / filters that rely on
mapping settings would yield unexpected behaviour. Note by default field names do get resolved in a smart manner,
but in certain cases with multiple types this can lead to unexpected behaviour, so being explicit about it will help.</p><pre class="programlisting prettyprint lang-js">{
        "query" : {
                "range" : {
                        "created_at" : {
                                "gte" : "2010-01-01T00:00:00",
                                "lte" : "2011-01-01T00:00:00"
                        }
                }
        },
        "type" : "tweet",
        "priority" : "high"
}</pre><p>In the above example the range query gets really parsed into a Lucene numeric range query, based on the settings for
the field <code class="literal">created_at</code> in the type <code class="literal">tweet</code>.</p><p>Just as with any other type, the <code class="literal">.percolator</code> type has a mapping, which you can configure via the mappings apis.
The default percolate mapping doesnât index the query field and only stores it.</p><p>Because <code class="literal">.percolate</code> is a type it also has a mapping. By default the following mapping is active:</p><pre class="programlisting prettyprint lang-js">{
        ".percolator" : {
                "properties" : {
                        "query" : {
                                "type" : "object",
                                "enabled" : false
                        }
                }
        }
}</pre><p>If needed this mapping can be modified wit the update mapping api.</p><p>In order to un-register a percolate query the delete api can be used. So if the previous added query needs to be deleted
the following delete requests needs to be executed:</p><pre class="programlisting prettyprint lang-js">curl -XDELETE localhost:9200/my-index/.percolator/1</pre><h3><a id="_percolate_api"></a>Percolate api</h3><p>The percolate api executes in a distributed manner, meaning it executes on all shards an index points to.</p><div class="itemizedlist"><p class="title"><strong>Required options</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">index</code> - The index that contains the <code class="literal">.percolator</code> type. This can also be an alias.
</li><li class="listitem">
<code class="literal">type</code> - The type of the document to be percolated. The mapping of that type is used to parse document.
</li><li class="listitem">
<code class="literal">doc</code> - The actual document to percolate. Unlike the other two options this needs to be specified in the request body. Note this isnât required when percolating an existing document.
</li></ul></div><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/twitter/tweet/_percolate' -d '{
        "doc" : {
                "created_at" : "2010-10-10T00:00:00",
                "message" : "some text"
        }
}'</pre><div class="itemizedlist"><p class="title"><strong>Additional supported query string options</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">routing</code> - In the case the percolate queries are partitioned by a custom routing value, that routing option make sure
that the percolate request only gets executed on the shard where the routing value is partitioned to. This means that
the percolate request only gets executed on one shard instead of all shards. Multiple values can be specified as a
comma separated string, in that case the request can be be executed on more than one shard.
</li><li class="listitem">
<code class="literal">preference</code> - Controls which shard replicas are preferred to execute the request on. Works the same as in the search api.
</li><li class="listitem">
<code class="literal">ignore_unavailable</code> - Controls if missing concrete indices should silently be ignored. Same as is in the search api.
</li><li class="listitem">
<code class="literal">percolate_format</code> - If <code class="literal">ids</code> is specified then the matches array in the percolate response will contain a string
array of the matching ids instead of an array of objects. This can be useful the reduce the amount of data being send
back to the client. Obviously if there are to percolator queries with same id from different indices there is no way
the find out which percolator query belongs to what index. Any other value to <code class="literal">percolate_format</code> will be ignored.
</li></ul></div><div class="itemizedlist"><p class="title"><strong>Additional request body options</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">filter</code> - Reduces the number queries to execute during percolating. Only the percolator queries that match with the
filter will be included in the percolate execution. The filter option works in near realtime, so a refresh needs to have
occurred for the filter to included the latest percolate queries.
</li><li class="listitem">
<code class="literal">query</code> - Same as the <code class="literal">filter</code> option, but also the score is computed. The computed scores can then be used by the
<code class="literal">track_scores</code> and <code class="literal">sort</code> option.
</li><li class="listitem">
<code class="literal">size</code> - Defines to maximum number of matches (percolate queries) to be returned. Defaults to unlimited.
</li><li class="listitem">
<code class="literal">track_scores</code> - Whether the <code class="literal">_score</code> is included for each match. The is based on the query and represents how the query matched
to the percolate queryâs metadata and <span class="strong"><strong>not</strong></span> how the document being percolated matched to the query. The <code class="literal">query</code> option
is required for this option. Defaults to <code class="literal">false</code>.
</li><li class="listitem">
<code class="literal">sort</code> - Define a sort specification like in the search api. Currently only sorting <code class="literal">_score</code> reverse (default relevancy)
is supported. Other sort fields will throw an exception. The <code class="literal">size</code> and <code class="literal">query</code> option are required for this setting. Like
<code class="literal">track_score</code> the score is based on the query and represents how the query matched to the percolate queryâs metadata
and <span class="strong"><strong>not</strong></span> how the document being percolated matched to the query.
</li><li class="listitem">
<code class="literal">facets</code> - Allows facet definitions to be included. The facets are based on the matching percolator queries. See facet
documentation how to define facets.
</li><li class="listitem">
<code class="literal">aggs</code> - Allows aggregation definitions to be included. The aggregations are based on the matching percolator queries,
look at the aggregation documentation on how to define aggregations.
</li><li class="listitem">
<code class="literal">highlight</code> - Allows highlight definitions to be included. The document being percolated is being highlight for each
matching query. This allows you to see how each match is highlighting the document being percolated. See highlight
documentation on how to define highlights. The <code class="literal">size</code> option is required for highlighting, the performance of highlighting
 in the percolate api depends of how many matches are being highlighted.
</li></ul></div><h3><a id="_dedicated_percolator_index"></a>Dedicated percolator index</h3><p>Percolate queries can be added to any index. Instead of adding percolate queries to the index the data resides in,
these queries can also be added to an dedicated index. The advantage of this is that this dedicated percolator index
can have its own index settings (For example the number of primary and replicas shards). If you choose to have a dedicated
percolate index, you need to make sure that the mappings from the normal index are also available on the percolate index.
Otherwise percolate queries can be parsed incorrectly.</p><h3><a id="_filtering_executed_queries"></a>Filtering Executed Queries</h3><p>Filtering allows to reduce the number of queries, any filter that the search api supports, (expect the ones mentioned in important notes)
can also be used in the percolate api. The filter only works on the metadata fields. The <code class="literal">query</code> field isnât indexed by
default. Based on the query we indexed before the following filter can be defined:</p><pre class="programlisting prettyprint lang-js">curl -XGET localhost:9200/test/type1/_percolate -d '{
    "doc" : {
        "field" : "value"
    },
    "filter" : {
        "term" : {
            "priority" : "high"
        }
    }
}'</pre><h3><a id="_percolator_count_api"></a>Percolator count api</h3><p>The count percolate api, only keeps track of the number of matches and doesnât keep track of the actual matches
Example:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/my-index/my-type/_percolate/count' -d '{
   "doc" : {
       "message" : "some message"
   }
}'</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
   ... // header
   "total" : 3
}</pre><h3><a id="_percolating_an_existing_document"></a>Percolating an existing document</h3><p>In order to percolate in newly indexed document, the percolate existing document can be used. Based on the response
from an index request the <code class="literal">_id</code> and other meta information can be used to the immediately percolate the newly added
document.</p><div class="itemizedlist"><p class="title"><strong>Supported options for percolating an existing document on top of existing percolator options:</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">id</code> - The id of the document to retrieve the source for.
</li><li class="listitem">
<code class="literal">percolate_index</code> - The index containing the percolate queries. Defaults to the <code class="literal">index</code> defined in the url.
</li><li class="listitem">
<code class="literal">percolate_type</code> - The percolate type (used for parsing the document). Default to <code class="literal">type</code> defined in the url.
</li><li class="listitem">
<code class="literal">routing</code> - The routing value to use when retrieving the document to percolate.
</li><li class="listitem">
<code class="literal">preference</code> - Which shard to prefer when retrieving the existing document.
</li><li class="listitem">
<code class="literal">percolate_routing</code> - The routing value to use when percolating the existing document.
</li><li class="listitem">
<code class="literal">percolate_preference</code> - Which shard to prefer when executing the percolate request.
</li><li class="listitem">
<code class="literal">version</code> - Enables a version check. If the fetched documentâs version isnât equal to the specified version then the request fails with a version conflict and the percolation request is aborted.
</li></ul></div><p>Internally the percolate api will issue a get request for fetching the`_source` of the document to percolate.
For this feature to work the <code class="literal">_source</code> for documents to be percolated need to be stored.</p><h4><a id="_example_2"></a>Example</h4><p>Index response:</p><pre class="programlisting prettyprint lang-js">{
        "_index" : "my-index",
        "_type" : "message",
        "_id" : "1",
        "_version" : 1,
        "created" : true
}</pre><p>Percolating an existing document:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/my-index1/message/1/_percolate'</pre><p>The response is the same as with the regular percolate api.</p><h3><a id="_multi_percolate_api"></a>Multi percolate api</h3><p>The multi percolate api allows to bundle multiple percolate requests into a single request, similar to what the multi
search api does to search requests. The request body format is line based. Each percolate request item takes two lines,
the first line is the header and the second line is the body.</p><p>The header can contain any parameter that normally would be set via the request path or query string parameters. T
here are several percolate actions, because there are multiple types of percolate requests.</p><div class="itemizedlist"><p class="title"><strong>Supported actions:</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">percolate</code> - Action for defining a regular percolate request.
</li><li class="listitem">
<code class="literal">count</code> - Action for defining a count percolate request.
</li></ul></div><p>Depending on the percolate action different parameters can be specified. For example the percolate and percolate existing
document actions support different parameters.</p><div class="itemizedlist"><p class="title"><strong>The following endpoints are supported</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
GET|POST /[index]/[type]/_mpercolate
</li><li class="listitem">
GET}POST /[index]/_mpercolate
</li><li class="listitem">
GET|POST /_mpercolate
</li></ul></div><p>The <code class="literal">index</code> and <code class="literal">type</code> defined in the url path are the default index and type.</p><h4><a id="_example_3"></a>Example</h4><p>Request:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/twitter/tweet/_mpercolate' --data-binary @requests.txt; echo</pre><p>The index twitter is the default index and the type tweet is the default type and will be used in the case a header
doesnât specify an index or type.</p><p>requests.txt:</p><pre class="programlisting prettyprint lang-js">{"percolate" : {"index" : twitter", "type" : "tweet"}}
{"doc" : {"message" : "some text"}}
{"percolate" : {"index" : twitter", "type" : "tweet", "id" : "1"}}
{}
{"percolate" : {"index" : users", "type" : "user", "id" : "3", "percolate_index" : "users_2012" }}
{"size" : 10}
{"count" : {"index" : twitter", "type" : "tweet"}}
{"doc" : {"message" : "some other text"}}
{"count" : {"index" : twitter", "type" : "tweet", "id" : "1"}}
{}</pre><p>For a percolate existing document item (headers with the <code class="literal">id</code> field), the response can be an empty json object.
All the required options are set in the header.</p><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    "items" : [
        {
            "took" : 24,
            "_shards" : {
                "total" : 5,
                "successful" : 5,
                "failed" : 0,
            },
            "total" : 3,
            "matches" : ["1", "2", "3"]
        },
        {
            "took" : 12,
            "_shards" : {
                "total" : 5,
                "successful" : 5,
                "failed" : 0,
            },
            "total" : 3,
            "matches" : ["4", "5", "6"]
        },
        {
            "error" : "[user][3]document missing"
        },
        {
            "took" : 12,
            "_shards" : {
                "total" : 5,
                "successful" : 5,
                "failed" : 0,
            },
            "total" : 3
        },
        {
            "took" : 14,
            "_shards" : {
                "total" : 5,
                "successful" : 5,
                "failed" : 0,
            },
            "total" : 3
        }
    ]
}</pre><p>Each item represents a percolate response, the order of the items maps to the order in where the percolate requests
were specified. In case a percolate request failed, the item response is substituted with an error message.</p><h3><a id="_how_it_works_under_the_hood"></a>How it works under the hood</h3><p>When indexing a document that contains a query in an index and the <code class="literal">.percolator</code> type the query part of the documents gets
parsed into a Lucene query and is kept in memory until that percolator document is removed or the index containing the
<code class="literal">.percolator</code> type get removed. So all the active percolator queries are kept in memory.</p><p>At percolate time the document specified in the request gets parsed into a Lucene document and is stored in a in-memory
Lucene index. This in-memory index can just hold this one document and it is optimized for that. Then all the queries
that are registered to the index that the percolate request is targeted for are going to be executed on this single document
in-memory index. This happens on each shard the percolate request need to execute.</p><p>By using <code class="literal">routing</code>, <code class="literal">filter</code> or <code class="literal">query</code> features the amount of queries that need to be executed can be reduced and thus
the time the percolate api needs to run can be decreased.</p><h3><a id="_important_notes"></a>Important notes</h3><p>Because the percolator API is processing one document at a time, it doesnât support queries and filters that run
against child documents such as <code class="literal">has_child</code>, <code class="literal">has_parent</code> and <code class="literal">top_children</code>.</p><p>The <code class="literal">wildcard</code> and <code class="literal">regexp</code> query natively use a lot of memory and because the percolator keeps the queries into memory
this can easily take up the available memory in the heap space. If possible try to use a <code class="literal">prefix</code> query or ngramming to
achieve the same result (with way less memory being used).</p><p>The delete-by-query api doesnât work to unregister a query, it only deletes the percolate documents from disk. In order
to update the registered queries in memory the index needs be closed and opened.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-more-like-this"></a>More Like This API</h2></div></div></div><p>The more like this (mlt) API allows to get documents that are "like" a
specified document. Here is an example:</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/twitter/tweet/1/_mlt?mlt_fields=tag,content&amp;min_doc_freq=1'</pre><p>The API simply results in executing a search request with
<a class="link" href="#query-dsl-mlt-query" title="More Like This Query">moreLikeThis</a> query (http
parameters match the parameters to the <code class="literal">more_like_this</code> query). This
means that the body of the request can optionally include all the
request body options in the <a class="link" href="#search-search" title="Search">search API</a> (facets, from/to and so on).</p><p>Rest parameters relating to search are also allowed, including
<code class="literal">search_type</code>, <code class="literal">search_indices</code>, <code class="literal">search_types</code>, <code class="literal">search_scroll</code>,
<code class="literal">search_size</code> and <code class="literal">search_from</code>.</p><p>When no <code class="literal">mlt_fields</code> are specified, all the fields of the document will
be used in the <code class="literal">more_like_this</code> query generated.</p><p>Note: In order to use the <code class="literal">mlt</code> feature a <code class="literal">mlt_field</code> needs to be either
be <code class="literal">stored</code>, store <code class="literal">term_vector</code> or <code class="literal">source</code> needs to be enabled.</p></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="indices"></a>Indices APIs</h1></div></div></div><div class="partintro"><div></div><p>The indices APIs are used to manage individual indices,
index settings, aliases, mappings, index templates
and warmers.</p><h2><a id="index-management"></a>Index management:</h2><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="#indices-create-index" title="Create Index"><em>Create Index</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-delete-index" title="Delete Index"><em>Delete Index</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-exists" title="Indices Exists"><em>Indices Exists</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-open-close" title="Open / Close Index API"><em>Open / Close Index API</em></a>
</li></ul></div><h2><a id="mapping-management"></a>Mapping management:</h2><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="#indices-put-mapping" title="Put Mapping"><em>Put Mapping</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-get-mapping" title="Get Mapping"><em>Get Mapping</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-get-field-mapping" title="Get Field Mapping"><em>Get Field Mapping</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-delete-mapping" title="Delete Mapping"><em>Delete Mapping</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-types-exists" title="Types Exists"><em>Types Exists</em></a>
</li></ul></div><h2><a id="alias-management"></a>Alias management:</h2><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="#indices-aliases" title="Index Aliases"><em>Index Aliases</em></a>
</li></ul></div><h2><a id="index-settings"></a>Index settings:</h2><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="#indices-update-settings" title="Update Indices Settings"><em>Update Indices Settings</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-get-settings" title="Get Settings"><em>Get Settings</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-analyze" title="Analyze"><em>Analyze</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-templates" title="Index Templates"><em>Index Templates</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-warmers" title="Warmers"><em>Warmers</em></a>
</li></ul></div><h2><a id="monitoring"></a>Monitoring:</h2><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="#indices-status" title="Status"><em>Status</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-stats" title="Indices Stats"><em>Indices Stats</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-segments" title="Indices Segments"><em>Indices Segments</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-recovery" title="Indices Recovery"><em>Indices Recovery</em></a>
</li></ul></div><h2><a id="status-management"></a>Status management:</h2><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="#indices-clearcache" title="Clear Cache"><em>Clear Cache</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-refresh" title="Refresh"><em>Refresh</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-flush" title="Flush"><em>Flush</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-optimize" title="Optimize"><em>Optimize</em></a>
</li><li class="listitem">
<a class="xref" href="#indices-gateway-snapshot" title="Gateway Snapshot"><em>Gateway Snapshot</em></a>
</li></ul></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-create-index"></a>Create Index</h2></div></div></div><p>The create index API allows to instantiate an index. Elasticsearch
provides support for multiple indices, including executing operations
across several indices.</p><h3><a id="create-index-settings"></a>Index Settings</h3><p>Each index created can have specific settings
associated with it.</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT 'http://localhost:9200/twitter/'

$ curl -XPUT 'http://localhost:9200/twitter/' -d '
index :
    number_of_shards : 3
    number_of_replicas : 2
'</pre><p>The above second curl example shows how an index called <code class="literal">twitter</code> can be
created with specific settings for it using <a class="ulink" href="http://www.yaml.org" target="_top">YAML</a>.
In this case, creating an index with 3 shards, each with 2 replicas. The
index settings can also be defined with <a class="ulink" href="http://www.json.org" target="_top">JSON</a>:</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT 'http://localhost:9200/twitter/' -d '{
    "settings" : {
        "index" : {
            "number_of_shards" : 3,
            "number_of_replicas" : 2
        }
    }
}'</pre><p>or more simplified</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT 'http://localhost:9200/twitter/' -d '{
    "settings" : {
        "number_of_shards" : 3,
        "number_of_replicas" : 2
    }
}'</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>You do not have to explicitly specify <code class="literal">index</code> section inside the
<code class="literal">settings</code> section.</p></div></div><p>For more information regarding all the different index level settings
that can be set when creating an index, please check the
<a class="link" href="#index-modules" title="Index Modules">index modules</a> section.</p><h3><a id="mappings"></a>Mappings</h3><p>The create index API allows to provide a set of one or more mappings:</p><pre class="programlisting prettyprint lang-js">curl -XPOST localhost:9200/test -d '{
    "settings" : {
        "number_of_shards" : 1
    },
    "mappings" : {
        "type1" : {
            "_source" : { "enabled" : false },
            "properties" : {
                "field1" : { "type" : "string", "index" : "not_analyzed" }
            }
        }
    }
}'</pre><h3><a id="warmers"></a>Warmers</h3><p>The create index API allows also to provide a set of <a class="link" href="#indices-warmers" title="Warmers">warmers</a>:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test -d '{
    "warmers" : {
        "warmer_1" : {
            "source" : {
                "query" : {
                    ...
                }
            }
        }
    }
}'</pre><h3><a id="create-index-aliases"></a>Aliases</h3><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.1.0.</p></div></div><p>The create index API allows also to provide a set of <a class="link" href="#indices-aliases" title="Index Aliases">aliases</a>:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test -d '{
    "aliases" : {
        "alias_1" : {},
        "alias_2" : {
            "filter" : {
                "term" : {"user" : "kimchy" }
            },
            "routing" : "kimchy"
        }
    }
}'</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-delete-index"></a>Delete Index</h2></div></div></div><p>The delete index API allows to delete an existing index.</p><pre class="programlisting prettyprint lang-js">$ curl -XDELETE 'http://localhost:9200/twitter/'</pre><p>The above example deletes an index called <code class="literal">twitter</code>. Specifying an index,
alias or wildcard expression is required.</p><p>The delete index API can also be applied to more than one index, or on
all indices (be careful!) by using <code class="literal">_all</code> or <code class="literal">*</code> as index.</p><p>In order to disable allowing to delete indices via wildcards or <code class="literal">_all</code>,
set <code class="literal">action.destructive_requires_name</code> setting in the config to <code class="literal">true</code>.
This setting can also be changed via the cluster update settings api.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-exists"></a>Indices Exists</h2></div></div></div><p>Used to check if the index (indices) exists or not. For example:</p><pre class="programlisting prettyprint lang-js">curl -XHEAD 'http://localhost:9200/twitter'</pre><p>The HTTP status code indicates if the index exists or not. A <code class="literal">404</code> means
it does not exist, and <code class="literal">200</code> means it does.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-open-close"></a>Open / Close Index API</h2></div></div></div><p>The open and close index APIs allow to close an index, and later on
opening it. A closed index has almost no overhead on the cluster (except
for maintaining its metadata), and is blocked for read/write operations.
A closed index can be opened which will then go through the normal
recovery process.</p><p>The REST endpoint is <code class="literal">/{index}/_close</code> and <code class="literal">/{index}/_open</code>. For
example:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/my_index/_close'

curl -XPOST 'localhost:9200/my_index/_open'</pre><p>It is possible to open and close multiple indices. An error will be thrown
if the request explicitly refers to a missing index. This behaviour can be
disabled using the <code class="literal">ignore_unavailable=true</code> parameter.</p><p>All indices can be opened or closed at once using <code class="literal">_all</code> as the index name
or specifying patterns that identify them all (e.g. <code class="literal">*</code>).</p><p>Identifying indices via wildcards or <code class="literal">_all</code> can be disabled by setting the
<code class="literal">action.destructive_requires_name</code> flag in the config file to <code class="literal">true</code>.
This setting can also be changed via the cluster update settings api.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-put-mapping"></a>Put Mapping</h2></div></div></div><p>The put mapping API allows to register specific mapping definition for a
specific type.</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT 'http://localhost:9200/twitter/tweet/_mapping' -d '
{
    "tweet" : {
        "properties" : {
            "message" : {"type" : "string", "store" : true }
        }
    }
}
'</pre><p>The above example creates a mapping called <code class="literal">tweet</code> within the <code class="literal">twitter</code>
index. The mapping simply defines that the <code class="literal">message</code> field should be
stored (by default, fields are not stored, just indexed) so we can
retrieve it later on using selective loading.</p><p>More information on how to define type mappings can be found in the
<a class="link" href="#mapping" title="Mapping">mapping</a> section.</p><h3><a id="merging-conflicts"></a>Merging &amp; Conflicts</h3><p>When an existing mapping already exists under the given type, the two
mapping definitions, the one already defined, and the new ones are
merged. The <code class="literal">ignore_conflicts</code> parameters can be used to control if
conflicts should be ignored or not, by default, it is set to <code class="literal">false</code>
which means conflicts are <span class="strong"><strong>not</strong></span> ignored.</p><p>The definition of conflict is really dependent on the type merged, but
in general, if a different core type is defined, it is considered as a
conflict. New mapping definitions can be added to object types, and core
type mappings can be upgraded by specifying multi fields on a core type.</p><h3><a id="put-mapping-multi-index"></a>Multi Index</h3><p>The put mapping API can be applied to more than one index with a single
call, or even on <code class="literal">_all</code> the indices.</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT 'http://localhost:9200/kimchy,elasticsearch/tweet/_mapping' -d '
{
    "tweet" : {
        "properties" : {
            "message" : {"type" : "string", "store" : true }
        }
    }
}
'</pre><p>All options:</p><pre class="programlisting prettyprint lang-js">PUT /{index}/_mapping/{type}</pre><p>where</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">{index}</code>
</p>
</td><td valign="top">
<p>
<code class="literal">blank | * | _all | glob pattern | name1, name2, â¦</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">{type}</code>
</p>
</td><td valign="top">
<p>
Name of the type to add. Must be the name of the type defined in the body.
</p>
</td></tr></tbody></table></div><p>Instead of <code class="literal">_mapping</code> you can also use the plural <code class="literal">_mappings</code>.
The uri <code class="literal">PUT /{index}/{type}/_mapping</code> is still supported for backwardscompatibility.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-get-mapping"></a>Get Mapping</h2></div></div></div><p>The get mapping API allows to retrieve mapping definitions for an index or
index/type.</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/_mapping'</pre><h3><a id="_multiple_indices_and_types"></a>Multiple Indices and Types</h3><p>The get mapping API can be used to get more than one index or type
mapping with a single call. General usage of the API follows the
following syntax: <code class="literal">host:port/{index}/{type}/_mapping</code> where both
<code class="literal">{index}</code> and <code class="literal">{type}</code> can accept a comma-separated list of names. To
get mappings for all indices you can use <code class="literal">_all</code> for <code class="literal">{index}</code>. The
following are some examples:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter,kimchy/_mapping'

curl -XGET 'http://localhost:9200/_all/tweet,book/_mapping'</pre><p>If you want to get mappings of all indices and types then the following
two examples are equivalent:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/_all/_mapping'

curl -XGET 'http://localhost:9200/_mapping'</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-get-field-mapping"></a>Get Field Mapping</h2></div></div></div><p>The get field mapping API allows you to retrieve mapping definitions for one or more fields.
This is useful when you do not need the complete type mapping returned by
the <a class="xref" href="#indices-get-mapping" title="Get Mapping"><em>Get Mapping</em></a> API.</p><p>The following returns the mapping of the field <code class="literal">text</code> only:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/tweet/_mapping/field/text'</pre><p>For which the response is (assuming <code class="literal">text</code> is a default string field):</p><pre class="programlisting prettyprint lang-js">{
   "twitter": {
      "tweet": {
         "text": {
            "full_name": "text",
            "mapping": {
               "text": { "type": "string" }
            }
         }
      }
   }
}</pre><h3><a id="_multiple_indices_types_and_fields"></a>Multiple Indices, Types and Fields</h3><p>The get field mapping API can be used to get the mapping of multiple fields from more than one index or type
with a single call. General usage of the API follows the
following syntax: <code class="literal">host:port/{index}/{type}/_mapping/field/{field}</code> where
<code class="literal">{index}</code>, <code class="literal">{type}</code> and <code class="literal">{field}</code> can stand for comma-separated list of names or wild cards. To
get mappings for all indices you can use <code class="literal">_all</code> for <code class="literal">{index}</code>. The
following are some examples:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter,kimchy/_mapping/field/message'

curl -XGET 'http://localhost:9200/_all/tweet,book/_mapping/field/message,user.id'

curl -XGET 'http://localhost:9200/_all/tw*/_mapping/field/*.id'</pre><h3><a id="_specifying_fields"></a>Specifying fields</h3><p>The get mapping api allows you to specify one or more fields separated with by a comma.
You can also use wildcards. The field names can be any of the following:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
Full names
</p>
</td><td valign="top">
<p>
the full path, including any parent object name the field is
   part of (ex. <code class="literal">user.id</code>).
</p>
</td></tr><tr><td valign="top">
<p>
Index names
</p>
</td><td valign="top">
<p>
the name of the lucene field (can be different than the
   field name if the <code class="literal">index_name</code> option of the mapping is used).
</p>
</td></tr><tr><td valign="top">
<p>
Field names
</p>
</td><td valign="top">
<p>
the name of the field without the path to it (ex. <code class="literal">id</code> for <code class="literal">{ "user" : { "id" : 1 } }</code>).
</p>
</td></tr></tbody></table></div><p>The above options are specified in the order the <code class="literal">field</code> parameter is resolved.
The first field found which matches is returned. This is especially important
if index names or field names are used as those can be ambiguous.</p><p>For example, consider the following mapping:</p><pre class="programlisting prettyprint lang-js"> {
     "article": {
         "properties": {
             "id": { "type": "string" },
             "title":  { "type": "string", "index_name": "text" },
             "abstract": { "type": "string", "index_name": "text" },
             "author": {
                 "properties": {
                     "id": { "type": "string" },
                     "name": { "type": "string", "index_name": "author" }
                 }
             }
         }
     }
 }</pre><p>To select the <code class="literal">id</code> of the <code class="literal">author</code> field, you can use its full name <code class="literal">author.id</code>. Using <code class="literal">text</code> will return
the mapping of <code class="literal">abstract</code> as it is one of the fields which map to the Lucene field <code class="literal">text</code>. <code class="literal">name</code> will return
the field <code class="literal">author.name</code>:</p><pre class="programlisting prettyprint lang-js">curl -XGET "http://localhost:9200/publications/article/_mapping/field/author.id,text,name"</pre><p>returns:</p><pre class="programlisting prettyprint lang-js">{
   "publications": {
      "article": {
         "text": {
            "full_name": "abstract",
            "mapping": {
               "abstract": { "type": "string", "index_name": "text" }
            }
         },
         "author.id": {
            "full_name": "author.id",
            "mapping": {
               "id": { "type": "string" }
            }
         },
         "name": {
            "full_name": "author.name",
            "mapping": {
               "name": { "type": "string", "index_name": "author" }
            }
         }
      }
   }
}</pre><p>Note how the response always use the same fields specified in the request as keys.
The <code class="literal">full_name</code> in every entry contains the full name of the field whose mapping were returned.
This is useful when the request can refer to to multiple fields (like <code class="literal">text</code> above).</p><h3><a id="_other_options"></a>Other options</h3><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
include_defaults
</p>
</td><td valign="top">
<p>
adding <code class="literal">include_defaults=true</code> to the query string will cause the response to
include default values, which are normally suppressed.
</p>
</td></tr></tbody></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-types-exists"></a>Types Exists</h2></div></div></div><p>Used to check if a type/types exists in an index/indices.</p><pre class="programlisting prettyprint lang-js">curl -XHEAD 'http://localhost:9200/twitter/tweet'</pre><p>The HTTP status code indicates if the type exists or not. A <code class="literal">404</code> means
it does not exist, and <code class="literal">200</code> means it does.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-delete-mapping"></a>Delete Mapping</h2></div></div></div><p>Allow to delete a mapping (type) along with its data. The REST endpoints are</p><pre class="programlisting prettyprint lang-js">[DELETE] /{index}/{type}

[DELETE] /{index}/{type}/_mapping

[DELETE] /{index}/_mapping/{type}</pre><p>where</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">index</code>
</p>
</td><td valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, â¦</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">type</code>
</p>
</td><td valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, â¦</code>
</p>
</td></tr></tbody></table></div><p>Note, most times, it make more sense to reindex the data into a fresh
index compared to delete large chunks of it.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-aliases"></a>Index Aliases</h2></div></div></div><p>APIs in elasticsearch accept an index name when working against a
specific index, and several indices when applicable. The index aliases
API allow to alias an index with a name, with all APIs automatically
converting the alias name to the actual index name. An alias can also be
mapped to more than one index, and when specifying it, the alias will
automatically expand to the aliases indices. An alias can also be
associated with a filter that will automatically be applied when
searching, and routing values.</p><p>Here is a sample of associating the alias <code class="literal">alias1</code> with index <code class="literal">test1</code>:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        { "add" : { "index" : "test1", "alias" : "alias1" } }
    ]
}'</pre><p>An alias can also be removed, for example:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        { "remove" : { "index" : "test1", "alias" : "alias1" } }
    ]
}'</pre><p>Renaming an alias is a simple <code class="literal">remove</code> then <code class="literal">add</code> operation within the
same API. This operation is atomic, no need to worry about a short
period of time where the alias does not point to an index:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        { "remove" : { "index" : "test1", "alias" : "alias1" } },
        { "add" : { "index" : "test1", "alias" : "alias2" } }
    ]
}'</pre><p>Associating an alias with more than one index are simply several <code class="literal">add</code>
actions:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        { "add" : { "index" : "test1", "alias" : "alias1" } },
        { "add" : { "index" : "test2", "alias" : "alias1" } }
    ]
}'</pre><p>It is an error to index to an alias which points to more than one index.</p><h3><a id="filtered"></a>Filtered Aliases</h3><p>Aliases with filters provide an easy way to create different "views" of
the same index. The filter can be defined using Query DSL and is applied
to all Search, Count, Delete By Query and More Like This operations with
this alias. Here is an example:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        {
            "add" : {
                 "index" : "test1",
                 "alias" : "alias2",
                 "filter" : { "term" : { "user" : "kimchy" } }
            }
        }
    ]
}'</pre><h4><a id="aliases-routing"></a>Routing</h4><p>It is possible to associate routing values with aliases. This feature
can be used together with filtering aliases in order to avoid
unnecessary shard operations.</p><p>The following command creates a new alias <code class="literal">alias1</code> that points to index
<code class="literal">test</code>. After <code class="literal">alias1</code> is created, all operations with this alias are
automatically modified to use value <code class="literal">1</code> for routing:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        {
            "add" : {
                 "index" : "test",
                 "alias" : "alias1",
                 "routing" : "1"
            }
        }
    ]
}'</pre><p>Itâs also possible to specify different routing values for searching
and indexing operations:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        {
            "add" : {
                 "index" : "test",
                 "alias" : "alias2",
                 "search_routing" : "1,2",
                 "index_routing" : "2"
            }
        }
    ]
}'</pre><p>As shown in the example above, search routing may contain several values
separated by comma. Index routing can contain only a single value.</p><p>If an operation that uses routing alias also has a routing parameter, an
intersection of both alias routing and routing specified in the
parameter is used. For example the following command will use "2" as a
routing value:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/alias2/_search?q=user:kimchy&amp;routing=2,3'</pre><h3><a id="alias-adding"></a>Add a single alias</h3><p>An alias can also be added with the endpoint</p><p><code class="literal">PUT /{index}/_alias/{name}</code></p><p>where</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">index</code>
</p>
</td><td valign="top">
<p>
The index the alias refers to. Can be any of <code class="literal">blank | * | _all | glob pattern | name1, name2, â¦</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">name</code>
</p>
</td><td valign="top">
<p>
The name of the alias. This is a required option.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">routing</code>
</p>
</td><td valign="top">
<p>
An optional routing that can be associated with an alias.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">filter</code>
</p>
</td><td valign="top">
<p>
An optional filter that can be associated with an alias.
</p>
</td></tr></tbody></table></div><p>You can also use the plural <code class="literal">_aliases</code>.</p><h4><a id="_examples"></a>Examples:</h4><p>Adding time based alias:</p><pre class="programlisting prettyprint lang-js">curl -XPUT 'localhost:9200/logs_201305/_alias/2013'</pre><p>Adding user alias:</p><pre class="programlisting prettyprint lang-js">curl -XPUT 'localhost:9200/users/_alias/user_12' -d '{
    "routing" : "12",
    "filter" : {
        "term" : {
            "user_id" : 12
        }
    }
}'</pre><h3><a id="alias-index-creation"></a>Aliases during index creation</h3><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.1.0.</p></div></div><p>Aliases can also be specified during <a class="link" href="#create-index-aliases" title="Aliases">index creation</a>:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/logs_20142801 -d '{
    "aliases" : {
        "current_day" : {},
        "2014" : {
            "filter" : {
                "term" : {"year" : 2014 }
            }
        }
    }
}'</pre><h3><a id="deleting"></a>Delete aliases</h3><p>The rest endpoint is: <code class="literal">/{index}/_alias/{name}</code></p><p>where</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">index</code>
</p>
</td><td valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, â¦</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">name</code>
</p>
</td><td valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, â¦</code>
</p>
</td></tr></tbody></table></div><p>Alternatively you can use the plural <code class="literal">_aliases</code>. Example:</p><pre class="programlisting prettyprint lang-js">curl -XDELETE 'localhost:9200/users/_alias/user_12'</pre><h3><a id="alias-retrieving"></a>Retrieving existing aliases</h3><p>The get index alias api allows to filter by
alias name and index name. This api redirects to the master and fetches
the requested index aliases, if available. This api only serialises the
found index aliases.</p><p>Possible options:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">index</code>
</p>
</td><td valign="top">
<p>
    The index name to get aliases for. Partially names are
    supported via wildcards, also multiple index names can be specified
    separated with a comma. Also the alias name for an index can be used.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">alias</code>
</p>
</td><td valign="top">
<p>
    The name of alias to return in the response. Like the index
    option, this option supports wildcards and the option the specify
    multiple alias names separated by a comma.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">ignore_unavailable</code>
</p>
</td><td valign="top">
<p>
    What to do is an specified index name doesnât
    exist. If set to <code class="literal">true</code> then those indices are ignored.
</p>
</td></tr></tbody></table></div><p>The rest endpoint is: <code class="literal">/{index}/_alias/{alias}</code>.</p><h4><a id="_examples_2"></a>Examples:</h4><p>All aliases for the index users:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/users/_alias/*'</pre><p>Response:</p><pre class="programlisting prettyprint lang-js"> {
  "users" : {
    "aliases" : {
      "user_13" : {
        "filter" : {
          "term" : {
            "user_id" : 13
          }
        },
        "index_routing" : "13",
        "search_routing" : "13"
      },
      "user_14" : {
        "filter" : {
          "term" : {
            "user_id" : 14
          }
        },
        "index_routing" : "14",
        "search_routing" : "14"
      },
      "user_12" : {
        "filter" : {
          "term" : {
            "user_id" : 12
          }
        },
        "index_routing" : "12",
        "search_routing" : "12"
      }
    }
  }
}</pre><p>All aliases with the name 2013 in any index:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/_alias/2013'</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
  "logs_201304" : {
    "aliases" : {
      "2013" : { }
    }
  },
  "logs_201305" : {
    "aliases" : {
      "2013" : { }
    }
  }
}</pre><p>All aliases that start with 2013_01 in any index:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/_alias/2013_01*'</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
  "logs_20130101" : {
    "aliases" : {
      "2013_01" : { }
    }
  }
}</pre><p>There is also a HEAD variant of the get indices aliases api to check if
index aliases exist. The indices aliases exists api supports the same
option as the get indices aliases api. Examples:</p><pre class="programlisting prettyprint lang-js">curl -XHEAD 'localhost:9200/_alias/2013'
curl -XHEAD 'localhost:9200/_alias/2013_01*'
curl -XHEAD 'localhost:9200/users/_alias/*'</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-update-settings"></a>Update Indices Settings</h2></div></div></div><p>Change specific index level settings in real time.</p><p>The REST endpoint is <code class="literal">/_settings</code> (to update all indices) or
<code class="literal">{index}/_settings</code> to update one (or more) indices settings. The body
of the request includes the updated settings, for example:</p><pre class="programlisting prettyprint lang-js">{
    "index" : {
        "number_of_replicas" : 4
    } }</pre><p>The above will change the number of replicas to 4 from the current
number of replicas. Here is a curl example:</p><pre class="programlisting prettyprint lang-js">curl -XPUT 'localhost:9200/my_index/_settings' -d '
{
    "index" : {
        "number_of_replicas" : 4
    } }
'</pre><p>Below is the list of settings that can be changed using the update
settings API:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">index.number_of_replicas</code>
</span></dt><dd>
    The number of replicas each shard has.
</dd><dt><span class="term">
<code class="literal">index.auto_expand_replicas</code>
</span></dt><dd>
    Set to an actual value (like <code class="literal">0-all</code>) or <code class="literal">false</code> to disable it.
</dd><dt><span class="term">
<code class="literal">index.blocks.read_only</code>
</span></dt><dd>
    Set to <code class="literal">true</code> to have the index read only, <code class="literal">false</code> to allow writes
    and metadata changes.
</dd><dt><span class="term">
<code class="literal">index.blocks.read</code>
</span></dt><dd>
    Set to <code class="literal">true</code> to disable read operations againstthe index.
</dd><dt><span class="term">
<code class="literal">index.blocks.write</code>
</span></dt><dd>
    Set to <code class="literal">true</code> to disable write operations against the index.
</dd><dt><span class="term">
<code class="literal">index.blocks.metadata</code>
</span></dt><dd>
    Set to <code class="literal">true</code> to disable metadata operations against the index.
</dd><dt><span class="term">
<code class="literal">index.refresh_interval</code>
</span></dt><dd>
    The async refresh interval of a shard.
</dd><dt><span class="term">
<code class="literal">index.index_concurrency</code>
</span></dt><dd>
    Defaults to <code class="literal">8</code>.
</dd><dt><span class="term">
<code class="literal">index.codec</code>
</span></dt><dd>
    Codec. Default to <code class="literal">default</code>.
</dd><dt><span class="term">
<code class="literal">index.codec.bloom.load</code>
</span></dt><dd>
    Whether to load the bloom filter. Defaults to <code class="literal">true</code>.
    See <a class="xref" href="#bloom-postings" title="Bloom filter posting format">the section called âBloom filter posting formatâ</a>.
</dd><dt><span class="term">
<code class="literal">index.fail_on_merge_failure</code>
</span></dt><dd>
    Default to <code class="literal">true</code>.
</dd><dt><span class="term">
<code class="literal">index.translog.flush_threshold_ops</code>
</span></dt><dd>
    When to flush based on operations.
</dd><dt><span class="term">
<code class="literal">index.translog.flush_threshold_size</code>
</span></dt><dd>
    When to flush based on translog (bytes) size.
</dd><dt><span class="term">
<code class="literal">index.translog.flush_threshold_period</code>
</span></dt><dd>
    When to flush based on a period of not flushing.
</dd><dt><span class="term">
<code class="literal">index.translog.disable_flush</code>
</span></dt><dd>
    Disables flushing. Note, should be set for a short
    interval and then enabled.
</dd><dt><span class="term">
<code class="literal">index.cache.filter.max_size</code>
</span></dt><dd>
    The maximum size of filter cache (per segment in shard).
    Set to <code class="literal">-1</code> to disable.
</dd><dt><span class="term">
<code class="literal">index.cache.filter.expire</code>
</span></dt><dd>
    The expire after access time for filter cache.
    Set to <code class="literal">-1</code> to disable.
</dd><dt><span class="term">
<code class="literal">index.gateway.snapshot_interval</code>
</span></dt><dd>
    The gateway snapshot interval (only applies to shared gateways).
    Defaults to 10s.
</dd><dt><span class="term">
<a class="link" href="#index-modules-merge" title="Merge">merge policy</a>
</span></dt><dd>
    All the settings for the merge policy currently configured.
    A different merge policy canât be set.
</dd><dt><span class="term">
<code class="literal">index.routing.allocation.include.*</code>
</span></dt><dd>
    A node matching any rule will be allowed to host shards from the index.
</dd><dt><span class="term">
<code class="literal">index.routing.allocation.exclude.*</code>
</span></dt><dd>
    A node matching any rule will NOT be allowed to host shards from the index.
</dd><dt><span class="term">
<code class="literal">index.routing.allocation.require.*</code>
</span></dt><dd>
    Only nodes matching all rules will be allowed to host shards from the index.
</dd><dt><span class="term">
<code class="literal">index.routing.allocation.disable_allocation</code>
</span></dt><dd>
    Disable allocation. Defaults to <code class="literal">false</code>. Deprecated in favour for <code class="literal">index.routing.allocation.enable</code>.
</dd><dt><span class="term">
<code class="literal">index.routing.allocation.disable_new_allocation</code>
</span></dt><dd>
    Disable new allocation. Defaults to <code class="literal">false</code>. Deprecated in favour for <code class="literal">index.routing.allocation.enable</code>.
</dd><dt><span class="term">
<code class="literal">index.routing.allocation.disable_replica_allocation</code>
</span></dt><dd>
    Disable replica allocation. Defaults to <code class="literal">false</code>. Deprecated in favour for <code class="literal">index.routing.allocation.enable</code>.
</dd></dl></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.0.0.RC1.</p></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">index.routing.allocation.enable</code>
</span></dt><dd><p class="simpara">
    Enables shard allocation for a specific index. It can be set to:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">all</code> (default) - Allows shard allocation for all shards.
</li><li class="listitem">
<code class="literal">primaries</code> - Allows shard allocation only for primary shards.
</li><li class="listitem">
<code class="literal">new_primaries</code> - Allows shard allocation only for primary shards for new indices.
</li><li class="listitem">
<code class="literal">none</code> - No shard allocation is allowed.
</li></ul></div></dd><dt><span class="term">
<code class="literal">index.routing.allocation.total_shards_per_node</code>
</span></dt><dd>
    Controls the total number of shards allowed to be allocated on a single node. Defaults to unbounded (<code class="literal">-1</code>).
</dd><dt><span class="term">
<code class="literal">index.recovery.initial_shards</code>
</span></dt><dd><p class="simpara">
    When using local gateway a particular shard is recovered only if there can be allocated quorum shards in the cluster. It can be set to:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">quorum</code> (default)
</li><li class="listitem">
<code class="literal">quorum-1</code> (or <code class="literal">half</code>)
</li><li class="listitem">
<code class="literal">full</code>
</li><li class="listitem">
<code class="literal">full-1</code>.
</li><li class="listitem">
Number values are also supported, e.g. <code class="literal">1</code>.
</li></ul></div></dd><dt><span class="term">
<code class="literal">index.gc_deletes</code>
, </span><span class="term">
<code class="literal">index.ttl.disable_purge</code>
</span></dt><dd>
    Disables temporarily the purge of expired docs.
</dd><dt><span class="term">
<a class="link" href="#index-modules-store" title="Store">store level throttling</a>
</span></dt><dd>
    All the settings for the store level throttling policy currently configured.
</dd><dt><span class="term">
<code class="literal">index.translog.fs.type</code>
</span></dt><dd>
    Either <code class="literal">simple</code> or <code class="literal">buffered</code> (default).
</dd><dt><span class="term">
<code class="literal">index.compound_format</code>
</span></dt><dd>
    See <a class="link" href="#index-compound-format"><code class="literal">index.compound_format</code></a> in
    <a class="xref" href="#index-modules-settings" title="Index Settings">the section called âIndex Settingsâ</a>.
</dd><dt><span class="term">
<code class="literal">index.compound_on_flush</code>
</span></dt><dd>
    See <a class="link" href="#index-compound-on-flush">`index.compound_on_flush</a> in
    <a class="xref" href="#index-modules-settings" title="Index Settings">the section called âIndex Settingsâ</a>.
</dd><dt><span class="term">
<a class="xref" href="#index-modules-slowlog" title="Index Slow Log"><em>Index Slow Log</em></a>
</span></dt><dd>
    All the settings for slow log.
</dd><dt><span class="term">
<code class="literal">index.warmer.enabled</code>
</span></dt><dd>
    See <a class="xref" href="#indices-warmers" title="Warmers"><em>Warmers</em></a>. Defaults to <code class="literal">true</code>.
</dd></dl></div><h3><a id="bulk"></a>Bulk Indexing Usage</h3><p>For example, the update settings API can be used to dynamically change
the index from being more performant for bulk indexing, and then move it
to more real time indexing state. Before the bulk indexing is started,
use:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test/_settings -d '{
    "index" : {
        "refresh_interval" : "-1"
    } }'</pre><p>(Another optimization option is to start the index without any replicas,
and only later adding them, but that really depends on the use case).</p><p>Then, once bulk indexing is done, the settings can be updated (back to
the defaults for example):</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test/_settings -d '{
    "index" : {
        "refresh_interval" : "1s"
    } }'</pre><p>And, an optimize should be called:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'http://localhost:9200/test/_optimize?max_num_segments=5'</pre><h3><a id="update-settings-analysis"></a>Updating Index Analysis</h3><p>It is also possible to define new <a class="link" href="#analysis" title="Analysis">analyzers</a> for the index.
But it is required to <a class="link" href="#indices-open-close" title="Open / Close Index API">close</a> the index
first and <a class="link" href="#indices-open-close" title="Open / Close Index API">open</a> it after the changes are made.</p><p>For example if <code class="literal">content</code> analyzer hasnât been defined on <code class="literal">myindex</code> yet
you can use the following commands to add it:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/myindex/_close'

curl -XPUT 'localhost:9200/myindex/_settings' -d '{
  "analysis" : {
    "analyzer":{
      "content":{
        "type":"custom",
        "tokenizer":"whitespace"
      }
    }
  }
}'

curl -XPOST 'localhost:9200/myindex/_open'</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-get-settings"></a>Get Settings</h2></div></div></div><p>The get settings API allows to retrieve settings of index/indices:</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/twitter/_settings'</pre><h3><a id="_multiple_indices_and_types_2"></a>Multiple Indices and Types</h3><p>The get settings API can be used to get settings for more than one index
with a single call. General usage of the API follows the
following syntax: <code class="literal">host:port/{index}/_settings</code> where
<code class="literal">{index}</code> can stand for comma-separated list of index names and aliases. To
get settings for all indices you can use <code class="literal">_all</code> for <code class="literal">{index}</code>.
Wildcard expressions are also supported. The following are some examples:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter,kimchy/_settings'

curl -XGET 'http://localhost:9200/_all/_settings'

curl -XGET 'http://localhost:9200/2013-*/_settings'</pre><h3><a id="_prefix_option"></a>Prefix option</h3><p>There is also support for a <code class="literal">prefix</code> query string option
that allows to include only settings matches the specified prefix.</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/my-index/_settings?prefix=index.'

curl -XGET 'http://localhost:9200/_all/_settings?prefix=index.routing.allocation.'

curl -XGET 'http://localhost:9200/2013-*/_settings?name=index.merge.*'

curl -XGET 'http://localhost:9200/2013-*/_settings/index.merge.*'</pre><p>The first example returns all index settings the start with <code class="literal">index.</code> in the index <code class="literal">my-index</code>,
the second example gets all index settings that start with <code class="literal">index.routing.allocation.</code> for
all indices, lastly the third example returns all index settings that start with <code class="literal">index.merge.</code>
in indices that start with <code class="literal">2013-</code>.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-analyze"></a>Analyze</h2></div></div></div><p>Performs the analysis process on a text and return the tokens breakdown
of the text.</p><p>Can be used without specifying an index against one of the many built in
analyzers:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/_analyze?analyzer=standard' -d 'this is a test'</pre><p>Or by building a custom transient analyzer out of tokenizers,
token filters and char filters. Token filters can use the shorter <span class="emphasis"><em>filters</em></span>
parameter name:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/_analyze?tokenizer=keyword&amp;filters=lowercase' -d 'this is a test'

curl -XGET 'localhost:9200/_analyze?tokenizer=keyword&amp;token_filters=lowercase&amp;char_filters=html_strip' -d 'this is a &lt;b&gt;test&lt;/b&gt;'</pre><p>It can also run against a specific index:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/test/_analyze?text=this+is+a+test'</pre><p>The above will run an analysis on the "this is a test" text, using the
default index analyzer associated with the <code class="literal">test</code> index. An <code class="literal">analyzer</code>
can also be provided to use a different analyzer:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/test/_analyze?analyzer=whitespace' -d 'this is a test'</pre><p>Also, the analyzer can be derived based on a field mapping, for example:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9200/test/_analyze?field=obj1.field1' -d 'this is a test'</pre><p>Will cause the analysis to happen based on the analyzer configured in the
mapping for <code class="literal">obj1.field1</code> (and if not, the default index analyzer).</p><p>Also, the text can be provided as part of the request body, and not as a
parameter.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-templates"></a>Index Templates</h2></div></div></div><p>Index templates allow to define templates that will automatically be
applied to new indices created. The templates include both settings and
mappings, and a simple pattern template that controls if the template
will be applied to the index created. For example:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/_template/template_1 -d '
{
    "template" : "te*",
    "settings" : {
        "number_of_shards" : 1
    },
    "mappings" : {
        "type1" : {
            "_source" : { "enabled" : false }
        }
    }
}
'</pre><p>Defines a template named template_1, with a template pattern of <code class="literal">te*</code>.
The settings and mappings will be applied to any index name that matches
the <code class="literal">te*</code> template.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.1.0.</p></div></div><p>It is also possible to include aliases in an index template as follows:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/_template/template_1 -d '
{
    "template" : "te*",
    "settings" : {
        "number_of_shards" : 1
    },
    "aliases" : {
        "alias1" : {},
        "alias2" : {
            "filter" : {
                "term" : {"user" : "kimchy" }
            },
            "routing" : "kimchy"
        },
        "{index}-alias" : {} <a id="CO23-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    }
}
'</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO23-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
the <code class="literal">{index}</code> placeholder within the alias name will be replaced with the
actual index name that the template gets applied to during index creation.
</p></td></tr></table></div><h3><a id="delete"></a>Deleting a Template</h3><p>Index templates are identified by a name (in the above case
<code class="literal">template_1</code>) and can be deleted as well:</p><pre class="programlisting prettyprint lang-js">curl -XDELETE localhost:9200/_template/template_1</pre><h3><a id="getting"></a>GETting templates</h3><p>Index templates are identified by a name (in the above case
<code class="literal">template_1</code>) and can be retrieved using the following:</p><pre class="programlisting prettyprint lang-js">curl -XGET localhost:9200/_template/template_1</pre><p>You can also match several templates by using wildcards like:</p><pre class="programlisting prettyprint lang-js">curl -XGET localhost:9200/_template/temp*
curl -XGET localhost:9200/_template/template_1,template_2</pre><p>To get list of all index templates you can use
<a class="link" href="#cluster-state" title="Cluster State">Cluster State</a> API
and check for the metadata/templates section of the response.</p><p>Or run:</p><pre class="programlisting prettyprint lang-js">curl -XGET localhost:9200/_template/</pre><h3><a id="multiple-templates"></a>Multiple Template Matching</h3><p>Multiple index templates can potentially match an index, in this case,
both the settings and mappings are merged into the final configuration
of the index. The order of the merging can be controlled using the
<code class="literal">order</code> parameter, with lower order being applied first, and higher
orders overriding them. For example:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/_template/template_1 -d '
{
    "template" : "*",
    "order" : 0,
    "settings" : {
        "number_of_shards" : 1
    },
    "mappings" : {
        "type1" : {
            "_source" : { "enabled" : false }
        }
    }
}
'

curl -XPUT localhost:9200/_template/template_2 -d '
{
    "template" : "te*",
    "order" : 1,
    "settings" : {
        "number_of_shards" : 1
    },
    "mappings" : {
        "type1" : {
            "_source" : { "enabled" : true }
        }
    }
}
'</pre><p>The above will disable storing the <code class="literal">_source</code> on all <code class="literal">type1</code> types, but
for indices of that start with <code class="literal">te*</code>, source will still be enabled.
Note, for mappings, the merging is "deep", meaning that specific
object/property based mappings can easily be added/overridden on higher
order templates, with lower order templates providing the basis.</p><h3><a id="config"></a>Config</h3><p>Index templates can also be placed within the config location
(<code class="literal">path.conf</code>) under the <code class="literal">templates</code> directory (note, make sure to place
them on all master eligible nodes). For example, a file called
<code class="literal">template_1.json</code> can be placed under <code class="literal">config/templates</code> and it will be
added if it matches an index. Here is a sample of the mentioned file:</p><pre class="programlisting prettyprint lang-js">{
    "template_1" : {
        "template" : "*",
        "settings" : {
            "index.number_of_shards" : 2
        },
        "mappings" : {
            "_default_" : {
                "_source" : {
                    "enabled" : false
                }
            },
            "type1" : {
                "_all" : {
                    "enabled" : false
                }
            }
        }
    }
}</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-warmers"></a>Warmers</h2></div></div></div><p>Index warming allows to run registered search requests to warm up the
index before it is available for search. With the near real time aspect
of search, cold data (segments) will be warmed up before they become
available for search.</p><p>Warmup searches typically include requests that require heavy loading of
data, such as faceting or sorting on specific fields. The warmup APIs
allows to register warmup (search) under specific names, remove them,
and get them.</p><p>Index warmup can be disabled by setting <code class="literal">index.warmer.enabled</code> to
<code class="literal">false</code>. It is supported as a realtime setting using update settings
API. This can be handy when doing initial bulk indexing: disable pre
registered warmers to make indexing faster and less expensive and then
enable it.</p><h3><a id="creation"></a>Index Creation / Templates</h3><p>Warmers can be registered when an index gets created, for example:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test -d '{
    "warmers" : {
        "warmer_1" : {
            "types" : [],
            "source" : {
                "query" : {
                    ...
                },
                "facets" : {
                    ...
                }
            }
        }
    }
}'</pre><p>Or, in an index template:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/_template/template_1 -d '
{
    "template" : "te*",
    "warmers" : {
        "warmer_1" : {
            "types" : [],
            "source" : {
                "query" : {
                    ...
                },
                "facets" : {
                    ...
                }
            }
        }
    }
}'</pre><h3><a id="warmer-adding"></a>Put Warmer</h3><p>Allows to put a warmup search request on a specific index (or indices),
with the body composing of a regular search request. Types can be
provided as part of the URI if the search request is designed to be run
only against the specific types.</p><p>Here is an example that registers a warmup called <code class="literal">warmer_1</code> against
index <code class="literal">test</code> (can be alias or several indices), for a search request
that runs against all types:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test/_warmer/warmer_1 -d '{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "facet_1" : {
            "terms" : {
                "field" : "field"
            }
        }
    }
}'</pre><p>And an example that registers a warmup against specific types:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test/type1/_warmer/warmer_1 -d '{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "facet_1" : {
            "terms" : {
                "field" : "field"
            }
        }
    }
}'</pre><p>All options:</p><pre class="programlisting prettyprint lang-js">PUT _warmer/{warmer_name}

PUT /{index}/_warmer/{warmer_name}

PUT /{index}/{type}/_warmer/{warmer_name}</pre><p>where</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">{index}</code>
</p>
</td><td valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, â¦</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">{type}</code>
</p>
</td><td valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, â¦</code>
</p>
</td></tr></tbody></table></div><p>Instead of <code class="literal">_warmer</code> you can also use the plural <code class="literal">_warmers</code>.</p><h3><a id="removing"></a>Delete Warmers</h3><p>Warmers can be deleted using the following endpoint:</p><pre class="programlisting prettyprint lang-js">[DELETE] /{index}/_warmer/{name}</pre><p>where</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">{index}</code>
</p>
</td><td valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, â¦</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">{name}</code>
</p>
</td><td valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, â¦</code>
</p>
</td></tr></tbody></table></div><p>Instead of <code class="literal">_warmer</code> you can also use the plural <code class="literal">_warmers</code>.</p><h3><a id="warmer-retrieving"></a>GETting Warmer</h3><p>Getting a warmer for specific index (or alias, or several indices) based
on its name. The provided name can be a simple wildcard expression or
omitted to get all warmers. Some examples:</p><pre class="programlisting prettyprint lang-js"># get warmer named warmer_1 on test index
curl -XGET localhost:9200/test/_warmer/warmer_1

# get all warmers that start with warm on test index
curl -XGET localhost:9200/test/_warmer/warm*

# get all warmers for test index
curl -XGET localhost:9200/test/_warmer/</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-status"></a>Status</h2></div></div></div><p>The indices status API allows to get a comprehensive status information
of one or more indices.</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/twitter/_status'</pre><p>In order to see the recovery status of shards, pass <code class="literal">recovery</code> flag and
set it to <code class="literal">true</code>. For snapshot status, pass the <code class="literal">snapshot</code> flag and set
it to <code class="literal">true</code>.</p><h3><a id="_multi_index"></a>Multi Index</h3><p>The status API can be applied to more than one index with a single call,
or even on <code class="literal">_all</code> the indices.</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/kimchy,elasticsearch/_status'

curl -XGET 'http://localhost:9200/_status'</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-stats"></a>Indices Stats</h2></div></div></div><p>Indices level stats provide statistics on different operations happening
on an index. The API provides statistics on the index level scope
(though most stats can also be retrieved using node level scope).</p><p>The following returns high level aggregation and index level stats for
all indices:</p><pre class="programlisting prettyprint lang-js">curl localhost:9200/_stats</pre><p>Specific index stats can be retrieved using:</p><pre class="programlisting prettyprint lang-js">curl localhost:9200/index1,index2/_stats</pre><p>By default, all stats are returned, returning only specific stats can be
specified as well in the URI. Those stats can be any of:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">docs</code>
</p>
</td><td valign="top">
<p>
The number of docs / deleted docs (docs not yet merged out).
                                Note, affected by refreshing the index.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">store</code>
</p>
</td><td valign="top">
<p>
The size of the index.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">indexing</code>
</p>
</td><td valign="top">
<p>
Indexing statistics, can be combined with a comma
                                separated list of <code class="literal">types</code> to provide document type level stats.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">get</code>
</p>
</td><td valign="top">
<p>
Get statistics, including missing stats.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">search</code>
</p>
</td><td valign="top">
<p>
Search statistics. You can include statistics for custom groups by adding
                an extra <code class="literal">groups</code> parameter (search operations can be associated with one or more
                groups). The <code class="literal">groups</code> parameter accepts a comma separated list of group names.
                Use <code class="literal">_all</code> to return statistics for all groups.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">warmer</code>
</p>
</td><td valign="top">
<p>
Warmer statistics.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">merge</code>
</p>
</td><td valign="top">
<p>
Merge statistics.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">fielddata</code>
</p>
</td><td valign="top">
<p>
Fielddata statistics.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">flush</code>
</p>
</td><td valign="top">
<p>
Flush statistics.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">completion</code>
</p>
</td><td valign="top">
<p>
Completion suggest statistics.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">refresh</code>
</p>
</td><td valign="top">
<p>
Refresh statistics.
</p>
</td></tr></tbody></table></div><p>Some statistics allow per field granularity which accepts a list comma-separated list of included fields. By default all fields are included:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">fields</code>
</p>
</td><td valign="top">
<p>
List of fields to be included in the statistics. This is used as the default list unless a more specific field list is provided (see below).
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">completion_fields</code>
</p>
</td><td valign="top">
<p>
List of fields to be included in the Completion Suggest statistics
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">fielddata_fields</code>
</p>
</td><td valign="top">
<p>
List of fields to be included in the Fielddata statistics
</p>
</td></tr></tbody></table></div><p>Here are some samples:</p><pre class="programlisting prettyprint lang-js"># Get back stats for merge and refresh only for all indices
curl 'localhost:9200/_stats/merge,refresh'
# Get back stats for type1 and type2 documents for the my_index index
curl 'localhost:9200/my_index/_stats/indexing?types=type1,type2
# Get back just search stats for group1 and group2
curl 'localhost:9200/_stats/search?groups=group1,group2</pre><p>The stats returned are aggregated on the index level, with
<code class="literal">primaries</code> and <code class="literal">total</code> aggregations. In order to get back shard level
stats, set the <code class="literal">level</code> parameter to <code class="literal">shards</code>.</p><p>Note, as shards move around the cluster, their stats will be cleared as
they are created on other nodes. On the other hand, even though a shard
"left" a node, that node will still retain the stats that shard
contributed to.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-segments"></a>Indices Segments</h2></div></div></div><p>Provide low level segments information that a Lucene index (shard level)
is built with. Allows to be used to provide more information on the
state of a shard and an index, possibly optimization information, data
"wasted" on deletes, and so on.</p><p>Endpoints include segments for a specific index, several indices, or
all:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/test/_segments'
curl -XGET 'http://localhost:9200/test1,test2/_segments'
curl -XGET 'http://localhost:9200/_segments'</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
    ...
        "_3": {
            "generation": 3,
            "num_docs": 1121,
            "deleted_docs": 53,
            "size_in_bytes": 228288,
            "memory_in_bytes": 3211,
            "committed": true,
            "search": true,
            "version": "4.6",
            "compound": true
        }
    ...
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">
_0
</span></dt><dd>
The key of the JSON document is the name of the segment. This name
             is used to generate file names: all files starting with this
             segment name in the directory of the shard belong to this segment.
</dd><dt><span class="term">
generation
</span></dt><dd>
A generation number that is basically incremented when needing to
             write a new segment. The segment name is derived from this
             generation number.
</dd><dt><span class="term">
num_docs
</span></dt><dd>
The number of non-deleted documents that are stored in this segment.
</dd><dt><span class="term">
deleted_docs
</span></dt><dd>
The number of deleted documents that are stored in this segment.
             It is perfectly fine if this number is greater than 0, space is
             going to be reclaimed when this segment gets merged.
</dd><dt><span class="term">
size_in_bytes
</span></dt><dd>
The amount of disk space that this segment uses, in bytes.
</dd><dt><span class="term">
memory_in_bytes
</span></dt><dd>
Segments need to store some data into memory in order to be
             searchable efficiently. This number returns the number of bytes
             that are used for that purpose. A value of -1 indicates that
             Elasticsearch was not able to compute this number.
</dd><dt><span class="term">
committed
</span></dt><dd>
Whether the segment has been syncâed on disk. Segments that are
             committed would survive a hard reboot. No need to worry in case
             of false, the data from uncommitted segments is also stored in
             the transaction log so that Elasticsearch is able to replay
             changes on the next start.
</dd><dt><span class="term">
search
</span></dt><dd>
Whether the segment is searchable. A value of false would most
             likely mean that the segment has been written to disk but no
             refresh occurred since then to make it searchable.
</dd><dt><span class="term">
version
</span></dt><dd>
The version of Lucene that has been used to write this segment.
</dd><dt><span class="term">
compound
</span></dt><dd>
Whether the segment is stored in a compound file. When true, this
             means that Lucene merged all files from the segment in a single
             one in order to save file descriptors.
</dd></dl></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-recovery"></a>Indices Recovery</h2></div></div></div><p>The indices recovery API provides insight into on-going shard recoveries.
Recovery status may be reported for specific indices, or cluster-wide.</p><p>For example, the following command would show recovery information for the indices "index1" and "index2".</p><pre class="programlisting prettyprint lang-js">curl -XGET http://localhost:9200/index1,index2/_recovery?pretty=true</pre><p>To see cluster-wide recovery status simply leave out the index names.</p><pre class="programlisting prettyprint lang-js">curl -XGET http://localhost:9200/_recovery?pretty=true</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
  "index1" : {
    "shards" : [ {
      "id" : 0,
      "type" : "snapshot",
      "stage" : "index",
      "primary" : true,
      "start_time" : "2014-02-24T12:15:59.716",
      "stop_time" : 0,
      "total_time_in_millis" : 175576,
      "source" : {
        "repository" : "my_repository",
        "snapshot" : "my_snapshot",
        "index" : "index1"
      },
      "target" : {
        "id" : "ryqJ5lO5S4-lSFbGntkEkg",
        "hostname" : "my.fqdn",
        "ip" : "10.0.1.7",
        "name" : "my_es_node"
      },
      "index" : {
        "files" : {
          "total" : 73,
          "reused" : 0,
          "recovered" : 69,
          "percent" : "94.5%"
        },
        "bytes" : {
          "total" : 79063092,
          "reused" : 0,
          "recovered" : 68891939,
          "percent" : "87.1%"
        },
        "total_time_in_millis" : 0
      },
      "translog" : {
        "recovered" : 0,
        "total_time_in_millis" : 0
      },
      "start" : {
        "check_index_time" : 0,
        "total_time_in_millis" : 0
      }
    } ]
  }
}</pre><p>The above response shows a single index recovering a single shard. In this case, the source of the recovery is a snapshot repository
and the target of the recovery is the node with name "my_es_node".</p><p>Additionally, the output shows the number and percent of files recovered, as well as the number and percent of bytes recovered.</p><p>In some cases a higher level of detail may be preferable. Setting "detailed=true" will present a list of physical files in recovery.</p><pre class="programlisting prettyprint lang-js">curl -XGET http://localhost:9200/_recovery?pretty=true&amp;detailed=true</pre><p>Response:</p><pre class="programlisting prettyprint lang-js">{
  "index1" : {
    "shards" : [ {
      "id" : 0,
      "type" : "gateway",
      "stage" : "done",
      "primary" : true,
      "start_time" : "2014-02-24T12:38:06.349",
      "stop_time" : "2014-02-24T12:38:08.464",
      "total_time_in_millis" : 2115,
      "source" : {
        "id" : "RGMdRc-yQWWKIBM4DGvwqQ",
        "hostname" : "my.fqdn",
        "ip" : "10.0.1.7",
        "name" : "my_es_node"
      },
      "target" : {
        "id" : "RGMdRc-yQWWKIBM4DGvwqQ",
        "hostname" : "my.fqdn",
        "ip" : "10.0.1.7",
        "name" : "my_es_node"
      },
      "index" : {
        "files" : {
          "total" : 26,
          "reused" : 26,
          "recovered" : 26,
          "percent" : "100.0%",
          "details" : [ {
            "name" : "segments.gen",
            "length" : 20,
            "recovered" : 20
          }, {
            "name" : "_0.cfs",
            "length" : 135306,
            "recovered" : 135306
          }, {
            "name" : "segments_2",
            "length" : 251,
            "recovered" : 251
          },
           ...
          ]
        },
        "bytes" : {
          "total" : 26001617,
          "reused" : 26001617,
          "recovered" : 26001617,
          "percent" : "100.0%"
        },
        "total_time_in_millis" : 2
      },
      "translog" : {
        "recovered" : 71,
        "total_time_in_millis" : 2025
      },
      "start" : {
        "check_index_time" : 0,
        "total_time_in_millis" : 88
      }
    } ]
  }
}</pre><p>This response shows a detailed listing (truncated for brevity) of the actual files recovered and their sizes.</p><p>Also shown are the timings in milliseconds of the various stages of recovery: index retrieval, translog replay, and index start time.</p><p>Note that the above listing indicates that the recovery is in stage "done". All recoveries, whether on-going or complete, are kept in
cluster state and may be reported on at any time. Setting "active_only=true" will cause only on-going recoveries to be reported.</p><p>Here is a complete list of options:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">detailed</code>
</p>
</td><td valign="top">
<p>
Display a detailed view. This is primarily useful for viewing the recovery of physical index files. Default: false.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">active_only</code>
</p>
</td><td valign="top">
<p>
Display only those recoveries that are currently on-going. Default: false.
</p>
</td></tr></tbody></table></div><p>Description of output fields:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">id</code>
</p>
</td><td valign="top">
<p>
Shard ID
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">type</code>
</p>
</td><td valign="top">
<p>
Recovery type:
</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
gateway
</li><li class="listitem">
snapshot
</li><li class="listitem">
replica
</li><li class="listitem">
relocating
</li></ul></div>
</td></tr><tr><td valign="top">
<p>
<code class="literal">stage</code>
</p>
</td><td valign="top">
<p>
Recovery stage:
</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
init:     Recovery has not started
</li><li class="listitem">
index:    Reading index meta-data and copying bytes from source to destination
</li><li class="listitem">
start:    Starting the engine; opening the index for use
</li><li class="listitem">
translog: Replaying transaction log
</li><li class="listitem">
finalize: Cleanup
</li><li class="listitem">
done:     Complete
</li></ul></div>
</td></tr><tr><td valign="top">
<p>
<code class="literal">primary</code>
</p>
</td><td valign="top">
<p>
True if shard is primary, false otherwise
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">start_time</code>
</p>
</td><td valign="top">
<p>
Timestamp of recovery start
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">stop_time</code>
</p>
</td><td valign="top">
<p>
Timestamp of recovery finish
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">total_time_in_millis</code>
</p>
</td><td valign="top">
<p>
Total time to recover shard in milliseconds
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">source</code>
</p>
</td><td valign="top">
<p>
Recovery source:
</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
repository description if recovery is from a snapshot
</li><li class="listitem">
description of source node otherwise
</li></ul></div>
</td></tr><tr><td valign="top">
<p>
<code class="literal">target</code>
</p>
</td><td valign="top">
<p>
Destination node
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">index</code>
</p>
</td><td valign="top">
<p>
Statistics about physical index recovery
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">translog</code>
</p>
</td><td valign="top">
<p>
Statistics about translog recovery
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">start</code>
</p>
</td><td valign="top">
<p>
Statistics about time to open and start the index
</p>
</td></tr></tbody></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-clearcache"></a>Clear Cache</h2></div></div></div><p>The clear cache API allows to clear either all caches or specific cached
associated with one ore more indices.</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/twitter/_cache/clear'</pre><p>The API, by default, will clear all caches. Specific caches can be
cleaned explicitly by setting <code class="literal">filter</code>, <code class="literal">field_data</code> or <code class="literal">id_cache</code> to
<code class="literal">true</code>.</p><p>All caches relating to a specific field(s) can also be cleared by
specifying <code class="literal">fields</code> parameter with a comma delimited list of the
relevant fields.</p><h3><a id="_multi_index_2"></a>Multi Index</h3><p>The clear cache API can be applied to more than one index with a single
call, or even on <code class="literal">_all</code> the indices.</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/kimchy,elasticsearch/_cache/clear'

$ curl -XPOST 'http://localhost:9200/_cache/clear'</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The <code class="literal">filter</code> cache is not cleared immediately but is scheduled to be
cleared within 60 seconds.</p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-flush"></a>Flush</h2></div></div></div><p>The flush API allows to flush one or more indices through an API. The
flush process of an index basically frees memory from the index by
flushing data to the index storage and clearing the internal
<a class="link" href="#index-modules-translog" title="Translog">transaction log</a>. By
default, Elasticsearch uses memory heuristics in order to automatically
trigger flush operations as required in order to clear memory.</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/twitter/_flush'</pre><h3><a id="_multi_index_3"></a>Multi Index</h3><p>The flush API can be applied to more than one index with a single call,
or even on <code class="literal">_all</code> the indices.</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/kimchy,elasticsearch/_flush'

$ curl -XPOST 'http://localhost:9200/_flush'</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-refresh"></a>Refresh</h2></div></div></div><p>The refresh API allows to explicitly refresh one or more index, making
all operations performed since the last refresh available for search.
The (near) real-time capabilities depend on the index engine used. For
example, the internal one requires refresh to be called, but by default a
refresh is scheduled periodically.</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/twitter/_refresh'</pre><h3><a id="_multi_index_4"></a>Multi Index</h3><p>The refresh API can be applied to more than one index with a single
call, or even on <code class="literal">_all</code> the indices.</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/kimchy,elasticsearch/_refresh'

$ curl -XPOST 'http://localhost:9200/_refresh'</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-optimize"></a>Optimize</h2></div></div></div><p>The optimize API allows to optimize one or more indices through an API.
The optimize process basically optimizes the index for faster search
operations (and relates to the number of segments a Lucene index holds
within each shard). The optimize operation allows to reduce the number
of segments by merging them.</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/twitter/_optimize'</pre><h3><a id="optimize-parameters"></a>Request Parameters</h3><p>The optimize API accepts the following request parameters:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">max_num_segments</code>
</p>
</td><td valign="top">
<p>
The number of segments to optimize to. To fully
optimize the index, set it to <code class="literal">1</code>. Defaults to simply checking if a
merge needs to execute, and if so, executes it.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">only_expunge_deletes</code>
</p>
</td><td valign="top">
<p>
Should the optimize process only expunge segments
with deletes in it. In Lucene, a document is not deleted from a segment,
just marked as deleted. During a merge process of segments, a new
segment is created that does not have those deletes. This flag allows to
only merge segments that have deletes. Defaults to <code class="literal">false</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">flush</code>
</p>
</td><td valign="top">
<p>
Should a flush be performed after the optimize. Defaults to
<code class="literal">true</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">wait_for_merge</code>
</p>
</td><td valign="top">
<p>
Should the request wait for the merge to end. Defaults
to <code class="literal">true</code>. Note, a merge can potentially be a very heavy operation, so
it might make sense to run it set to <code class="literal">false</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">force</code>
</p>
</td><td valign="top">
<p>
Force a merge operation, even if there is a single segment in the
shard with no deletions. <span class="added">
      [<span class="version">1.1.0</span>]
      <span class="detail">Added in 1.1.0.</span></span>
</p>
</td></tr></tbody></table></div><h3><a id="optimize-multi-index"></a>Multi Index</h3><p>The optimize API can be applied to more than one index with a single
call, or even on <code class="literal">_all</code> the indices.</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/kimchy,elasticsearch/_optimize'

$ curl -XPOST 'http://localhost:9200/_optimize'</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-gateway-snapshot"></a>Gateway Snapshot</h2></div></div></div><p>The gateway snapshot API allows to explicitly perform a snapshot through
the gateway of one or more indices (backup them). By default, each index
gateway periodically snapshot changes, though it can be disabled and be
controlled completely through this API.</p><p>Note, this API only applies when using shared storage gateway
implementation, and does not apply when using the (default) local
gateway.</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/twitter/_gateway/snapshot'</pre><h3><a id="_multi_index_5"></a>Multi Index</h3><p>The gateway snapshot API can be applied to more than one index with a
single call, or even on <code class="literal">_all</code> the indices.</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/kimchy,elasticsearch/_gateway/snapshot'

$ curl -XPOST 'http://localhost:9200/_gateway/snapshot'</pre></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="cat"></a>cat APIs</h1></div></div></div><div class="partintro"><div></div><h2><a id="intro"></a>Introduction</h2><p>JSON is greatâ¦ for computers.  Even if itâs pretty-printed, trying
to find relationships in the data is tedious.  Human eyes, especially
when looking at an ssh terminal, need compact and aligned text.  The
cat API aims to meet this need.</p><p>All the cat commands accept a query string parameter <code class="literal">help</code> to see all
the headers and info they provide, and the <code class="literal">/_cat</code> command alone lists all
the available commands.</p><h2><a id="common-parameters"></a>Common parameters</h2><h3><a id="verbose"></a>Verbose</h3><p>Each of the commands accepts a query string parameter <code class="literal">v</code> to turn on
verbose output.</p><pre class="programlisting prettyprint lang-shell">% curl 'localhost:9200/_cat/master?v'
id                     ip        node
EGtKWZlWQYWDmX29fUnp3Q 127.0.0.1 Grey, Sara</pre><h3><a id="help"></a>Help</h3><p>Each of the commands accepts a query string parameter <code class="literal">help</code> which will
output its available columns.</p><pre class="programlisting prettyprint lang-shell">% curl 'localhost:9200/_cat/master?help'
id   | node id
ip   | node transport ip address
node | node name</pre><h3><a id="headers"></a>Headers</h3><p>Each of the commands accepts a query string parameter <code class="literal">h</code> which forces
only those columns to appear.</p><pre class="programlisting prettyprint lang-shell">% curl 'n1:9200/_cat/nodes?h=ip,port,heapPercent,name'
192.168.56.40 9300 40.3 Captain Universe
192.168.56.20 9300 15.3 Kaluu
192.168.56.50 9300 17.0 Yellowjacket
192.168.56.10 9300 12.3 Remy LeBeau
192.168.56.30 9300 43.9 Ramsey, Doug</pre><h3><a id="numeric-formats"></a>Numeric formats</h3><p>Many commands provide a few types of numeric output, either a byte
value or a time value.  By default, these types are human-formatted,
for example, <code class="literal">3.5mb</code> instead of <code class="literal">3763212</code>.  The human values are not
sortable numerically, so in order to operate on these values where
order is important, you can change it.</p><p>Say you want to find the largest index in your cluster (storage used
by all the shards, not number of documents).  The <code class="literal">/_cat/indices</code> API
is ideal.  We only need to tweak two things.  First, we want to turn
off human mode.  Weâll use a byte-level resolution.  Then weâll pipe
our output into <code class="literal">sort</code> using the appropriate column, which in this
case is the eight one.</p><pre class="programlisting prettyprint lang-shell">% curl '192.168.56.10:9200/_cat/indices?bytes=b' | sort -rnk8
green wiki2 3 0 10000   0 105274918 105274918
green wiki1 3 0 10000 413 103776272 103776272
green foo   1 0   227   0   2065131   2065131</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-alias"></a>Aliases</h2></div></div></div><p><code class="literal">aliases</code> shows information about currently configured aliases to indices
including filter and routing infos.</p><pre class="programlisting prettyprint lang-shell">% curl '192.168.56.10:9200/_cat/aliases?v'
alias  index filter indexRouting searchRouting
alias2 test1 *      -            -
alias4 test1 -      2            1,2
alias1 test1 -      -            -
alias3 test1 -      1            1</pre><p>The output shows that <code class="literal">alias</code> has configured a filter, and specific routing
configurations in <code class="literal">alias3</code> and <code class="literal">alias4</code>.</p><p>If you only want to get information about a single alias, you can specify
the alias in the URL, for example <code class="literal">/_cat/aliases/alias1</code>.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-allocation"></a>Allocation</h2></div></div></div><p><code class="literal">allocation</code> provides a snapshot of how shards have located around the
cluster and the state of disk usage.</p><pre class="programlisting prettyprint lang-shell">% curl '192.168.56.10:9200/_cat/allocation?v'
shards diskUsed diskAvail diskRatio ip            node
     1    5.6gb    72.2gb      7.8% 192.168.56.10 Jarella
     1    5.6gb    72.2gb      7.8% 192.168.56.30 Solarr
     1    5.5gb    72.3gb      7.6% 192.168.56.20 Adam II</pre><p>Here we can see that each node has been allocated a single shard and
that theyâre all using about the same amount of space.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-count"></a>Count</h2></div></div></div><p><code class="literal">count</code> provides quick access to the document count of the entire
cluster, or individual indices.</p><pre class="programlisting prettyprint lang-shell">% curl 192.168.56.10:9200/_cat/indices
green wiki1 3 0 10000 331 168.5mb 168.5mb
green wiki2 3 0   428   0     8mb     8mb
% curl 192.168.56.10:9200/_cat/count
1384314124582 19:42:04 10428
% curl 192.168.56.10:9200/_cat/count/wiki2
1384314139815 19:42:19 428</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-health"></a>Health</h2></div></div></div><p><code class="literal">health</code> is a terse, one-line representation of the same information
from <code class="literal">/_cluster/health</code>. It has one option <code class="literal">ts</code> to disable the
timestamping.</p><pre class="programlisting prettyprint lang-shell">% curl 192.168.56.10:9200/_cat/health
1384308967 18:16:07 foo green 3 3 3 3 0 0 0
% curl '192.168.56.10:9200/_cat/health?v&amp;ts=0'
cluster status nodeTotal nodeData shards pri relo init unassign
foo     green          3        3      3   3    0    0        0</pre><p>A common use of this command is to verify the health is consistent
across nodes:</p><pre class="programlisting prettyprint lang-shell">% pssh -i -h list.of.cluster.hosts curl -s localhost:9200/_cat/health
[1] 20:20:52 [SUCCESS] es3.vm
1384309218 18:20:18 foo green 3 3 3 3 0 0 0
[2] 20:20:52 [SUCCESS] es1.vm
1384309218 18:20:18 foo green 3 3 3 3 0 0 0
[3] 20:20:52 [SUCCESS] es2.vm
1384309218 18:20:18 foo green 3 3 3 3 0 0 0</pre><p>A less obvious use is to track recovery of a large cluster over
time. With enough shards, starting a cluster, or even recovering after
losing a node, can take time (depending on your network &amp; disk). A way
to track its progress is by using this command in a delayed loop:</p><pre class="programlisting prettyprint lang-shell">% while true; do curl 192.168.56.10:9200/_cat/health; sleep 120; done
1384309446 18:24:06 foo red 3 3 20 20 0 0 1812
1384309566 18:26:06 foo yellow 3 3 950 916 0 12 870
1384309686 18:28:06 foo yellow 3 3 1328 916 0 12 492
1384309806 18:30:06 foo green 3 3 1832 916 4 0 0
^C</pre><p>In this scenario, we can tell that recovery took roughly four minutes.
If this were going on for hours, we would be able to watch the
<code class="literal">UNASSIGNED</code> shards drop precipitously.  If that number remained
static, we would have an idea that there is a problem.</p><h3><a id="timestamp"></a>Why the timestamp?</h3><p>You typically are using the <code class="literal">health</code> command when a cluster is
malfunctioning.  During this period, itâs extremely important to
correlate activities across log files, alerting systems, etc.</p><p>There are two outputs.  The <code class="literal">HH:MM:SS</code> output is simply for quick
human consumption.  The epoch time retains more information, including
date, and is machine sortable if your recovery spans days.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-indices"></a>Indices</h2></div></div></div><p>The <code class="literal">indices</code> command provides a cross-section of each index.  This
information <span class="strong"><strong>spans nodes</strong></span>.</p><pre class="programlisting prettyprint lang-shell">% curl 'localhost:9200/_cat/indices/twi*?v'
health index    pri rep docs.count docs.deleted store.size pri.store.size
green  twitter    5   1      11434            0       64mb           32mb
green  twitter2   2   0       2030            0      5.8mb          5.8mb</pre><p>We can tell quickly how many shards make up an index, the number of
docs, deleted docs, primary store size, and total store size (all
shards including replicas).</p><h3><a id="pri-flag"></a>Primaries</h3><p>The index stats by default will show them for all of an indexâs
shards, including replicas.  A <code class="literal">pri</code> flag can be supplied to enable
the view of relevant stats in the context of only the primaries.</p><h3><a id="examples"></a>Examples</h3><p>Which indices are yellow?</p><pre class="programlisting prettyprint lang-shell">% curl localhost:9200/_cat/indices | grep ^yell
yellow wiki     2 1  6401 1115 151.4mb 151.4mb
yellow twitter  5 1 11434    0    32mb    32mb</pre><p>Whatâs my largest index by disk usage not including replicas?</p><pre class="programlisting prettyprint lang-shell">% curl 'localhost:9200/_cat/indices?bytes=b' | sort -rnk7
green wiki     2 0  6401 1115 158843725 158843725
green twitter  5 1 11434    0  67155614  33577857
green twitter2 2 0  2030    0   6125085   6125085</pre><p>How many merge operations have the shards for the <code class="literal">wiki</code> completed?</p><pre class="programlisting prettyprint lang-shell">% curl 'localhost:9200/_cat/indices/wiki?pri&amp;v&amp;h=health,index,prirep,docs.count,mt'
health index docs.count mt pri.mt
green  wiki        9646 16     16</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-master"></a>Master</h2></div></div></div><p><code class="literal">master</code> doesnât have any extra options. It simply displays the
masterâs node ID, bound IP address, and node name.</p><pre class="programlisting prettyprint lang-shell">% curl 'localhost:9200/_cat/master?v'
id                     ip            node
Ntgn2DcuTjGuXlhKDUD4vA 192.168.56.30 Solarr</pre><p>This information is also available via the <code class="literal">nodes</code> command, but this
is slightly shorter when all you want to do, for example, is verify
all nodes agree on the master:</p><pre class="programlisting prettyprint lang-shell">% pssh -i -h list.of.cluster.hosts curl -s localhost:9200/_cat/master
[1] 19:16:37 [SUCCESS] es3.vm
Ntgn2DcuTjGuXlhKDUD4vA 192.168.56.30 Solarr
[2] 19:16:37 [SUCCESS] es2.vm
Ntgn2DcuTjGuXlhKDUD4vA 192.168.56.30 Solarr
[3] 19:16:37 [SUCCESS] es1.vm
Ntgn2DcuTjGuXlhKDUD4vA 192.168.56.30 Solarr</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-nodes"></a>Nodes</h2></div></div></div><p>The <code class="literal">nodes</code> command shows the cluster topology.</p><pre class="programlisting prettyprint lang-shell">% curl 192.168.56.10:9200/_cat/nodes
SP4H 4727 192.168.56.30 9300 1.0.0.Beta2 1.6.0_27 72.1gb 35.4 93.9mb 79 239.1mb 0.45 3.4h d m Boneyard
_uhJ 5134 192.168.56.10 9300 1.0.0.Beta2 1.6.0_27 72.1gb 33.3 93.9mb 85 239.1mb 0.06 3.4h d * Athena
HfDp 4562 192.168.56.20 9300 1.0.0.Beta2 1.6.0_27 72.2gb 74.5 93.9mb 83 239.1mb 0.12 3.4h d m Zarek</pre><p>The first few columns tell you where your nodes live.  For sanity it
also tells you what version of ES and the JVM each one runs.</p><pre class="programlisting prettyprint lang-shell">nodeId pid  ip            port es          jdk
u2PZ   4234 192.168.56.30 9300 1.0.0.Beta1 1.6.0_27
URzf   5443 192.168.56.10 9300 1.0.0.Beta1 1.6.0_27
ActN   3806 192.168.56.20 9300 1.0.0.Beta1 1.6.0_27</pre><p>The next few give a picture of your heap, memory, and load.</p><pre class="programlisting prettyprint lang-shell">diskAvail heapPercent heapMax ramPercent  ramMax load
   72.1gb        31.3  93.9mb         81 239.1mb 0.24
   72.1gb        19.6  93.9mb         82 239.1mb 0.05
   72.2gb        64.9  93.9mb         84 239.1mb 0.12</pre><p>The last columns provide ancillary information that can often be
useful when looking at the cluster as a whole, particularly large
ones.  How many master-eligible nodes do I have?  How many client
nodes?  It looks like someone restarted a node recently; which one was
it?</p><pre class="programlisting prettyprint lang-shell">uptime data/client master name
  3.5h d           m      Boneyard
  3.5h d           *      Athena
  3.5h d           m      Zarek</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-pending-tasks"></a>Cluster Pending Tasks</h2></div></div></div><p><code class="literal">pending_tasks</code> provides the same information as the
<a class="link" href="#cluster-pending" title="Pending cluster tasks"><code class="literal">/_cluster/pending_tasks</code></a> API in a
convenient tabular format.</p><pre class="programlisting prettyprint lang-shell">% curl 'localhost:9200/_cat/pending_tasks?v'
insertOrder timeInQueue priority source
       1685       855ms HIGH     update-mapping [foo][t]
       1686       843ms HIGH     update-mapping [foo][t]
       1693       753ms HIGH     refresh-mapping [foo][[t]]
       1688       816ms HIGH     update-mapping [foo][t]
       1689       802ms HIGH     update-mapping [foo][t]
       1690       787ms HIGH     update-mapping [foo][t]
       1691       773ms HIGH     update-mapping [foo][t]</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-recovery"></a>Recovery</h2></div></div></div><p><code class="literal">recovery</code> is a view of shard replication.  It will show information
anytime data from at least one shard is copying to a different node.
It can also show up on cluster restarts.  If your recovery process
seems stuck, try it to see if thereâs any movement.</p><p>As an example, letâs enable replicas on a cluster which has two
indices, three shards each.  Afterward weâll have twelve total shards,
but before those replica shards are <code class="literal">STARTED</code>, weâll take a snapshot
of the recovery:</p><pre class="programlisting prettyprint lang-shell">% curl -XPUT 192.168.56.30:9200/_settings -d'{"number_of_replicas":1}'
{"acknowledged":true}
% curl '192.168.56.30:9200/_cat/recovery?v'
index shard   target recovered     % ip            node
wiki1 2     68083830   7865837 11.6% 192.168.56.20 Adam II
wiki2 1      2542400    444175 17.5% 192.168.56.20 Adam II
wiki2 2      3242108    329039 10.1% 192.168.56.10 Jarella
wiki2 0      2614132         0  0.0% 192.168.56.30 Solarr
wiki1 0     60992898   4719290  7.7% 192.168.56.30 Solarr
wiki1 1     47630362   6798313 14.3% 192.168.56.10 Jarella</pre><p>We have six total shards in recovery (a replica for each primary), at
varying points of progress.</p><p>Letâs restart the cluster and then lose a node.  This output shows us
what was moving around shortly after the node left the cluster.</p><pre class="programlisting prettyprint lang-shell">% curl 192.168.56.30:9200/_cat/health; curl 192.168.56.30:9200/_cat/recovery
1384315040 19:57:20 foo yellow 2 2 8 6 0 4 0
wiki2 2  1621477        0  0.0% 192.168.56.30 Garrett, Jonathan "John"
wiki2 0  1307488        0  0.0% 192.168.56.20 Commander Kraken
wiki1 0 32696794 20984240 64.2% 192.168.56.20 Commander Kraken
wiki1 1 31123128 21951695 70.5% 192.168.56.30 Garrett, Jonathan "John"</pre><h3><a id="big-percent"></a>Why am I seeing recovery percentages greater than 100?</h3><p>This can happen if a shard copy goes away and comes back while the
primary was indexing.  The replica shard will catch up with the
primary by receiving any new segments created during its outage.
These new segments can contain data from segments it already has
because theyâre the result of merging that happened on the primary,
but now live in different, larger segments.  After the new segments
are copied over the replica will delete unneeded segments, resulting
in a dataset that more closely matches the primary (or exactly,
assuming indexing isnât still happening).</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-thread-pool"></a>Thread pool</h2></div></div></div><p>The <code class="literal">thread_pool</code> command shows cluster wide thread pool statistics per node. By default the active, queue and rejected
statistics are returned for the bulk, index and search thread pools.</p><pre class="programlisting prettyprint lang-shell">% curl 192.168.56.10:9200/_cat/thread_pool
host1 192.168.1.35 0 0 0 0 0 0 0 0 0
host2 192.168.1.36 0 0 0 0 0 0 0 0 0</pre><p>The first two columns contain the host and ip of a node.</p><pre class="programlisting prettyprint lang-shell">host      ip
host1 192.168.1.35
host2 192.168.1.36</pre><p>The next three columns show the active queue and rejected statistics for the bulk thread pool.</p><pre class="programlisting prettyprint lang-shell">bulk.active bulk.queue bulk.rejected
          0          0             0</pre><p>The remaining columns show the active queue and rejected statistics of the index and search thread pool respectively.</p><p>Also other statistics of different thread pools can be retrieved by using the <code class="literal">h</code> (header) parameter.</p><pre class="programlisting prettyprint lang-shell">% curl 'localhost:9200/_cat/thread_pool?v&amp;h=id,host,suggest.active,suggest.rejected,suggest.completed'
host      suggest.active suggest.rejected suggest.completed
host1                  0                0                 0
host2                  0                0                 0</pre><p>Here the host columns and the active, rejected and completed suggest thread pool statistic are displayed. The suggest
thread pool wonât be displayed by default, so you always need be specific about what statistic you want to display.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-shards"></a>Shards</h2></div></div></div><p>The <code class="literal">shards</code> command is the detailed view of what nodes contain which
shards.  It will tell you if itâs a primary or replica, the number of
docs, the bytes it takes on disk, and the node where itâs located.</p><p>Here we see a single index, with three primary shards and no replicas:</p><pre class="programlisting prettyprint lang-shell">% curl 192.168.56.20:9200/_cat/shards
wiki1 0 p STARTED 3014 31.1mb 192.168.56.10 Stiletto
wiki1 1 p STARTED 3013 29.6mb 192.168.56.30 Frankie Raye
wiki1 2 p STARTED 3973 38.1mb 192.168.56.20 Commander Kraken</pre><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="index-pattern"></a>Index pattern</h2></div></div></div><p>If you have many shards, you may wish to limit which indices show up
in the output.  You can always do this with <code class="literal">grep</code>, but you can save
some bandwidth by supplying an index pattern to the end.</p><pre class="programlisting prettyprint lang-shell">% curl 192.168.56.20:9200/_cat/shards/wiki2
wiki2 0 p STARTED 197 3.2mb 192.168.56.10 Stiletto
wiki2 1 p STARTED 205 5.9mb 192.168.56.30 Frankie Raye
wiki2 2 p STARTED 275 7.8mb 192.168.56.20 Commander Kraken</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="relocation"></a>Relocation</h2></div></div></div><p>Letâs say youâve checked your health and you see two relocating
shards.  Where are they from and where are they going?</p><pre class="programlisting prettyprint lang-shell">% curl 192.168.56.10:9200/_cat/health
1384315316 20:01:56 foo green 3 3 12 6 2 0 0
% curl 192.168.56.10:9200/_cat/shards | fgrep RELO
wiki1 0 r RELOCATING 3014 31.1mb 192.168.56.20 Commander Kraken -&gt; 192.168.56.30 Frankie Raye
wiki1 1 r RELOCATING 3013 29.6mb 192.168.56.10 Stiletto -&gt; 192.168.56.30 Frankie Raye</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="states"></a>Shard states</h2></div></div></div><p>Before a shard can be used, it goes through an <code class="literal">INITIALIZING</code> state.
<code class="literal">shards</code> can show you which ones.</p><pre class="programlisting prettyprint lang-shell">% curl -XPUT 192.168.56.20:9200/_settings -d'{"number_of_replicas":1}'
{"acknowledged":true}
% curl 192.168.56.20:9200/_cat/shards
wiki1 0 p STARTED      3014 31.1mb 192.168.56.10 Stiletto
wiki1 0 r INITIALIZING    0 14.3mb 192.168.56.30 Frankie Raye
wiki1 1 p STARTED      3013 29.6mb 192.168.56.30 Frankie Raye
wiki1 1 r INITIALIZING    0 13.1mb 192.168.56.20 Commander Kraken
wiki1 2 r INITIALIZING    0   14mb 192.168.56.10 Stiletto
wiki1 2 p STARTED      3973 38.1mb 192.168.56.20 Commander Kraken</pre><p>If a shard cannot be assigned, for example youâve overallocated the
number of replicas for the number of nodes in the cluster, they will
remain <code class="literal">UNASSIGNED</code>.</p><pre class="programlisting prettyprint lang-shell">% curl -XPUT 192.168.56.20:9200/_settings -d'{"number_of_replicas":3}'
% curl 192.168.56.20:9200/_cat/health
1384316325 20:18:45 foo yellow 3 3 9 3 0 0 3
% curl 192.168.56.20:9200/_cat/shards
wiki1 0 p STARTED    3014 31.1mb 192.168.56.10 Stiletto
wiki1 0 r STARTED    3014 31.1mb 192.168.56.30 Frankie Raye
wiki1 0 r STARTED    3014 31.1mb 192.168.56.20 Commander Kraken
wiki1 0 r UNASSIGNED
wiki1 1 r STARTED    3013 29.6mb 192.168.56.10 Stiletto
wiki1 1 p STARTED    3013 29.6mb 192.168.56.30 Frankie Raye
wiki1 1 r STARTED    3013 29.6mb 192.168.56.20 Commander Kraken
wiki1 1 r UNASSIGNED
wiki1 2 r STARTED    3973 38.1mb 192.168.56.10 Stiletto
wiki1 2 r STARTED    3973 38.1mb 192.168.56.30 Frankie Raye
wiki1 2 p STARTED    3973 38.1mb 192.168.56.20 Commander Kraken
wiki1 2 r UNASSIGNED</pre></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-plugins"></a>Plugins</h2></div></div></div><p>The <code class="literal">plugins</code> command provides a view per node of running plugins. This information <span class="strong"><strong>spans nodes</strong></span>.</p><pre class="programlisting prettyprint lang-shell">% curl 'localhost:9200/_cat/plugins?v'
name    component       version        type isolation url
Abraxas cloud-azure     2.1.0-SNAPSHOT j    x
Abraxas lang-groovy     2.0.0          j    x
Abraxas lang-javascript 2.0.0-SNAPSHOT j    x
Abraxas marvel          NA             j/s  x         /_plugin/marvel/
Abraxas lang-python     2.0.0-SNAPSHOT j    x
Abraxas inquisitor      NA             s              /_plugin/inquisitor/
Abraxas kopf            0.5.2          s              /_plugin/kopf/
Abraxas segmentspy      NA             s              /_plugin/segmentspy/</pre><p>We can tell quickly how many plugins per node we have and which versions.</p></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="cluster"></a>Cluster APIs</h1></div></div></div><div class="partintro"><div></div><h2><a id="cluster-nodes"></a>Node specification</h2><p>Most cluster level APIs allow to specify which nodes to execute on (for
example, getting the node stats for a node). Nodes can be identified in
the APIs either using their internal node id, the node name, address,
custom attributes, or just the <code class="literal">_local</code> node receiving the request. For
example, here are some sample executions of nodes info:</p><pre class="programlisting prettyprint lang-js"># Local
curl localhost:9200/_nodes/_local
# Address
curl localhost:9200/_nodes/10.0.0.3,10.0.0.4
curl localhost:9200/_nodes/10.0.0.*
# Names
curl localhost:9200/_nodes/node_name_goes_here
curl localhost:9200/_nodes/node_name_goes_*
# Attributes (set something like node.rack: 2 in the config)
curl localhost:9200/_nodes/rack:2
curl localhost:9200/_nodes/ra*:2
curl localhost:9200/_nodes/ra*:2*</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-health"></a>Cluster Health</h2></div></div></div><p>The cluster health API allows to get a very simple status on the health
of the cluster.</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_cluster/health?pretty=true'
{
  "cluster_name" : "testcluster",
  "status" : "green",
  "timed_out" : false,
  "number_of_nodes" : 2,
  "number_of_data_nodes" : 2,
  "active_primary_shards" : 5,
  "active_shards" : 10,
  "relocating_shards" : 0,
  "initializing_shards" : 0,
  "unassigned_shards" : 0
}</pre><p>The API can also be executed against one or more indices to get just the
specified indices health:</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_cluster/health/test1,test2'</pre><p>The cluster health status is: <code class="literal">green</code>, <code class="literal">yellow</code> or <code class="literal">red</code>. On the shard
level, a <code class="literal">red</code> status indicates that the specific shard is not allocated
in the cluster, <code class="literal">yellow</code> means that the primary shard is allocated but
replicas are not, and <code class="literal">green</code> means that all shards are allocated. The
index level status is controlled by the worst shard status. The cluster
status is controlled by the worst index status.</p><p>One of the main benefits of the API is the ability to wait until the
cluster reaches a certain high water-mark health level. For example, the
following will wait for 50 seconds for the cluster to reach the <code class="literal">yellow</code>
level (if it reaches the <code class="literal">green</code> or <code class="literal">yellow</code> status before 50 seconds elapse,
it will return at that point):</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_cluster/health?wait_for_status=yellow&amp;timeout=50s'</pre><h3><a id="request-params"></a>Request Parameters</h3><p>The cluster health API accepts the following request parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">level</code>
</span></dt><dd>
    Can be one of <code class="literal">cluster</code>, <code class="literal">indices</code> or <code class="literal">shards</code>. Controls the
    details level of the health information returned. Defaults to <code class="literal">cluster</code>.
</dd><dt><span class="term">
<code class="literal">wait_for_status</code>
</span></dt><dd>
    One of <code class="literal">green</code>, <code class="literal">yellow</code> or <code class="literal">red</code>. Will wait (until
    the timeout provided) until the status of the cluster changes to the one
    provided. By default, will not wait for any status.
</dd><dt><span class="term">
<code class="literal">wait_for_relocating_shards</code>
</span></dt><dd>
    A number controlling to how many relocating
    shards to wait for. Usually will be <code class="literal">0</code> to indicate to wait till all
    relocation have happened. Defaults to not to wait.
</dd><dt><span class="term">
<code class="literal">wait_for_nodes</code>
</span></dt><dd>
    The request waits until the specified number <code class="literal">N</code> of
    nodes is available. It also accepts <code class="literal">&gt;=N</code>, <code class="literal">&lt;=N</code>, <code class="literal">&gt;N</code> and <code class="literal">&lt;N</code>.
    Alternatively, it is possible to use <code class="literal">ge(N)</code>, <code class="literal">le(N)</code>, <code class="literal">gt(N)</code> and
    <code class="literal">lt(N)</code> notation.
</dd><dt><span class="term">
<code class="literal">timeout</code>
</span></dt><dd>
    A time based parameter controlling how long to wait if one of
    the wait_for_XXX are provided. Defaults to <code class="literal">30s</code>.
</dd></dl></div><p>The following is an example of getting the cluster health at the
<code class="literal">shards</code> level:</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_cluster/health/twitter?level=shards'</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-state"></a>Cluster State</h2></div></div></div><p>The cluster state API allows to get a comprehensive state information of
the whole cluster.</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_cluster/state'</pre><p>By default, the cluster state request is routed to the master node, to
ensure that the latest cluster state is returned.
For debugging purposes, you can retrieve the cluster state local to a
particular node by adding <code class="literal">local=true</code> to the  query string.</p><h3><a id="_response_filters"></a>Response Filters</h3><p>As the cluster state can grow (depending on the number of shards and indices, your mapping, templates),
it is possible to filter the cluster state response specifying the parts in the URL.</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_cluster/state/{metrics}/{indices}'</pre><p><code class="literal">metrics</code> can be a comma-separated list of</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">version</code>
</span></dt><dd>
    Shows the cluster state version.
</dd><dt><span class="term">
<code class="literal">master_node</code>
</span></dt><dd>
    Shows the elected <code class="literal">master_node</code> part of the response
</dd><dt><span class="term">
<code class="literal">nodes</code>
</span></dt><dd>
    Shows the <code class="literal">nodes</code> part of the response
</dd><dt><span class="term">
<code class="literal">routing_table</code>
</span></dt><dd>
    Shows the <code class="literal">routing_table</code> part of the response. If you supply a comma separated list of indices, the returned output will only contain the indices listed.
</dd><dt><span class="term">
<code class="literal">metadata</code>
</span></dt><dd>
    Shows the <code class="literal">metadata</code> part of the response. If you supply a comma separated list of indices, the returned output will only contain the indices listed.
</dd><dt><span class="term">
<code class="literal">blocks</code>
</span></dt><dd>
    Shows the <code class="literal">blocks</code> part of the response
</dd></dl></div><p>In addition the <code class="literal">index_templates</code> parameter can be specified, which returns the specified index templates only. This works only if the <code class="literal">metadata</code> is asked to be returned.</p><p>A couple of example calls:</p><pre class="programlisting prettyprint lang-js"># return only metadata and routing_table data for specified indices
$ curl -XGET 'http://localhost:9200/_cluster/state/metadata,routing_table/foo,bar'

# return everything for these two indices
$ curl -XGET 'http://localhost:9200/_cluster/state/_all/foo,bar'

# Return only blocks data
$ curl -XGET 'http://localhost:9200/_cluster/state/blocks'

# Return only metadata and a specific index_template
# You should use the dedicated template endpoint for this
$ curl -XGET 'http://localhost:9200/_cluster/state/metadata?index_templates=template_1'</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-stats"></a>Cluster Stats</h2></div></div></div><p>The Cluster Stats API allows to retrieve statistics from a cluster wide perspective.
The API returns basic index metrics (shard numbers, store size, memory usage) and
information about the current nodes that form the cluster (number, roles, os, jvm
versions, memory usage, cpu and installed plugins).</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/_cluster/stats?human'</pre><p>Will return, for example:</p><pre class="programlisting prettyprint lang-js">{
   "cluster_name": "elasticsearch",
   "status": "green",
   "indices": {
      "count": 3,
      "shards": {
         "total": 35,
         "primaries": 15,
         "replication": 1.333333333333333,
         "index": {
            "shards": {
               "min": 10,
               "max": 15,
               "avg": 11.66666666666666
            },
            "primaries": {
               "min": 5,
               "max": 5,
               "avg": 5
            },
            "replication": {
               "min": 1,
               "max": 2,
               "avg": 1.3333333333333333
            }
         }
      },
      "docs": {
         "count": 2,
         "deleted": 0
      },
      "store": {
         "size": "5.6kb",
         "size_in_bytes": 5770,
         "throttle_time": "0s",
         "throttle_time_in_millis": 0
      },
      "fielddata": {
         "memory_size": "0b",
         "memory_size_in_bytes": 0,
         "evictions": 0
      },
      "filter_cache": {
         "memory_size": "0b",
         "memory_size_in_bytes": 0,
         "evictions": 0
      },
      "id_cache": {
         "memory_size": "0b",
         "memory_size_in_bytes": 0
      },
      "completion": {
         "size": "0b",
         "size_in_bytes": 0
      },
      "segments": {
         "count": 2
      }
   },
   "nodes": {
      "count": {
         "total": 2,
         "master_only": 0,
         "data_only": 0,
         "master_data": 2,
         "client": 0
      },
      "versions": [
         "0.90.8"
      ],
      "os": {
         "available_processors": 4,
         "mem": {
            "total": "8gb",
            "total_in_bytes": 8589934592
         },
         "cpu": [
            {
               "vendor": "Intel",
               "model": "MacBookAir5,2",
               "mhz": 2000,
               "total_cores": 4,
               "total_sockets": 4,
               "cores_per_socket": 16,
               "cache_size": "256b",
               "cache_size_in_bytes": 256,
               "count": 1
            }
         ]
      },
      "process": {
         "cpu": {
            "percent": 3
         },
         "open_file_descriptors": {
            "min": 200,
            "max": 346,
            "avg": 273
         }
      },
      "jvm": {
         "max_uptime": "24s",
         "max_uptime_in_millis": 24054,
         "version": [
            {
               "version": "1.6.0_45",
               "vm_name": "Java HotSpot(TM) 64-Bit Server VM",
               "vm_version": "20.45-b01-451",
               "vm_vendor": "Apple Inc.",
               "count": 2
            }
         ],
         "mem": {
            "heap_used": "38.3mb",
            "heap_used_in_bytes": 40237120,
            "heap_max": "1.9gb",
            "heap_max_in_bytes": 2130051072
         },
         "threads": 89
      },
      "fs":
         {
            "total": "232.9gb",
            "total_in_bytes": 250140434432,
            "free": "31.3gb",
            "free_in_bytes": 33705881600,
            "available": "31.1gb",
            "available_in_bytes": 33443737600,
            "disk_reads": 21202753,
            "disk_writes": 27028840,
            "disk_io_op": 48231593,
            "disk_read_size": "528gb",
            "disk_read_size_in_bytes": 566980806656,
            "disk_write_size": "617.9gb",
            "disk_write_size_in_bytes": 663525366784,
            "disk_io_size": "1145.9gb",
            "disk_io_size_in_bytes": 1230506173440
       },
      "plugins": [
         // all plugins installed on nodes
         {
            "name": "inquisitor",
            "description": "",
            "url": "/_plugin/inquisitor/",
            "jvm": false,
            "site": true
         }
      ]
   }
}</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-pending"></a>Pending cluster tasks</h2></div></div></div><p>The pending cluster tasks API returns a list of any cluster-level changes
(e.g. create index, update mapping, allocate or fail shard) which have not yet
been executed.</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_cluster/pending_tasks'</pre><p>Usually this will return an empty list as cluster-level changes are usually
fast. However if there are tasks queued up, the output will look something
like this:</p><pre class="programlisting prettyprint lang-js">{
   "tasks": [
      {
         "insert_order": 101,
         "priority": "URGENT",
         "source": "create-index [foo_9], cause [api]",
         "time_in_queue_millis": 86,
         "time_in_queue": "86ms"
      },
      {
         "insert_order": 46,
         "priority": "HIGH",
         "source": "shard-started ([foo_2][1], node[tMTocMvQQgGCkj7QDHl3OA], [P], s[INITIALIZING]), reason [after recovery from gateway]",
         "time_in_queue_millis": 842,
         "time_in_queue": "842ms"
      },
      {
         "insert_order": 45,
         "priority": "HIGH",
         "source": "shard-started ([foo_2][0], node[tMTocMvQQgGCkj7QDHl3OA], [P], s[INITIALIZING]), reason [after recovery from gateway]",
         "time_in_queue_millis": 858,
         "time_in_queue": "858ms"
      }
  ]
}</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-reroute"></a>Cluster Reroute</h2></div></div></div><p>The reroute command allows to explicitly execute a cluster reroute
allocation command including specific commands. For example, a shard can
be moved from one node to another explicitly, an allocation can be
canceled, or an unassigned shard can be explicitly allocated on a
specific node.</p><p>Here is a short example of how a simple reroute API call:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/_cluster/reroute' -d '{
    "commands" : [ {
        "move" :
            {
              "index" : "test", "shard" : 0,
              "from_node" : "node1", "to_node" : "node2"
            }
        },
        {
          "allocate" : {
              "index" : "test", "shard" : 1, "node" : "node3"
          }
        }
    ]
}'</pre><p>An important aspect to remember is the fact that once when an allocation
occurs, the cluster will aim at re-balancing its state back to an even
state. For example, if the allocation includes moving a shard from
<code class="literal">node1</code> to <code class="literal">node2</code>, in an <code class="literal">even</code> state, then another shard will be moved
from <code class="literal">node2</code> to <code class="literal">node1</code> to even things out.</p><p>The cluster can be set to disable allocations, which means that only the
explicitly allocations will be performed. Obviously, only once all
commands has been applied, the cluster will aim to be re-balance its
state.</p><p>Another option is to run the commands in <code class="literal">dry_run</code> (as a URI flag, or in
the request body). This will cause the commands to apply to the current
cluster state, and return the resulting cluster after the commands (and
re-balancing) has been applied.</p><p>If the <code class="literal">explain</code> parameter is specified, a detailed explanation of why the
commands could or could not be executed is returned.</p><p>The commands supported are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">move</code>
</span></dt><dd>
    Move a started shard from one node to another node. Accepts
    <code class="literal">index</code> and <code class="literal">shard</code> for index name and shard number, <code class="literal">from_node</code> for the
    node to move the shard <code class="literal">from</code>, and <code class="literal">to_node</code> for the node to move the
    shard to.
</dd><dt><span class="term">
<code class="literal">cancel</code>
</span></dt><dd>
    Cancel allocation of a shard (or recovery). Accepts <code class="literal">index</code>
    and <code class="literal">shard</code> for index name and shard number, and <code class="literal">node</code> for the node to
    cancel the shard allocation on. It also accepts <code class="literal">allow_primary</code> flag to
    explicitly specify that it is allowed to cancel allocation for a primary
    shard.  This can be used to force resynchronization of existing replicas
    from the primary shard by cancelling them and allowing them to be
    reinitialized through the standard reallocation process.
</dd><dt><span class="term">
<code class="literal">allocate</code>
</span></dt><dd>
    Allocate an unassigned shard to a node. Accepts the
    <code class="literal">index</code> and <code class="literal">shard</code> for index name and shard number, and <code class="literal">node</code> to
    allocate the shard to. It also accepts <code class="literal">allow_primary</code> flag to
    explicitly specify that it is allowed to explicitly allocate a primary
    shard (might result in data loss).
</dd></dl></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-update-settings"></a>Cluster Update Settings</h2></div></div></div><p>Allows to update cluster wide specific settings. Settings updated can
either be persistent (applied cross restarts) or transient (will not
survive a full cluster restart). Here is an example:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/_cluster/settings -d '{
    "persistent" : {
        "discovery.zen.minimum_master_nodes" : 2
    }
}'</pre><p>Or:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/_cluster/settings -d '{
    "transient" : {
        "discovery.zen.minimum_master_nodes" : 2
    }
}'</pre><p>The cluster responds with the settings updated. So the response for the
last example will be:</p><pre class="programlisting prettyprint lang-js">{
    "persistent" : {},
    "transient" : {
        "discovery.zen.minimum_master_nodes" : "2"
    }
}'</pre><p>Cluster wide settings can be returned using:</p><pre class="programlisting prettyprint lang-js">curl -XGET localhost:9200/_cluster/settings</pre><p>There is a specific list of settings that can be updated, those include:</p><h3><a id="cluster-settings"></a>Cluster settings</h3><h4><a id="_routing_allocation"></a>Routing allocation</h4><h5><a id="_awareness"></a>Awareness</h5><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.routing.allocation.awareness.attributes</code>
</span></dt><dd>
     See <a class="xref" href="#modules-cluster" title="Cluster"><em>Cluster</em></a>.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.awareness.force.*</code>
</span></dt><dd>
     See <a class="xref" href="#modules-cluster" title="Cluster"><em>Cluster</em></a>.
</dd></dl></div><h5><a id="_balanced_shards"></a>Balanced Shards</h5><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.routing.allocation.balance.shard</code>
</span></dt><dd>
     Defines the weight factor for shards allocated on a node
     (float). Defaults to <code class="literal">0.45f</code>.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.balance.index</code>
</span></dt><dd>
     Defines a factor to the number of shards per index allocated
      on a specific node (float). Defaults to <code class="literal">0.5f</code>.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.balance.primary</code>
</span></dt><dd>
      defines a weight factor for the number of primaries of a specific index
      allocated on a node (float). <code class="literal">0.05f</code>.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.balance.threshold</code>
</span></dt><dd>
      minimal optimization value of operations that should be performed (non
      negative float). Defaults to <code class="literal">1.0f</code>.
</dd></dl></div><h5><a id="_concurrent_rebalance"></a>Concurrent Rebalance</h5><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.routing.allocation.cluster_concurrent_rebalance</code>
</span></dt><dd>
       Allow to control how many concurrent rebalancing of shards are
       allowed cluster wide, and default it to <code class="literal">2</code> (integer). <code class="literal">-1</code> for
       unlimited. See also <a class="xref" href="#modules-cluster" title="Cluster"><em>Cluster</em></a>.
</dd></dl></div><h5><a id="_disable_allocation"></a>Disable allocation</h5><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.0.0.RC1.</p></div></div><p>All the disable allocation settings have been deprecated in favour for
<code class="literal">cluster.routing.allocation.enable</code> setting.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.routing.allocation.disable_allocation</code>
</span></dt><dd>
     See <a class="xref" href="#modules-cluster" title="Cluster"><em>Cluster</em></a>.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.disable_replica_allocation</code>
</span></dt><dd>
     See <a class="xref" href="#modules-cluster" title="Cluster"><em>Cluster</em></a>.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.disable_new_allocation</code>
</span></dt><dd>
     See <a class="xref" href="#modules-cluster" title="Cluster"><em>Cluster</em></a>.
</dd></dl></div><h5><a id="_enable_allocation"></a>Enable allocation</h5><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.routing.allocation.enable</code>
</span></dt><dd>
     See <a class="xref" href="#modules-cluster" title="Cluster"><em>Cluster</em></a>.
</dd></dl></div><h5><a id="_throttling_allocation"></a>Throttling allocation</h5><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.routing.allocation.node_initial_primaries_recoveries</code>
</span></dt><dd>
     See <a class="xref" href="#modules-cluster" title="Cluster"><em>Cluster</em></a>.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.node_concurrent_recoveries</code>
</span></dt><dd>
     See <a class="xref" href="#modules-cluster" title="Cluster"><em>Cluster</em></a>.
</dd></dl></div><h5><a id="_filter_allocation"></a>Filter allocation</h5><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.routing.allocation.include.*</code>
</span></dt><dd>
     See <a class="xref" href="#modules-cluster" title="Cluster"><em>Cluster</em></a>.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.exclude.*</code>
</span></dt><dd>
     See <a class="xref" href="#modules-cluster" title="Cluster"><em>Cluster</em></a>.
</dd></dl></div><p><code class="literal">cluster.routing.allocation.require.*</code>
     See <a class="xref" href="#modules-cluster" title="Cluster"><em>Cluster</em></a>.</p><h4><a id="_metadata"></a>Metadata</h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.blocks.read_only</code>
</span></dt><dd>
      Have the whole cluster read only (indices do not accept write operations), metadata is not allowed to be modified (create or delete indices).
</dd></dl></div><h4><a id="_discovery"></a>Discovery</h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">discovery.zen.minimum_master_nodes</code>
</span></dt><dd>
     See <a class="xref" href="#modules-discovery-zen" title="Zen Discovery">Zen Discovery</a>
</dd><dt><span class="term">
<code class="literal">discovery.zen.publish_timeout</code> <span class="added">
      [<span class="version">1.1.0</span>]
      <span class="detail">Added in 1.1.0. The setting existed before but wasnât dynamic.</span></span>
</span></dt><dd>
     See <a class="xref" href="#modules-discovery-zen" title="Zen Discovery">Zen Discovery</a>
</dd></dl></div><h4><a id="_threadpools"></a>Threadpools</h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">threadpool.*</code>
</span></dt><dd>
     See <a class="xref" href="#modules-threadpool" title="Thread Pool"><em>Thread Pool</em></a>
</dd></dl></div><h3><a id="cluster-index-settings"></a>Index settings</h3><h4><a id="_index_filter_cache"></a>Index filter cache</h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">indices.cache.filter.size</code>
</span></dt><dd>
     See <a class="xref" href="#index-modules-cache" title="Cache"><em>Cache</em></a>
</dd><dt><span class="term">
<code class="literal">indices.cache.filter.expire</code> (time)
</span></dt><dd>
     See <a class="xref" href="#index-modules-cache" title="Cache"><em>Cache</em></a>
</dd></dl></div><h4><a id="_ttl_interval"></a>TTL interval</h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">indices.ttl.interval</code> (time)
</span></dt><dd>
    See <a class="xref" href="#mapping-ttl-field" title="_ttl"><code class="literal">_ttl</code></a>
</dd></dl></div><h4><a id="_recovery"></a>Recovery</h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">indices.recovery.concurrent_streams</code>
</span></dt><dd>
     See <a class="xref" href="#modules-indices" title="Indices"><em>Indices</em></a>
</dd><dt><span class="term">
<code class="literal">indices.recovery.file_chunk_size</code>
</span></dt><dd>
     See <a class="xref" href="#modules-indices" title="Indices"><em>Indices</em></a>
</dd><dt><span class="term">
<code class="literal">indices.recovery.translog_ops</code>
</span></dt><dd>
     See <a class="xref" href="#modules-indices" title="Indices"><em>Indices</em></a>
</dd><dt><span class="term">
<code class="literal">indices.recovery.translog_size</code>
</span></dt><dd>
     See <a class="xref" href="#modules-indices" title="Indices"><em>Indices</em></a>
</dd><dt><span class="term">
<code class="literal">indices.recovery.compress</code>
</span></dt><dd>
     See <a class="xref" href="#modules-indices" title="Indices"><em>Indices</em></a>
</dd><dt><span class="term">
<code class="literal">indices.recovery.max_bytes_per_sec</code>
</span></dt><dd>
     See <a class="xref" href="#modules-indices" title="Indices"><em>Indices</em></a>
</dd></dl></div><h4><a id="_store_level_throttling"></a>Store level throttling</h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">indices.store.throttle.type</code>
</span></dt><dd>
      See <a class="xref" href="#index-modules-store" title="Store"><em>Store</em></a>
</dd><dt><span class="term">
<code class="literal">indices.store.throttle.max_bytes_per_sec</code>
</span></dt><dd>
      See <a class="xref" href="#index-modules-store" title="Store"><em>Store</em></a>
</dd></dl></div><h3><a id="logger"></a>Logger</h3><p>Logger values can also be updated by setting <code class="literal">logger.</code> prefix. More
settings will be allowed to be updated.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-nodes-stats"></a>Nodes Stats</h2></div></div></div><h3><a id="_nodes_statistics"></a>Nodes statistics</h3><p>The cluster nodes stats API allows to retrieve one or more (or all) of
the cluster nodes statistics.</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/_nodes/stats'
curl -XGET 'http://localhost:9200/_nodes/nodeId1,nodeId2/stats'</pre><p>The first command retrieves stats of all the nodes in the cluster. The
second command selectively retrieves nodes stats of only <code class="literal">nodeId1</code> and
<code class="literal">nodeId2</code>. All the nodes selective options are explained
<a class="link" href="#cluster-nodes" title="Node specification">here</a>.</p><p>By default, all stats are returned. You can limit this by combining any
of <code class="literal">indices</code>, <code class="literal">os</code>, <code class="literal">process</code>, <code class="literal">jvm</code>, <code class="literal">network</code>, <code class="literal">transport</code>, <code class="literal">http</code>,
<code class="literal">fs</code>, <code class="literal">breaker</code> and <code class="literal">thread_pool</code>. For example:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">indices</code>
</p>
</td><td valign="top">
<p>
        Indices stats about size, document count, indexing and
        deletion times, search times, field cache size , merges and flushes
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">fs</code>
</p>
</td><td valign="top">
<p>
        File system information, data path, free disk space, read/write
        stats
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">http</code>
</p>
</td><td valign="top">
<p>
        HTTP connection information
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">jvm</code>
</p>
</td><td valign="top">
<p>
        JVM stats, memory pool information, garbage collection, buffer
        pools
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">network</code>
</p>
</td><td valign="top">
<p>
        TCP information
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">os</code>
</p>
</td><td valign="top">
<p>
        Operating system stats, load average, cpu, mem, swap
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">process</code>
</p>
</td><td valign="top">
<p>
        Process statistics, memory consumption, cpu usage, open
        file descriptors
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">thread_pool</code>
</p>
</td><td valign="top">
<p>
        Statistics about each thread pool, including current
        size, queue and rejected tasks
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">transport</code>
</p>
</td><td valign="top">
<p>
        Transport statistics about sent and received bytes in
        cluster communication
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">breaker</code>
</p>
</td><td valign="top">
<p>
        Statistics about the field data circuit breaker
</p>
</td></tr></tbody></table></div><pre class="programlisting prettyprint lang-js"># return indices and os
curl -XGET 'http://localhost:9200/_nodes/stats/os'
# return just os and process
curl -XGET 'http://localhost:9200/_nodes/stats/os,process'
# specific type endpoint
curl -XGET 'http://localhost:9200/_nodes/stats/process'
curl -XGET 'http://localhost:9200/_nodes/10.0.0.1/stats/process'</pre><p>The <code class="literal">all</code> flag can be set to return all the stats.</p><h3><a id="field-data"></a>Field data statistics</h3><p>You can get information about field data memory usage on node
level or on index level.</p><pre class="programlisting prettyprint lang-js"># Node Stats
curl localhost:9200/_nodes/stats/indices/field1,field2?pretty

# Indices Stat
curl localhost:9200/_stats/fielddata/field1,field2?pretty

# You can use wildcards for field names
curl localhost:9200/_stats/fielddata/field*?pretty
curl localhost:9200/_nodes/stats/indices/field*?pretty</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-nodes-info"></a>Nodes Info</h2></div></div></div><p>The cluster nodes info API allows to retrieve one or more (or all) of
the cluster nodes information.</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/_nodes'
curl -XGET 'http://localhost:9200/_nodes/nodeId1,nodeId2'</pre><p>The first command retrieves information of all the nodes in the cluster.
The second command selectively retrieves nodes information of only
<code class="literal">nodeId1</code> and <code class="literal">nodeId2</code>. All the nodes selective options are explained
<a class="link" href="#cluster-nodes" title="Node specification">here</a>.</p><p>By default, it just returns all attributes and core settings for a node.
It also allows to get only information on <code class="literal">settings</code>, <code class="literal">os</code>, <code class="literal">process</code>, <code class="literal">jvm</code>,
<code class="literal">thread_pool</code>, <code class="literal">network</code>, <code class="literal">transport</code>, <code class="literal">http</code> and <code class="literal">plugins</code>:</p><pre class="programlisting prettyprint lang-js">curl -XGET 'http://localhost:9200/_nodes/process'
curl -XGET 'http://localhost:9200/_nodes/_all/process'
curl -XGET 'http://localhost:9200/_nodes/nodeId1,nodeId2/jvm,process'
# same as above
curl -XGET 'http://localhost:9200/_nodes/nodeId1,nodeId2/info/jvm,process'

curl -XGET 'http://localhost:9200/_nodes/nodeId1,nodeId2/_all</pre><p>The <code class="literal">_all</code> flag can be set to return all the information - or you can simply omit it.</p><p><code class="literal">plugins</code> - if set, the result will contain details about the loaded
plugins per node:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">name</code>: plugin name
</li><li class="listitem">
<code class="literal">description</code>: plugin description if any
</li><li class="listitem">
<code class="literal">site</code>: <code class="literal">true</code> if the plugin is a site plugin
</li><li class="listitem">
<code class="literal">jvm</code>: <code class="literal">true</code> if the plugin is a plugin running in the JVM
</li><li class="listitem">
<code class="literal">url</code>: URL if the plugin is a site plugin
</li><li class="listitem">
<code class="literal">isolation</code>: whether the plugin is loaded in isolation (<code class="literal">true</code>) or not (<code class="literal">false</code>)
</li></ul></div><p>The result will look similar to:</p><pre class="programlisting prettyprint lang-js">{
  "cluster_name" : "test-cluster-MacBook-Air-de-David.local",
  "nodes" : {
    "hJLXmY_NTrCytiIMbX4_1g" : {
      "name" : "node4",
      "transport_address" : "inet[/172.18.58.139:9303]",
      "hostname" : "MacBook-Air-de-David.local",
      "version" : "0.90.0.Beta2-SNAPSHOT",
      "http_address" : "inet[/172.18.58.139:9203]",
      "plugins" : [ {
        "name" : "test-plugin",
        "description" : "test-plugin description",
        "site" : true,
        "jvm" : false
      }, {
        "name" : "test-no-version-plugin",
        "description" : "test-no-version-plugin description",
        "site" : true,
        "jvm" : false
      }, {
        "name" : "dummy",
        "description" : "No description found for dummy.",
        "url" : "/_plugin/dummy/",
        "site" : false,
        "jvm" : true
      } ]
    }
  }
}</pre><p>if your <code class="literal">plugin</code> data is subject to change use
<code class="literal">plugins.info_refresh_interval</code> to change or disable the caching
interval:</p><pre class="programlisting prettyprint lang-js"># Change cache to 20 seconds
plugins.info_refresh_interval: 20s

# Infinite cache
plugins.info_refresh_interval: -1

# Disable cache
plugins.info_refresh_interval: 0</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-nodes-hot-threads"></a>Nodes hot_threads</h2></div></div></div><p>An API allowing to get the current hot threads on each node in the
cluster. Endpoints are <code class="literal">/_nodes/hot_threads</code>, and
<code class="literal">/_nodes/{nodesIds}/hot_threads</code>.</p><p>The output is plain text with a breakdown of each nodeâs top hot
threads. Parameters allowed are:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">threads</code>
</p>
</td><td valign="top">
<p>
number of hot threads to provide, defaults to 3.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">interval</code>
</p>
</td><td valign="top">
<p>
the interval to do the second sampling of threads.
                                Defaults to 500ms.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">type</code>
</p>
</td><td valign="top">
<p>
The type to sample, defaults to cpu, but supports wait and
                                block to see hot threads that are in wait or block state.
</p>
</td></tr></tbody></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-nodes-shutdown"></a>Nodes Shutdown</h2></div></div></div><p>The nodes shutdown API allows to shutdown one or more (or all) nodes in
the cluster. Here is an example of shutting the <code class="literal">_local</code> node the
request is directed to:</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/_cluster/nodes/_local/_shutdown'</pre><p>Specific node(s) can be shutdown as well using their respective node ids
(or other selective options as explained
<a class="link" href="#cluster-nodes" title="Node specification">here</a> .):</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/_cluster/nodes/nodeId1,nodeId2/_shutdown'</pre><p>The master (of the cluster) can also be shutdown using:</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/_cluster/nodes/_master/_shutdown'</pre><p>Finally, all nodes can be shutdown using one of the options below:</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/_shutdown'

$ curl -XPOST 'http://localhost:9200/_cluster/nodes/_shutdown'

$ curl -XPOST 'http://localhost:9200/_cluster/nodes/_all/_shutdown'</pre><h3><a id="delay"></a>Delay</h3><p>By default, the shutdown will be executed after a 1 second delay (<code class="literal">1s</code>).
The delay can be customized by setting the <code class="literal">delay</code> parameter in a time
value format. For example:</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST 'http://localhost:9200/_cluster/nodes/_local/_shutdown?delay=10s'</pre><h3><a id="_disable_shutdown"></a>Disable Shutdown</h3><p>The shutdown API can be disabled by setting <code class="literal">action.disable_shutdown</code> in
the node configuration.</p></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="query-dsl"></a>Query DSL</h1></div></div></div><div class="partintro"><div></div><p><span class="strong"><strong>elasticsearch</strong></span> provides a full Query DSL based on JSON to define
queries. In general, there are basic queries such as
<a class="link" href="#query-dsl-term-query" title="Term Query">term</a> or
<a class="link" href="#query-dsl-prefix-query" title="Prefix Query">prefix</a>. There are
also compound queries like the
<a class="link" href="#query-dsl-bool-query" title="Bool Query">bool</a> query. Queries can
also have filters associated with them such as the
<a class="link" href="#query-dsl-filtered-query" title="Filtered Query">filtered</a> or
<a class="link" href="#query-dsl-constant-score-query" title="Constant Score Query">constant_score</a>
queries, with specific filter queries.</p><p>Think of the Query DSL as an AST of queries. Certain queries can contain
other queries (like the
<a class="link" href="#query-dsl-bool-query" title="Bool Query">bool</a> query), others can
contain filters (like the
<a class="link" href="#query-dsl-constant-score-query" title="Constant Score Query">constant_score</a>),
and some can contain both a query and a filter (like the
<a class="link" href="#query-dsl-filtered-query" title="Filtered Query">filtered</a>). Each of
those can contain <span class="strong"><strong>any</strong></span> query of the list of queries or <span class="strong"><strong>any</strong></span> filter
from the list of filters, resulting in the ability to build quite
complex (and interesting) queries.</p><p>Both queries and filters can be used in different APIs. For example,
within a <a class="link" href="#search-request-query" title="Query">search query</a>, or
as a <a class="link" href="#search-facets" title="Facets">facet filter</a>. This
section explains the components (queries and filters) that can form the
AST one can use.</p><p>Filters are very handy since they perform an order of magnitude better
than plain queries since no scoring is performed and they are
automatically cached.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-queries"></a>Queries</h2></div></div></div><p>As a general rule, queries should be used instead of filters:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
for full text search
</li><li class="listitem">
where the result depends on a relevance score
</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-match-query"></a>Match Query</h2></div></div></div><p>A family of <code class="literal">match</code> queries that accept text/numerics/dates, analyzes
it, and constructs a query out of it. For example:</p><pre class="programlisting prettyprint lang-js">{
    "match" : {
        "message" : "this is a test"
    }
}</pre><p>Note, <code class="literal">message</code> is the name of a field, you can substitute the name of
any field (including <code class="literal">_all</code>) instead.</p><h4><a id="_types_of_match_queries"></a>Types of Match Queries</h4><h5><a id="_boolean"></a>boolean</h5><p>The default <code class="literal">match</code> query is of type <code class="literal">boolean</code>. It means that the text
provided is analyzed and the analysis process constructs a boolean query
from the provided text. The <code class="literal">operator</code> flag can be set to <code class="literal">or</code> or <code class="literal">and</code>
to control the boolean clauses (defaults to <code class="literal">or</code>). The minimum number of
should clauses to match can be set using the
<a class="link" href="#query-dsl-minimum-should-match" title="Minimum Should Match"><code class="literal">minimum_should_match</code></a>
parameter.</p><p>The <code class="literal">analyzer</code> can be set to control which analyzer will perform the
analysis process on the text. It default to the field explicit mapping
definition, or the default search analyzer.</p><p><code class="literal">fuzziness</code> allows <span class="emphasis"><em>fuzzy matching</em></span> based on the type of field being queried.
See <a class="xref" href="#fuzziness" title="Fuzziness">the section called âFuzzinessâ</a> for allowed settings.</p><p>The <code class="literal">prefix_length</code> and
<code class="literal">max_expansions</code> can be set in this case to control the fuzzy process.
If the fuzzy option is set the query will use <code class="literal">constant_score_rewrite</code>
as its <a class="link" href="#query-dsl-multi-term-rewrite" title="Multi Term Query Rewrite">rewrite method</a> the <code class="literal">rewrite</code> parameter allows to control how the query will get
rewritten.</p><p>Here is an example when providing additional parameters (note the slight
change in structure, <code class="literal">message</code> is the field name):</p><pre class="programlisting prettyprint lang-js">{
    "match" : {
        "message" : {
            "query" : "this is a test",
            "operator" : "and"
        }
    }
}</pre><p><strong>zero_terms_query.Â </strong>If the analyzer used removes all tokens in a query like a <code class="literal">stop</code> filter
does, the default behavior is to match no documents at all. In order to
change that the <code class="literal">zero_terms_query</code> option can be used, which accepts
<code class="literal">none</code> (default) and <code class="literal">all</code> which corresponds to a <code class="literal">match_all</code> query.</p><pre class="programlisting prettyprint lang-js">{
    "match" : {
        "message" : {
            "query" : "to be or not to be",
            "operator" : "and",
            "zero_terms_query": "all"
        }
    }
}</pre><p><strong>cutoff_frequency.Â </strong>The match query supports a <code class="literal">cutoff_frequency</code> that allows
specifying an absolute or relative document frequency where high
frequent terms are moved into an optional subquery and are only scored
if one of the low frequent (below the cutoff) terms in the case of an
<code class="literal">or</code> operator or all of the low frequent terms in the case of an <code class="literal">and</code>
operator match.</p><p>This query allows handling <code class="literal">stopwords</code> dynamically at runtime, is domain
independent and doesnât require on a stopword file. It prevent scoring /
iterating high frequent terms and only takes the terms into account if a
more significant / lower frequent terms match a document. Yet, if all of
the query terms are above the given <code class="literal">cutoff_frequency</code> the query is
automatically transformed into a pure conjunction (<code class="literal">and</code>) query to
ensure fast execution.</p><p>The <code class="literal">cutoff_frequency</code> can either be relative to the number of documents
in the index if in the range <code class="literal">[0..1)</code> or absolute if greater or equal to
<code class="literal">1.0</code>.</p><p>Note: If the <code class="literal">cutoff_frequency</code> is used and the operator is <code class="literal">and</code>
<span class="emphasis"><em>stacked tokens</em></span> (tokens that are on the same position like <code class="literal">synonym</code> filter emits)
are not handled gracefully as they are in a pure <code class="literal">and</code> query. For instance the query
<code class="literal">fast fox</code> is analyzed into 3 terms <code class="literal">[fast, quick, fox]</code> where <code class="literal">quick</code> is a synonym
for <code class="literal">fast</code> on the same token positions the query might require <code class="literal">fast</code> and <code class="literal">quick</code> to
match if the operator is <code class="literal">and</code>.</p><p>Here is an example showing a query composed of stopwords exclusivly:</p><pre class="programlisting prettyprint lang-js">{
    "match" : {
        "message" : {
            "query" : "to be or not to be",
            "cutoff_frequency" : 0.001
        }
    }
}</pre><h5><a id="_phrase"></a>phrase</h5><p>The <code class="literal">match_phrase</code> query analyzes the text and creates a <code class="literal">phrase</code> query
out of the analyzed text. For example:</p><pre class="programlisting prettyprint lang-js">{
    "match_phrase" : {
        "message" : "this is a test"
    }
}</pre><p>Since <code class="literal">match_phrase</code> is only a <code class="literal">type</code> of a <code class="literal">match</code> query, it can also be
used in the following manner:</p><pre class="programlisting prettyprint lang-js">{
    "match" : {
        "message" : {
            "query" : "this is a test",
            "type" : "phrase"
        }
    }
}</pre><p>A phrase query matches terms up to a configurable <code class="literal">slop</code>
(which defaults to 0) in any order. Transposed terms have a slop of 2.</p><p>The <code class="literal">analyzer</code> can be set to control which analyzer will perform the
analysis process on the text. It default to the field explicit mapping
definition, or the default search analyzer, for example:</p><pre class="programlisting prettyprint lang-js">{
    "match_phrase" : {
        "message" : {
            "query" : "this is a test",
            "analyzer" : "my_analyzer"
        }
    }
}</pre><h5><a id="_match_phrase_prefix"></a>match_phrase_prefix</h5><p>The <code class="literal">match_phrase_prefix</code> is the same as <code class="literal">match_phrase</code>, except that it
allows for prefix matches on the last term in the text. For example:</p><pre class="programlisting prettyprint lang-js">{
    "match_phrase_prefix" : {
        "message" : "this is a test"
    }
}</pre><p>Or:</p><pre class="programlisting prettyprint lang-js">{
    "match" : {
        "message" : {
            "query" : "this is a test",
            "type" : "phrase_prefix"
        }
    }
}</pre><p>It accepts the same parameters as the phrase type. In addition, it also
accepts a <code class="literal">max_expansions</code> parameter that can control to how many
prefixes the last term will be expanded. It is highly recommended to set
it to an acceptable value to control the execution time of the query.
For example:</p><pre class="programlisting prettyprint lang-js">{
    "match_phrase_prefix" : {
        "message" : {
            "query" : "this is a test",
            "max_expansions" : 10
        }
    }
}</pre><h4><a id="_comparison_to_query_string_field"></a>Comparison to query_string / field</h4><p>The match family of queries does not go through a "query parsing"
process. It does not support field name prefixes, wildcard characters,
or other "advance" features. For this reason, chances of it failing are
very small / non existent, and it provides an excellent behavior when it
comes to just analyze and run that text as a query behavior (which is
usually what a text search box does). Also, the <code class="literal">phrase_prefix</code> type can
provide a great "as you type" behavior to automatically load search
results.</p><h4><a id="_other_options_2"></a>Other options</h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">lenient</code> - If set to true will cause format based failures (like
providing text to a numeric field) to be ignored. Defaults to false.
</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-multi-match-query"></a>Multi Match Query</h2></div></div></div><p>The <code class="literal">multi_match</code> query builds on the <a class="link" href="#query-dsl-match-query" title="Match Query"><code class="literal">match</code> query</a>
to allow multi-field queries:</p><pre class="programlisting prettyprint lang-js">{
  "multi_match" : {
    "query":    "this is a test", <a id="CO24-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "fields": [ "subject", "message" ] <a id="CO24-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
  }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO24-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The query string.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO24-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The fields to be queried.
</p></td></tr></table></div><h3><a id="_literal_fields_literal_and_per_field_boosting"></a><code class="literal">fields</code> and per-field boosting</h3><p>Fields can be specified with wildcards, eg:</p><pre class="programlisting prettyprint lang-js">{
  "multi_match" : {
    "query":    "Will Smith"
    "fields": [ "title", "*_name" ] <a id="CO25-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
  }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Query the <code class="literal">title</code>, <code class="literal">first_name</code> and <code class="literal">last_name</code> fields.
</p></td></tr></table></div><p>Individual fields can be boosted with the caret (<code class="literal">^</code>) notation:</p><pre class="programlisting prettyprint lang-js">{
  "multi_match" : {
    "query" : "this is a test",
    "fields" : [ "subject^3", "message" ] <a id="CO26-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
  }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO26-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">subject</code> field is three times as important than the <code class="literal">message</code> field.
</p></td></tr></table></div><h3><a id="_literal_use_dis_max_literal"></a><code class="literal">use_dis_max</code></h3><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><h4>Deprecated in 1.1.0.</h4><p>Use <code class="literal">type:best_fields</code> or <code class="literal">type:most_fields</code> instead. See <a class="xref" href="#multi-match-types" title="Types of multi_match query:">the section called âTypes of <code class="literal">multi_match</code> query:â</a>.</p></div></div><p>By default, the <code class="literal">multi_match</code> query generates a <code class="literal">match</code> clause per field, then wraps them
in a <code class="literal">dis_max</code> query.  By setting <code class="literal">use_dis_max</code> to <code class="literal">false</code>, they will be wrapped in a
<code class="literal">bool</code> query instead.</p><h3><a id="multi-match-types"></a>Types of <code class="literal">multi_match</code> query:</h3><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.1.0.</p></div></div><p>The way the <code class="literal">multi_match</code> query is executed internally depends on the <code class="literal">type</code>
parameter, which can be set to:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">best_fields</code>
</p>
</td><td valign="top">
<p>
(<span class="strong"><strong>default</strong></span>) Finds documents which match any field, but
                    uses the  <code class="literal">_score</code> from the best field.  See <a class="xref" href="#type-best-fields" title="best_fields"><code class="literal">best_fields</code></a>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">most_fields</code>
</p>
</td><td valign="top">
<p>
Finds documents which match any field and combines
                    the <code class="literal">_score</code> from each field.  See <a class="xref" href="#type-most-fields" title="most_fields"><code class="literal">most_fields</code></a>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">cross_fields</code>
</p>
</td><td valign="top">
<p>
Treats fields with the same <code class="literal">analyzer</code> as though they
                    were one big field. Looks for each word in <span class="strong"><strong>any</strong></span>
                    field. See <a class="xref" href="#type-cross-fields" title="cross_fields"><code class="literal">cross_fields</code></a>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">phrase</code>
</p>
</td><td valign="top">
<p>
Runs a <code class="literal">match_phrase</code> query on each field and combines
                    the <code class="literal">_score</code> from each field.  See <a class="xref" href="#type-phrase" title="phrase and phrase_prefix"><code class="literal">phrase</code> and <code class="literal">phrase_prefix</code></a>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">phrase_prefix</code>
</p>
</td><td valign="top">
<p>
Runs a <code class="literal">match_phrase_prefix</code> query on each field and
                    combines the <code class="literal">_score</code> from each field.  See <a class="xref" href="#type-phrase" title="phrase and phrase_prefix"><code class="literal">phrase</code> and <code class="literal">phrase_prefix</code></a>.
</p>
</td></tr></tbody></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="type-best-fields"></a><code class="literal">best_fields</code></h3></div></div></div><p>The <code class="literal">best_fields</code> type is most useful when you are searching for multiple
words best found in the same field. For instance âbrown foxâ in a single
field is more meaningful than âbrownâ in one field and âfoxâ in the other.</p><p>The <code class="literal">best_fields</code> type generates a <a class="link" href="#query-dsl-match-query" title="Match Query"><code class="literal">match</code> query</a> for
each field and wraps them in a <a class="link" href="#query-dsl-dis-max-query" title="Dis Max Query"><code class="literal">dis_max</code></a> query, to
find the single best matching field.  For instance, this query:</p><pre class="programlisting prettyprint lang-js">{
  "multi_match" : {
    "query":      "brown fox",
    "type":       "best_fields",
    "fields":     [ "subject", "message" ],
    "tie_breaker": 0.3
  }
}</pre><p>would be executed as:</p><pre class="programlisting prettyprint lang-js">{
  "dis_max": {
    "queries": [
      { "match": { "subject": "brown fox" }},
      { "match": { "message": "brown fox" }}
    ],
    "tie_breaker": 0.3
  }
}</pre><p>Normally the <code class="literal">best_fields</code> type uses the score of the <span class="strong"><strong>single</strong></span> best matching
field, but if <code class="literal">tie_breaker</code> is specified, then it calculates the score as
follows:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
the score from the best matching field
</li><li class="listitem">
plus <code class="literal">tie_breaker * _score</code> for all other matching fields
</li></ul></div><p>Also, accepts <code class="literal">analyzer</code>, <code class="literal">boost</code>, <code class="literal">operator</code>, <code class="literal">minimum_should_match</code>,
<code class="literal">fuzziness</code>, <code class="literal">prefix_length</code>, <code class="literal">max_expansions</code>, <code class="literal">rewrite</code>, <code class="literal">zero_terms_query</code>
and <code class="literal">cutoff_frequency</code>, as explained in <a class="link" href="#query-dsl-match-query" title="Match Query">match query</a>.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><h4><code class="literal">operator</code> and <code class="literal">minimum_should_match</code></h4><a id="operator-min"></a><p>The <code class="literal">best_fields</code> and <code class="literal">most_fields</code> types are <span class="emphasis"><em>field-centric</em></span>âââthey generate
a <code class="literal">match</code> query <span class="strong"><strong>per field</strong></span>.  This means that the <code class="literal">operator</code> and
<code class="literal">minimum_should_match</code> parameters are applied to each field individually,
which is probably not what you want.</p><p>Take this query for example:</p><pre class="programlisting prettyprint lang-js">{
  "multi_match" : {
    "query":      "Will Smith",
    "type":       "best_fields",
    "fields":     [ "first_name", "last_name" ],
    "operator":   "and" <a id="CO27-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
  }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO27-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
All terms must be present.
</p></td></tr></table></div><p>This query is executed as:</p><pre class="literallayout">  (+first_name:will +first_name:smith)
| (+last_name:will  +last_name:smith)</pre><p>In other words, <span class="strong"><strong>all terms</strong></span> must be present <span class="strong"><strong>in a single field</strong></span> for a document
to match.</p><p>See <a class="xref" href="#type-cross-fields" title="cross_fields"><code class="literal">cross_fields</code></a> for a better solution.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="type-most-fields"></a><code class="literal">most_fields</code></h3></div></div></div><p>The <code class="literal">most_fields</code> type is most useful when querying multiple fields that
contain the same text analyzed in different ways.  For instance, the main
field may contain synonyms, stemming and terms without diacritics. A second
field may contain the original terms, and a third field might contain
shingles. By combining scores from all three fields we can match as many
documents as possible with the main field, but use the second and third fields
to push the most similar results to the top of the list.</p><p>This query:</p><pre class="programlisting prettyprint lang-js">{
  "multi_match" : {
    "query":      "quick brown fox",
    "type":       "most_fields",
    "fields":     [ "title", "title.original", "title.shingles" ]
  }
}</pre><p>would be executed as:</p><pre class="programlisting prettyprint lang-js">{
  "bool": {
    "should": [
      { "match": { "title":          "quick brown fox" }},
      { "match": { "title.original": "quick brown fox" }},
      { "match": { "title.shingles": "quick brown fox" }}
    ]
  }
}</pre><p>The score from each <code class="literal">match</code> clause is added together, then divided by the
number of <code class="literal">match</code> clauses.</p><p>Also, accepts <code class="literal">analyzer</code>, <code class="literal">boost</code>, <code class="literal">operator</code>, <code class="literal">minimum_should_match</code>,
<code class="literal">fuzziness</code>, <code class="literal">prefix_length</code>, <code class="literal">max_expansions</code>, <code class="literal">rewrite</code>, <code class="literal">zero_terms_query</code>
and <code class="literal">cutoff_frequency</code>, as explained in <a class="link" href="#query-dsl-match-query" title="Match Query">match query</a>, but
<span class="strong"><strong>see <a class="xref" href="#operator-min" title="operator and minimum_should_match"><code class="literal">operator</code> and <code class="literal">minimum_should_match</code></a></strong></span>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="type-phrase"></a><code class="literal">phrase</code> and <code class="literal">phrase_prefix</code></h3></div></div></div><p>The <code class="literal">phrase</code> and <code class="literal">phrase_prefix</code> types behave just like <a class="xref" href="#type-best-fields" title="best_fields"><code class="literal">best_fields</code></a>,
but they use a <code class="literal">match_phrase</code> or <code class="literal">match_phrase_prefix</code> query instead of a
<code class="literal">match</code> query.</p><p>This query:</p><pre class="programlisting prettyprint lang-js">{
  "multi_match" : {
    "query":      "quick brown f",
    "type":       "phrase_prefix",
    "fields":     [ "subject", "message" ]
  }
}</pre><pre class="programlisting prettyprint lang-js">{
  "dis_max": {
    "queries": [
      { "match_phrase_prefix": { "subject": "quick brown f" }},
      { "match_phrase_prefix": { "message": "quick brown f" }}
    ]
  }
}</pre><p>Also, accepts <code class="literal">analyzer</code>, <code class="literal">boost</code>, <code class="literal">slop</code> and <code class="literal">zero_terms_query</code>  as explained
in <a class="xref" href="#query-dsl-match-query" title="Match Query">Match Query</a>.  Type <code class="literal">phrase_prefix</code> additionally accepts
<code class="literal">max_expansions</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="type-cross-fields"></a><code class="literal">cross_fields</code></h3></div></div></div><p>The <code class="literal">cross_fields</code> type is particularly useful with structured documents where
multiple fields <span class="strong"><strong>should</strong></span> match.  For instance, when querying the <code class="literal">first_name</code>
and <code class="literal">last_name</code> fields for âWill Smithâ, the best match is like to have
âWillâ in one field and âSmithâ in the other.</p><div class="sidebar"><div class="titlepage"></div><p>This sounds like a job for <a class="xref" href="#type-most-fields" title="most_fields"><code class="literal">most_fields</code></a> but there are two problems
with that approach. The first problem is that <code class="literal">operator</code> and
<code class="literal">minimum_should_match</code> are applied per-field, instead of per-term (see
<a class="link" href="#operator-min" title="operator and minimum_should_match">explanation above</a>).</p><p>The second problem is to do with relevance: the different term frequencies in
the <code class="literal">first_name</code> and <code class="literal">last_name</code> fields   can produce unexpected results.</p><p>For instance, imagine we have two people: âWill Smithâ and âSmith Jonesâ.
âSmithâ as a last name is very common (and so is of low importance) but
âSmithâ as a first name is very uncommon (and so is of great importance).</p><p>If we do a search for âWill Smithâ, the âSmith Jonesâ document will
probably appear above the better matching âWill Smithâ because the score of
<code class="literal">first_name:smith</code> has trumped the combined scores of <code class="literal">first_name:will</code> plus
<code class="literal">last_name:smith</code>.</p></div><p>One way of dealing with these types of queries is simply to index the
<code class="literal">first_name</code> and <code class="literal">last_name</code> fields into a single <code class="literal">full_name</code> field.  Of
course, this can only be done at index time.</p><p>The <code class="literal">cross_field</code> type tries to solve these problems at query time by taking a
<span class="emphasis"><em>term-centric</em></span> approach.  It first analyzes the query string into individual
terms, then looks for each term in any of the fields, as though they were one
big field.</p><p>A query like:</p><pre class="programlisting prettyprint lang-js">{
  "multi_match" : {
    "query":      "Will Smith",
    "type":       "cross_fields",
    "fields":     [ "first_name", "last_name" ],
    "operator":   "and"
  }
}</pre><p>is executed as:</p><pre class="literallayout">+(first_name:will  last_name:will)
+(first_name:smith last_name:smith)</pre><p>In other words, <span class="strong"><strong>all terms</strong></span> must be present <span class="strong"><strong>in at least one field</strong></span> for a
document to match.  (Compare this to
<a class="link" href="#operator-min" title="operator and minimum_should_match">the logic used for <code class="literal">best_fields</code> and <code class="literal">most_fields</code></a>.)</p><p>That solves one of the two problems. The problem of differing term frequencies
is solved by <span class="emphasis"><em>blending</em></span> the term frequencies for all fields in order to even
out the differences.  In other words, <code class="literal">first_name:smith</code> will be treated as
though it has the same weight as <code class="literal">last_name:smith</code>. (Actually,
<code class="literal">first_name:smith</code> is given a tiny advantage over <code class="literal">last_name:smith</code>, just to
make the order of results more stable.)</p><p>If you run the above query through the <a class="xref" href="#search-validate" title="Validate API"><em>Validate API</em></a>, it returns this
explanation:</p><pre class="literallayout">+blended("will",  fields: [first_name, last_name])
+blended("smith", fields: [first_name, last_name])</pre><p>Also, accepts <code class="literal">analyzer</code>, <code class="literal">boost</code>, <code class="literal">operator</code>, <code class="literal">minimum_should_match</code>,
<code class="literal">zero_terms_query</code> and <code class="literal">cutoff_frequency</code>, as explained in
<a class="link" href="#query-dsl-match-query" title="Match Query">match query</a>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_literal_cross_field_literal_and_analysis"></a><code class="literal">cross_field</code> and analysis</h4></div></div></div><p>The <code class="literal">cross_field</code> type can only work in term-centric mode on fields that have
the same analyzer. Fields with the same analyzer are grouped together as in
the example above.  If there are multiple groups, they are combined with a
<code class="literal">bool</code> query.</p><p>For instance, if we have a <code class="literal">first</code> and <code class="literal">last</code> field which have
the same analyzer, plus a <code class="literal">first.edge</code> and <code class="literal">last.edge</code> which
both use an <code class="literal">edge_ngram</code> analyzer, this query:</p><pre class="programlisting prettyprint lang-js">{
  "multi_match" : {
    "query":      "Jon",
    "type":       "cross_fields",
    "fields":     [
        "first", "first.edge",
        "last",  "last.edge"
    ]
  }
}</pre><p>would be executed as:</p><pre class="literallayout">    blended("jon", fields: [first, last])
| (
    blended("j",   fields: [first.edge, last.edge])
    blended("jo",  fields: [first.edge, last.edge])
    blended("jon", fields: [first.edge, last.edge])
)</pre><p>In other words, <code class="literal">first</code> and <code class="literal">last</code> would be grouped together and
treated as a single field, and <code class="literal">first.edge</code> and <code class="literal">last.edge</code> would be
grouped together and treated as a single field.</p><p>Having multiple groups is fine but, when combined with <code class="literal">operator</code> or
<code class="literal">minimum_should_match</code>, it can suffer from the <a class="link" href="#operator-min" title="operator and minimum_should_match">same problem</a>
as <code class="literal">most_fields</code> or <code class="literal">best_fields</code>.</p><p>You can easily rewrite this query yourself as two separate <code class="literal">cross_type</code>
queries combined with a <code class="literal">bool</code> query, and apply the <code class="literal">minimum_should_match</code>
parameter to just one of them:</p><pre class="programlisting prettyprint lang-js">{
    "bool": {
        "should": [
            {
              "multi_match" : {
                "query":      "Will Smith",
                "type":       "cross_fields",
                "fields":     [ "first", "last" ],
                "minimum_should_match": "50%" <a id="CO28-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
              }
            },
            {
              "multi_match" : {
                "query":      "Will Smith",
                "type":       "cross_fields",
                "fields":     [ "*.edge" ]
              }
            }
        ]
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Either <code class="literal">will</code> or <code class="literal">smith</code> must be present in either of the <code class="literal">first</code>
    or <code class="literal">last</code> fields
</p></td></tr></table></div><p>You can force all fields into the same group by specifying the <code class="literal">analyzer</code>
parameter in the query.</p><pre class="programlisting prettyprint lang-js">{
  "multi_match" : {
    "query":      "Jon",
    "type":       "cross_fields",
    "analyzer":   "standard", <a id="CO29-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "fields":     [ "first", "last", "*.edge" ]
  }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO29-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Use the <code class="literal">standard</code> analyzer for all fields.
</p></td></tr></table></div><p>which will be executed as:</p><pre class="literallayout">blended("will",  fields: [first, first.edge, last.edge, last])
blended("smith", fields: [first, first.edge, last.edge, last])</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_literal_tie_breaker_literal"></a><code class="literal">tie_breaker</code></h4></div></div></div><p>By default, each per-term <code class="literal">blended</code> query will use the best score returned by
any field in a group, then these scores are added together to give the final
score. The <code class="literal">tie_breaker</code> parameter can change the default behaviour of the
per-term <code class="literal">blended</code> queries. It accepts:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">0.0</code>
</p>
</td><td valign="top">
<p>
Take the single best score out of (eg) <code class="literal">first_name:will</code>
                    and <code class="literal">last_name:will</code> (<span class="strong"><strong>default</strong></span>)
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">1.0</code>
</p>
</td><td valign="top">
<p>
Add together the scores for (eg) <code class="literal">first_name:will</code> and
                    <code class="literal">last_name:will</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">0.0 &lt; n &lt; 1.0</code>
</p>
</td><td valign="top">
<p>
Take the single best score plus <code class="literal">tie_breaker</code> multiplied
                    by each of the scores from other matching fields.
</p>
</td></tr></tbody></table></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-bool-query"></a>Bool Query</h2></div></div></div><p>A query that matches documents matching boolean combinations of other
queries. The bool query maps to Lucene <code class="literal">BooleanQuery</code>. It is built using
one or more boolean clauses, each clause with a typed occurrence. The
occurrence types are:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Occur </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">must</code></p></td><td align="left" valign="top"><p>The clause (query) must appear in matching documents.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">should</code></p></td><td align="left" valign="top"><p>The clause (query) should appear in the matching document. In
a boolean query with no <code class="literal">must</code> clauses, one or more <code class="literal">should</code> clauses
must match a document. The minimum number of should clauses to match can
be set using the
<a class="link" href="#query-dsl-minimum-should-match" title="Minimum Should Match"><code class="literal">minimum_should_match</code></a>
parameter.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">must_not</code></p></td><td align="left" valign="top"><p>The clause (query) must not appear in the matching
documents.</p></td></tr></tbody></table></div><p>The bool query also supports <code class="literal">disable_coord</code> parameter (defaults to
<code class="literal">false</code>). Basically the coord similarity computes a score factor based
on the fraction of all query terms that a document contains. See Lucene
<code class="literal">BooleanQuery</code> for more details.</p><pre class="programlisting prettyprint lang-js">{
    "bool" : {
        "must" : {
            "term" : { "user" : "kimchy" }
        },
        "must_not" : {
            "range" : {
                "age" : { "from" : 10, "to" : 20 }
            }
        },
        "should" : [
            {
                "term" : { "tag" : "wow" }
            },
            {
                "term" : { "tag" : "elasticsearch" }
            }
        ],
        "minimum_should_match" : 1,
        "boost" : 1.0
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-boosting-query"></a>Boosting Query</h2></div></div></div><p>The <code class="literal">boosting</code> query can be used to effectively demote results that
match a given query. Unlike the "NOT" clause in bool query, this still
selects documents that contain undesirable terms, but reduces their
overall score.</p><pre class="programlisting prettyprint lang-js">{
    "boosting" : {
        "positive" : {
            "term" : {
                "field1" : "value1"
            }
        },
        "negative" : {
            "term" : {
                "field2" : "value2"
            }
        },
        "negative_boost" : 0.2
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-common-terms-query"></a>Common Terms Query</h2></div></div></div><p>The <code class="literal">common</code> terms query is a modern alternative to stopwords which
improves the precision and recall of search results (by taking stopwords
into account), without sacrificing performance.</p><h4><a id="_the_problem"></a>The problem</h4><p>Every term in a query has a cost. A search for <code class="literal">"The brown fox"</code>
requires three term queries, one for each of <code class="literal">"the"</code>, <code class="literal">"brown"</code> and
<code class="literal">"fox"</code>, all of which are executed against all documents in the index.
The query for <code class="literal">"the"</code> is likely to match many documents and thus has a
much smaller impact on relevance than the other two terms.</p><p>Previously, the solution to this problem was to ignore terms with high
frequency. By treating <code class="literal">"the"</code> as a <span class="emphasis"><em>stopword</em></span>, we reduce the index size
and reduce the number of term queries that need to be executed.</p><p>The problem with this approach is that, while stopwords have a small
impact on relevance, they are still important. If we remove stopwords,
we lose precision, (eg we are unable to distinguish between <code class="literal">"happy"</code>
and <code class="literal">"not happy"</code>) and we lose recall (eg text like <code class="literal">"The The"</code> or
<code class="literal">"To be or not to be"</code> would simply not exist in the index).</p><h4><a id="_the_solution"></a>The solution</h4><p>The <code class="literal">common</code> terms query divides the query terms into two groups: more
important (ie <span class="emphasis"><em>low frequency</em></span> terms) and less important (ie <span class="emphasis"><em>high
frequency</em></span> terms which would previously have been stopwords).</p><p>First it searches for documents which match the more important terms.
These are the terms which appear in fewer documents and have a greater
impact on relevance.</p><p>Then, it executes a second query for the less important termsâââterms
which appear frequently and have a low impact on relevance. But instead
of calculating the relevance score for <span class="strong"><strong>all</strong></span> matching documents, it only
calculates the <code class="literal">_score</code> for documents already matched by the first
query. In this way the high frequency terms can improve the relevance
calculation without paying the cost of poor performance.</p><p>If a query consists only of high frequency terms, then a single query is
executed as an <code class="literal">AND</code> (conjunction) query, in other words all terms are
required. Even though each individual term will match many documents,
the combination of terms narrows down the resultset to only the most
relevant. The single query can also be executed as an <code class="literal">OR</code> with a
specific
<a class="link" href="#query-dsl-minimum-should-match" title="Minimum Should Match"><code class="literal">minimum_should_match</code></a>,
in this case a high enough value should probably be used.</p><p>Terms are allocated to the high or low frequency groups based on the
<code class="literal">cutoff_frequency</code>, which can be specified as an absolute frequency
(<code class="literal">&gt;=1</code>) or as a relative frequency (<code class="literal">0.0 .. 1.0</code>).</p><p>Perhaps the most interesting property of this query is that it adapts to
domain specific stopwords automatically. For example, on a video hosting
site, common terms like <code class="literal">"clip"</code> or <code class="literal">"video"</code> will automatically behave
as stopwords without the need to maintain a manual list.</p><h4><a id="_examples_3"></a>Examples</h4><p>In this example, words that have a document frequency greater than 0.1%
(eg <code class="literal">"this"</code> and <code class="literal">"is"</code>) will be treated as <span class="emphasis"><em>common terms</em></span>.</p><pre class="programlisting prettyprint lang-js">{
  "common": {
    "body": {
      "query":            "this is bonsai cool",
      "cutoff_frequency": 0.001
    }
  }
}</pre><p>The number of terms which should match can be controlled with the
<a class="link" href="#query-dsl-minimum-should-match" title="Minimum Should Match"><code class="literal">minimum_should_match</code></a>
(<code class="literal">high_freq</code>, <code class="literal">low_freq</code>), <code class="literal">low_freq_operator</code> (default <code class="literal">"or"</code>) and
<code class="literal">high_freq_operator</code> (default <code class="literal">"or"</code>) parameters.</p><p>For low frequency terms, set the <code class="literal">low_freq_operator</code> to <code class="literal">"and"</code> to make
all terms required:</p><pre class="programlisting prettyprint lang-js">{
  "common": {
    "body": {
      "query":            "nelly the elephant as a cartoon",
      "cutoff_frequency": 0.001,
      "low_freq_operator" "and"
    }
  }
}</pre><p>which is roughly equivalent to:</p><pre class="programlisting prettyprint lang-js">{
  "bool": {
    "must": [
      { "term": { "body": "nelly"}},
      { "term": { "body": "elephant"}},
      { "term": { "body": "cartoon"}}
    ],
    "should": [
      { "term": { "body": "the"}}
      { "term": { "body": "as"}}
      { "term": { "body": "a"}}
    ]
  }
}</pre><p>Alternatively use
<a class="link" href="#query-dsl-minimum-should-match" title="Minimum Should Match"><code class="literal">minimum_should_match</code></a>
to specify a minimum number or percentage of low frequency terms which
must be present, for instance:</p><pre class="programlisting prettyprint lang-js">{
  "common": {
    "body": {
      "query":                "nelly the elephant as a cartoon",
      "cutoff_frequency":     0.001,
      "minimum_should_match": 2
    }
  }
}</pre><p>which is roughly equivalent to:</p><pre class="programlisting prettyprint lang-js">{
  "bool": {
    "must": {
      "bool": {
        "should": [
          { "term": { "body": "nelly"}},
          { "term": { "body": "elephant"}},
          { "term": { "body": "cartoon"}}
        ],
        "minimum_should_match": 2
      }
    },
    "should": [
      { "term": { "body": "the"}}
      { "term": { "body": "as"}}
      { "term": { "body": "a"}}
    ]
  }
}</pre><p>minimum_should_match</p><p>A different
<a class="link" href="#query-dsl-minimum-should-match" title="Minimum Should Match"><code class="literal">minimum_should_match</code></a>
can be applied for low and high frequency terms with the additional
<code class="literal">low_freq</code> and <code class="literal">high_freq</code> parameters Here is an example when providing
additional parameters (note the change in structure):</p><pre class="programlisting prettyprint lang-js">{
  "common": {
    "body": {
      "query":                "nelly the elephant not as a cartoon",
      "cutoff_frequency":     0.001,
      "minimum_should_match": {
          "low_freq" : 2,
          "high_freq" : 3
       }
    }
  }
}</pre><p>which is roughly equivalent to:</p><pre class="programlisting prettyprint lang-js">{
  "bool": {
    "must": {
      "bool": {
        "should": [
          { "term": { "body": "nelly"}},
          { "term": { "body": "elephant"}},
          { "term": { "body": "cartoon"}}
        ],
        "minimum_should_match": 2
      }
    },
    "should": {
      "bool": {
        "should": [
          { "term": { "body": "the"}},
          { "term": { "body": "not"}},
          { "term": { "body": "as"}},
          { "term": { "body": "a"}}
        ],
        "minimum_should_match": 3
      }
    }
  }
}</pre><p>In this case it means the high frequency terms have only an impact on
relevance when there are at least three of them. But the most
interesting use of the
<a class="link" href="#query-dsl-minimum-should-match" title="Minimum Should Match"><code class="literal">minimum_should_match</code></a>
for high frequency terms is when there are only high frequency terms:</p><pre class="programlisting prettyprint lang-js">{
  "common": {
    "body": {
      "query":                "how not to be",
      "cutoff_frequency":     0.001,
      "minimum_should_match": {
          "low_freq" : 2,
          "high_freq" : 3
       }
    }
  }
}</pre><p>which is roughly equivalent to:</p><pre class="programlisting prettyprint lang-js">{
  "bool": {
    "should": [
      { "term": { "body": "how"}},
      { "term": { "body": "not"}},
      { "term": { "body": "to"}},
      { "term": { "body": "be"}}
    ],
    "minimum_should_match": "3&lt;50%"
  }
}</pre><p>The high frequency generated query is then slightly less restrictive
than with an <code class="literal">AND</code>.</p><p>The <code class="literal">common</code> terms query also supports <code class="literal">boost</code>, <code class="literal">analyzer</code> and
<code class="literal">disable_coord</code> as parameters.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-constant-score-query"></a>Constant Score Query</h2></div></div></div><p>A query that wraps a filter or another query and simply returns a
constant score equal to the query boost for every document in the
filter. Maps to Lucene <code class="literal">ConstantScoreQuery</code>.</p><pre class="programlisting prettyprint lang-js">{
    "constant_score" : {
        "filter" : {
            "term" : { "user" : "kimchy"}
        },
        "boost" : 1.2
    }
}</pre><p>The filter object can hold only filter elements, not queries. Filters
can be much faster compared to queries since they donât perform any
scoring, especially when they are cached.</p><p>A query can also be wrapped in a <code class="literal">constant_score</code> query:</p><pre class="programlisting prettyprint lang-js">{
    "constant_score" : {
        "query" : {
            "term" : { "user" : "kimchy"}
        },
        "boost" : 1.2
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-dis-max-query"></a>Dis Max Query</h2></div></div></div><p>A query that generates the union of documents produced by its
subqueries, and that scores each document with the maximum score for
that document as produced by any subquery, plus a tie breaking increment
for any additional matching subqueries.</p><p>This is useful when searching for a word in multiple fields with
different boost factors (so that the fields cannot be combined
equivalently into a single search field). We want the primary score to
be the one associated with the highest boost, not the sum of the field
scores (as Boolean Query would give). If the query is "albino elephant"
this ensures that "albino" matching one field and "elephant" matching
another gets a higher score than "albino" matching both fields. To get
this result, use both Boolean Query and DisjunctionMax Query: for each
term a DisjunctionMaxQuery searches for it in each field, while the set
of these DisjunctionMaxQueryâs is combined into a BooleanQuery.</p><p>The tie breaker capability allows results that include the same term in
multiple fields to be judged better than results that include this term
in only the best of those multiple fields, without confusing this with
the better case of two different terms in the multiple fields.The
default <code class="literal">tie_breaker</code> is <code class="literal">0.0</code>.</p><p>This query maps to Lucene <code class="literal">DisjunctionMaxQuery</code>.</p><pre class="programlisting prettyprint lang-js">{
    "dis_max" : {
        "tie_breaker" : 0.7,
        "boost" : 1.2,
        "queries" : [
            {
                "term" : { "age" : 34 }
            },
            {
                "term" : { "age" : 35 }
            }
        ]
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-filtered-query"></a>Filtered Query</h2></div></div></div><p>A query that applies a filter to the results of another query. This
query maps to Lucene <code class="literal">FilteredQuery</code>.</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "term" : { "tag" : "wow" }
        },
        "filter" : {
            "range" : {
                "age" : { "from" : 10, "to" : 20 }
            }
        }
    }
}</pre><p>The filter object can hold only filter elements, not queries. Filters
can be much faster compared to queries since they donât perform any
scoring, especially when they are cached.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-flt-query"></a>Fuzzy Like This Query</h2></div></div></div><p>Fuzzy like this query find documents that are "like" provided text by
running it against one or more fields.</p><pre class="programlisting prettyprint lang-js">{
    "fuzzy_like_this" : {
        "fields" : ["name.first", "name.last"],
        "like_text" : "text like this one",
        "max_query_terms" : 12
    }
}</pre><p><code class="literal">fuzzy_like_this</code> can be shortened to <code class="literal">flt</code>.</p><p>The <code class="literal">fuzzy_like_this</code> top level parameters include:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Parameter </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">fields</code></p></td><td align="left" valign="top"><p>A list of the fields to run the more like this query against.
Defaults to the <code class="literal">_all</code> field.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">like_text</code></p></td><td align="left" valign="top"><p>The text to find documents like it, <span class="strong"><strong>required</strong></span>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ignore_tf</code></p></td><td align="left" valign="top"><p>Should term frequency be ignored. Defaults to <code class="literal">false</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_query_terms</code></p></td><td align="left" valign="top"><p>The maximum number of query terms that will be
included in any generated query. Defaults to <code class="literal">25</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">fuzziness</code></p></td><td align="left" valign="top"><p>The minimum similarity of the term variants. Defaults
to <code class="literal">0.5</code>. See  <a class="xref" href="#fuzziness" title="Fuzziness">the section called âFuzzinessâ</a>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">prefix_length</code></p></td><td align="left" valign="top"><p>Length of required common prefix on variant terms.
Defaults to <code class="literal">0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">boost</code></p></td><td align="left" valign="top"><p>Sets the boost value of the query. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td align="left" valign="top"><p>The analyzer that will be used to analyze the text.
Defaults to the analyzer associated with the field.</p></td></tr></tbody></table></div><h4><a id="_how_it_works"></a>How it Works</h4><p>Fuzzifies ALL terms provided as strings and then picks the best n
differentiating terms. In effect this mixes the behaviour of FuzzyQuery
and MoreLikeThis but with special consideration of fuzzy scoring
factors. This generally produces good results for queries where users
may provide details in a number of fields and have no knowledge of
boolean query syntax and also want a degree of fuzzy matching and a fast
query.</p><p>For each source term the fuzzy variants are held in a BooleanQuery with
no coord factor (because we are not looking for matches on multiple
variants in any one doc). Additionally, a specialized TermQuery is used
for variants and does not use that variant termâs IDF because this would
favor rarer terms, such as misspellings. Instead, all variants use the
same IDF ranking (the one for the source query term) and this is
factored into the variantâs boost. If the source query term does not
exist in the index the average IDF of the variants is used.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-flt-field-query"></a>Fuzzy Like This Field Query</h2></div></div></div><p>The <code class="literal">fuzzy_like_this_field</code> query is the same as the <code class="literal">fuzzy_like_this</code>
query, except that it runs against a single field. It provides nicer
query DSL over the generic <code class="literal">fuzzy_like_this</code> query, and support typed
fields query (automatically wraps typed fields with type filter to match
only on the specific type).</p><pre class="programlisting prettyprint lang-js">{
    "fuzzy_like_this_field" : {
        "name.first" : {
            "like_text" : "text like this one",
            "max_query_terms" : 12
        }
    }
}</pre><p><code class="literal">fuzzy_like_this_field</code> can be shortened to <code class="literal">flt_field</code>.</p><p>The <code class="literal">fuzzy_like_this_field</code> top level parameters include:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Parameter </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">like_text</code></p></td><td align="left" valign="top"><p>The text to find documents like it, <span class="strong"><strong>required</strong></span>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ignore_tf</code></p></td><td align="left" valign="top"><p>Should term frequency be ignored. Defaults to <code class="literal">false</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_query_terms</code></p></td><td align="left" valign="top"><p>The maximum number of query terms that will be
included in any generated query. Defaults to <code class="literal">25</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">fuzziness</code></p></td><td align="left" valign="top"><p>The fuzziness of the term variants. Defaults
to <code class="literal">0.5</code>. See  <a class="xref" href="#fuzziness" title="Fuzziness">the section called âFuzzinessâ</a>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">prefix_length</code></p></td><td align="left" valign="top"><p>Length of required common prefix on variant terms.
Defaults to <code class="literal">0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">boost</code></p></td><td align="left" valign="top"><p>Sets the boost value of the query. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td align="left" valign="top"><p>The analyzer that will be used to analyze the text.
Defaults to the analyzer associated with the field.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-function-score-query"></a>Function Score Query</h2></div></div></div><p>The <code class="literal">function_score</code> allows you to modify the score of documents that are
retrieved by a query. This can be useful if, for example, a score
function is computationally expensive and it is sufficient to compute
the score on a filtered set of documents.</p><p><code class="literal">function_score</code> provides the same functionality that
<code class="literal">custom_boost_factor</code>, <code class="literal">custom_score</code> and
<code class="literal">custom_filters_score</code> provided
but furthermore adds futher scoring functionality such as
distance and recency scoring (see description below).</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_using_function_score"></a>Using function score</h3></div></div></div><p>To use <code class="literal">function_score</code>, the user has to define a query and one or
several functions, that compute a new score for each document returned
by the query.</p><p><code class="literal">function_score</code> can be used with only one function like this:</p><pre class="programlisting prettyprint lang-js">"function_score": {
    "(query|filter)": {},
    "boost": "boost for the whole query",
    "FUNCTION": {},
    "boost_mode":"(multiply|replace|...)"
}</pre><p>Furthermore, several functions can be combined. In this case one can
optionally choose to apply the function only if a document matches a
given filter:</p><pre class="programlisting prettyprint lang-js">"function_score": {
    "(query|filter)": {},
    "boost": "boost for the whole query",
    "functions": [
        {
            "filter": {},
            "FUNCTION": {}
        },
        {
            "FUNCTION": {}
        }
    ],
    "max_boost": number,
    "score_mode": "(multiply|max|...)",
    "boost_mode": "(multiply|replace|...)"
}</pre><p>If no filter is given with a function this is equivalent to specifying
<code class="literal">"match_all": {}</code></p><p>First, each document is scored by the defined functons. The parameter
<code class="literal">score_mode</code> specifies how the computed scores are combined:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">multiply</code>
</p>
</td><td valign="top">
<p>
scores are multiplied (default)
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">sum</code>
</p>
</td><td valign="top">
<p>
scores are summed
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">avg</code>
</p>
</td><td valign="top">
<p>
scores are averaged
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">first</code>
</p>
</td><td valign="top">
<p>
the first function that has a matching filter
                is applied
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max</code>
</p>
</td><td valign="top">
<p>
maximum score is used
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">min</code>
</p>
</td><td valign="top">
<p>
minimum score is used
</p>
</td></tr></tbody></table></div><p>The new score can be restricted to not exceed a certain limit by setting
the <code class="literal">max_boost</code> parameter. The default for <code class="literal">max_boost</code> is FLT_MAX.</p><p>Finally, the newly computed score is combined with the score of the
query. The parameter <code class="literal">boost_mode</code> defines how:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">multiply</code>
</p>
</td><td valign="top">
<p>
query score and function score is multiplied (default)
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">replace</code>
</p>
</td><td valign="top">
<p>
only function score is used, the query score is ignored
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">sum</code>
</p>
</td><td valign="top">
<p>
query score and function score are added
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">avg</code>
</p>
</td><td valign="top">
<p>
average
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max</code>
</p>
</td><td valign="top">
<p>
max of query score and function score
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">min</code>
</p>
</td><td valign="top">
<p>
min of query score and function score
</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_score_functions"></a>Score functions</h3></div></div></div><p>The <code class="literal">function_score</code> query provides several types of score functions.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_script_score"></a>Script score</h4></div></div></div><p>The <code class="literal">script_score</code> function allows you to wrap another query and customize
the scoring of it optionally with a computation derived from other numeric
field values in the doc using a script expression. Here is a
simple sample:</p><pre class="programlisting prettyprint lang-js">"script_score" : {
    "script" : "_score * doc['my_numeric_field'].value"
}</pre><p>On top of the different scripting field values and expression, the
<code class="literal">_score</code> script parameter can be used to retrieve the score based on the
wrapped query.</p><p>Scripts are cached for faster execution. If the script has parameters
that it needs to take into account, it is preferable to reuse the same
script, and provide parameters to it:</p><pre class="programlisting prettyprint lang-js">"script_score": {
    "lang": "lang",
    "params": {
        "param1": value1,
        "param2": value2
     },
    "script": "_score * doc['my_numeric_field'].value / pow(param1, param2)"
}</pre><p>Note that unlike the <code class="literal">custom_score</code> query, the
score of the query is multiplied with the result of the script scoring. If
you wish to inhibit this, set <code class="literal">"boost_mode": "replace"</code></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_boost_factor"></a>Boost factor</h4></div></div></div><p>The <code class="literal">boost_factor</code> score allows you to multiply the score by the provided
<code class="literal">boost_factor</code>. This can sometimes be desired since boost value set on
specific queries gets normalized, while for this score function it does
not.</p><pre class="programlisting prettyprint lang-js">"boost_factor" : number</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_random"></a>Random</h4></div></div></div><p>The <code class="literal">random_score</code> generates scores via a pseudo random number algorithm
that is initialized with a <code class="literal">seed</code>.</p><pre class="programlisting prettyprint lang-js">"random_score": {
    "seed" : number
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_decay_functions"></a>Decay functions</h4></div></div></div><p>Decay functions score a document with a function that decays depending
on the distance of a numeric field value of the document from a user
given origin. This is similar to a range query, but with smooth edges
instead of boxes.</p><p>To use distance scoring on a query that has numerical fields, the user
has to define an <code class="literal">origin</code> and a <code class="literal">scale</code> for each field. The <code class="literal">origin</code>
is needed to define the âcentral pointâ from which the distance
is calculated, and the <code class="literal">scale</code> to define the rate of decay. The
decay function is specified as</p><pre class="programlisting prettyprint lang-js">"DECAY_FUNCTION": {
    "FIELD_NAME": {
          "origin": "11, 12",
          "scale": "2km",
          "offset": "0km",
          "decay": 0.33
    }
}</pre><p>where <code class="literal">DECAY_FUNCTION</code> can be "linear", "exp" and "gauss" (see below). The specified field must be a numeric field. In the above example, the field is a <a class="xref" href="#mapping-geo-point-type" title="Geo Point Type">Geo Point Type</a> and origin can be provided in geo format. <code class="literal">scale</code> and <code class="literal">offset</code> must be given with a unit in this case. If your field is a date field, you can set <code class="literal">scale</code> and <code class="literal">offset</code> as days, weeks, and so on. Example:</p><pre class="programlisting prettyprint lang-js">    "DECAY_FUNCTION": {
        "FIELD_NAME": {
              "origin": "2013-09-17",
              "scale": "10d",
              "offset": "5d",
              "decay" : 0.5
        }
    }</pre><p>The format of the origin depends on the <a class="xref" href="#mapping-date-format" title="Date Format"><em>Date Format</em></a> defined in your mapping. If you do not define the origin, the current time is used.</p><p>The <code class="literal">offset</code> and <code class="literal">decay</code> parameters are optional.</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">offset</code>
</p>
</td><td valign="top">
<p>
    If an <code class="literal">offset</code> is defined, the decay function will only compute a the
    decay function for documents with a distance greater that the defined
    <code class="literal">offset</code>. The default is 0.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">decay</code>
</p>
</td><td valign="top">
<p>
    The <code class="literal">decay</code> parameter defines how documents are scored at the distance
    given at <code class="literal">scale</code>. If no <code class="literal">decay</code> is defined, documents at the distance
    <code class="literal">scale</code> will be scored 0.5.
</p>
</td></tr></tbody></table></div><p>In the first example, your documents might represents hotels and contain a geo
location field. You want to compute a decay function depending on how
far the hotel is from a given location. You might not immediately see
what scale to choose for the gauss function, but you can say something
like: "At a distance of 2km from the desired location, the score should
be reduced by one third."
The parameter "scale" will then be adjusted automatically to assure that
the score function computes a score of 0.5 for hotels that are 2km away
from the desired location.</p><p>In the second example, documents with a field value between 2013-09-12 and 2013-09-22 would get a weight of 1.0 and documents which are 15 days from that date a weight of 0.5.</p><p>The <code class="literal">DECAY_FUNCTION</code> determines the shape of the decay:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">gauss</code>
</p>
</td><td valign="top">
<p>
Normal decay, computed as:
</p>
<p><span class="inlinemediaobject"><img src="images/Gaussian.png" alt="images/Gaussian.png" /></span></p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">exp</code>
</p>
</td><td valign="top">
<p>
Exponential decay, computed as:
</p>
<p><span class="inlinemediaobject"><img src="images/Exponential.png" alt="images/Exponential.png" /></span></p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">linear</code>
</p>
</td><td valign="top">
<p>
Linear decay, computed as:
</p>
<p><span class="inlinemediaobject"><img src="images/Linear.png" alt="images/Linear.png" /></span>.</p>
<p>In contrast to the normal and exponential decay, this function actually
sets the score to 0 if the field value exceeds twice the user given
scale value.</p>
</td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_detailed_example"></a>Detailed example</h3></div></div></div><p>Suppose you are searching for a hotel in a certain town. Your budget is
limited. Also, you would like the hotel to be close to the town center,
so the farther the hotel is from the desired location the less likely
you are to check in.</p><p>You would like the query results that match your criterion (for
example, "hotel, Nancy, non-smoker") to be scored with respect to
distance to the town center and also the price.</p><p>Intuitively, you would like to define the town center as the origin and
maybe you are willing to walk 2km to the town center from the hotel.
In this case your <span class="strong"><strong>origin</strong></span> for the location field is the town center
and the <span class="strong"><strong>scale</strong></span> is ~2km.</p><p>If your budget is low, you would probably prefer something cheap above
something expensive.  For the price field, the <span class="strong"><strong>origin</strong></span> would be 0 Euros
and the <span class="strong"><strong>scale</strong></span> depends on how much you are willing to pay, for example 20 Euros.</p><p>In this example, the fields might be called "price" for the price of the
hotel and "location" for the coordinates of this hotel.</p><p>The function for <code class="literal">price</code> in this case would be</p><pre class="programlisting prettyprint lang-js">"DECAY_FUNCTION": {
    "price": {
          "origin": "0",
          "scale": "20"
    }
}</pre><p>and for <code class="literal">location</code>:</p><pre class="programlisting prettyprint lang-js">"DECAY_FUNCTION": {
    "location": {
          "origin": "11, 12",
          "scale": "2km"
    }
}</pre><p>where <code class="literal">DECAY_FUNCTION</code> can be "linear", "exp" and "gauss".</p><p>Suppose you want to multiply these two functions on the original score,
the request would look like this:</p><pre class="programlisting prettyprint lang-js">curl 'localhost:9200/hotels/_search/' -d '{
"query": {
    "function_score": {
        "functions": [
            {
                "DECAY_FUNCTION": {
                    "price": {
                        "origin": "0",
                        "scale": "20"
                    }
                }
            },
            {
                "DECAY_FUNCTION": {
                    "location": {
                        "origin": "11, 12",
                        "scale": "2km"
                    }
                }
            }
        ],
        "query": {
            "match": {
                "properties": "balcony"
            }
        },
        "score_mode": "multiply"
    }
}
}'</pre><p>Next, we show how the computed score looks like for each of the three
possible decay functions.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_normal_decay_keyword_literal_gauss_literal"></a>Normal decay, keyword <code class="literal">gauss</code></h4></div></div></div><p>When choosing <code class="literal">gauss</code> as the decay function in the above example, the
contour and surface plot of the multiplier looks like this:</p><div class="informalfigure"><div class="mediaobject"><img src="https://f.cloud.github.com/assets/4320215/768157/cd0e18a6-e898-11e2-9b3c-f0145078bd6f.png" width="700" alt="https://f.cloud.github.com/assets/4320215/768157/cd0e18a6-e898-11e2-9b3c-f0145078bd6f.png" /></div></div><div class="informalfigure"><div class="mediaobject"><img src="https://f.cloud.github.com/assets/4320215/768160/ec43c928-e898-11e2-8e0d-f3c4519dbd89.png" width="700" alt="https://f.cloud.github.com/assets/4320215/768160/ec43c928-e898-11e2-8e0d-f3c4519dbd89.png" /></div></div><p>Suppose your original search results matches three hotels :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
"Backback Nap"
</li><li class="listitem">
"Drink n Drive"
</li><li class="listitem">
"BnB Bellevue".
</li></ul></div><p>"Drink n Drive" is pretty far from your defined location (nearly 2 km)
and is not too cheap (about 13 Euros) so it gets a low factor a factor
of 0.56. "BnB Bellevue" and "Backback Nap" are both pretty close to the
defined location but "BnB Bellevue" is cheaper, so it gets a multiplier
of 0.86 whereas "Backpack Nap" gets a value of 0.66.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_exponential_decay_keyword_literal_exp_literal"></a>Exponential decay, keyword <code class="literal">exp</code></h4></div></div></div><p>When choosing <code class="literal">exp</code> as the decay function in the above example, the
contour and surface plot of the multiplier looks like this:</p><div class="informalfigure"><div class="mediaobject"><img src="https://f.cloud.github.com/assets/4320215/768161/082975c0-e899-11e2-86f7-174c3a729d64.png" width="700" alt="https://f.cloud.github.com/assets/4320215/768161/082975c0-e899-11e2-86f7-174c3a729d64.png" /></div></div><div class="informalfigure"><div class="mediaobject"><img src="https://f.cloud.github.com/assets/4320215/768162/0b606884-e899-11e2-907b-aefc77eefef6.png" width="700" alt="https://f.cloud.github.com/assets/4320215/768162/0b606884-e899-11e2-907b-aefc77eefef6.png" /></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_linear_decay_keyword_literal_linear_literal"></a>Linear' decay, keyword <code class="literal">linear</code></h4></div></div></div><p>When choosing <code class="literal">linear</code> as the decay function in the above example, the
contour and surface plot of the multiplier looks like this:</p><div class="informalfigure"><div class="mediaobject"><img src="https://f.cloud.github.com/assets/4320215/768164/1775b0ca-e899-11e2-9f4a-776b406305c6.png" width="700" alt="https://f.cloud.github.com/assets/4320215/768164/1775b0ca-e899-11e2-9f4a-776b406305c6.png" /></div></div><div class="informalfigure"><div class="mediaobject"><img src="https://f.cloud.github.com/assets/4320215/768165/19d8b1aa-e899-11e2-91bc-6b0553e8d722.png" width="700" alt="https://f.cloud.github.com/assets/4320215/768165/19d8b1aa-e899-11e2-91bc-6b0553e8d722.png" /></div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_supported_fields_for_decay_functions"></a>Supported fields for decay functions</h3></div></div></div><p>Only single valued numeric fields, including time and geo locations,
are supported.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_what_is_a_field_is_missing"></a>What is a field is missing?</h3></div></div></div><p>If the numeric field is missing in the document, the function will
return 1.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_relation_to_literal_custom_boost_literal_literal_custom_score_literal_and_literal_custom_filters_score_literal"></a>Relation to <code class="literal">custom_boost</code>, <code class="literal">custom_score</code> and <code class="literal">custom_filters_score</code></h3></div></div></div><p>The <code class="literal">custom_boost_factor</code> query</p><pre class="programlisting prettyprint lang-js">"custom_boost_factor": {
    "boost_factor": 5.2,
    "query": {...}
}</pre><p>becomes</p><pre class="programlisting prettyprint lang-js">"function_score": {
    "boost_factor": 5.2,
    "query": {...}
}</pre><p>The <code class="literal">custom_score</code> query</p><pre class="programlisting prettyprint lang-js">"custom_score": {
    "params": {
        "param1": 2,
        "param2": 3.1
    },
    "query": {...},
    "script": "_score * doc['my_numeric_field'].value / pow(param1, param2)"
}</pre><p>becomes</p><pre class="programlisting prettyprint lang-js">"function_score": {
    "boost_mode": "replace",
    "query": {...},
    "script_score": {
        "params": {
            "param1": 2,
            "param2": 3.1
        },
        "script": "_score * doc['my_numeric_field'].value / pow(param1, param2)"
    }
}</pre><p>and the <code class="literal">custom_filters_score</code></p><pre class="programlisting prettyprint lang-js">"custom_filters_score": {
    "filters": [
        {
            "boost_factor": "3",
            "filter": {...}
        },
        {
            "filter": {Ã¢ÂÂ¦},
            "script": "_score * doc['my_numeric_field'].value / pow(param1, param2)"
        }
    ],
    "params": {
        "param1": 2,
        "param2": 3.1
    },
    "query": {...},
    "score_mode": "first"
}</pre><p>becomes:</p><pre class="programlisting prettyprint lang-js">"function_score": {
    "functions": [
        {
            "boost_factor": "3",
            "filter": {...}
        },
        {
            "filter": {...},
            "script_score": {
                "params": {
                    "param1": 2,
                    "param2": 3.1
                },
                "script": "_score * doc['my_numeric_field'].value / pow(param1, param2)"
            }
        }
    ],
    "query": {...},
    "score_mode": "first"
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-fuzzy-query"></a>Fuzzy Query</h2></div></div></div><p>The fuzzy query uses similarity based on Levenshtein edit distance for
<code class="literal">string</code> fields, and a <code class="literal">+/-</code> margin on numeric and date fields.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_string_fields_2"></a>String fields</h3></div></div></div><p>The <code class="literal">fuzzy</code> query generates all possible matching terms that are within  the
maximum edit distance specified in <code class="literal">fuzziness</code> and then checks the term
dictionary to find out which of those generated terms actually exist in the
index.</p><p>Here is a simple example:</p><pre class="programlisting prettyprint lang-js">{
    "fuzzy" : { "user" : "ki" }
}</pre><p>Or with more advanced settings:</p><pre class="programlisting prettyprint lang-js">{
    "fuzzy" : {
        "user" : {
            "value" :         "ki",
            "boost" :         1.0,
            "fuzziness" :     2,
            "prefix_length" : 0,
            "max_expansions": 100
        }
    }
}</pre><h5><a id="_parameters_6"></a>Parameters</h5><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">fuzziness</code>
</p>
</td><td valign="top">
<p>
    The maximum edit distance. Defaults to <code class="literal">AUTO</code>. See <a class="xref" href="#fuzziness" title="Fuzziness">the section called âFuzzinessâ</a>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">prefix_length</code>
</p>
</td><td valign="top">
<p>
    The number of initial characters which will not be âfuzzifiedâ. This
    helps to reduce the number of terms which must be examined. Defaults
    to <code class="literal">0</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max_expansions</code>
</p>
</td><td valign="top">
<p>
    The maximum number of terms that the <code class="literal">fuzzy</code> query will expand to.
    Defaults to <code class="literal">0</code>.
</p>
</td></tr></tbody></table></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>this query can be very heavy if <code class="literal">prefix_length</code> and <code class="literal">max_expansions</code>
are both set to their defaults of <code class="literal">0</code>. This could cause every term in the
index to be examined!</p></div></div><h4><a id="_numeric_and_date_fields"></a>Numeric and date fields</h4><p>Performs a <a class="xref" href="#query-dsl-range-query" title="Range Query">Range Query</a> âaroundâ the value using the
<code class="literal">fuzziness</code> value as a <code class="literal">+/-</code> range, where:</p><pre class="literallayout">-fuzziness &lt;= field value &lt;= +fuzziness</pre><p>For example:</p><pre class="programlisting prettyprint lang-js">{
    "fuzzy" : {
        "price" : {
            "value" : 12,
            "fuzziness" : 2
        }
    }
}</pre><p>Will result in a range query between 10 and 14. Date fields support
<a class="link" href="#time-units" title="Time units">time values</a>, eg:</p><pre class="programlisting prettyprint lang-js">{
    "fuzzy" : {
        "created" : {
            "value" : "2010-02-05T12:05:07",
            "fuzziness" : "1d"
        }
    }
}</pre><p>See <a class="xref" href="#fuzziness" title="Fuzziness">the section called âFuzzinessâ</a> for more details about accepted values.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-geo-shape-query"></a>GeoShape Query</h2></div></div></div><p>Query version of the
<a class="link" href="#query-dsl-geo-shape-filter" title="GeoShape Filter">geo_shape Filter</a>.</p><p>Requires the <a class="link" href="#mapping-geo-shape-type" title="Geo Shape Type">geo_shape Mapping</a>.</p><p>Given a document that looks like this:</p><pre class="programlisting prettyprint lang-js">{
    "name": "Wind &amp; Wetter, Berlin, Germany",
    "location": {
        "type": "Point",
        "coordinates": [13.400544, 52.530286]
    }
}</pre><p>The following query will find the point:</p><pre class="programlisting prettyprint lang-js">{
    "query": {
        "geo_shape": {
            "location": {
                "shape": {
                    "type": "envelope",
                    "coordinates": [[13, 53],[14, 52]]
                }
            }
        }
    }
}</pre><p>See the Filterâs documentation for more information.</p><h4><a id="_relevancy_and_score"></a>Relevancy and Score</h4><p>Currently Elasticsearch does not have any notion of geo shape relevancy,
consequently the Query internally uses a <code class="literal">constant_score</code> Query which
wraps a <a class="link" href="#query-dsl-geo-shape-filter" title="GeoShape Filter">geo_shape filter</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-has-child-query"></a>Has Child Query</h2></div></div></div><p>The <code class="literal">has_child</code> query works the same as the
<a class="link" href="#query-dsl-has-child-filter" title="Has Child Filter">has_child</a> filter,
by automatically wrapping the filter with a
<a class="link" href="#query-dsl-constant-score-query" title="Constant Score Query">constant_score</a>
(when using the default score type). It has the same syntax as the
<a class="link" href="#query-dsl-has-child-filter" title="Has Child Filter">has_child</a> filter:</p><pre class="programlisting prettyprint lang-js">{
    "has_child" : {
        "type" : "blog_tag",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</pre><p>An important difference with the <code class="literal">top_children</code> query is that this query
is always executed in two iterations whereas the <code class="literal">top_children</code> query
can be executed in one or more iteration. When using the <code class="literal">has_child</code>
query the <code class="literal">total_hits</code> is always correct.</p><h4><a id="_scoring_capabilities"></a>Scoring capabilities</h4><p>The <code class="literal">has_child</code> also has scoring support. The
supported score types are <code class="literal">max</code>, <code class="literal">sum</code>, <code class="literal">avg</code> or <code class="literal">none</code>. The default is
<code class="literal">none</code> and yields the same behaviour as in previous versions. If the
score type is set to another value than <code class="literal">none</code>, the scores of all the
matching child documents are aggregated into the associated parent
documents. The score type can be specified with the <code class="literal">score_type</code> field
inside the <code class="literal">has_child</code> query:</p><pre class="programlisting prettyprint lang-js">{
    "has_child" : {
        "type" : "blog_tag",
        "score_type" : "sum",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</pre><h4><a id="_memory_considerations_5"></a>Memory Considerations</h4><p>With the current implementation, all <code class="literal">_parent</code> field values and all <code class="literal">_id</code>
field values of parent documents are loaded into memory (heap) via field data
in order to support fast lookups, so make sure there is enough memory for it.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-has-parent-query"></a>Has Parent Query</h2></div></div></div><p>The <code class="literal">has_parent</code> query works the same as the
<a class="link" href="#query-dsl-has-parent-filter" title="Has Parent Filter">has_parent</a>
filter, by automatically wrapping the filter with a constant_score (when
using the default score type). It has the same syntax as the
<a class="link" href="#query-dsl-has-parent-filter" title="Has Parent Filter">has_parent</a>
filter.</p><pre class="programlisting prettyprint lang-js">{
    "has_parent" : {
        "parent_type" : "blog",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</pre><h4><a id="_scoring_capabilities_2"></a>Scoring capabilities</h4><p>The <code class="literal">has_parent</code> also has scoring support. The
supported score types are <code class="literal">score</code> or <code class="literal">none</code>. The default is <code class="literal">none</code> and
this ignores the score from the parent document. The score is in this
case equal to the boost on the <code class="literal">has_parent</code> query (Defaults to 1). If
the score type is set to <code class="literal">score</code>, then the score of the matching parent
document is aggregated into the child documents belonging to the
matching parent document. The score type can be specified with the
<code class="literal">score_type</code> field inside the <code class="literal">has_parent</code> query:</p><pre class="programlisting prettyprint lang-js">{
    "has_parent" : {
        "parent_type" : "blog",
        "score_type" : "score",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</pre><h4><a id="_memory_considerations_6"></a>Memory Considerations</h4><p>With the current implementation, all <code class="literal">_parent</code> field values and all <code class="literal">_id</code>
field values of parent documents are loaded into memory (heap) via field data
in order to support fast lookups, so make sure there is enough memory for it.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-ids-query"></a>Ids Query</h2></div></div></div><p>Filters documents that only have the provided ids. Note, this filter
does not require the <a class="link" href="#mapping-id-field" title="_id">_id</a>
field to be indexed since it works using the
<a class="link" href="#mapping-uid-field" title="_uid">_uid</a> field.</p><pre class="programlisting prettyprint lang-js">{
    "ids" : {
        "type" : "my_type",
        "values" : ["1", "4", "100"]
    }
}</pre><p>The <code class="literal">type</code> is optional and can be omitted, and can also accept an array
of values.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-indices-query"></a>Indices Query</h2></div></div></div><p>The <code class="literal">indices</code> query can be used when executed across multiple indices,
allowing to have a query that executes only when executed on an index
that matches a specific list of indices, and another query that executes
when it is executed on an index that does not match the listed indices.</p><pre class="programlisting prettyprint lang-js">{
    "indices" : {
        "indices" : ["index1", "index2"],
        "query" : {
            "term" : { "tag" : "wow" }
        },
        "no_match_query" : {
            "term" : { "tag" : "kow" }
        }
    }
}</pre><p>You can use the <code class="literal">index</code> field to provide a single index.</p><p><code class="literal">no_match_query</code> can also have "string" value of <code class="literal">none</code> (to match no
documents), and <code class="literal">all</code> (to match all). Defaults to <code class="literal">all</code>.</p><p><code class="literal">query</code> is mandatory, as well as <code class="literal">indices</code> (or <code class="literal">index</code>).</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>The fields order is important: if the <code class="literal">indices</code> are provided before <code class="literal">query</code>
or <code class="literal">no_match_query</code>, the related queries get parsed only against the indices
that they are going to be executed on. This is useful to avoid parsing queries
when it is not necessary and prevent potential mapping errors.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-match-all-query"></a>Match All Query</h2></div></div></div><p>A query that matches all documents. Maps to Lucene <code class="literal">MatchAllDocsQuery</code>.</p><pre class="programlisting prettyprint lang-js">{
    "match_all" : { }
}</pre><p>Which can also have boost associated with it:</p><pre class="programlisting prettyprint lang-js">{
    "match_all" : { "boost" : 1.2 }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-mlt-query"></a>More Like This Query</h2></div></div></div><p>More like this query find documents that are "like" provided text by
running it against one or more fields.</p><pre class="programlisting prettyprint lang-js">{
    "more_like_this" : {
        "fields" : ["name.first", "name.last"],
        "like_text" : "text like this one",
        "min_term_freq" : 1,
        "max_query_terms" : 12
    }
}</pre><p><code class="literal">more_like_this</code> can be shortened to <code class="literal">mlt</code>.</p><p>The <code class="literal">more_like_this</code> top level parameters include:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Parameter </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">fields</code></p></td><td align="left" valign="top"><p>A list of the fields to run the more like this query against.
Defaults to the <code class="literal">_all</code> field.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">like_text</code></p></td><td align="left" valign="top"><p>The text to find documents like it, <span class="strong"><strong>required</strong></span>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">percent_terms_to_match</code></p></td><td align="left" valign="top"><p>The percentage of terms to match on (float
value). Defaults to <code class="literal">0.3</code> (30 percent).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">min_term_freq</code></p></td><td align="left" valign="top"><p>The frequency below which terms will be ignored in the
source doc. The default frequency is <code class="literal">2</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_query_terms</code></p></td><td align="left" valign="top"><p>The maximum number of query terms that will be
included in any generated query. Defaults to <code class="literal">25</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">stop_words</code></p></td><td align="left" valign="top"><p>An array of stop words. Any word in this set is
considered "uninteresting" and ignored. Even if your Analyzer allows
stopwords, you might want to tell the MoreLikeThis code to ignore them,
as for the purposes of document similarity it seems reasonable to assume
that "a stop word is never interesting".</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">min_doc_freq</code></p></td><td align="left" valign="top"><p>The frequency at which words will be ignored which do
not occur in at least this many docs. Defaults to <code class="literal">5</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_doc_freq</code></p></td><td align="left" valign="top"><p>The maximum frequency in which words may still appear.
Words that appear in more than this many docs will be ignored. Defaults
to unbounded.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">min_word_length</code></p></td><td align="left" valign="top"><p>The minimum word length below which words will be
ignored. Defaults to <code class="literal">0</code>.(Old name "min_word_len" is deprecated)</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_word_length</code></p></td><td align="left" valign="top"><p>The maximum word length above which words will be
ignored. Defaults to unbounded (<code class="literal">0</code>). (Old name "max_word_len" is deprecated)</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">boost_terms</code></p></td><td align="left" valign="top"><p>Sets the boost factor to use when boosting terms.
Defaults to <code class="literal">1</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">boost</code></p></td><td align="left" valign="top"><p>Sets the boost value of the query. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td align="left" valign="top"><p>The analyzer that will be used to analyze the text.
Defaults to the analyzer associated with the field.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-mlt-field-query"></a>More Like This Field Query</h2></div></div></div><p>The <code class="literal">more_like_this_field</code> query is the same as the <code class="literal">more_like_this</code>
query, except it runs against a single field. It provides nicer query
DSL over the generic <code class="literal">more_like_this</code> query, and support typed fields
query (automatically wraps typed fields with type filter to match only
on the specific type).</p><pre class="programlisting prettyprint lang-js">{
    "more_like_this_field" : {
        "name.first" : {
            "like_text" : "text like this one",
            "min_term_freq" : 1,
            "max_query_terms" : 12
        }
    }
}</pre><p><code class="literal">more_like_this_field</code> can be shortened to <code class="literal">mlt_field</code>.</p><p>The <code class="literal">more_like_this_field</code> top level parameters include:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Parameter </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">like_text</code></p></td><td align="left" valign="top"><p>The text to find documents like it, <span class="strong"><strong>required</strong></span>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">percent_terms_to_match</code></p></td><td align="left" valign="top"><p>The percentage of terms to match on (float
value). Defaults to <code class="literal">0.3</code> (30 percent).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">min_term_freq</code></p></td><td align="left" valign="top"><p>The frequency below which terms will be ignored in the
source doc. The default frequency is <code class="literal">2</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_query_terms</code></p></td><td align="left" valign="top"><p>The maximum number of query terms that will be
included in any generated query. Defaults to <code class="literal">25</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">stop_words</code></p></td><td align="left" valign="top"><p>An array of stop words. Any word in this set is
considered "uninteresting" and ignored. Even if your Analyzer allows
stopwords, you might want to tell the MoreLikeThis code to ignore them,
as for the purposes of document similarity it seems reasonable to assume
that "a stop word is never interesting".</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">min_doc_freq</code></p></td><td align="left" valign="top"><p>The frequency at which words will be ignored which do
not occur in at least this many docs. Defaults to <code class="literal">5</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_doc_freq</code></p></td><td align="left" valign="top"><p>The maximum frequency in which words may still appear.
Words that appear in more than this many docs will be ignored. Defaults
to unbounded.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">min_word_length</code></p></td><td align="left" valign="top"><p>The minimum word length below which words will be
ignored. Defaults to <code class="literal">0</code>. (Old name "min_word_len" is deprecated)</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_word_length</code></p></td><td align="left" valign="top"><p>The maximum word length above which words will be
ignored. Defaults to unbounded (<code class="literal">0</code>). (Old name "max_word_len" is deprecated)</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">boost_terms</code></p></td><td align="left" valign="top"><p>Sets the boost factor to use when boosting terms.
Defaults to <code class="literal">1</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">boost</code></p></td><td align="left" valign="top"><p>Sets the boost value of the query. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td align="left" valign="top"><p>The analyzer that will be used to analyze the text.
Defaults to the analyzer associated with the field.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-nested-query"></a>Nested Query</h2></div></div></div><p>Nested query allows to query nested objects / docs (see
<a class="link" href="#mapping-nested-type" title="Nested Type">nested mapping</a>). The
query is executed against the nested objects / docs as if they were
indexed as separate docs (they are, internally) and resulting in the
root parent doc (or parent nested mapping). Here is a sample mapping we
will work with:</p><pre class="programlisting prettyprint lang-js">{
    "type1" : {
        "properties" : {
            "obj1" : {
                "type" : "nested"
            }
        }
    }
}</pre><p>And here is a sample nested query usage:</p><pre class="programlisting prettyprint lang-js">{
    "nested" : {
        "path" : "obj1",
        "score_mode" : "avg",
        "query" : {
            "bool" : {
                "must" : [
                    {
                        "match" : {"obj1.name" : "blue"}
                    },
                    {
                        "range" : {"obj1.count" : {"gt" : 5}}
                    }
                ]
            }
        }
    }
}</pre><p>The query <code class="literal">path</code> points to the nested object path, and the <code class="literal">query</code> (or
<code class="literal">filter</code>) includes the query that will run on the nested docs matching
the direct path, and joining with the root parent docs.</p><p>The <code class="literal">score_mode</code> allows to set how inner children matching affects
scoring of parent. It defaults to <code class="literal">avg</code>, but can be <code class="literal">total</code>, <code class="literal">max</code> and
<code class="literal">none</code>.</p><p>Multi level nesting is automatically supported, and detected, resulting
in an inner nested query to automatically match the relevant nesting
level (and not root) if it exists within another nested query.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-prefix-query"></a>Prefix Query</h2></div></div></div><p>Matches documents that have fields containing terms with a specified
prefix (<span class="strong"><strong>not analyzed</strong></span>). The prefix query maps to Lucene <code class="literal">PrefixQuery</code>.
The following matches documents where the user field contains a term
that starts with <code class="literal">ki</code>:</p><pre class="programlisting prettyprint lang-js">{
    "prefix" : { "user" : "ki" }
}</pre><p>A boost can also be associated with the query:</p><pre class="programlisting prettyprint lang-js">{
    "prefix" : { "user" :  { "value" : "ki", "boost" : 2.0 } }
}</pre><p>Or :</p><pre class="programlisting prettyprint lang-js">{
    "prefix" : { "user" :  { "prefix" : "ki", "boost" : 2.0 } }
}</pre><p>This multi term query allows to control how it gets rewritten using the
<a class="link" href="#query-dsl-multi-term-rewrite" title="Multi Term Query Rewrite">rewrite</a>
parameter.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-query-string-query"></a>Query String Query</h2></div></div></div><p>A query that uses a query parser in order to parse its content. Here is
an example:</p><pre class="programlisting prettyprint lang-js">{
    "query_string" : {
        "default_field" : "content",
        "query" : "this AND that OR thus"
    }
}</pre><p>The <code class="literal">query_string</code> top level parameters include:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Parameter </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">query</code></p></td><td align="left" valign="top"><p>The actual query to be parsed. See <a class="xref" href="#query-string-syntax" title="Query string syntax">Query string syntax</a>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">default_field</code></p></td><td align="left" valign="top"><p>The default field for query terms if no prefix field
is specified. Defaults to the <code class="literal">index.query.default_field</code> index
settings, which in turn defaults to <code class="literal">_all</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">default_operator</code></p></td><td align="left" valign="top"><p>The default operator used if no explicit operator
is specified. For example, with a default operator of <code class="literal">OR</code>, the query
<code class="literal">capital of Hungary</code> is translated to <code class="literal">capital OR of OR Hungary</code>, and
with default operator of <code class="literal">AND</code>, the same query is translated to
<code class="literal">capital AND of AND Hungary</code>. The default value is <code class="literal">OR</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td align="left" valign="top"><p>The analyzer name used to analyze the query string.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">allow_leading_wildcard</code></p></td><td align="left" valign="top"><p>When set, <code class="literal">*</code> or <code class="literal">?</code> are allowed as the first
character. Defaults to <code class="literal">true</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">lowercase_expanded_terms</code></p></td><td align="left" valign="top"><p>Whether terms of wildcard, prefix, fuzzy,
and range queries are to be automatically lower-cased or not (since they
are not analyzed). Default it <code class="literal">true</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">enable_position_increments</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to enable position
increments in result queries. Defaults to <code class="literal">true</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">fuzzy_max_expansions</code></p></td><td align="left" valign="top"><p>Controls the number of terms fuzzy queries will
expand to. Defaults to <code class="literal">50</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">fuzziness</code></p></td><td align="left" valign="top"><p>Set the fuzziness for fuzzy queries. Defaults
to <code class="literal">AUTO</code>. See  <a class="xref" href="#fuzziness" title="Fuzziness">the section called âFuzzinessâ</a> for allowed settings.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">fuzzy_prefix_length</code></p></td><td align="left" valign="top"><p>Set the prefix length for fuzzy queries. Default
is <code class="literal">0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">phrase_slop</code></p></td><td align="left" valign="top"><p>Sets the default slop for phrases. If zero, then exact
phrase matches are required. Default value is <code class="literal">0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">boost</code></p></td><td align="left" valign="top"><p>Sets the boost value of the query. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">analyze_wildcard</code></p></td><td align="left" valign="top"><p>By default, wildcards terms in a query string are
not analyzed. By setting this value to <code class="literal">true</code>, a best effort will be
made to analyze those as well.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">auto_generate_phrase_queries</code></p></td><td align="left" valign="top"><p>Default to <code class="literal">false</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">minimum_should_match</code></p></td><td align="left" valign="top"><p>A value controlling how many "should" clauses
in the resulting boolean query should match. It can be an absolute value
(<code class="literal">2</code>), a percentage (<code class="literal">30%</code>) or a
<a class="link" href="#query-dsl-minimum-should-match" title="Minimum Should Match">combination of both</a>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">lenient</code></p></td><td align="left" valign="top"><p>If set to <code class="literal">true</code> will cause format based failures (like
providing text to a numeric field) to be ignored.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">locale</code></p></td><td align="left" valign="top"><p><span class="added">
      [<span class="version">1.1.0</span>]
      <span class="detail">Added in 1.1.0.</span></span> Locale that should be used for string conversions.
Defaults to <code class="literal">ROOT</code>.</p></td></tr></tbody></table></div><p>When a multi term query is being generated, one can control how it gets
rewritten using the
<a class="link" href="#query-dsl-multi-term-rewrite" title="Multi Term Query Rewrite">rewrite</a>
parameter.</p><h4><a id="_default_field"></a>Default Field</h4><p>When not explicitly specifying the field to search on in the query
string syntax, the <code class="literal">index.query.default_field</code> will be used to derive
which field to search on. It defaults to <code class="literal">_all</code> field.</p><p>So, if <code class="literal">_all</code> field is disabled, it might make sense to change it to set
a different default field.</p><h4><a id="_multi_field_2"></a>Multi Field</h4><p>The <code class="literal">query_string</code> query can also run against multiple fields. The idea
of running the <code class="literal">query_string</code> query against multiple fields is by
internally creating several queries for the same query string, each with
<code class="literal">default_field</code> that match the fields provided. Since several queries
are generated, combining them can be automatically done either using a
<code class="literal">dis_max</code> query or a simple <code class="literal">bool</code> query. For example (the <code class="literal">name</code> is
boosted by 5 using <code class="literal">^5</code> notation):</p><pre class="programlisting prettyprint lang-js">{
    "query_string" : {
        "fields" : ["content", "name^5"],
        "query" : "this AND that OR thus",
        "use_dis_max" : true
    }
}</pre><p>Simple wildcard can also be used to search "within" specific inner
elements of the document. For example, if we have a <code class="literal">city</code> object with
several fields (or inner object with fields) in it, we can automatically
search on all "city" fields:</p><pre class="programlisting prettyprint lang-js">{
    "query_string" : {
        "fields" : ["city.*"],
        "query" : "this AND that OR thus",
        "use_dis_max" : true
    }
}</pre><p>Another option is to provide the wildcard fields search in the query
string itself (properly escaping the <code class="literal">*</code> sign), for example:
<code class="literal">city.\*:something</code>.</p><p>When running the <code class="literal">query_string</code> query against multiple fields, the
following additional parameters are allowed:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Parameter </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">use_dis_max</code></p></td><td align="left" valign="top"><p>Should the queries be combined using <code class="literal">dis_max</code> (set it
to <code class="literal">true</code>), or a <code class="literal">bool</code> query (set it to <code class="literal">false</code>). Defaults to <code class="literal">true</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">tie_breaker</code></p></td><td align="left" valign="top"><p>When using <code class="literal">dis_max</code>, the disjunction max tie breaker.
Defaults to <code class="literal">0</code>.</p></td></tr></tbody></table></div><p>The fields parameter can also include pattern based field names,
allowing to automatically expand to the relevant fields (dynamically
introduced fields included). For example:</p><pre class="programlisting prettyprint lang-js">{
    "query_string" : {
        "fields" : ["content", "name.*^5"],
        "query" : "this AND that OR thus",
        "use_dis_max" : true
    }
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="query-string-syntax"></a>Query string syntax</h3></div></div></div><p>The query string âmini-languageâ is used by the
<a class="xref" href="#query-dsl-query-string-query" title="Query String Query">Query String Query</a> and by the
<code class="literal">q</code> query string parameter in the <a class="link" href="#search-search" title="Search"><code class="literal">search</code> API</a>.</p><p>The query string is parsed into a series of <span class="emphasis"><em>terms</em></span> and <span class="emphasis"><em>operators</em></span>. A
term can be a single wordâââ<code class="literal">quick</code> or <code class="literal">brown</code>âââor a phrase, surrounded by
double quotesâââ<code class="literal">"quick brown"</code>âââwhich searches for all the words in the
phrase, in the same order.</p><p>Operators allow you to customize the searchâââthe available options are
explained below.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_field_names"></a>Field names</h4></div></div></div><p>As mentioned in <a class="xref" href="#query-dsl-query-string-query" title="Query String Query">Query String Query</a>, the <code class="literal">default_field</code> is searched for the
search terms, but it is possible to specify other fields in the query syntax:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
where the <code class="literal">status</code> field contains <code class="literal">active</code>
</p><pre class="literallayout">status:active</pre></li><li class="listitem"><p class="simpara">
where the <code class="literal">title</code> field contains <code class="literal">quick</code> or <code class="literal">brown</code>
</p><pre class="literallayout">title:(quick brown)</pre></li><li class="listitem"><p class="simpara">
where the <code class="literal">author</code> field contains the exact phrase <code class="literal">"john smith"</code>
</p><pre class="literallayout">author:"John Smith"</pre></li><li class="listitem"><p class="simpara">
where any of the fields <code class="literal">book.title</code>, <code class="literal">book.content</code> or <code class="literal">book.date</code> contains
  <code class="literal">quick</code> or <code class="literal">brown</code> (note how we need to escape the <code class="literal">*</code> with a backslash):
</p><pre class="literallayout">book.\*:(quick brown)</pre></li><li class="listitem"><p class="simpara">
where the field <code class="literal">title</code> has no value (or is missing):
</p><pre class="literallayout">_missing_:title</pre></li><li class="listitem"><p class="simpara">
where the field <code class="literal">title</code> has any non-null value:
</p><pre class="literallayout">_exists_:title</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_wildcards"></a>Wildcards</h4></div></div></div><p>Wildcard searches can be run on individual terms, using <code class="literal">?</code> to replace
a single character, and <code class="literal">*</code> to replace zero or more characters:</p><pre class="literallayout">qu?ck bro*</pre><p>Be aware that wildcard queries can use an enormous amount of memory and
perform very badlyâââjust think how many terms need to be queried to
match the query string <code class="literal">"a* b* c*"</code>.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>Allowing a wildcard at the beginning of a word (eg <code class="literal">"*ing"</code>) is particularly
heavy, because all terms in the index need to be examined, just in case
they match.  Leading wildcards can be disabled by setting
<code class="literal">allow_leading_wildcard</code> to <code class="literal">false</code>.</p></div></div><p>Wildcarded terms are not analyzed by defaultâââthey are lowercased
(<code class="literal">lowercase_expanded_terms</code> defaults to <code class="literal">true</code>) but no further analysis
is done, mainly because it is impossible to accurately analyze a word that
is missing some of its letters.  However, by setting <code class="literal">analyze_wildcard</code> to
<code class="literal">true</code>, an attempt will be made to analyze wildcarded words before searching
the term list for matching terms.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_regular_expressions"></a>Regular expressions</h4></div></div></div><p>Regular expression patterns can be embedded in the query string by
wrapping them in forward-slashes (<code class="literal">"/"</code>):</p><pre class="literallayout">name:/joh?n(ath[oa]n)/</pre><p>The supported regular expression syntax is explained in <a class="xref" href="#regexp-syntax" title="Regular expression syntax">Regular expression syntax</a>.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>The <code class="literal">allow_leading_wildcard</code> parameter does not have any control over
regular expressions.  A query string such as the following would force
Elasticsearch to visit every term in the index:</p><pre class="literallayout">/.*n/</pre><p>Use with caution!</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_fuzziness"></a>Fuzziness</h4></div></div></div><p>We can search for terms that are
similar to, but not exactly like our search terms, using the âfuzzyâ
operator:</p><pre class="literallayout">quikc~ brwn~ foks~</pre><p>This uses the
<a class="ulink" href="http://en.wikipedia.org/wiki/Damerau-Levenshtein_distance" target="_top">Damerau-Levenshtein distance</a>
to find all terms with a maximum of
two changes, where a change is the insertion, deletion
or substitution of a single character, or transposition of two adjacent
characters.</p><p>The default <span class="emphasis"><em>edit distance</em></span> is <code class="literal">2</code>, but an edit distance of <code class="literal">1</code> should be
sufficient to catch 80% of all human misspellings. It can be specified as:</p><pre class="literallayout">quikc~1</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_proximity_searches"></a>Proximity searches</h4></div></div></div><p>While a phrase query (eg <code class="literal">"john smith"</code>) expects all of the terms in exactly
the same order, a proximity query allows the specified words to be further
apart or in a different order.  In the same way that fuzzy queries can
specify a maximum edit distance for characters in a word, a proximity search
allows us to specify a maximum edit distance of words in a phrase:</p><pre class="literallayout">"fox quick"~5</pre><p>The closer the text in a field is to the original order specified in the
query string, the more relevant that document is considered to be. When
compared to the above example query, the phrase <code class="literal">"quick fox"</code> would be
considered more relevant than <code class="literal">"quick brown fox"</code>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_ranges_2"></a>Ranges</h4></div></div></div><p>Ranges can be specified for date, numeric or string fields. Inclusive ranges
are specified with square brackets <code class="literal">[min TO max]</code> and exclusive ranges with
curly brackets <code class="literal">{min TO max}</code>.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
All days in 2012:
</p><pre class="literallayout">date:[2012/01/01 TO 2012/12/31]</pre></li><li class="listitem"><p class="simpara">
Numbers 1..5
</p><pre class="literallayout">count:[1 TO 5]</pre></li><li class="listitem"><p class="simpara">
Tags between <code class="literal">alpha</code> and <code class="literal">omega</code>, excluding <code class="literal">alpha</code> and <code class="literal">omega</code>:
</p><pre class="literallayout">tag:{alpha TO omega}</pre></li><li class="listitem"><p class="simpara">
Numbers from 10 upwards
</p><pre class="literallayout">count:[10 TO *]</pre></li><li class="listitem"><p class="simpara">
Dates before 2012
</p><pre class="literallayout">date:{* TO 2012/01/01}</pre></li></ul></div><p>Curly and square brackets can be combined:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
Numbers from 1 up to but not including 5
</p><pre class="literallayout">count:[1..5}</pre></li></ul></div><p>Ranges with one side unbounded can use the following syntax:</p><pre class="literallayout">age:&gt;10
age:&gt;=10
age:&lt;10
age:&lt;=10</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>To combine an upper and lower bound with the simplified syntax, you
would need to join two clauses with an <code class="literal">AND</code> operator:</p><pre class="literallayout">age:(&gt;=10 AND &lt; 20)
age:(+&gt;=10 +&lt;20)</pre></div></div><p>The parsing of ranges in query strings can be complex and error prone. It is
much more reliable to use an explicit <a class="link" href="#query-dsl-range-filter" title="Range Filter"><code class="literal">range</code> filter</a>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_boosting"></a>Boosting</h4></div></div></div><p>Use the <span class="emphasis"><em>boost</em></span> operator <code class="literal">^</code> to make one term more relevant than another.
For instance, if we want to find all documents about foxes, but we are
especially interested in quick foxes:</p><pre class="literallayout">quick^2 fox</pre><p>The default <code class="literal">boost</code> value is 1, but can be any positive floating point number.
Boosts between 0 and 1 reduce relevance.</p><p>Boosts can also be applied to phrases or to groups:</p><pre class="literallayout">"john smith"^2   (foo bar)^4</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_boolean_operators"></a>Boolean operators</h4></div></div></div><p>By default, all terms are optional, as long as one term matches.  A search
for <code class="literal">foo bar baz</code> will find any document that contains one or more of
<code class="literal">foo</code> or <code class="literal">bar</code> or <code class="literal">baz</code>.  We have already discussed the <code class="literal">default_operator</code>
above which allows you to force all terms to be required, but there are
also <span class="emphasis"><em>boolean operators</em></span> which can be used in the query string itself
to provide more control.</p><p>The preferred operators are <code class="literal">+</code> (this term <span class="strong"><strong>must</strong></span> be present) and <code class="literal">-</code>
(this term <span class="strong"><strong>must not</strong></span> be present). All other terms are optional.
For example, this query:</p><pre class="literallayout">quick brown +fox -news</pre><p>states that:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">fox</code> must be present
</li><li class="listitem">
<code class="literal">news</code> must not be present
</li><li class="listitem">
<code class="literal">quick</code> and <code class="literal">brown</code> are optionalâââtheir presence increases the relevance
</li></ul></div><p>The familiar operators <code class="literal">AND</code>, <code class="literal">OR</code> and <code class="literal">NOT</code> (also written <code class="literal">&amp;&amp;</code>, <code class="literal">||</code> and <code class="literal">!</code>)
are also supported.  However, the effects of these operators can be more
complicated than is obvious at first glance.  <code class="literal">NOT</code> takes precedence over
<code class="literal">AND</code>, which takes precedence over <code class="literal">OR</code>.  While the <code class="literal">+</code> and <code class="literal">-</code> only affect
the term to the right of the operator, <code class="literal">AND</code> and <code class="literal">OR</code> can affect the terms to
the left and right.</p><div class="sidebar"><div class="titlepage"></div><p>Rewriting the above query using <code class="literal">AND</code>, <code class="literal">OR</code> and <code class="literal">NOT</code> demonstrates the
complexity:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">quick OR brown AND fox AND NOT news</code>
</span></dt><dd>
This is incorrect, because <code class="literal">brown</code> is now a required term.
</dd><dt><span class="term">
<code class="literal">(quick OR brown) AND fox AND NOT news</code>
</span></dt><dd>
This is incorrect because at least one of <code class="literal">quick</code> or <code class="literal">brown</code> is now required
and the search for those terms would be scored differently from the original
query.
</dd><dt><span class="term">
<code class="literal">((quick AND fox) OR (brown AND fox) OR fox) AND NOT news</code>
</span></dt><dd>
This form now replicates the logic from the original query correctly, but
the relevance scoring bares little resemblance to the original.
</dd></dl></div><p>In contrast, the same query rewritten using the <a class="link" href="#query-dsl-match-query" title="Match Query"><code class="literal">match</code> query</a>
would look like this:</p><pre class="literallayout">{
    "bool": {
        "must":     { "match": "fox"         },
        "should":   { "match": "quick brown" },
        "must_not": { "match": "news"        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_grouping"></a>Grouping</h4></div></div></div><p>Multiple terms or clauses can be grouped together with parentheses, to form
sub-queries:</p><pre class="literallayout">(quick OR brown) AND fox</pre><p>Groups can be used to target a particular field, or to boost the result
of a sub-query:</p><pre class="literallayout">status:(active OR pending) title:(full text search)^2</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_reserved_characters"></a>Reserved characters</h4></div></div></div><p>If you need to use any of the characters which function as operators in your
query itself (and not as operators), then you should escape them with
a leading backslash. For instance, to search for <code class="literal">(1+1)=2</code>, you would
need to write your query as <code class="literal">\(1\+1\)=2</code>.</p><p>The reserved characters are:  <code class="literal">+ - &amp;&amp; || ! ( ) { } [ ] ^ " ~ * ? : \ /</code></p><p>Failing to escape these special characters correctly could lead to a syntax
error which prevents your query from running.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Watch this space</strong></p></div></div></div><p>A space may also be a reserved character.  For instance, if you have a
synonym list which converts <code class="literal">"wi fi"</code> to <code class="literal">"wifi"</code>, a <code class="literal">query_string</code> search
for <code class="literal">"wi fi"</code> would fail. The query string parser would interpret your
query as a search for <code class="literal">"wi OR fi"</code>, while the token stored in your
index is actually <code class="literal">"wifi"</code>.  Escaping the space will protect it from
being touched by the query string parser: <code class="literal">"wi\ fi"</code>.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_empty_query"></a>Empty Query</h4></div></div></div><p>If the query string is empty or only contains whitespaces the
query string is interpreted as a <code class="literal">no_docs_query</code> and will yield
an empty result set.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-simple-query-string-query"></a>Simple Query String Query</h2></div></div></div><p>A query that uses the SimpleQueryParser to parse its context. Unlike the
regular <code class="literal">query_string</code> query, the <code class="literal">simple_query_string</code> query will never
throw an exception, and discards invalid parts of the query. Here is
an example:</p><pre class="programlisting prettyprint lang-js">{
    "simple_query_string" : {
        "query": "\"fried eggs\" +(eggplant | potato) -frittata",
        "analyzer": "snowball",
        "fields": ["body^5","_all"],
        "default_operator": "and"
    }
}</pre><p>The <code class="literal">simple_query_string</code> top level parameters include:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Parameter </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">query</code></p></td><td align="left" valign="top"><p>The actual query to be parsed. See below for syntax.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">fields</code></p></td><td align="left" valign="top"><p>The fields to perform the parsed query against. Defaults to the
<code class="literal">index.query.default_field</code> index settings, which in turn defaults to <code class="literal">_all</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">default_operator</code></p></td><td align="left" valign="top"><p>The default operator used if no explicit operator
is specified. For example, with a default operator of <code class="literal">OR</code>, the query
<code class="literal">capital of Hungary</code> is translated to <code class="literal">capital OR of OR Hungary</code>, and
with default operator of <code class="literal">AND</code>, the same query is translated to
<code class="literal">capital AND of AND Hungary</code>. The default value is <code class="literal">OR</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td align="left" valign="top"><p>The analyzer used to analyze each term of the query when
creating composite queries.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">flags</code></p></td><td align="left" valign="top"><p>Flags specifying which features of the <code class="literal">simple_query_string</code> to
enable. Defaults to <code class="literal">ALL</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">lowercase_expanded_terms</code></p></td><td align="left" valign="top"><p>Whether terms of prefix and fuzzy queries are to
be automatically lower-cased or not (since they are not analyzed). Defaults to
true.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">locale</code></p></td><td align="left" valign="top"><p><span class="added">
      [<span class="version">1.1.0</span>]
      <span class="detail">Added in 1.1.0.</span></span> Locale that should be used for string conversions.
Defaults to <code class="literal">ROOT</code>.</p></td></tr></tbody></table></div><h4><a id="_simple_query_string_syntax"></a>Simple Query String Syntax</h4><p>The <code class="literal">simple_query_string</code> supports the following special characters:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">+</code> signifies AND operation
</li><li class="listitem">
<code class="literal">|</code> signifies OR operation
</li><li class="listitem">
<code class="literal">-</code> negates a single token
</li><li class="listitem">
<code class="literal">"</code> wraps a number of tokens to signify a phrase for searching
</li><li class="listitem">
<code class="literal">*</code> at the end of a term signifies a prefix query
</li><li class="listitem">
<code class="literal">(</code> and <code class="literal">)</code> signify precedence
</li><li class="listitem">
<code class="literal">~N</code> after a word signifies edit distance (fuzziness)
</li><li class="listitem">
<code class="literal">~N</code> after a phrase signifies slop amount
</li></ul></div><p>In order to search for any of these special characters, they will need to
be escaped with <code class="literal">\</code>.</p><h4><a id="_default_field_2"></a>Default Field</h4><p>When not explicitly specifying the field to search on in the query
string syntax, the <code class="literal">index.query.default_field</code> will be used to derive
which field to search on. It defaults to <code class="literal">_all</code> field.</p><p>So, if <code class="literal">_all</code> field is disabled, it might make sense to change it to set
a different default field.</p><h4><a id="_multi_field_3"></a>Multi Field</h4><p>The fields parameter can also include pattern based field names,
allowing to automatically expand to the relevant fields (dynamically
introduced fields included). For example:</p><pre class="programlisting prettyprint lang-js">{
    "simple_query_string" : {
        "fields" : ["content", "name.*^5"],
        "query" : "foo bar baz"
    }
}</pre><h4><a id="_flags"></a>Flags</h4><p><code class="literal">simple_query_string</code> support multiple flags to specify which parsing features
should be enabled. It is specified as a <code class="literal">|</code>-delimited string with the
<code class="literal">flags</code> parameter:</p><pre class="programlisting prettyprint lang-js">{
    "simple_query_string" : {
        "query" : "foo | bar  &amp; baz*",
        "flags" : "OR|AND|PREFIX"
    }
}</pre><p>The available flags are: <code class="literal">ALL</code>, <code class="literal">NONE</code>, <code class="literal">AND</code>, <code class="literal">OR</code>, <code class="literal">PREFIX</code>, <code class="literal">PHRASE</code>,
<code class="literal">PRECEDENCE</code>, <code class="literal">ESCAPE</code>, <code class="literal">WHITESPACE</code>, <code class="literal">FUZZY</code>, <code class="literal">NEAR</code>, and <code class="literal">SLOP</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-range-query"></a>Range Query</h2></div></div></div><p>Matches documents with fields that have terms within a certain range.
The type of the Lucene query depends on the field type, for <code class="literal">string</code>
fields, the <code class="literal">TermRangeQuery</code>, while for number/date fields, the query is
a <code class="literal">NumericRangeQuery</code>. The following example returns all documents where
<code class="literal">age</code> is between <code class="literal">10</code> and <code class="literal">20</code>:</p><pre class="programlisting prettyprint lang-js">{
    "range" : {
        "age" : {
            "gte" : 10,
            "lte" : 20,
            "boost" : 2.0
        }
    }
}</pre><p>The <code class="literal">range</code> query accepts the following parameters:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">gte</code>
</p>
</td><td valign="top">
<p>
Greater-than or equal to
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">gt</code>
</p>
</td><td valign="top">
<p>
Greater-than
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">lte</code>
</p>
</td><td valign="top">
<p>
Less-than or equal to
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">lt</code>
</p>
</td><td valign="top">
<p>
Less-than
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">boost</code>
</p>
</td><td valign="top">
<p>
Sets the boost value of the query, defaults to <code class="literal">1.0</code>
</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-regexp-query"></a>Regexp Query</h2></div></div></div><p>The <code class="literal">regexp</code> query allows you to use regular expression term queries.
See <a class="xref" href="#regexp-syntax" title="Regular expression syntax">Regular expression syntax</a> for details of the supported regular expression language.</p><p><span class="strong"><strong>Note</strong></span>: The performance of a <code class="literal">regexp</code> query heavily depends on the
regular expression chosen. Matching everything like <code class="literal">.*</code> is very slow as
well as using lookaround regular expressions. If possible, you should
try to use a long prefix before your regular expression starts. Wildcard
matchers like <code class="literal">.*?+</code> will mostly lower performance.</p><pre class="programlisting prettyprint lang-js">{
    "regexp":{
        "name.first": "s.*y"
    }
}</pre><p>Boosting is also supported</p><pre class="programlisting prettyprint lang-js">{
    "regexp":{
        "name.first":{
            "value":"s.*y",
            "boost":1.2
        }
    }
}</pre><p>You can also use special flags</p><pre class="programlisting prettyprint lang-js">{
    "regexp":{
        "name.first": "s.*y",
        "flags" : "INTERSECTION|COMPLEMENT|EMPTY"
    }
}</pre><p>Possible flags are <code class="literal">ALL</code>, <code class="literal">ANYSTRING</code>, <code class="literal">AUTOMATON</code>, <code class="literal">COMPLEMENT</code>,
<code class="literal">EMPTY</code>, <code class="literal">INTERSECTION</code>, <code class="literal">INTERVAL</code>, or <code class="literal">NONE</code>. Please check the
<a class="ulink" href="http://lucene.apache.org/core/4_3_0/core/index.html?org%2Fapache%2Flucene%2Futil%2Fautomaton%2FRegExp.html" target="_top">Lucene
documentation</a> for their meaning</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="regexp-syntax"></a>Regular expression syntax</h3></div></div></div><p>Regular expression queries are supported by the <code class="literal">regexp</code> and the <code class="literal">query_string</code>
queries.  The Lucene regular expression engine
is not Perl-compatible but supports a smaller range of operators.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>We will not attempt to explain regular expressions, but
just explain the supported operators.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_standard_operators"></a>Standard operators</h4></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Anchoring
</span></dt><dd><p class="simpara">Most regular expression engines allow you to match any part of a string.
If you want the regexp pattern to start at the beginning of the string or
finish at the end of the string, then you have to <span class="emphasis"><em>anchor</em></span> it specifically,
using <code class="literal">^</code> to indicate the beginning or <code class="literal">$</code> to indicate the end.</p><p class="simpara">Luceneâs patterns are always anchored.  The pattern provided must match
the entire string. For string <code class="literal">"abcde"</code>:</p><pre class="literallayout">ab.*     # match
abcd     # no match</pre></dd><dt><span class="term">
Allowed characters
</span></dt><dd><p class="simpara">Any Unicode characters may be used in the pattern, but certain characters
are reserved and must be escaped.  The standard reserved characters are:</p><pre class="literallayout">. ? + * | { } [ ] ( ) " \</pre><p class="simpara">If you enable optional features (see below) then these characters may
also be reserved:</p><pre class="literallayout"># @ &amp; &lt; &gt;  ~</pre><p class="simpara">Any reserved character can be escaped with a backslash <code class="literal">"\*"</code> including
a literal backslash character: <code class="literal">"\\"</code></p><p class="simpara">Additionally, any characters (except double quotes) are interpreted literally
when surrounded by double quotes:</p><pre class="literallayout">john"@smith.com"</pre></dd><dt><span class="term">
Match any character
</span></dt><dd><p class="simpara">The period <code class="literal">"."</code> can be used to represent any character.  For string <code class="literal">"abcde"</code>:</p><pre class="literallayout">ab...   # match
a.c.e   # match</pre></dd><dt><span class="term">
One-or-more
</span></dt><dd><p class="simpara">The plus sign <code class="literal">"+"</code> can be used to repeat the preceding shortest pattern
once or more times. For string <code class="literal">"aaabbb"</code>:</p><pre class="literallayout">a+b+        # match
aa+bb+      # match
a+.+        # match
aa+bbb+     # no match</pre></dd><dt><span class="term">
Zero-or-more
</span></dt><dd><p class="simpara">The asterisk <code class="literal">"*"</code> can be used to match the preceding shortest pattern
zero-or-more times.  For string <code class="literal">"aaabbb</code>":</p><pre class="literallayout">a*b*        # match
a*b*c*      # match
.*bbb.*     # match
aaa*bbb*    # match</pre></dd><dt><span class="term">
Zero-or-one
</span></dt><dd><p class="simpara">The question mark <code class="literal">"?"</code> makes the preceding shortest pattern optional. It
matches zero or one times.  For string <code class="literal">"aaabbb"</code>:</p><pre class="literallayout">aaa?bbb?    # match
aaaa?bbbb?  # match
.....?.?    # match
aa?bb?      # no match</pre></dd><dt><span class="term">
Min-to-max
</span></dt><dd><p class="simpara">Curly brackets <code class="literal">"{}"</code> can be used to specify a minimum and (optionally)
a maximum number of times the preceding shortest pattern can repeat.  The
allowed forms are:</p><pre class="literallayout">{5}     # repeat exactly 5 times
{2,5}   # repeat at least twice and at most 5 times
{2,}    # repeat at least twice</pre><p class="simpara">For string <code class="literal">"aaabbb"</code>:</p><pre class="literallayout">a{3}b{3}        # match
a{2,4}b{2,4}    # match
a{2,}b{2,}      # match
.{3}.{3}        # match
a{4}b{4}        # no match
a{4,6}b{4,6}    # no match
a{4,}b{4,}      # no match</pre></dd><dt><span class="term">
Grouping
</span></dt><dd><p class="simpara">Parentheses <code class="literal">"()"</code> can be used to form sub-patterns. The quantity operators
listed above operate on the shortest previous pattern, which can be a group.
For string <code class="literal">"ababab"</code>:</p><pre class="literallayout">(ab)+       # match
ab(ab)+     # match
(..)+       # match
(...)+      # no match
(ab)*       # match
abab(ab)?   # match
ab(ab)?     # no match
(ab){3}     # match
(ab){1,2}   # no match</pre></dd><dt><span class="term">
Alternation
</span></dt><dd><p class="simpara">The pipe symbol <code class="literal">"|"</code> acts as an OR operator. The match will succeed if
the pattern on either the left-hand side OR the right-hand side matches.
The alternation applies to the <span class="emphasis"><em>longest pattern</em></span>, not the shortest.
For string <code class="literal">"aabb"</code>:</p><pre class="literallayout">aabb|bbaa   # match
aacc|bb     # no match
aa(cc|bb)   # match
a+|b+       # no match
a+b+|b+a+   # match
a+(b|c)+    # match</pre></dd><dt><span class="term">
Character classes
</span></dt><dd><p class="simpara">Ranges of potential characters may be represented as character classes
by enclosing them in square brackets <code class="literal">"[]"</code>. A leading <code class="literal">^</code>
negates the character class. The allowed forms are:</p><pre class="literallayout">[abc]   # 'a' or 'b' or 'c'
[a-c]   # 'a' or 'b' or 'c'
[-abc]  # '-' or 'a' or 'b' or 'c'
[abc\-] # '-' or 'a' or 'b' or 'c'
[^a-c]  # any character except 'a' or 'b' or 'c'
[^a-c]  # any character except 'a' or 'b' or 'c'
[-abc]  # '-' or 'a' or 'b' or 'c'
[abc\-] # '-' or 'a' or 'b' or 'c'</pre><p class="simpara">Note that the dash <code class="literal">"-"</code> indicates a range of characeters, unless it is
the first character or if it is escaped with a backslash.</p><p class="simpara">For string <code class="literal">"abcd"</code>:</p><pre class="literallayout">ab[cd]+     # match
[a-d]+      # match
[^a-d]+     # no match</pre></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_optional_operators"></a>Optional operators</h4></div></div></div><p>These operators are only available when they are explicitly enabled, by
passing <code class="literal">flags</code> to the query.</p><p>Multiple flags can be enabled either using the <code class="literal">ALL</code> flag, or by
concatenating flags with a pipe <code class="literal">"|"</code>:</p><pre class="literallayout">{
    "regexp": {
        "username": {
            "value": "john~athon&lt;1-5&gt;",
            "flags": "COMPLEMENT|INTERVAL"
        }
    }
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Complement
</span></dt><dd><p class="simpara">The complement is probably the most useful option. The shortest pattern that
follows a tilde <code class="literal">"~"</code> is negated.  For the string <code class="literal">"abcdef"</code>:</p><pre class="literallayout">ab~df     # match
ab~cf     # no match
a~(cd)f   # match
a~(bc)f   # no match</pre><p class="simpara">Enabled with the <code class="literal">COMPLEMENT</code> or <code class="literal">ALL</code> flags.</p></dd><dt><span class="term">
Interval
</span></dt><dd><p class="simpara">The interval option enables the use of numeric ranges, enclosed by angle
brackets <code class="literal">"&lt;&gt;"</code>. For string: <code class="literal">"foo80"</code>:</p><pre class="literallayout">foo&lt;1-100&gt;     # match
foo&lt;01-100&gt;    # match
foo&lt;001-100&gt;   # no match</pre><p class="simpara">Enabled with the <code class="literal">INTERVAL</code> or <code class="literal">ALL</code> flags.</p></dd><dt><span class="term">
Intersection
</span></dt><dd><p class="simpara">The ampersand <code class="literal">"&amp;"</code> joins two patterns in a way that both of them have to
match. For string <code class="literal">"aaabbb"</code>:</p><pre class="literallayout">aaa.+&amp;.+bbb     # match
aaa&amp;bbb         # no match</pre><p class="simpara">Using this feature usually means that you should rewrite your regular
expression.</p><p class="simpara">Enabled with the <code class="literal">INTERSECTION</code> or <code class="literal">ALL</code> flags.</p></dd><dt><span class="term">
Any string
</span></dt><dd><p class="simpara">The at sign <code class="literal">"@"</code> matches any string in its entirety.  This could be combined
with the intersection and complement above to express âeverything exceptâ.
For instance:</p><pre class="literallayout">@&amp;~(foo.+)      # anything except string beginning with "foo"</pre><p class="simpara">Enabled with the <code class="literal">ANYSTRING</code> or <code class="literal">ALL</code> flags.</p></dd></dl></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-span-first-query"></a>Span First Query</h2></div></div></div><p>Matches spans near the beginning of a field. The span first query maps
to Lucene <code class="literal">SpanFirstQuery</code>. Here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "span_first" : {
        "match" : {
            "span_term" : { "user" : "kimchy" }
        },
        "end" : 3
    }
}</pre><p>The <code class="literal">match</code> clause can be any other span type query. The <code class="literal">end</code> controls
the maximum end position permitted in a match.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-span-multi-term-query"></a>Span Multi Term Query</h2></div></div></div><p>The <code class="literal">span_multi</code> query allows you to wrap a <code class="literal">multi term query</code> (one of
fuzzy, prefix, term range or regexp query) as a <code class="literal">span query</code>, so
it can be nested. Example:</p><pre class="programlisting prettyprint lang-js">{
    "span_multi":{
        "match":{
            "prefix" : { "user" :  { "value" : "ki" } }
        }
    }
}</pre><p>A boost can also be associated with the query:</p><pre class="programlisting prettyprint lang-js">{
    "span_multi":{
        "match":{
            "prefix" : { "user" :  { "value" : "ki", "boost" : 1.08 } }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-span-near-query"></a>Span Near Query</h2></div></div></div><p>Matches spans which are near one another. One can specify <span class="emphasis"><em>slop</em></span>, the
maximum number of intervening unmatched positions, as well as whether
matches are required to be in-order. The span near query maps to Lucene
<code class="literal">SpanNearQuery</code>. Here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "span_near" : {
        "clauses" : [
            { "span_term" : { "field" : "value1" } },
            { "span_term" : { "field" : "value2" } },
            { "span_term" : { "field" : "value3" } }
        ],
        "slop" : 12,
        "in_order" : false,
        "collect_payloads" : false
    }
}</pre><p>The <code class="literal">clauses</code> element is a list of one or more other span type queries
and the <code class="literal">slop</code> controls the maximum number of intervening unmatched
positions permitted.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-span-not-query"></a>Span Not Query</h2></div></div></div><p>Removes matches which overlap with another span query. The span not
query maps to Lucene <code class="literal">SpanNotQuery</code>. Here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "span_not" : {
        "include" : {
            "span_term" : { "field1" : "value1" }
        },
        "exclude" : {
            "span_term" : { "field2" : "value2" }
        }
    }
}</pre><p>The <code class="literal">include</code> and <code class="literal">exclude</code> clauses can be any span type query. The
<code class="literal">include</code> clause is the span query whose matches are filtered, and the
<code class="literal">exclude</code> clause is the span query whose matches must not overlap those
returned.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-span-or-query"></a>Span Or Query</h2></div></div></div><p>Matches the union of its span clauses. The span or query maps to Lucene
<code class="literal">SpanOrQuery</code>. Here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "span_or" : {
        "clauses" : [
            { "span_term" : { "field" : "value1" } },
            { "span_term" : { "field" : "value2" } },
            { "span_term" : { "field" : "value3" } }
        ]
    }
}</pre><p>The <code class="literal">clauses</code> element is a list of one or more other span type queries.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-span-term-query"></a>Span Term Query</h2></div></div></div><p>Matches spans containing a term. The span term query maps to Lucene
<code class="literal">SpanTermQuery</code>. Here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "span_term" : { "user" : "kimchy" }
}</pre><p>A boost can also be associated with the query:</p><pre class="programlisting prettyprint lang-js">{
    "span_term" : { "user" : { "value" : "kimchy", "boost" : 2.0 } }
}</pre><p>Or :</p><pre class="programlisting prettyprint lang-js">{
    "span_term" : { "user" : { "term" : "kimchy", "boost" : 2.0 } }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-term-query"></a>Term Query</h2></div></div></div><p>Matches documents that have fields that contain a term (<span class="strong"><strong>not analyzed</strong></span>).
The term query maps to Lucene <code class="literal">TermQuery</code>. The following matches
documents where the user field contains the term <code class="literal">kimchy</code>:</p><pre class="programlisting prettyprint lang-js">{
    "term" : { "user" : "kimchy" }
}</pre><p>A boost can also be associated with the query:</p><pre class="programlisting prettyprint lang-js">{
    "term" : { "user" : { "value" : "kimchy", "boost" : 2.0 } }
}</pre><p>Or :</p><pre class="programlisting prettyprint lang-js">{
    "term" : { "user" : { "term" : "kimchy", "boost" : 2.0 } }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-terms-query"></a>Terms Query</h2></div></div></div><p>A query that match on any (configurable) of the provided terms. This is
a simpler syntax query for using a <code class="literal">bool</code> query with several <code class="literal">term</code>
queries in the <code class="literal">should</code> clauses. For example:</p><pre class="programlisting prettyprint lang-js">{
    "terms" : {
        "tags" : [ "blue", "pill" ],
        "minimum_should_match" : 1
    }
}</pre><p>The <code class="literal">terms</code> query is also aliased with <code class="literal">in</code> as the query name for
simpler usage.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-top-children-query"></a>Top Children Query</h2></div></div></div><p>The <code class="literal">top_children</code> query runs the child query with an estimated hits
size, and out of the hit docs, aggregates it into parent docs. If there
arenât enough parent docs matching the requested from/size search
request, then it is run again with a wider (more hits) search.</p><p>The <code class="literal">top_children</code> also provide scoring capabilities, with the ability
to specify <code class="literal">max</code>, <code class="literal">sum</code> or <code class="literal">avg</code> as the score type.</p><p>One downside of using the <code class="literal">top_children</code> is that if there are more child
docs matching the required hits when executing the child query, then the
<code class="literal">total_hits</code> result of the search response will be incorrect.</p><p>How many hits are asked for in the first child query run is controlled
using the <code class="literal">factor</code> parameter (defaults to <code class="literal">5</code>). For example, when asking
for 10 parent docs (with <code class="literal">from</code> set to 0), then the child query will
execute with 50 hits expected. If not enough parents are found (in our
example 10), and there are still more child docs to query, then the
child search hits are expanded by multiplying by the
<code class="literal">incremental_factor</code> (defaults to <code class="literal">2</code>).</p><p>The required parameters are the <code class="literal">query</code> and <code class="literal">type</code> (the child type to
execute the query on). Here is an example with all different parameters,
including the default values:</p><pre class="programlisting prettyprint lang-js">{
    "top_children" : {
        "type": "blog_tag",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        },
        "score" : "max",
        "factor" : 5,
        "incremental_factor" : 2
    }
}</pre><h4><a id="_scope_2"></a>Scope</h4><p>A <code class="literal">_scope</code> can be defined on the query allowing to run facets on the
same scope name that will work against the child documents. For example:</p><pre class="programlisting prettyprint lang-js">{
    "top_children" : {
        "_scope" : "my_scope",
        "type": "blog_tag",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</pre><h4><a id="_memory_considerations_7"></a>Memory Considerations</h4><p>With the current implementation, all <code class="literal">_parent</code> field values and all <code class="literal">_id</code>
field values of parent documents are loaded into memory (heap) via field data
in order to support fast lookups, so make sure there is enough memory for it.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-wildcard-query"></a>Wildcard Query</h2></div></div></div><p>Matches documents that have fields matching a wildcard expression (<span class="strong"><strong>not
analyzed</strong></span>). Supported wildcards are <code class="literal">*</code>, which matches any character
sequence (including the empty one), and <code class="literal">?</code>, which matches any single
character. Note this query can be slow, as it needs to iterate over many
terms. In order to prevent extremely slow wildcard queries, a wildcard
term should not start with one of the wildcards <code class="literal">*</code> or <code class="literal">?</code>. The wildcard
query maps to Lucene <code class="literal">WildcardQuery</code>.</p><pre class="programlisting prettyprint lang-js">{
    "wildcard" : { "user" : "ki*y" }
}</pre><p>A boost can also be associated with the query:</p><pre class="programlisting prettyprint lang-js">{
    "wildcard" : { "user" : { "value" : "ki*y", "boost" : 2.0 } }
}</pre><p>Or :</p><pre class="programlisting prettyprint lang-js">{
    "wildcard" : { "user" : { "wildcard" : "ki*y", "boost" : 2.0 } }
}</pre><p>This multi term query allows to control how it gets rewritten using the
<a class="link" href="#query-dsl-multi-term-rewrite" title="Multi Term Query Rewrite">rewrite</a>
parameter.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-minimum-should-match"></a>Minimum Should Match</h2></div></div></div><p>The <code class="literal">minimum_should_match</code> parameter possible values:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /></colgroup><thead><tr><th align="left" valign="top">Type </th><th align="left" valign="top">Example </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>Integer</p></td><td align="left" valign="top"><p><code class="literal">3</code></p></td><td align="left" valign="top"><p>Indicates a fixed value regardless of the number of
optional clauses.</p></td></tr><tr><td align="left" valign="top"><p>Negative integer</p></td><td align="left" valign="top"><p><code class="literal">-2</code></p></td><td align="left" valign="top"><p>Indicates that the total number of optional
clauses, minus this number should be mandatory.</p></td></tr><tr><td align="left" valign="top"><p>Percentage</p></td><td align="left" valign="top"><p><code class="literal">75%</code></p></td><td align="left" valign="top"><p>Indicates that this percent of the total number of
optional clauses are necessary. The number computed from the percentage
is rounded down and used as the minimum.</p></td></tr><tr><td align="left" valign="top"><p>Negative percentage</p></td><td align="left" valign="top"><p><code class="literal">-25%</code></p></td><td align="left" valign="top"><p>Indicates that this percent of the total
number of optional clauses can be missing. The number computed from the
percentage is rounded down, before being subtracted from the total to
determine the minimum.</p></td></tr><tr><td align="left" valign="top"><p>Combination</p></td><td align="left" valign="top"><p><code class="literal">3&lt;90%</code></p></td><td align="left" valign="top"><p>A positive integer, followed by the less-than
symbol, followed by any of the previously mentioned specifiers is a
conditional specification. It indicates that if the number of optional
clauses is equal to (or less than) the integer, they are all required,
but if itâs greater than the integer, the specification applies. In this
example: if there are 1 to 3 clauses they are all required, but for 4 or
more clauses only 90% are required.</p></td></tr><tr><td align="left" valign="top"><p>Multiple combinations</p></td><td align="left" valign="top"><p><code class="literal">2&lt;-25 9&lt;-3</code></p></td><td align="left" valign="top"><p>Multiple conditional
specifications can be separated by spaces, each one only being valid for
numbers greater than the one before it. In this example: if there are 1
or 2 clauses both are required, if there are 3-9 clauses all but 25% are
required, and if there are more than 9 clauses, all but three are
required.</p></td></tr></tbody></table></div><p><span class="strong"><strong>NOTE:</strong></span></p><p>When dealing with percentages, negative values can be used to get
different behavior in edge cases. 75% and -25% mean the same thing when
dealing with 4 clauses, but when dealing with 5 clauses 75% means 3 are
required, but -25% means 4 are required.</p><p>If the calculations based on the specification determine that no
optional clauses are needed, the usual rules about BooleanQueries still
apply at search time (a BooleanQuery containing no required clauses must
still match at least one optional clause)</p><p>No matter what number the calculation arrives at, a value greater than
the number of optional clauses, or a value less than 1 will never be
used. (ie: no matter how low or how high the result of the calculation
result is, the minimum number of required matches will never be lower
than 1 or greater than the number of clauses.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-multi-term-rewrite"></a>Multi Term Query Rewrite</h2></div></div></div><p>Multi term queries, like
<a class="link" href="#query-dsl-wildcard-query" title="Wildcard Query">wildcard</a> and
<a class="link" href="#query-dsl-prefix-query" title="Prefix Query">prefix</a> are called
multi term queries and end up going through a process of rewrite. This
also happens on the
<a class="link" href="#query-dsl-query-string-query" title="Query String Query">query_string</a>.
All of those queries allow to control how they will get rewritten using
the <code class="literal">rewrite</code> parameter:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
When not set, or set to <code class="literal">constant_score_auto</code>, defaults to
automatically choosing either <code class="literal">constant_score_boolean</code> or
<code class="literal">constant_score_filter</code> based on query characteristics.
</li><li class="listitem">
<code class="literal">scoring_boolean</code>: A rewrite method that first translates each term
into a should clause in a boolean query, and keeps the scores as
computed by the query. Note that typically such scores are meaningless
to the user, and require non-trivial CPU to compute, so itâs almost
always better to use <code class="literal">constant_score_auto</code>. This rewrite method will hit
too many clauses failure if it exceeds the boolean query limit (defaults
to <code class="literal">1024</code>).
</li><li class="listitem">
<code class="literal">constant_score_boolean</code>: Similar to <code class="literal">scoring_boolean</code> except scores
are not computed. Instead, each matching document receives a constant
score equal to the queryâs boost. This rewrite method will hit too many
clauses failure if it exceeds the boolean query limit (defaults to
<code class="literal">1024</code>).
</li><li class="listitem">
<code class="literal">constant_score_filter</code>: A rewrite method that first creates a private
Filter by visiting each term in sequence and marking all docs for that
term. Matching documents are assigned a constant score equal to the
queryâs boost.
</li><li class="listitem">
<code class="literal">top_terms_N</code>: A rewrite method that first translates each term into
should clause in boolean query, and keeps the scores as computed by the
query. This rewrite method only uses the top scoring terms so it will
not overflow boolean max clause count. The <code class="literal">N</code> controls the size of the
top scoring terms to use.
</li><li class="listitem">
<code class="literal">top_terms_boost_N</code>: A rewrite method that first translates each term
into should clause in boolean query, but the scores are only computed as
the boost. This rewrite method only uses the top scoring terms so it
will not overflow the boolean max clause count. The <code class="literal">N</code> controls the
size of the top scoring terms to use.
</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-template-query"></a>Template Query</h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.1.0.</p></div></div><p>A query that accepts a query template and a map of key/value pairs to fill in
template parameters.</p><pre class="programlisting prettyprint lang-js">GET /_search
{
    "query": {
        "template": {
            "query": {"match_{{template}}": {}},
            "params" : {
                "template" : "all"
            }
        }
    }
}</pre><p>Alternatively passing the template as an escaped string works as well:</p><pre class="programlisting prettyprint lang-js">GET /_search
{
    "query": {
        "template": {
            "query": "{\"match_{{template}}\": {}}\"", <a id="CO30-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            "params" : {
                "template" : "all"
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO30-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
New line characters (<code class="literal">\n</code>) should be escaped as <code class="literal">\\n</code> or removed,
    and quotes (<code class="literal">"</code>) should be escaped as <code class="literal">\\"</code>.
</p></td></tr></table></div><p>You can register a template by storing it in the <code class="literal">config/scripts</code> directory, in a file using the <code class="literal">.mustache</code> extension.
In order to execute the stored template, reference it by name in the <code class="literal">query</code>
parameter:</p><pre class="programlisting prettyprint lang-js">GET /_search
{
    "query": {
        "template": {
            "query": "storedTemplate", <a id="CO31-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            "params" : {
                "template" : "all"
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO31-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Name of the the query template in <code class="literal">config/scripts/</code>, i.e., <code class="literal">storedTemplate.mustache</code>.
</p></td></tr></table></div><p>Templating is based on Mustache. For simple token substitution all you provide
is a query containing some variable that you want to substitute and the actual
values:</p><pre class="programlisting prettyprint lang-js">GET /_search
{
    "query": {
        "template": {
            "query": {"match_{{template}}": {}},
            "params" : {
                "template" : "all"
            }
        }
    }
}</pre><p>which is then turned into:</p><pre class="programlisting prettyprint lang-js">{
    "query": {
        "match_all": {}
    }
}</pre><p>There is also a dedicated <code class="literal">template</code> endpoint, allows you to template an entire search request.
Please see <a class="xref" href="#search-template" title="Search Template"><em>Search Template</em></a> for more details.</p></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-filters"></a>Filters</h2></div></div></div><p>As a general rule, filters should be used instead of queries:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
for binary yes/no searches
</li><li class="listitem">
for queries on exact values
</li></ul></div><h3><a id="caching"></a>Filters and Caching</h3><p>Filters can be a great candidate for caching. Caching the result of a
filter does not require a lot of memory, and will cause other queries
executing against the same filter (same parameters) to be blazingly
fast.</p><p>Some filters already produce a result that is easily cacheable, and the
difference between caching and not caching them is the act of placing
the result in the cache or not. These filters, which include the
<a class="link" href="#query-dsl-term-filter" title="Term Filter">term</a>,
<a class="link" href="#query-dsl-terms-filter" title="Terms Filter">terms</a>,
<a class="link" href="#query-dsl-prefix-filter" title="Prefix Filter">prefix</a>, and
<a class="link" href="#query-dsl-range-filter" title="Range Filter">range</a> filters, are by
default cached and are recommended to use (compared to the equivalent
query version) when the same filter (same parameters) will be used
across multiple different queries (for example, a range filter with age
higher than 10).</p><p>Other filters, usually already working with the field data loaded into
memory, are not cached by default. Those filters are already very fast,
and the process of caching them requires extra processing in order to
allow the filter result to be used with different queries than the one
executed. These filters, including the geo,
and <a class="link" href="#query-dsl-script-filter" title="Script Filter">script</a> filters
are not cached by default.</p><p>The last type of filters are those working with other filters. The
<a class="link" href="#query-dsl-and-filter" title="And Filter">and</a>,
<a class="link" href="#query-dsl-not-filter" title="Not Filter">not</a> and
<a class="link" href="#query-dsl-or-filter" title="Or Filter">or</a> filters are not
cached as they basically just manipulate the internal filters.</p><p>All filters allow to set <code class="literal">_cache</code> element on them to explicitly control
caching. They also allow to set <code class="literal">_cache_key</code> which will be used as the
caching key for that filter. This can be handy when using very large
filters (like a terms filter with many elements in it).</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-and-filter"></a>And Filter</h2></div></div></div><p>A filter that matches documents using <code class="literal">AND</code> boolean operator on other
filters. Can be placed within queries that accept a filter.</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "and" : [
                {
                    "range" : {
                        "postDate" : {
                            "from" : "2010-03-01",
                            "to" : "2010-04-01"
                        }
                    }
                },
                {
                    "prefix" : { "name.second" : "ba" }
                }
            ]
        }
    }
}</pre><h4><a id="_caching"></a>Caching</h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> in order to cache it (though usually not needed). Since
the <code class="literal">_cache</code> element requires to be set on the <code class="literal">and</code> filter itself, the
structure then changes a bit to have the filters provided within a
<code class="literal">filters</code> element:</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "and" : {
                "filters": [
                    {
                        "range" : {
                            "postDate" : {
                                "from" : "2010-03-01",
                                "to" : "2010-04-01"
                            }
                        }
                    },
                    {
                        "prefix" : { "name.second" : "ba" }
                    }
                ],
                "_cache" : true
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-bool-filter"></a>Bool Filter</h2></div></div></div><p>A filter that matches documents matching boolean combinations of other
queries. Similar in concept to
<a class="link" href="#query-dsl-bool-query" title="Bool Query">Boolean query</a>, except
that the clauses are other filters. Can be placed within queries that
accept a filter.</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "queryString" : {
                "default_field" : "message",
                "query" : "elasticsearch"
            }
        },
        "filter" : {
            "bool" : {
                "must" : {
                    "term" : { "tag" : "wow" }
                },
                "must_not" : {
                    "range" : {
                        "age" : { "from" : 10, "to" : 20 }
                    }
                },
                "should" : [
                    {
                        "term" : { "tag" : "sometag" }
                    },
                    {
                        "term" : { "tag" : "sometagtag" }
                    }
                ]
            }
        }
    }
}</pre><h4><a id="_caching_2"></a>Caching</h4><p>The result of the <code class="literal">bool</code> filter is not cached by default (though
internal filters might be). The <code class="literal">_cache</code> can be set to <code class="literal">true</code> in order
to enable caching.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-exists-filter"></a>Exists Filter</h2></div></div></div><p>Filters documents where a specific field has a value in them.</p><pre class="programlisting prettyprint lang-js">{
    "constant_score" : {
        "filter" : {
            "exists" : { "field" : "user" }
        }
    }
}</pre><h4><a id="_caching_3"></a>Caching</h4><p>The result of the filter is always cached.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-geo-bounding-box-filter"></a>Geo Bounding Box Filter</h2></div></div></div><p>A filter allowing to filter hits based on a point location using a
bounding box. Assuming the following indexed document:</p><pre class="programlisting prettyprint lang-js">{
    "pin" : {
        "location" : {
            "lat" : 40.12,
            "lon" : -71.34
        }
    }
}</pre><p>Then the following simple query can be executed with a
<code class="literal">geo_bounding_box</code> filter:</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : {
                        "lat" : 40.73,
                        "lon" : -74.1
                    },
                    "bottom_right" : {
                        "lat" : 40.01,
                        "lon" : -71.12
                    }
                }
            }
        }
    }
}</pre><h4><a id="_accepted_formats_2"></a>Accepted Formats</h4><p>In much the same way the geo_point type can accept different
representation of the geo point, the filter can accept it as well:</p><h5><a id="_lat_lon_as_properties_3"></a>Lat Lon As Properties</h5><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : {
                        "lat" : 40.73,
                        "lon" : -74.1
                    },
                    "bottom_right" : {
                        "lat" : 40.01,
                        "lon" : -71.12
                    }
                }
            }
        }
    }
}</pre><h5><a id="_lat_lon_as_array_3"></a>Lat Lon As Array</h5><p>Format in <code class="literal">[lon, lat]</code>, note, the order of lon/lat here in order to
conform with <a class="ulink" href="http://geojson.org/" target="_top">GeoJSON</a>.</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : [-74.1, 40.73],
                    "bottom_right" : [-71.12, 40.01]
                }
            }
        }
    }
}</pre><h5><a id="_lat_lon_as_string_3"></a>Lat Lon As String</h5><p>Format in <code class="literal">lat,lon</code>.</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : "40.73, -74.1",
                    "bottom_right" : "40.01, -71.12"
                }
            }
        }
    }
}</pre><h5><a id="_geohash_3"></a>Geohash</h5><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : "dr5r9ydj2y73",
                    "bottom_right" : "drj7teegpus6"
                }
            }
        }
    }
}</pre><h4><a id="_vertices"></a>Vertices</h4><p>The vertices of the bounding box can either be set by <code class="literal">top_left</code> and
<code class="literal">bottom_right</code> or by <code class="literal">top_right</code> and <code class="literal">bottom_left</code> parameters. More
over the names <code class="literal">topLeft</code>, <code class="literal">bottomRight</code>, <code class="literal">topRight</code> and <code class="literal">bottomLeft</code>
are supported. Instead of setting the values pairwise, one can use
the simple names <code class="literal">top</code>, <code class="literal">left</code>, <code class="literal">bottom</code> and <code class="literal">right</code> to set the
values separately.</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top" : -74.1,
                    "left" : 40.73,
                    "bottom" : -71.12,
                    "right" : 40.01
                }
            }
        }
    }
}</pre><h4><a id="_geo_point_type"></a>geo_point Type</h4><p>The filter <span class="strong"><strong>requires</strong></span> the <code class="literal">geo_point</code> type to be set on the relevant
field.</p><h4><a id="_multi_location_per_document"></a>Multi Location Per Document</h4><p>The filter can work with multiple locations / points per document. Once
a single location / point matches the filter, the document will be
included in the filter</p><h4><a id="_type"></a>Type</h4><p>The type of the bounding box execution by default is set to <code class="literal">memory</code>,
which means in memory checks if the doc falls within the bounding box
range. In some cases, an <code class="literal">indexed</code> option will perform faster (but note
that the <code class="literal">geo_point</code> type must have lat and lon indexed in this case).
Note, when using the indexed option, multi locations per document field
are not supported. Here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : {
                        "lat" : 40.73,
                        "lon" : -74.1
                    },
                    "bottom_right" : {
                        "lat" : 40.10,
                        "lon" : -71.12
                    }
                },
                "type" : "indexed"
            }
        }
    }
}</pre><h4><a id="_caching_4"></a>Caching</h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> to cache the <span class="strong"><strong>result</strong></span> of the filter. This is handy when
the same bounding box parameters are used on several (many) other
queries. Note, the process of caching the first execution is higher when
caching (since it needs to satisfy different queries).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-geo-distance-filter"></a>Geo Distance Filter</h2></div></div></div><p>Filters documents that include only hits that exists within a specific
distance from a geo point. Assuming the following indexed json:</p><pre class="programlisting prettyprint lang-js">{
    "pin" : {
        "location" : {
            "lat" : 40.12,
            "lon" : -71.34
        }
    }
}</pre><p>Then the following simple query can be executed with a <code class="literal">geo_distance</code>
filter:</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "200km",
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                }
            }
        }
    }
}</pre><h4><a id="_accepted_formats_3"></a>Accepted Formats</h4><p>In much the same way the <code class="literal">geo_point</code> type can accept different
representation of the geo point, the filter can accept it as well:</p><h5><a id="_lat_lon_as_properties_4"></a>Lat Lon As Properties</h5><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                }
            }
        }
    }
}</pre><h5><a id="_lat_lon_as_array_4"></a>Lat Lon As Array</h5><p>Format in <code class="literal">[lon, lat]</code>, note, the order of lon/lat here in order to
conform with <a class="ulink" href="http://geojson.org/" target="_top">GeoJSON</a>.</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : [40, -70]
            }
        }
    }
}</pre><h5><a id="_lat_lon_as_string_4"></a>Lat Lon As String</h5><p>Format in <code class="literal">lat,lon</code>.</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : "40,-70"
            }
        }
    }
}</pre><h5><a id="_geohash_4"></a>Geohash</h5><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : "drm3btev3e86"
            }
        }
    }
}</pre><h4><a id="_options_3"></a>Options</h4><p>The following are options allowed on the filter:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">distance</code>
</p>
</td><td valign="top">
<p>
    The radius of the circle centred on the specified location. Points which
    fall into this circle are considered to be matches. The <code class="literal">distance</code> can be
    specified in various units. See <a class="xref" href="#distance-units" title="Distance Units">the section called âDistance Unitsâ</a>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">distance_type</code>
</p>
</td><td valign="top">
<p>
    How to compute the distance. Can either be <code class="literal">arc</code> (better precision),
    <code class="literal">sloppy_arc</code> (faster but less precise) or <code class="literal">plane</code> (fastest). Defaults
    to <code class="literal">sloppy_arc</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">optimize_bbox</code>
</p>
</td><td valign="top">
<p>
    Whether to use the optimization of first running a bounding box check
    before the distance check. Defaults to <code class="literal">memory</code> which will do in memory
    checks. Can also have values of <code class="literal">indexed</code> to use indexed value check (make
    sure the <code class="literal">geo_point</code> type index lat lon in this case), or <code class="literal">none</code> which
    disables bounding box optimization.
</p>
</td></tr></tbody></table></div><h4><a id="_geo_point_type_2"></a>geo_point Type</h4><p>The filter <span class="strong"><strong>requires</strong></span> the <code class="literal">geo_point</code> type to be set on the relevant
field.</p><h4><a id="_multi_location_per_document_2"></a>Multi Location Per Document</h4><p>The <code class="literal">geo_distance</code> filter can work with multiple locations / points per
document. Once a single location / point matches the filter, the
document will be included in the filter.</p><h4><a id="_caching_5"></a>Caching</h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> to cache the <span class="strong"><strong>result</strong></span> of the filter. This is handy when
the same point and distance parameters are used on several (many) other
queries. Note, the process of caching the first execution is higher when
caching (since it needs to satisfy different queries).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-geo-distance-range-filter"></a>Geo Distance Range Filter</h2></div></div></div><p>Filters documents that exists within a range from a specific point:</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance_range" : {
                "from" : "200km",
                "to" : "400km"
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                }
            }
        }
    }
}</pre><p>Supports the same point location parameter as the
<a class="link" href="#query-dsl-geo-distance-filter" title="Geo Distance Filter">geo_distance</a>
filter. And also support the common parameters for range (lt, lte, gt,
gte, from, to, include_upper and include_lower).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-geo-polygon-filter"></a>Geo Polygon Filter</h2></div></div></div><p>A filter allowing to include hits that only fall within a polygon of
points. Here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_polygon" : {
                "person.location" : {
                    "points" : [
                        {"lat" : 40, "lon" : -70},
                        {"lat" : 30, "lon" : -80},
                        {"lat" : 20, "lon" : -90}
                    ]
                }
            }
        }
    }
}</pre><h4><a id="_allowed_formats"></a>Allowed Formats</h4><h5><a id="_lat_long_as_array"></a>Lat Long as Array</h5><p>Format in <code class="literal">[lon, lat]</code>, note, the order of lon/lat here in order to
conform with <a class="ulink" href="http://geojson.org/" target="_top">GeoJSON</a>.</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_polygon" : {
                "person.location" : {
                    "points" : [
                        [-70, 40],
                        [-80, 30],
                        [-90, 20]
                    ]
                }
            }
        }
    }
}</pre><h5><a id="_lat_lon_as_string_5"></a>Lat Lon as String</h5><p>Format in <code class="literal">lat,lon</code>.</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_polygon" : {
                "person.location" : {
                    "points" : [
                        "40, -70",
                        "30, -80",
                        "20, -90"
                    ]
                }
            }
        }
    }
}</pre><h5><a id="_geohash_5"></a>Geohash</h5><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_polygon" : {
                "person.location" : {
                    "points" : [
                        "drn5x1g8cu2y",
                        "30, -80",
                        "20, -90"
                    ]
                }
            }
        }
    }
}</pre><h4><a id="_geo_point_type_3"></a>geo_point Type</h4><p>The filter <span class="strong"><strong>requires</strong></span> the
<a class="link" href="#mapping-geo-point-type" title="Geo Point Type">geo_point</a> type to be
set on the relevant field.</p><h4><a id="_caching_6"></a>Caching</h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> to cache the <span class="strong"><strong>result</strong></span> of the filter. This is handy when
the same points parameters are used on several (many) other queries.
Note, the process of caching the first execution is higher when caching
(since it needs to satisfy different queries).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-geo-shape-filter"></a>GeoShape Filter</h2></div></div></div><p>Filter documents indexed using the <code class="literal">geo_shape</code> type.</p><p>Requires the <a class="link" href="#mapping-geo-shape-type" title="Geo Shape Type">geo_shape Mapping</a>.</p><p>You may also use the
<a class="link" href="#query-dsl-geo-shape-query" title="GeoShape Query">geo_shape Query</a>.</p><p>The <code class="literal">geo_shape</code> Filter uses the same grid square representation as the
geo_shape mapping to find documents that have a shape that intersects
with the query shape. It will also use the same PrefixTree configuration
as defined for the field mapping.</p><h4><a id="_filter_format"></a>Filter Format</h4><p>The Filter supports two ways of defining the Filter shape, either by
providing a whole shape defintion, or by referencing the name of a shape
pre-indexed in another index. Both formats are defined below with
examples.</p><h5><a id="_provided_shape_definition"></a>Provided Shape Definition</h5><p>Similar to the <code class="literal">geo_shape</code> type, the <code class="literal">geo_shape</code> Filter uses
<a class="ulink" href="http://www.geojson.org" target="_top">GeoJSON</a> to represent shapes.</p><p>Given a document that looks like this:</p><pre class="programlisting prettyprint lang-js">{
    "name": "Wind &amp; Wetter, Berlin, Germany",
    "location": {
        "type": "Point",
        "coordinates": [13.400544, 52.530286]
    }
}</pre><p>The following query will find the point using the Elasticsearchâs
<code class="literal">envelope</code> GeoJSON extension:</p><pre class="programlisting prettyprint lang-js">{
    "query":{
        "filtered": {
            "query": {
                "match_all": {}
            },
            "filter": {
                "geo_shape": {
                    "location": {
                        "shape": {
                            "type": "envelope",
                            "coordinates" : [[13.0, 53.0], [14.0, 52.0]]
                        }
                    }
                }
            }
        }
    }
}</pre><h5><a id="_pre_indexed_shape"></a>Pre-Indexed Shape</h5><p>The Filter also supports using a shape which has already been indexed in
another index and/or index type. This is particularly useful for when
you have a pre-defined list of shapes which are useful to your
application and you want to reference this using a logical name (for
example <span class="emphasis"><em>New Zealand</em></span>) rather than having to provide their coordinates
each time. In this situation it is only necessary to provide:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">id</code> - The ID of the document that containing the pre-indexed shape.
</li><li class="listitem">
<code class="literal">index</code> - Name of the index where the pre-indexed shape is. Defaults
to <span class="emphasis"><em>shapes</em></span>.
</li><li class="listitem">
<code class="literal">type</code> - Index type where the pre-indexed shape is.
</li><li class="listitem">
<code class="literal">path</code> - The field specified as path containing the pre-indexed shape.
Defaults to <span class="emphasis"><em>shape</em></span>.
</li></ul></div><p>The following is an example of using the Filter with a pre-indexed
shape:</p><pre class="programlisting prettyprint lang-js">{
    "filtered": {
        "query": {
            "match_all": {}
        },
        "filter": {
            "geo_shape": {
                "location": {
                    "indexed_shape": {
                        "id": "DEU",
                        "type": "countries",
                        "index": "shapes",
                        "path": "location"
                    }
                }
            }
        }
    }
}</pre><h4><a id="_caching_7"></a>Caching</h4><p>The result of the Filter is not cached by default. Setting <code class="literal">_cache</code> to
<code class="literal">true</code> will mean the results of the Filter will be cached. Since shapes
can contain 10s-100s of coordinates and any one differing means a new
shape, it may make sense to only using caching when you are sure that
the shapes will remain reasonably static.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-geohash-cell-filter"></a>Geohash Cell Filter</h2></div></div></div><p>The <code class="literal">geohash_cell</code> filter provides access to a hierarchy of geohashes.
By defining a geohash cell, only <a class="link" href="#mapping-geo-point-type" title="Geo Point Type">geopoints</a>
within this cell will match this filter.</p><p>To get this filter work all prefixes of a geohash need to be indexed. In
example a geohash <code class="literal">u30</code> needs to be decomposed into three terms: <code class="literal">u30</code>,
<code class="literal">u3</code> and <code class="literal">u</code>. This decomposition must be enabled in the mapping of the
<a class="link" href="#mapping-geo-point-type" title="Geo Point Type">geopoint</a> field thatâs going to be filtered by
setting the <code class="literal">geohash_prefix</code> option:</p><pre class="programlisting prettyprint lang-js">{
    "mappings" : {
        "location": {
            "properties": {
                "pin": {
                    "type": "geo_point",
                    "geohash": true,
                    "geohash_prefix": true,
                    "geohash_precision": 10
                }
            }
        }
    }
}</pre><p>The geohash cell can defined by all formats of <code class="literal">geo_points</code>. If such a cell is
defined by a latitude and longitude pair the size of the cell needs to be
setup. This can be done by the <code class="literal">precision</code> parameter of the filter. This
parameter can be set to an integer value which sets the length of the geohash
prefix. Instead of setting a geohash length directly it is also possible to
define the precision as distance, in example <code class="literal">"precision": "50m"</code>. (See
<a class="xref" href="#distance-units" title="Distance Units">the section called âDistance Unitsâ</a>.)</p><p>The <code class="literal">neighbor</code> option of the filter offers the possibility to filter cells
next to the given cell.</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geohash_cell": {
                "pin": {
                    "lat": 13.4080,
                    "lon": 52.5186
                },
                "precision": 3,
                "neighbors": true
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-has-child-filter"></a>Has Child Filter</h2></div></div></div><p>The <code class="literal">has_child</code> filter accepts a query and the child type to run
against, and results in parent documents that have child docs matching
the query. Here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "has_child" : {
        "type" : "blog_tag",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</pre><p>The <code class="literal">type</code> is the child type to query against. The parent type to return
is automatically detected based on the mappings.</p><p>The way that the filter is implemented is by first running the child
query, doing the matching up to the parent doc for each document
matched.</p><p>The <code class="literal">has_child</code> filter also accepts a filter instead of a query:</p><pre class="programlisting prettyprint lang-js">{
    "has_child" : {
        "type" : "comment",
        "filter" : {
            "term" : {
                "user" : "john"
            }
        }
    }
}</pre><h4><a id="_memory_considerations_8"></a>Memory Considerations</h4><p>With the current implementation, all <code class="literal">_parent</code> field values and all <code class="literal">_id</code>
field values of parent documents are loaded into memory (heap) via field data
in order to support fast lookups, so make sure there is enough memory for it.</p><h4><a id="_caching_8"></a>Caching</h4><p>The <code class="literal">has_child</code> filter cannot be cached in the filter cache. The <code class="literal">_cache</code>
and <code class="literal">_cache_key</code> options are a no-op in this filter. Also any filter that
wraps the <code class="literal">has_child</code> filter either directly or indirectly will not be cached.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-has-parent-filter"></a>Has Parent Filter</h2></div></div></div><p>The <code class="literal">has_parent</code> filter accepts a query and a parent type. The query is
executed in the parent document space, which is specified by the parent
type. This filter return child documents which associated parents have
matched. For the rest <code class="literal">has_parent</code> filter has the same options and works
in the same manner as the <code class="literal">has_child</code> filter.</p><h4><a id="_filter_example"></a>Filter example</h4><pre class="programlisting prettyprint lang-js">{
    "has_parent" : {
        "parent_type" : "blog",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</pre><p>The <code class="literal">parent_type</code> field name can also be abbreviated to <code class="literal">type</code>.</p><p>The way that the filter is implemented is by first running the parent
query, doing the matching up to the child doc for each document matched.</p><p>The <code class="literal">has_parent</code> filter also accepts a filter instead of a query:</p><pre class="programlisting prettyprint lang-js">{
    "has_parent" : {
        "type" : "blog",
        "filter" : {
            "term" : {
                "text" : "bonsai three"
            }
        }
    }
}</pre><h4><a id="_memory_considerations_9"></a>Memory considerations</h4><p>With the current implementation, all <code class="literal">_parent</code> field values and all <code class="literal">_id</code>
field values of parent documents are loaded into memory (heap) via field data
in order to support fast lookups, so make sure there is enough memory for it.</p><h4><a id="_caching_9"></a>Caching</h4><p>The <code class="literal">has_parent</code> filter cannot be cached in the filter cache. The <code class="literal">_cache</code>
and <code class="literal">_cache_key</code> options are a no-op in this filter. Also any filter that
wraps the <code class="literal">has_parent</code> filter either directly or indirectly will not be cached.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-ids-filter"></a>Ids Filter</h2></div></div></div><p>Filters documents that only have the provided ids. Note, this filter
does not require the <a class="link" href="#mapping-id-field" title="_id">_id</a>
field to be indexed since it works using the
<a class="link" href="#mapping-uid-field" title="_uid">_uid</a> field.</p><pre class="programlisting prettyprint lang-js">{
    "ids" : {
        "type" : "my_type",
        "values" : ["1", "4", "100"]
    }
}</pre><p>The <code class="literal">type</code> is optional and can be omitted, and can also accept an array
of values.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-indices-filter"></a>Indices Filter</h2></div></div></div><p>The <code class="literal">indices</code> filter can be used when executed across multiple indices,
allowing to have a filter that executes only when executed on an index
that matches a specific list of indices, and another filter that executes
when it is executed on an index that does not match the listed indices.</p><pre class="programlisting prettyprint lang-js">{
    "indices" : {
        "indices" : ["index1", "index2"],
        "filter" : {
            "term" : { "tag" : "wow" }
        },
        "no_match_filter" : {
            "term" : { "tag" : "kow" }
        }
    }
}</pre><p>You can use the <code class="literal">index</code> field to provide a single index.</p><p><code class="literal">no_match_filter</code> can also have "string" value of <code class="literal">none</code> (to match no
documents), and <code class="literal">all</code> (to match all). Defaults to <code class="literal">all</code>.</p><p><code class="literal">filter</code> is mandatory, as well as <code class="literal">indices</code> (or <code class="literal">index</code>).</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>The fields order is important: if the <code class="literal">indices</code> are provided before <code class="literal">filter</code>
or <code class="literal">no_match_filter</code>, the related filters get parsed only against the indices
that they are going to be executed on. This is useful to avoid parsing filters
when it is not necessary and prevent potential mapping errors.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-limit-filter"></a>Limit Filter</h2></div></div></div><p>A limit filter limits the number of documents (per shard) to execute on.
For example:</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "filter" : {
             "limit" : {"value" : 100}
         },
         "query" : {
            "term" : { "name.first" : "shay" }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-match-all-filter"></a>Match All Filter</h2></div></div></div><p>A filter that matches on all documents:</p><pre class="programlisting prettyprint lang-js">{
    "constant_score" : {
        "filter" : {
            "match_all" : { }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-missing-filter"></a>Missing Filter</h2></div></div></div><p>Filters documents where a specific field has no value in them.</p><pre class="programlisting prettyprint lang-js">{
    "constant_score" : {
        "filter" : {
            "missing" : { "field" : "user" }
        }
    }
}</pre><p>By default, the filter will only find "missing" fields, i.e., fields
that have no values. It can be configured also to find fields with an
explicit <code class="literal">null_value</code> mapped for them. Here is an example that will both
find missing field that donât exists (<code class="literal">existence</code> set to <code class="literal">true</code>), or
have null values (<code class="literal">null_value</code> set to <code class="literal">true</code>).</p><pre class="programlisting prettyprint lang-js">{
    "constant_score" : {
        "filter" : {
            "missing" : {
                "field" : "user",
                "existence" : true,
                "null_value" : true
            }
        }
    }
}</pre><h4><a id="_caching_10"></a>Caching</h4><p>The result of the filter is always cached.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-nested-filter"></a>Nested Filter</h2></div></div></div><p>A <code class="literal">nested</code> filter works in a similar fashion to the
<a class="link" href="#query-dsl-nested-query" title="Nested Query">nested</a> query, except itâs
used as a filter. It follows exactly the same structure, but also allows
to cache the results (set <code class="literal">_cache</code> to <code class="literal">true</code>), and have it named (set
the <code class="literal">_name</code> value). For example:</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : { "match_all" : {} },
        "filter" : {
            "nested" : {
                "path" : "obj1",
                "filter" : {
                    "bool" : {
                        "must" : [
                            {
                                "term" : {"obj1.name" : "blue"}
                            },
                            {
                                "range" : {"obj1.count" : {"gt" : 5}}
                            }
                        ]
                    }
                },
                "_cache" : true
            }
        }
    }
}</pre><h4><a id="_join_option"></a>Join option</h4><p>The nested filter also supports a <code class="literal">join</code> option which controls whether to perform the block join or not.
By default, itâs enabled. But when itâs disabled, it emits the hidden nested documents as hits instead of the joined root document.</p><p>This is useful when a <code class="literal">nested</code> filter is used in a facet where nested is enabled, like you can see in the example below:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
                "nested" : {
                        "path" : "offers",
                        "query" : {
                                "match" : {
                                        "offers.color" : "blue"
                                }
                        }
                }
        },
        "facets" : {
                "size" : {
                        "terms" : {
                                "field" : "offers.size"
                        },
                        "facet_filter" : {
                                "nested" : {
                                        "path" : "offers",
                                        "query" : {
                                                "match" : {
                                                        "offers.color" : "blue"
                                                }
                                        },
                                        "join" : false
                                }
                        },
                        "nested" : "offers"
                }
        }
}'</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-not-filter"></a>Not Filter</h2></div></div></div><p>A filter that filters out matched documents using a query. Can be placed
within queries that accept a filter.</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "not" : {
                "range" : {
                    "postDate" : {
                        "from" : "2010-03-01",
                        "to" : "2010-04-01"
                    }
                }
            }
        }
    }
}</pre><p>Or, in a longer form with a <code class="literal">filter</code> element:</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "not" : {
                "filter" :  {
                    "range" : {
                        "postDate" : {
                            "from" : "2010-03-01",
                            "to" : "2010-04-01"
                        }
                    }
                }
            }
        }
    }
}</pre><h4><a id="_caching_11"></a>Caching</h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> in order to cache it (though usually not needed). Here is
an example:</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "not" : {
                "filter" :  {
                    "range" : {
                        "postDate" : {
                            "from" : "2010-03-01",
                            "to" : "2010-04-01"
                        }
                    }
                },
                "_cache" : true
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-or-filter"></a>Or Filter</h2></div></div></div><p>A filter that matches documents using <code class="literal">OR</code> boolean operator on other
queries. Can be placed within queries that accept a filter.</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "or" : [
                {
                    "term" : { "name.second" : "banon" }
                },
                {
                    "term" : { "name.nick" : "kimchy" }
                }
            ]
        }
    }
}</pre><h4><a id="_caching_12"></a>Caching</h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> in order to cache it (though usually not needed). Since
the <code class="literal">_cache</code> element requires to be set on the <code class="literal">or</code> filter itself, the
structure then changes a bit to have the filters provided within a
<code class="literal">filters</code> element:</p><pre class="programlisting prettyprint lang-js">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "or" : {
                "filters" : [
                    {
                        "term" : { "name.second" : "banon" }
                    },
                    {
                        "term" : { "name.nick" : "kimchy" }
                    }
                ],
                "_cache" : true
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-prefix-filter"></a>Prefix Filter</h2></div></div></div><p>Filters documents that have fields containing terms with a specified
prefix (<span class="strong"><strong>not analyzed</strong></span>). Similar to phrase query, except that it acts as
a filter. Can be placed within queries that accept a filter.</p><pre class="programlisting prettyprint lang-js">{
    "constant_score" : {
        "filter" : {
            "prefix" : { "user" : "ki" }
        }
    }
}</pre><h4><a id="_caching_13"></a>Caching</h4><p>The result of the filter is cached by default. The <code class="literal">_cache</code> can be set
to <code class="literal">false</code> in order not to cache it. Here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "constant_score" : {
        "filter" : {
            "prefix" : {
                "user" : "ki",
                "_cache" : false
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-query-filter"></a>Query Filter</h2></div></div></div><p>Wraps any query to be used as a filter. Can be placed within queries
that accept a filter.</p><pre class="programlisting prettyprint lang-js">{
    "constantScore" : {
        "filter" : {
            "query" : {
                "query_string" : {
                    "query" : "this AND that OR thus"
                }
            }
        }
    }
}</pre><h4><a id="_caching_14"></a>Caching</h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> to cache the <span class="strong"><strong>result</strong></span> of the filter. This is handy when
the same query is used on several (many) other queries. Note, the
process of caching the first execution is higher when not caching (since
it needs to satisfy different queries).</p><p>Setting the <code class="literal">_cache</code> element requires a different format for the
<code class="literal">query</code>:</p><pre class="programlisting prettyprint lang-js">{
    "constantScore" : {
        "filter" : {
            "fquery" : {
                "query" : {
                    "query_string" : {
                        "query" : "this AND that OR thus"
                    }
                },
                "_cache" : true
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-range-filter"></a>Range Filter</h2></div></div></div><p>Filters documents with fields that have terms within a certain range.
Similar to <a class="link" href="#query-dsl-range-query" title="Range Query">range query</a>, except that it acts as a filter. Can be placed within queries
that accept a filter.</p><pre class="programlisting prettyprint lang-js">{
    "constant_score" : {
        "filter" : {
            "range" : {
                "age" : {
                    "gte": 10,
                    "lte": 20
                }
            }
        }
    }
}</pre><p>The <code class="literal">range</code> filter accepts the following parameters:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">gte</code>
</p>
</td><td valign="top">
<p>
Greater-than or equal to
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">gt</code>
</p>
</td><td valign="top">
<p>
Greater-than
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">lte</code>
</p>
</td><td valign="top">
<p>
Less-than or equal to
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">lt</code>
</p>
</td><td valign="top">
<p>
Less-than
</p>
</td></tr></tbody></table></div><h4><a id="_execution"></a>Execution</h4><p>The <code class="literal">execution</code> option controls how the range filter internally executes. The <code class="literal">execution</code> option accepts the following values:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">index</code>
</p>
</td><td valign="top">
<p>
Uses fieldâs inverted in order to determine of documents fall with in the range filterâs from and to range
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">fielddata</code>
</p>
</td><td valign="top">
<p>
Uses field data in order to determine of documents fall with in the range filterâs from and to range.
</p>
</td></tr></tbody></table></div><p>In general for small ranges the <code class="literal">index</code> execution is faster and for longer ranges the <code class="literal">fielddata</code> execution is faster.</p><p>The <code class="literal">fielddata</code> execution as the same suggests uses field data and therefor requires more memory, so make you have
sufficient memory on your nodes in order to use this execution mode. It usually makes sense to use it on fields  youâre
already faceting or sorting by.</p><h4><a id="_caching_15"></a>Caching</h4><p>The result of the filter is only automatically cached by default if the <code class="literal">execution</code> is set to <code class="literal">index</code>. The
<code class="literal">_cache</code> can be set to <code class="literal">false</code> to turn it off.</p><p>If the <code class="literal">now</code> date math expression is used without rounding then a range filter will never be cached even if <code class="literal">_cache</code> is
set to <code class="literal">true</code>. Also any filter that wraps this filter will never be cached.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-regexp-filter"></a>Regexp Filter</h2></div></div></div><p>The <code class="literal">regexp</code> filter is similar to the
<a class="link" href="#query-dsl-regexp-query" title="Regexp Query">regexp</a> query, except
that it is cacheable and can speedup performance in case you are reusing
this filter in your queries.</p><p>See <a class="xref" href="#regexp-syntax" title="Regular expression syntax">Regular expression syntax</a> for details of the supported regular expression language.</p><pre class="programlisting prettyprint lang-js">{
    "filtered": {
        "query": {
            "match_all": {}
        },
        "filter": {
            "regexp":{
                "name.first" : "s.*y"
            }
        }
    }
}</pre><p>You can also select the cache name and use the same regexp flags in the
filter as in the query.</p><p><span class="strong"><strong>Note</strong></span>: You have to enable caching explicitly in order to have the
<code class="literal">regexp</code> filter cached.</p><pre class="programlisting prettyprint lang-js">{
    "filtered": {
        "query": {
            "match_all": {}
        },
        "filter": {
            "regexp":{
                "name.first" : {
                    "value" : "s.*y",
                    "flags" : "INTERSECTION|COMPLEMENT|EMPTY"
                },
                "_name":"test",
                "_cache" : true,
                "_cache_key" : "key"
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-script-filter"></a>Script Filter</h2></div></div></div><p>A filter allowing to define
<a class="link" href="#modules-scripting" title="Scripting">scripts</a> as filters. For
example:</p><pre class="programlisting prettyprint lang-js">"filtered" : {
    "query" : {
        ...
    },
    "filter" : {
        "script" : {
            "script" : "doc['num1'].value &gt; 1"
        }
    }
}</pre><h4><a id="_custom_parameters"></a>Custom Parameters</h4><p>Scripts are compiled and cached for faster execution. If the same script
can be used, just with different parameters provider, it is preferable
to use the ability to pass parameters to the script itself, for example:</p><pre class="programlisting prettyprint lang-js">"filtered" : {
    "query" : {
        ...
    },
    "filter" : {
        "script" : {
            "script" : "doc['num1'].value &gt; param1"
            "params" : {
                "param1" : 5
            }
        }
    }
}</pre><h4><a id="_caching_16"></a>Caching</h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> to cache the <span class="strong"><strong>result</strong></span> of the filter. This is handy when
the same script and parameters are used on several (many) other queries.
Note, the process of caching the first execution is higher when caching
(since it needs to satisfy different queries).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-term-filter"></a>Term Filter</h2></div></div></div><p>Filters documents that have fields that contain a term (<span class="strong"><strong>not analyzed</strong></span>).
Similar to <a class="link" href="#query-dsl-term-query" title="Term Query">term query</a>,
except that it acts as a filter. Can be placed within queries that
accept a filter, for example:</p><pre class="programlisting prettyprint lang-js">{
    "constant_score" : {
        "filter" : {
            "term" : { "user" : "kimchy"}
        }
    }
}</pre><h4><a id="_caching_17"></a>Caching</h4><p>The result of the filter is automatically cached by default. The
<code class="literal">_cache</code> can be set to <code class="literal">false</code> to turn it off. Here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "constant_score" : {
        "filter" : {
            "term" : {
                "user" : "kimchy",
                "_cache" : false
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-terms-filter"></a>Terms Filter</h2></div></div></div><p>Filters documents that have fields that match any of the provided terms
(<span class="strong"><strong>not analyzed</strong></span>). For example:</p><pre class="programlisting prettyprint lang-js">{
    "constant_score" : {
        "filter" : {
            "terms" : { "user" : ["kimchy", "elasticsearch"]}
        }
    }
}</pre><p>The <code class="literal">terms</code> filter is also aliased with <code class="literal">in</code> as the filter name for
simpler usage.</p><h4><a id="_execution_mode"></a>Execution Mode</h4><p>The way terms filter executes is by iterating over the terms provided
and finding matches docs (loading into a bitset) and caching it.
Sometimes, we want a different execution model that can still be
achieved by building more complex queries in the DSL, but we can support
them in the more compact model that terms filter provides.</p><p>The <code class="literal">execution</code> option now has the following options :</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">plain</code>
</p>
</td><td valign="top">
<p>
    The default. Works as today. Iterates over all the terms,
    building a bit set matching it, and filtering. The total filter is
    cached.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">fielddata</code>
</p>
</td><td valign="top">
<p>
    Generates a terms filters that uses the fielddata cache to
    compare terms.  This execution mode is great to use when filtering
    on a field that is already loaded into the fielddata cache from
    faceting, sorting, or index warmers.  When filtering on
    a large number of terms, this execution can be considerably faster
    than the other modes.  The total filter is not cached unless
    explicitly configured to do so.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">bool</code>
</p>
</td><td valign="top">
<p>
    Generates a term filter (which is cached) for each term, and
    wraps those in a bool filter. The bool filter itself is not cached as it
    can operate very quickly on the cached term filters.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">and</code>
</p>
</td><td valign="top">
<p>
    Generates a term filter (which is cached) for each term, and
    wraps those in an and filter. The and filter itself is not cached.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">or</code>
</p>
</td><td valign="top">
<p>
    Generates a term filter (which is cached) for each term, and
    wraps those in an or filter. The or filter itself is not cached.
    Generally, the <code class="literal">bool</code> execution mode should be preferred.
</p>
</td></tr></tbody></table></div><p>If you donât want the generated individual term queries to be cached,
you can use: <code class="literal">bool_nocache</code>, <code class="literal">and_nocache</code> or <code class="literal">or_nocache</code> instead, but
be aware that this will affect performance.</p><p>The "total" terms filter caching can still be explicitly controlled
using the <code class="literal">_cache</code> option. Note the default value for it depends on the
execution value.</p><p>For example:</p><pre class="programlisting prettyprint lang-js">{
    "constant_score" : {
        "filter" : {
            "terms" : {
                "user" : ["kimchy", "elasticsearch"],
                "execution" : "bool",
                "_cache": true
            }
        }
    }
}</pre><h4><a id="_caching_18"></a>Caching</h4><p>The result of the filter is automatically cached by default. The
<code class="literal">_cache</code> can be set to <code class="literal">false</code> to turn it off.</p><h4><a id="_terms_lookup_mechanism"></a>Terms lookup mechanism</h4><p>When itâs needed to specify a <code class="literal">terms</code> filter with a lot of terms it can
be beneficial to fetch those term values from a document in an index. A
concrete example would be to filter tweets tweeted by your followers.
Potentially the amount of user ids specified in the terms filter can be
a lot. In this scenario it makes sense to use the terms filterâs terms
lookup mechanism.</p><p>The terms lookup mechanism supports the following options:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">index</code>
</p>
</td><td valign="top">
<p>
    The index to fetch the term values from. Defaults to the
    current index.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">type</code>
</p>
</td><td valign="top">
<p>
    The type to fetch the term values from.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">id</code>
</p>
</td><td valign="top">
<p>
    The id of the document to fetch the term values from.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">path</code>
</p>
</td><td valign="top">
<p>
    The field specified as path to fetch the actual values for the
    <code class="literal">terms</code> filter.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">routing</code>
</p>
</td><td valign="top">
<p>
    A custom routing value to be used when retrieving the
    external terms doc.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">cache</code>
</p>
</td><td valign="top">
<p>
    Whether to cache the filter built from the retrieved document
    (<code class="literal">true</code> - default) or whether to fetch and rebuild the filter on every
    request (<code class="literal">false</code>). See "<a class="link" href="#query-dsl-terms-filter-lookup-caching" title="Terms lookup caching">Terms lookup caching</a>" below
</p>
</td></tr></tbody></table></div><p>The values for the <code class="literal">terms</code> filter will be fetched from a field in a
document with the specified id in the specified type and index.
Internally a get request is executed to fetch the values from the
specified path. At the moment for this feature to work the <code class="literal">_source</code>
needs to be stored.</p><p>Also, consider using an index with a single shard and fully replicated
across all nodes if the "reference" terms data is not large. The lookup
terms filter will prefer to execute the get request on a local node if
possible, reducing the need for networking.</p><h4><a id="query-dsl-terms-filter-lookup-caching"></a>Terms lookup caching</h4><p>There is an additional cache involved, which caches the lookup of the
lookup document to the actual terms. This lookup cache is a LRU cache.
This cache has the following options:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">indices.cache.filter.terms.size</code>
</span></dt><dd>
    The size of the lookup cache. The default is <code class="literal">10mb</code>.
</dd><dt><span class="term">
<code class="literal">indices.cache.filter.terms.expire_after_access</code>
</span></dt><dd>
    The time after the last read an entry should expire. Disabled by default.
</dd><dt><span class="term">
<code class="literal">indices.cache.filter.terms.expire_after_write</code>
</span></dt><dd>
    The time after the last write an entry should expire. Disabled by default.
</dd></dl></div><p>All options for the lookup of the documents cache can only be configured
via the <code class="literal">elasticsearch.yml</code> file.</p><p>When using the terms lookup the <code class="literal">execution</code> option isnât taken into
account and behaves as if the execution mode was set to <code class="literal">plain</code>.</p><h4><a id="_terms_lookup_twitter_example"></a>Terms lookup twitter example</h4><pre class="programlisting prettyprint lang-js"># index the information for user with id 2, specifically, its followers
curl -XPUT localhost:9200/users/user/2 -d '{
   "followers" : ["1", "3"]
}'

# index a tweet, from user with id 2
curl -XPUT localhost:9200/tweets/tweet/1 -d '{
   "user" : "2"
}'

# search on all the tweets that match the followers of user 2
curl -XGET localhost:9200/tweets/_search -d '{
  "query" : {
    "filtered" : {
      "filter" : {
        "terms" : {
          "user" : {
            "index" : "users",
            "type" : "user",
            "id" : "2",
            "path" : "followers"
          },
          "_cache_key" : "user_2_friends"
        }
      }
    }
  }
}'</pre><p>The above is highly optimized, both in a sense that the list of
followers will not be fetched if the filter is already cached in the
filter cache, and with internal LRU cache for fetching external values
for the terms filter. Also, the entry in the filter cache will not hold
<code class="literal">all</code> the terms reducing the memory required for it.</p><p><code class="literal">_cache_key</code> is recommended to be set, so its simple to clear the cache
associated with it using the clear cache API. For example:</p><pre class="programlisting prettyprint lang-js">curl -XPOST 'localhost:9200/tweets/_cache/clear?filter_keys=user_2_friends'</pre><p>The structure of the external terms document can also include array of
inner objects, for example:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/users/user/2 -d '{
 "followers" : [
   {
     "id" : "1"
   },
   {
     "id" : "2"
   }
 ]
}'</pre><p>In which case, the lookup path will be <code class="literal">followers.id</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-type-filter"></a>Type Filter</h2></div></div></div><p>Filters documents matching the provided document / mapping type. Note,
this filter can work even when the <code class="literal">_type</code> field is not indexed (using
the <a class="link" href="#mapping-uid-field" title="_uid">_uid</a> field).</p><pre class="programlisting prettyprint lang-js">{
    "type" : {
        "value" : "my_type"
    }
}</pre></div></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="mapping"></a>Mapping</h1></div></div></div><div class="partintro"><div></div><p>Mapping is the process of defining how a document should be mapped to
the Search Engine, including its searchable characteristics such as
which fields are searchable and if/how they are tokenized. In
Elasticsearch, an index may store documents of different "mapping
types". Elasticsearch allows one to associate multiple mapping
definitions for each mapping type.</p><p>Explicit mapping is defined on an index/type level. By default, there
isnât a need to define an explicit mapping, since one is automatically
created and registered when a new type or new field is introduced (with
no performance overhead) and have sensible defaults. Only when the
defaults need to be overridden must a mapping definition be provided.</p><h3><a id="all-mapping-types"></a>Mapping Types</h3><p>Mapping types are a way to divide the documents in an index into logical
groups. Think of it as tables in a database. Though there is separation
between types, itâs not a full separation (all end up as a document
within the same Lucene index).</p><p>Field names with the same name across types are highly recommended to
have the same type and same mapping characteristics (analysis settings
for example). There is an effort to allow to explicitly "choose" which
field to use by using type prefix (<code class="literal">my_type.my_field</code>), but itâs not
complete, and there are places where it will never work (like faceting
on the field).</p><p>In practice though, this restriction is almost never an issue. The field
name usually ends up being a good indication to its "typeness" (e.g.
"first_name" will always be a string). Note also, that this does not
apply to the cross index case.</p><h3><a id="mapping-api"></a>Mapping API</h3><p>To create a mapping, you will need the <a class="link" href="#indices-put-mapping" title="Put Mapping">Put Mapping API</a>, or you can add multiple mappings when you <a class="link" href="#indices-create-index" title="Create Index">create an index</a>.</p><h3><a id="mapping-settings"></a>Global Settings</h3><p>The <code class="literal">index.mapping.ignore_malformed</code> global setting can be set on the
index level to allow to ignore malformed content globally across all
mapping types (malformed content example is trying to index a text string
value as a numeric type).</p><p>The <code class="literal">index.mapping.coerce</code> global setting can be set on the
index level to coerce numeric content globally across all
mapping types (The default setting is true and coercions attempted are
to convert strings with numbers into numeric types and also numeric values
with fractions to any integer/short/long values minus the fraction part).
When the permitted conversions fail in their attempts, the value is considered
malformed and the ignore_malformed setting dictates what will happen next.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-fields"></a>Fields</h2></div></div></div><p>Each mapping has a number of fields associated with it
which can be used to control how the document metadata
(eg <a class="xref" href="#mapping-all-field" title="_all"><code class="literal">_all</code></a>) is indexed.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-uid-field"></a><code class="literal">_uid</code></h2></div></div></div><p>Each document indexed is associated with an id and a type, the internal
<code class="literal">_uid</code> field is the unique identifier of a document within an index and
is composed of the type and the id (meaning that different types can
have the same id and still maintain uniqueness).</p><p>The <code class="literal">_uid</code> field is automatically used when <code class="literal">_type</code> is not indexed to
perform type based filtering, and does not require the <code class="literal">_id</code> to be
indexed.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-id-field"></a><code class="literal">_id</code></h2></div></div></div><p>Each document indexed is associated with an id and a type. The <code class="literal">_id</code>
field can be used to index just the id, and possible also store it. By
default it is not indexed and not stored (thus, not created).</p><p>Note, even though the <code class="literal">_id</code> is not indexed, all the APIs still work
(since they work with the <code class="literal">_uid</code> field), as well as fetching by ids
using <code class="literal">term</code>, <code class="literal">terms</code> or <code class="literal">prefix</code> queries/filters (including the
specific <code class="literal">ids</code> query/filter).</p><p>The <code class="literal">_id</code> field can be enabled to be indexed, and possibly stored,
using:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "_id" : {"index": "not_analyzed", "store" : false }
    }
}</pre><p>The <code class="literal">_id</code> mapping can also be associated with a <code class="literal">path</code> that will be used
to extract the id from a different location in the source document. For
example, having the following mapping:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "_id" : {
            "path" : "post_id"
        }
    }
}</pre><p>Will cause <code class="literal">1</code> to be used as the id for:</p><pre class="programlisting prettyprint lang-js">{
    "message" : "You know, for Search",
    "post_id" : "1"
}</pre><p>This does require an additional lightweight parsing step while indexing,
in order to extract the id to decide which shard the index operation
will be executed on.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-type-field"></a>Type Field</h2></div></div></div><p>Each document indexed is associated with an id and a type. The type,
when indexing, is automatically indexed into a <code class="literal">_type</code> field. By
default, the <code class="literal">_type</code> field is indexed (but <span class="strong"><strong>not</strong></span> analyzed) and not
stored. This means that the <code class="literal">_type</code> field can be queried.</p><p>The <code class="literal">_type</code> field can be stored as well, for example:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "_type" : {"store" : true}
    }
}</pre><p>The <code class="literal">_type</code> field can also not be indexed, and all the APIs will still
work except for specific queries (term queries / filters) or faceting
done on the <code class="literal">_type</code> field.</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "_type" : {"index" : "no"}
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-source-field"></a><code class="literal">_source</code></h2></div></div></div><p>The <code class="literal">_source</code> field is an automatically generated field that stores the
actual JSON that was used as the indexed document. It is not indexed
(searchable), just stored. When executing "fetch" requests, like
<a class="link" href="#docs-get" title="Get API">get</a> or
<a class="link" href="#search-search" title="Search">search</a>, the <code class="literal">_source</code> field is
returned by default.</p><p>Though very handy to have around, the source field does incur storage
overhead within the index. For this reason, it can be disabled. For
example:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "_source" : {"enabled" : false}
    }
}</pre><h4><a id="include-exclude"></a>Includes / Excludes</h4><p>Allow to specify paths in the source that would be included / excluded
when itâs stored, supporting <code class="literal">*</code> as wildcard annotation. For example:</p><pre class="programlisting prettyprint lang-js">{
    "my_type" : {
        "_source" : {
            "includes" : ["path1.*", "path2.*"],
            "excludes" : ["pat3.*"]
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-all-field"></a><code class="literal">_all</code></h2></div></div></div><p>The idea of the <code class="literal">_all</code> field is that it includes the text of one or more
other fields within the document indexed. It can come very handy
especially for search requests, where we want to execute a search query
against the content of a document, without knowing which fields to
search on. This comes at the expense of CPU cycles and index size.</p><p>The <code class="literal">_all</code> fields can be completely disabled. Explicit field mappings and
object mappings can be excluded / included in the <code class="literal">_all</code> field. By
default, it is enabled and all fields are included in it for ease of
use.</p><p>When disabling the <code class="literal">_all</code> field, it is a good practice to set
<code class="literal">index.query.default_field</code> to a different value (for example, if you
have a main "message" field in your data, set it to <code class="literal">message</code>).</p><p>One of the nice features of the <code class="literal">_all</code> field is that it takes into
account specific fields boost levels. Meaning that if a title field is
boosted more than content, the title (part) in the <code class="literal">_all</code> field will
mean more than the content (part) in the <code class="literal">_all</code> field.</p><p>Here is a sample mapping:</p><pre class="programlisting prettyprint lang-js">{
    "person" : {
        "_all" : {"enabled" : true},
        "properties" : {
            "name" : {
                "type" : "object",
                "dynamic" : false,
                "properties" : {
                    "first" : {"type" : "string", "store" : true , "include_in_all" : false},
                    "last" : {"type" : "string", "index" : "not_analyzed"}
                }
            },
            "address" : {
                "type" : "object",
                "include_in_all" : false,
                "properties" : {
                    "first" : {
                        "properties" : {
                            "location" : {"type" : "string", "store" : true, "index_name" : "firstLocation"}
                        }
                    },
                    "last" : {
                        "properties" : {
                            "location" : {"type" : "string"}
                        }
                    }
                }
            },
            "simple1" : {"type" : "long", "include_in_all" : true},
            "simple2" : {"type" : "long", "include_in_all" : false}
        }
    }
}</pre><p>The <code class="literal">_all</code> fields allows for <code class="literal">store</code>, <code class="literal">term_vector</code> and <code class="literal">analyzer</code> (with
specific <code class="literal">index_analyzer</code> and <code class="literal">search_analyzer</code>) to be set.</p><h4><a id="highlighting"></a>Highlighting</h4><p>For any field to allow
<a class="link" href="#search-request-highlighting" title="Highlighting">highlighting</a> it has
to be either stored or part of the <code class="literal">_source</code> field. By default the <code class="literal">_all</code>
field does not qualify for either, so highlighting for it does not yield
any data.</p><p>Although it is possible to <code class="literal">store</code> the <code class="literal">_all</code> field, it is basically an
aggregation of all fields, which means more data will be stored, and
highlighting it might produce strange results.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-analyzer-field"></a><code class="literal">_analyzer</code></h2></div></div></div><p>The <code class="literal">_analyzer</code> mapping allows to use a document field property as the
name of the analyzer that will be used to index the document. The
analyzer will be used for any field that does not explicitly defines an
<code class="literal">analyzer</code> or <code class="literal">index_analyzer</code> when indexing.</p><p>Here is a simple mapping:</p><pre class="programlisting prettyprint lang-js">{
    "type1" : {
        "_analyzer" : {
            "path" : "my_field"
        }
    }
}</pre><p>The above will use the value of the <code class="literal">my_field</code> to lookup an analyzer
registered under it. For example, indexing the following doc:</p><pre class="programlisting prettyprint lang-js">{
    "my_field" : "whitespace"
}</pre><p>Will cause the <code class="literal">whitespace</code> analyzer to be used as the index analyzer
for all fields without explicit analyzer setting.</p><p>The default path value is <code class="literal">_analyzer</code>, so the analyzer can be driven for
a specific document by setting the <code class="literal">_analyzer</code> field in it. If a custom json
field name is needed, an explicit mapping with a different path should
be set.</p><p>By default, the <code class="literal">_analyzer</code> field is indexed, it can be disabled by
settings <code class="literal">index</code> to <code class="literal">no</code> in the mapping.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-boost-field"></a><code class="literal">_boost</code></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><h4>Deprecated in 1.0.0.RC1.</h4><p>See <a class="xref" href="#function-score-instead-of-boost" title="Function score instead of boost">Function score instead of boost</a>.</p></div></div><p>Boosting is the process of enhancing the relevancy of a document or
field. Field level mapping allows to define an explicit boost level on a
specific field. The boost field mapping (applied on the
<a class="link" href="#mapping-root-object-type" title="Root Object Type">root object</a>) allows
to define a boost field mapping where <span class="strong"><strong>its content will control the
boost level of the document</strong></span>. For example, consider the following
mapping:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "_boost" : {"name" : "my_boost", "null_value" : 1.0}
    }
}</pre><p>The above mapping defines a mapping for a field named <code class="literal">my_boost</code>. If the
<code class="literal">my_boost</code> field exists within the JSON document indexed, its value will
control the boost level of the document indexed. For example, the
following JSON document will be indexed with a boost value of <code class="literal">2.2</code>:</p><pre class="programlisting prettyprint lang-js">{
    "my_boost" : 2.2,
    "message" : "This is a tweet!"
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="function-score-instead-of-boost"></a>Function score instead of boost</h3></div></div></div><p>Support for document boosting via the <code class="literal">_boost</code> field has been removed
from Lucene and is deprecated in Elasticsearch as of v1.0.0.RC1. The
implementation in Lucene resulted in unpredictable result when
used with multiple fields or multi-value fields.</p><p>Instead, the <a class="xref" href="#query-dsl-function-score-query" title="Function Score Query">Function Score Query</a> can be used to achieve
the desired functionality by boosting each document by the value in
any field the document:</p><pre class="programlisting prettyprint lang-js">{
    "query": {
        "function_score": {
            "query": {  <a id="CO32-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                "match": {
                    "title": "your main query"
                }
            },
            "functions": [{
                "script_score": { <a id="CO32-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
                    "script": "doc['my_boost_field'].value"
                }
            }],
            "score_mode": "multiply"
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The original query, now wrapped in a <code class="literal">function_score</code> query.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
This script returns the value in <code class="literal">my_boost_field</code>, which is then
    multiplied by the query <code class="literal">_score</code> for each document.
</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-parent-field"></a><code class="literal">_parent</code></h2></div></div></div><p>The parent field mapping is defined on a child mapping, and points to
the parent type this child relates to. For example, in case of a <code class="literal">blog</code>
type and a <code class="literal">blog_tag</code> type child document, the mapping for <code class="literal">blog_tag</code>
should be:</p><pre class="programlisting prettyprint lang-js">{
    "blog_tag" : {
        "_parent" : {
            "type" : "blog"
        }
    }
}</pre><p>The mapping is automatically stored and indexed (meaning it can be
searched on using the <code class="literal">_parent</code> field notation).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-routing-field"></a><code class="literal">_routing</code></h2></div></div></div><p>The routing field allows to control the <code class="literal">_routing</code> aspect when indexing
data and explicit routing control is required.</p><h4><a id="_store_index"></a>store / index</h4><p>The first thing the <code class="literal">_routing</code> mapping does is to store the routing
value provided (<code class="literal">store</code> set to <code class="literal">false</code>) and index it (<code class="literal">index</code> set to
<code class="literal">not_analyzed</code>). The reason why the routing is stored by default is so
reindexing data will be possible if the routing value is completely
external and not part of the docs.</p><h4><a id="_required"></a>required</h4><p>Another aspect of the <code class="literal">_routing</code> mapping is the ability to define it as
required by setting <code class="literal">required</code> to <code class="literal">true</code>. This is very important to set
when using routing features, as it allows different APIs to make use of
it. For example, an index operation will be rejected if no routing value
has been provided (or derived from the doc). A delete operation will be
broadcasted to all shards if no routing value is provided and <code class="literal">_routing</code>
is required.</p><h4><a id="_path"></a>path</h4><p>The routing value can be provided as an external value when indexing
(and still stored as part of the document, in much the same way
<code class="literal">_source</code> is stored). But, it can also be automatically extracted from
the index doc based on a <code class="literal">path</code>. For example, having the following
mapping:</p><pre class="programlisting prettyprint lang-js">{
    "comment" : {
        "_routing" : {
            "required" : true,
            "path" : "blog.post_id"
        }
    }
}</pre><p>Will cause the following doc to be routed based on the <code class="literal">111222</code> value:</p><pre class="programlisting prettyprint lang-js">{
    "text" : "the comment text"
    "blog" : {
        "post_id" : "111222"
    }
}</pre><p>Note, using <code class="literal">path</code> without explicit routing value provided required an
additional (though quite fast) parsing phase.</p><h4><a id="_id_uniqueness"></a>id uniqueness</h4><p>When indexing documents specifying a custom <code class="literal">_routing</code>, the uniqueness
of the <code class="literal">_id</code> is not guaranteed throughout all the shards that the index
is composed of. In fact, documents with the same <code class="literal">_id</code> might end up in
different shards if indexed with different <code class="literal">_routing</code> values.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-index-field"></a><code class="literal">_index</code></h2></div></div></div><p>The ability to store in a document the index it belongs to. By default
it is disabled, in order to enable it, the following mapping should be
defined:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "_index" : { "enabled" : true }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-size-field"></a><code class="literal">_size</code></h2></div></div></div><p>The <code class="literal">_size</code> field allows to automatically index the size of the original
<code class="literal">_source</code> indexed. By default, itâs disabled. In order to enable it, set
the mapping to:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "_size" : {"enabled" : true}
    }
}</pre><p>In order to also store it, use:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "_size" : {"enabled" : true, "store" : true }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-timestamp-field"></a><code class="literal">_timestamp</code></h2></div></div></div><p>The <code class="literal">_timestamp</code> field allows to automatically index the timestamp of a
document. It can be provided externally via the index request or in the
<code class="literal">_source</code>. If it is not provided externally it will be automatically set
to the date the document was processed by the indexing chain.</p><h4><a id="_enabled"></a>enabled</h4><p>By default it is disabled. In order to enable it, the following mapping
should be defined:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "_timestamp" : { "enabled" : true }
    }
}</pre><h4><a id="_store_index_2"></a>store / index</h4><p>By default the <code class="literal">_timestamp</code> field has <code class="literal">store</code> set to <code class="literal">false</code> and <code class="literal">index</code>
set to <code class="literal">not_analyzed</code>. It can be queried as a standard date field.</p><h4><a id="_path_2"></a>path</h4><p>The <code class="literal">_timestamp</code> value can be provided as an external value when
indexing. But, it can also be automatically extracted from the document
to index based on a <code class="literal">path</code>. For example, having the following mapping:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "_timestamp" : {
            "enabled" : true,
            "path" : "post_date"
        }
    }
}</pre><p>Will cause <code class="literal">2009-11-15T14:12:12</code> to be used as the timestamp value for:</p><pre class="programlisting prettyprint lang-js">{
    "message" : "You know, for Search",
    "post_date" : "2009-11-15T14:12:12"
}</pre><p>Note, using <code class="literal">path</code> without explicit timestamp value provided require an
additional (though quite fast) parsing phase.</p><h4><a id="_format"></a>format</h4><p>You can define the <a class="link" href="#mapping-date-format" title="Date Format">date format</a> used to parse the provided timestamp value. For example:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "_timestamp" : {
            "enabled" : true,
            "path" : "post_date",
            "format" : "YYYY-MM-dd"
        }
    }
}</pre><p>Note, the default format is <code class="literal">dateOptionalTime</code>. The timestamp value will
first be parsed as a number and if it fails the format will be tried.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-ttl-field"></a><code class="literal">_ttl</code></h2></div></div></div><p>A lot of documents naturally come with an expiration date. Documents can
therefore have a <code class="literal">_ttl</code> (time to live), which will cause the expired
documents to be deleted automatically.</p><h4><a id="_enabled_2"></a>enabled</h4><p>By default it is disabled, in order to enable it, the following mapping
should be defined:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "_ttl" : { "enabled" : true }
    }
}</pre><h4><a id="_store_index_3"></a>store / index</h4><p>By default the <code class="literal">_ttl</code> field has <code class="literal">store</code> set to <code class="literal">true</code> and <code class="literal">index</code> set to
<code class="literal">not_analyzed</code>. Note that <code class="literal">index</code> property has to be set to
<code class="literal">not_analyzed</code> in order for the purge process to work.</p><h4><a id="_default"></a>default</h4><p>You can provide a per index/type default <code class="literal">_ttl</code> value as follows:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "_ttl" : { "enabled" : true, "default" : "1d" }
    }
}</pre><p>In this case, if you donât provide a <code class="literal">_ttl</code> value in your query or in
the <code class="literal">_source</code> all tweets will have a <code class="literal">_ttl</code> of one day.</p><p>In case you do not specify a time unit like <code class="literal">d</code> (days), <code class="literal">m</code> (minutes),
<code class="literal">h</code> (hours), <code class="literal">ms</code> (milliseconds) or <code class="literal">w</code> (weeks), milliseconds is used as
default unit.</p><p>If no <code class="literal">default</code> is set and no <code class="literal">_ttl</code> value is given then the document
has an infinite <code class="literal">_ttl</code> and will not expire.</p><p>You can dynamically update the <code class="literal">default</code> value using the put mapping
API. It wonât change the <code class="literal">_ttl</code> of already indexed documents but will be
used for future documents.</p><h4><a id="_note_on_documents_expiration"></a>Note on documents expiration</h4><p>Expired documents will be automatically deleted regularly. You can
dynamically set the <code class="literal">indices.ttl.interval</code> to fit your needs. The
default value is <code class="literal">60s</code>.</p><p>The deletion orders are processed by bulk. You can set
<code class="literal">indices.ttl.bulk_size</code> to fit your needs. The default value is <code class="literal">10000</code>.</p><p>Note that the expiration procedure handle versioning properly so if a
document is updated between the collection of documents to expire and
the delete order, the document wonât be deleted.</p></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-types"></a>Types</h2></div></div></div><p>The datatype for each field in a document (eg strings, numbers,
objects etc) can be controlled via the type mapping.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-core-types"></a>Core Types</h2></div></div></div><p>Each JSON field can be mapped to a specific core type. JSON itself
already provides us with some typing, with its support for <code class="literal">string</code>,
<code class="literal">integer</code>/<code class="literal">long</code>, <code class="literal">float</code>/<code class="literal">double</code>, <code class="literal">boolean</code>, and <code class="literal">null</code>.</p><p>The following sample tweet JSON document will be used to explain the
core types:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" {
        "user" : "kimchy"
        "message" : "This is a tweet!",
        "postDate" : "2009-11-15T14:12:12",
        "priority" : 4,
        "rank" : 12.3
    }
}</pre><p>Explicit mapping for the above JSON tweet can be:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "properties" : {
            "user" : {"type" : "string", "index" : "not_analyzed"},
            "message" : {"type" : "string", "null_value" : "na"},
            "postDate" : {"type" : "date"},
            "priority" : {"type" : "integer"},
            "rank" : {"type" : "float"}
        }
    }
}</pre><h4><a id="string"></a>String</h4><p>The text based string type is the most basic type, and contains one or
more characters. An example mapping can be:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "properties" : {
            "message" : {
                "type" : "string",
                "store" : true,
                "index" : "analyzed",
                "null_value" : "na"
            },
            "user" : {
                "type" : "string",
                "index" : "not_analyzed",
                "norms" : {
                    "enabled" : false
                }
            }
        }
    }
}</pre><p>The above mapping defines a <code class="literal">string</code> <code class="literal">message</code> property/field within the
<code class="literal">tweet</code> type. The field is stored in the index (so it can later be
retrieved using selective loading when searching), and it gets analyzed
(broken down into searchable terms). If the message has a <code class="literal">null</code> value,
then the value that will be stored is <code class="literal">na</code>. There is also a <code class="literal">string</code> <code class="literal">user</code>
which is indexed as-is (not broken down into tokens) and has norms
disabled (so that matching this field is a binary decision, no match is
better than another one).</p><p>The following table lists all the attributes that can be used with the
<code class="literal">string</code> type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">index_name</code></p></td><td align="left" valign="top"><p>The name of the field that will be stored in the index.
Defaults to the property/field name.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">store</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to actually store the field in the index, <code class="literal">false</code> to not
store it. Defaults to <code class="literal">false</code> (note, the JSON document itself is stored,
and it can be retrieved from it).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">index</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">analyzed</code> for the field to be indexed and searchable
after being broken down into token using an analyzer. <code class="literal">not_analyzed</code>
means that its still searchable, but does not go through any analysis
process or broken down into tokens. <code class="literal">no</code> means that it wonât be
searchable at all (as an individual field; it may still be included in
<code class="literal">_all</code>). Setting to <code class="literal">no</code> disables <code class="literal">include_in_all</code>. Defaults to
<code class="literal">analyzed</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc_values</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to store field values in a column-stride fashion.
Automatically set to <code class="literal">true</code> when the fielddata format is <code class="literal">doc_values</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">term_vector</code></p></td><td align="left" valign="top"><p>Possible values are <code class="literal">no</code>, <code class="literal">yes</code>, <code class="literal">with_offsets</code>,
<code class="literal">with_positions</code>, <code class="literal">with_positions_offsets</code>. Defaults to <code class="literal">no</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">boost</code></p></td><td align="left" valign="top"><p>The boost value. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">null_value</code></p></td><td align="left" valign="top"><p>When there is a (JSON) null value for the field, use the
<code class="literal">null_value</code> as the field value. Defaults to not adding the field at
all.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">norms: {enabled: &lt;value&gt;}</code></p></td><td align="left" valign="top"><p>Boolean value if norms should be enabled or
not. Defaults to <code class="literal">true</code> for <code class="literal">analyzed</code> fields, and to <code class="literal">false</code> for
<code class="literal">not_analyzed</code> fields. See the <a class="link" href="#norms" title="Norms">section about norms</a>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">norms: {loading: &lt;value&gt;}</code></p></td><td align="left" valign="top"><p>Describes how norms should be loaded, possible values are
<code class="literal">eager</code> and <code class="literal">lazy</code> (default). It is possible to change the default value to
eager for all fields by configuring the index setting <code class="literal">index.norms.loading</code>
to <code class="literal">eager</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">index_options</code></p></td><td align="left" valign="top"><p>Allows to set the indexing
options, possible values are <code class="literal">docs</code> (only doc numbers are indexed),
<code class="literal">freqs</code> (doc numbers and term frequencies), and <code class="literal">positions</code> (doc
numbers, term frequencies and positions). Defaults to <code class="literal">positions</code> for
<code class="literal">analyzed</code> fields, and to <code class="literal">docs</code> for <code class="literal">not_analyzed</code> fields. It
is also possible to set it to <code class="literal">offsets</code> (doc numbers, term
frequencies, positions and offsets).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td align="left" valign="top"><p>The analyzer used to analyze the text contents when
<code class="literal">analyzed</code> during indexing and when searching using a query string.
Defaults to the globally configured analyzer.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">index_analyzer</code></p></td><td align="left" valign="top"><p>The analyzer used to analyze the text contents when
<code class="literal">analyzed</code> during indexing.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">search_analyzer</code></p></td><td align="left" valign="top"><p>The analyzer used to analyze the field when part of
a query string. Can be updated on an existing field.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">include_in_all</code></p></td><td align="left" valign="top"><p>Should the field be included in the <code class="literal">_all</code> field (if
enabled). If <code class="literal">index</code> is set to <code class="literal">no</code> this defaults to <code class="literal">false</code>, otherwise,
defaults to <code class="literal">true</code> or to the parent <code class="literal">object</code> type setting.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ignore_above</code></p></td><td align="left" valign="top"><p>The analyzer will ignore strings larger than this size.
Useful for generic <code class="literal">not_analyzed</code> fields that should ignore long text.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">position_offset_gap</code></p></td><td align="left" valign="top"><p>Position increment gap between field instances
with the same field name. Defaults to 0.</p></td></tr></tbody></table></div><p>The <code class="literal">string</code> type also support custom indexing parameters associated
with the indexed value. For example:</p><pre class="programlisting prettyprint lang-js">{
    "message" : {
        "_value":  "boosted value",
        "_boost":  2.0
    }
}</pre><p>The mapping is required to disambiguate the meaning of the document.
Otherwise, the structure would interpret "message" as a value of type
"object". The key <code class="literal">_value</code> (or <code class="literal">value</code>) in the inner document specifies
the real string content that should eventually be indexed. The <code class="literal">_boost</code>
(or <code class="literal">boost</code>) key specifies the per field document boost (here 2.0).</p><h5><a id="norms"></a>Norms</h5><p>Norms store various normalization factors that are later used (at query time)
in order to compute the score of a document relatively to a query.</p><p>Although useful for scoring, norms also require quite a lot of memory
(typically in the order of one byte per document per field in your index,
even for documents that donât have this specific field). As a consequence, if
you donât need scoring on a specific field, it is highly recommended to disable
norms on it. In  particular, this is the case for fields that are used solely
for filtering or aggregations.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Coming in 1.2.0.</p></div></div><p>In case you would like to disable norms after the fact, it is possible to do so
by using the <a class="link" href="#indices-put-mapping" title="Put Mapping">PUT mapping API</a>. Please however note that
norms wonât be removed instantly, but as your index will receive new insertions
or updates, and segments get merged. Any score computation on a field that got
norms removed might return inconsistent results since some documents wonât have
norms anymore while other documents might still have norms.</p><h4><a id="number"></a>Number</h4><p>A number based type supporting <code class="literal">float</code>, <code class="literal">double</code>, <code class="literal">byte</code>, <code class="literal">short</code>,
<code class="literal">integer</code>, and <code class="literal">long</code>. It uses specific constructs within Lucene in
order to support numeric values. The number types have the same ranges
as corresponding
<a class="ulink" href="http://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html" target="_top">Java
types</a>. An example mapping can be:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "properties" : {
            "rank" : {
                "type" : "float",
                "null_value" : 1.0
            }
        }
    }
}</pre><p>The following table lists all the attributes that can be used with a
numbered type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">type</code></p></td><td align="left" valign="top"><p>The type of the number. Can be <code class="literal">float</code>, <code class="literal">double</code>, <code class="literal">integer</code>,
<code class="literal">long</code>, <code class="literal">short</code>, <code class="literal">byte</code>. Required.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">index_name</code></p></td><td align="left" valign="top"><p>The name of the field that will be stored in the index.
Defaults to the property/field name.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">store</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to store actual field in the index, <code class="literal">false</code> to not
store it. Defaults to <code class="literal">false</code> (note, the JSON document itself is stored,
and it can be retrieved from it).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">index</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">no</code> if the value should not be indexed. Setting to
<code class="literal">no</code> disables <code class="literal">include_in_all</code>. If set to <code class="literal">no</code> the field should be either stored
in <code class="literal">_source</code>, have <code class="literal">include_in_all</code> enabled, or <code class="literal">store</code> be set to
<code class="literal">true</code> for this to be useful.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc_values</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to store field values in a column-stride fashion.
Automatically set to <code class="literal">true</code> when the fielddata format is <code class="literal">doc_values</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">precision_step</code></p></td><td align="left" valign="top"><p>The precision step (number of terms generated for
each number value). Defaults to <code class="literal">4</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">boost</code></p></td><td align="left" valign="top"><p>The boost value. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">null_value</code></p></td><td align="left" valign="top"><p>When there is a (JSON) null value for the field, use the
<code class="literal">null_value</code> as the field value. Defaults to not adding the field at
all.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">include_in_all</code></p></td><td align="left" valign="top"><p>Should the field be included in the <code class="literal">_all</code> field (if
enabled). If <code class="literal">index</code> is set to <code class="literal">no</code> this defaults to <code class="literal">false</code>, otherwise,
defaults to <code class="literal">true</code> or to the parent <code class="literal">object</code> type setting.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ignore_malformed</code></p></td><td align="left" valign="top"><p>Ignored a malformed number. Defaults to <code class="literal">false</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">coerce</code></p></td><td align="left" valign="top"><p>Try convert strings to numbers and truncate fractions for integers. Defaults to <code class="literal">true</code>.</p></td></tr></tbody></table></div><h4><a id="token_count"></a>Token Count</h4><p>The <code class="literal">token_count</code> type maps to the JSON string type but indexes and stores
the number of tokens in the string rather than the string itself.  For
example:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "properties" : {
            "name" : {
                "type" : "string",
                "fields" : {
                    "word_count": {
                        "type" : "token_count",
                        "store" : "yes",
                        "analyzer" : "standard"
                    }
                }
            }
        }
    }
}</pre><p>All the configuration that can be specified for a number can be specified
for a token_count.  The only extra configuration is the required
<code class="literal">analyzer</code> field which specifies which analyzer to use to break the string
into tokens.  For best performance, use an analyzer with no token filters.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Technically the <code class="literal">token_count</code> type sums position increments rather than
counting tokens. This means that even if the analyzer filters out stop
words they are included in the count.</p></div></div><h4><a id="date"></a>Date</h4><p>The date type is a special type which maps to JSON string type. It
follows a specific format that can be explicitly set. All dates are
<code class="literal">UTC</code>. Internally, a date maps to a number type <code class="literal">long</code>, with the added
parsing stage from string to long and from long to string. An example
mapping:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "properties" : {
            "postDate" : {
                "type" : "date",
                "format" : "YYYY-MM-dd"
            }
        }
    }
}</pre><p>The date type will also accept a long number representing UTC
milliseconds since the epoch, regardless of the format it can handle.</p><p>The following table lists all the attributes that can be used with a
date type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">index_name</code></p></td><td align="left" valign="top"><p>The name of the field that will be stored in the index.
Defaults to the property/field name.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">format</code></p></td><td align="left" valign="top"><p>The <a class="link" href="#mapping-date-format" title="Date Format">date format</a>. Defaults to <code class="literal">dateOptionalTime</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">store</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to store actual field in the index, <code class="literal">false</code> to not
store it. Defaults to <code class="literal">false</code> (note, the JSON document itself is stored,
and it can be retrieved from it).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">index</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">no</code> if the value should not be indexed. Setting to
<code class="literal">no</code> disables <code class="literal">include_in_all</code>. If set to <code class="literal">no</code> the field should be either stored
in <code class="literal">_source</code>, have <code class="literal">include_in_all</code> enabled, or <code class="literal">store</code> be set to
<code class="literal">true</code> for this to be useful.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc_values</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to store field values in a column-stride fashion.
Automatically set to <code class="literal">true</code> when the fielddata format is <code class="literal">doc_values</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">precision_step</code></p></td><td align="left" valign="top"><p>The precision step (number of terms generated for
each number value). Defaults to <code class="literal">4</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">boost</code></p></td><td align="left" valign="top"><p>The boost value. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">null_value</code></p></td><td align="left" valign="top"><p>When there is a (JSON) null value for the field, use the
<code class="literal">null_value</code> as the field value. Defaults to not adding the field at
all.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">include_in_all</code></p></td><td align="left" valign="top"><p>Should the field be included in the <code class="literal">_all</code> field (if
enabled). If <code class="literal">index</code> is set to <code class="literal">no</code> this defaults to <code class="literal">false</code>, otherwise,
defaults to <code class="literal">true</code> or to the parent <code class="literal">object</code> type setting.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ignore_malformed</code></p></td><td align="left" valign="top"><p>Ignored a malformed number. Defaults to <code class="literal">false</code>.</p></td></tr></tbody></table></div><h4><a id="boolean"></a>Boolean</h4><p>The boolean type Maps to the JSON boolean type. It ends up storing
within the index either <code class="literal">T</code> or <code class="literal">F</code>, with automatic translation to <code class="literal">true</code>
and <code class="literal">false</code> respectively.</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "properties" : {
            "hes_my_special_tweet" : {
                "type" : "boolean",
            }
        }
    }
}</pre><p>The boolean type also supports passing the value as a number or a string
(in this case <code class="literal">0</code>, an empty string, <code class="literal">F</code>, <code class="literal">false</code>, <code class="literal">off</code> and <code class="literal">no</code> are
<code class="literal">false</code>, all other values are <code class="literal">true</code>).</p><p>The following table lists all the attributes that can be used with the
boolean type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">index_name</code></p></td><td align="left" valign="top"><p>The name of the field that will be stored in the index.
Defaults to the property/field name.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">store</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to store actual field in the index, <code class="literal">false</code> to not
store it. Defaults to <code class="literal">false</code> (note, the JSON document itself is stored,
and it can be retrieved from it).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">index</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">no</code> if the value should not be indexed. Setting to
<code class="literal">no</code> disables <code class="literal">include_in_all</code>. If set to <code class="literal">no</code> the field should be either stored
in <code class="literal">_source</code>, have <code class="literal">include_in_all</code> enabled, or <code class="literal">store</code> be set to
<code class="literal">true</code> for this to be useful.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">boost</code></p></td><td align="left" valign="top"><p>The boost value. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">null_value</code></p></td><td align="left" valign="top"><p>When there is a (JSON) null value for the field, use the
<code class="literal">null_value</code> as the field value. Defaults to not adding the field at
all.</p></td></tr></tbody></table></div><h4><a id="binary"></a>Binary</h4><p>The binary type is a base64 representation of binary data that can be
stored in the index. The field is not stored by default and not indexed at
all.</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "properties" : {
            "image" : {
                "type" : "binary",
            }
        }
    }
}</pre><p>The following table lists all the attributes that can be used with the
binary type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">index_name</code></p></td><td align="left" valign="top"><p>The name of the field that will be stored in the index.
Defaults to the property/field name.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">store</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to store actual field in the index, <code class="literal">false</code> to not
store it. Defaults to <code class="literal">false</code> (note, the JSON document itself is stored,
and it can be retrieved from it).</p></td></tr></tbody></table></div><h4><a id="fielddata-filters"></a>Fielddata filters</h4><p>It is possible to control which field values are loaded into memory,
which is particularly useful for faceting on string fields, using
fielddata filters, which are explained in detail in the
<a class="link" href="#index-modules-fielddata" title="Field data">Fielddata</a> section.</p><p>Fielddata filters can exclude terms which do not match a regex, or which
donât fall between a <code class="literal">min</code> and <code class="literal">max</code> frequency range:</p><pre class="programlisting prettyprint lang-js">{
    tweet: {
        type:      "string",
        analyzer:  "whitespace"
        fielddata: {
            filter: {
                regex: {
                    "pattern":        "^#.*"
                },
                frequency: {
                    min:              0.001,
                    max:              0.1,
                    min_segment_size: 500
                }
            }
        }
    }
}</pre><p>These filters can be updated on an existing field mapping and will take
effect the next time the fielddata for a segment is loaded. Use the
<a class="link" href="#indices-clearcache" title="Clear Cache">Clear Cache</a> API
to reload the fielddata using the new filters.</p><h4><a id="postings"></a>Postings format</h4><p>Posting formats define how fields are written into the index and how
fields are represented into memory. Posting formats can be defined per
field via the <code class="literal">postings_format</code> option. Postings format are configurable.
Elasticsearch has several builtin formats:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">direct</code>
</span></dt><dd>
        A postings format that uses disk-based storage but loads
        its terms and postings directly into memory. Note this postings format
        is very memory intensive and has certain limitation that donât allow
        segments to grow beyond 2.1GB see {@link DirectPostingsFormat} for
        details.
</dd><dt><span class="term">
<code class="literal">memory</code>
</span></dt><dd>
        A postings format that stores its entire terms, postings,
        positions and payloads in a finite state transducer. This format should
        only be used for primary keys or with fields where each term is
        contained in a very low number of documents.
</dd><dt><span class="term">
<code class="literal">pulsing</code>
</span></dt><dd>
        A postings format that in-lines the posting lists for very low
        frequent terms in the term dictionary. This is useful to improve lookup
        performance for low-frequent terms.
</dd><dt><span class="term">
<code class="literal">bloom_default</code>
</span></dt><dd>
        A postings format that uses a bloom filter to
        improve term lookup performance. This is useful for primary keys or
        fields that are used as a delete key.
</dd><dt><span class="term">
<code class="literal">bloom_pulsing</code>
</span></dt><dd>
        A postings format that combines the advantages of
        <span class="strong"><strong>bloom</strong></span> and <span class="strong"><strong>pulsing</strong></span> to further improve lookup performance.
</dd><dt><span class="term">
<code class="literal">default</code>
</span></dt><dd>
        The default Elasticsearch postings format offering best
        general purpose performance. This format is used if no postings format
        is specified in the field mapping.
</dd></dl></div><h5><a id="_postings_format_example"></a>Postings format example</h5><p>On all field types it possible to configure a <code class="literal">postings_format</code>
attribute:</p><pre class="programlisting prettyprint lang-js">{
  "person" : {
     "properties" : {
         "second_person_id" : {"type" : "string", "postings_format" : "pulsing"}
     }
  }
}</pre><p>On top of using the built-in posting formats it is possible define
custom postings format. See
<a class="link" href="#index-modules-codec" title="Codec module">codec module</a> for more
information.</p><h4><a id="_doc_values_format"></a>Doc values format</h4><p>Doc values formats define how fields are written into column-stride storage in
the index for the purpose of sorting or faceting. Fields that have doc values
enabled will have special field data instances, which will not be uninverted
from the inverted index, but directly read from disk. This makes _refresh faster
and ultimately allows for having field data stored on disk depending on the
configured doc values format.</p><p>Doc values formats are configurable. Elasticsearch has several builtin formats:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">memory</code>
</span></dt><dd>
        A doc values format which stores data in memory. Compared to the default
        field data implementations, using doc values with this format will have
        similar performance but will be faster to load, making <span class="emphasis"><em>_refresh</em></span> less
        time-consuming.
</dd><dt><span class="term">
<code class="literal">disk</code>
</span></dt><dd>
        A doc values format which stores all data on disk, requiring almost no
        memory from the JVM at the cost of a slight performance degradation.
</dd><dt><span class="term">
<code class="literal">default</code>
</span></dt><dd>
        The default Elasticsearch doc values format, offering good performance
        with low memory usage. This format is used if no format is specified in
        the field mapping.
</dd></dl></div><h5><a id="_doc_values_format_example"></a>Doc values format example</h5><p>On all field types, it is possible to configure a <code class="literal">doc_values_format</code> attribute:</p><pre class="programlisting prettyprint lang-js">{
  "product" : {
     "properties" : {
         "price" : {"type" : "integer", "doc_values_format" : "memory"}
     }
  }
}</pre><p>On top of using the built-in doc values formats it is possible to define
custom doc values formats. See
<a class="link" href="#index-modules-codec" title="Codec module">codec module</a> for more information.</p><h4><a id="_similarity"></a>Similarity</h4><p>Elasticsearch allows you to configure a similarity (scoring algorithm) per field.
The <code class="literal">similarity</code> setting provides a simple way of choosing a similarity algorithm
other than the default TF/IDF, such as <code class="literal">BM25</code>.</p><p>You can configure similarities via the
<a class="link" href="#index-modules-similarity" title="Similarity module">similarity module</a></p><h5><a id="_configuring_similarity_per_field"></a>Configuring Similarity per Field</h5><p>Defining the Similarity for a field is done via the <code class="literal">similarity</code> mapping
property, as this example shows:</p><pre class="programlisting prettyprint lang-js">{
  "book" : {
    "properties" : {
      "title" : { "type" : "string", "similarity" : "BM25" }
    }
}</pre><p>The following Similarities are configured out-of-box:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">default</code>
</span></dt><dd>
        The Default TF/IDF algorithm used by Elasticsearch and
        Lucene in previous versions.
</dd><dt><span class="term">
<code class="literal">BM25</code>
</span></dt><dd>
        The BM25 algorithm.
        <a class="ulink" href="http://en.wikipedia.org/wiki/Okapi_BM25" target="_top">See Okapi_BM25</a> for more
        details.
</dd></dl></div><h5><a id="copy-to"></a>Copy to field</h5><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.0.0.RC2.</p></div></div><p>Adding <code class="literal">copy_to</code> parameter to any field mapping will cause all values of this field to be copied to fields specified in
the parameter. In the following example all values from fields <code class="literal">title</code> and <code class="literal">abstract</code> will be copied to the field
<code class="literal">meta_data</code>.</p><pre class="programlisting prettyprint lang-js">{
  "book" : {
    "properties" : {
      "title" : { "type" : "string", "copy_to" : "meta_data" },
      "abstract" : { "type" : "string", "copy_to" : "meta_data" },
      "meta_data" : { "type" : "string" },
    }
}</pre><p>Multiple fields are also supported:</p><pre class="programlisting prettyprint lang-js">{
  "book" : {
    "properties" : {
      "title" : { "type" : "string", "copy_to" : ["meta_data", "article_info"] },
    }
}</pre><h5><a id="_multi_fields_3"></a>Multi fields</h5><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.0.0.RC1.</p></div></div><p>The <code class="literal">fields</code> options allows to map several core types fields into a single
json source field. This can be useful if a single field need to be
used in different ways. For example a single field is to be used for both
free text search and sorting.</p><pre class="programlisting prettyprint lang-js">{
  "tweet" : {
    "properties" : {
      "name" : {
        "type" : "string",
        "index" : "analyzed",
        "fields" : {
          "raw" : {"type" : "string", "index" : "not_analyzed"}
        }
      }
    }
  }
}</pre><p>In the above example the field <code class="literal">name</code> gets processed twice. The first time it gets
processed as an analyzed string and this version is accessible under the field name
<code class="literal">name</code>, this is the main field and is in fact just like any other field. The second time
it gets processed as a not analyzed string and is accessible under the name <code class="literal">name.raw</code>.</p><h4><a id="_include_in_all"></a>Include in All</h4><p>The <code class="literal">include_in_all</code> setting is ignored on any field that is defined in
the <code class="literal">fields</code> options. Setting the <code class="literal">include_in_all</code> only makes sense on
the main field, since the raw field value to copied to the <code class="literal">_all</code> field,
the tokens arenât copied.</p><h4><a id="_updating_a_field"></a>Updating a field</h4><p>In the essence a field canât be updated. However multi fields can be
added to existing fields. This allows for example to have a different
<code class="literal">index_analyzer</code> configuration in addition to the already configured
<code class="literal">index_analyzer</code> configuration specified in the main and other multi fields.</p><p>Also the new multi field will only be applied on document that have been
added after the multi field has been added and in fact the new multi field
doesnât exist in existing documents.</p><p>Another important note is that new multi fields will be merged into the
list of existing multi fields, so when adding new multi fields for a field
previous added multi fields donât need to be specified.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-array-type"></a>Array Type</h2></div></div></div><p>JSON documents allow to define an array (list) of fields or objects.
Mapping array types could not be simpler since arrays gets automatically
detected and mapping them can be done either with
<a class="link" href="#mapping-core-types" title="Core Types">Core Types</a> or
<a class="link" href="#mapping-object-type" title="Object Type">Object Type</a> mappings.
For example, the following JSON defines several arrays:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "message" : "some arrays in this tweet...",
        "tags" : ["elasticsearch", "wow"],
        "lists" : [
            {
                "name" : "prog_list",
                "description" : "programming list"
            },
            {
                "name" : "cool_list",
                "description" : "cool stuff list"
            }
        ]
    }
}</pre><p>The above JSON has the <code class="literal">tags</code> property defining a list of a simple
<code class="literal">string</code> type, and the <code class="literal">lists</code> property is an <code class="literal">object</code> type array. Here
is a sample explicit mapping:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "properties" : {
            "message" : {"type" : "string"},
            "tags" : {"type" : "string", "index_name" : "tag"},
            "lists" : {
                "properties" : {
                    "name" : {"type" : "string"},
                    "description" : {"type" : "string"}
                }
            }
        }
    }
}</pre><p>The fact that array types are automatically supported can be shown by
the fact that the following JSON document is perfectly fine:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "message" : "some arrays in this tweet...",
        "tags" : "elasticsearch",
        "lists" : {
            "name" : "prog_list",
            "description" : "programming list"
        }
    }
}</pre><p>Note also, that thanks to the fact that we used the <code class="literal">index_name</code> to use
the non plural form (<code class="literal">tag</code> instead of <code class="literal">tags</code>), we can actually refer to
the field using the <code class="literal">index_name</code> as well. For example, we can execute a
query using <code class="literal">tweet.tags:wow</code> or <code class="literal">tweet.tag:wow</code>. We could, of course,
name the field as <code class="literal">tag</code> and skip the <code class="literal">index_name</code> all together).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-object-type"></a>Object Type</h2></div></div></div><p>JSON documents are hierarchical in nature, allowing them to define inner
"objects" within the actual JSON. Elasticsearch completely understands
the nature of these inner objects and can map them easily, providing
query support for their inner fields. Because each document can have
objects with different fields each time, objects mapped this way are
known as "dynamic". Dynamic mapping is enabled by default. Letâs take
the following JSON as an example:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "person" : {
            "name" : {
                "first_name" : "Shay",
                "last_name" : "Banon"
            },
            "sid" : "12345"
        },
        "message" : "This is a tweet!"
    }
}</pre><p>The above shows an example where a tweet includes the actual <code class="literal">person</code>
details. A <code class="literal">person</code> is an object, with a <code class="literal">sid</code>, and a <code class="literal">name</code> object
which has <code class="literal">first_name</code> and <code class="literal">last_name</code>. Itâs important to note that
<code class="literal">tweet</code> is also an object, although it is a special
<a class="link" href="#mapping-root-object-type" title="Root Object Type">root object type</a>
which allows for additional mapping definitions.</p><p>The following is an example of explicit mapping for the above JSON:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "properties" : {
            "person" : {
                "type" : "object",
                "properties" : {
                    "name" : {
                        "properties" : {
                            "first_name" : {"type" : "string"},
                            "last_name" : {"type" : "string"}
                        }
                    },
                    "sid" : {"type" : "string", "index" : "not_analyzed"}
                }
            },
            "message" : {"type" : "string"}
        }
    }
}</pre><p>In order to mark a mapping of type <code class="literal">object</code>, set the <code class="literal">type</code> to object.
This is an optional step, since if there are <code class="literal">properties</code> defined for
it, it will automatically be identified as an <code class="literal">object</code> mapping.</p><h4><a id="_properties"></a>properties</h4><p>An object mapping can optionally define one or more properties using the
<code class="literal">properties</code> tag for a field. Each property can be either another
<code class="literal">object</code>, or one of the
<a class="link" href="#mapping-core-types" title="Core Types">core_types</a>.</p><h4><a id="_dynamic"></a>dynamic</h4><p>One of the most important features of Elasticsearch is its ability to be
schema-less. This means that, in our example above, the <code class="literal">person</code> object
can be indexed later with a new propertyâââ<code class="literal">age</code>, for exampleâââand it
will automatically be added to the mapping definitions. Same goes for
the <code class="literal">tweet</code> root object.</p><p>This feature is by default turned on, and itâs the <code class="literal">dynamic</code> nature of
each object mapped. Each object mapped is automatically dynamic, though
it can be explicitly turned off:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "properties" : {
            "person" : {
                "type" : "object",
                "properties" : {
                    "name" : {
                        "dynamic" : false,
                        "properties" : {
                            "first_name" : {"type" : "string"},
                            "last_name" : {"type" : "string"}
                        }
                    },
                    "sid" : {"type" : "string", "index" : "not_analyzed"}
                }
            },
            "message" : {"type" : "string"}
        }
    }
}</pre><p>In the above example, the <code class="literal">name</code> object mapped is not dynamic, meaning
that if, in the future, we try to index JSON with a <code class="literal">middle_name</code> within
the <code class="literal">name</code> object, it will get discarded and not added.</p><p>There is no performance overhead if an <code class="literal">object</code> is dynamic, the ability
to turn it off is provided as a safety mechanism so "malformed" objects
wonât, by mistake, index data that we do not wish to be indexed.</p><p>If a dynamic object contains yet another inner <code class="literal">object</code>, it will be
automatically added to the index and mapped as well.</p><p>When processing dynamic new fields, their type is automatically derived.
For example, if it is a <code class="literal">number</code>, it will automatically be treated as
number <a class="link" href="#mapping-core-types" title="Core Types">core_type</a>. Dynamic
fields default to their default attributes, for example, they are not
stored and they are always indexed.</p><p>Date fields are special since they are represented as a <code class="literal">string</code>. Date
fields are detected if they can be parsed as a date when they are first
introduced into the system. The set of date formats that are tested
against can be configured using the <code class="literal">dynamic_date_formats</code> on the root object,
which is explained later.</p><p>Note, once a field has been added, <span class="strong"><strong>its type can not change</strong></span>. For
example, if we added age and its value is a number, then it canât be
treated as a string.</p><p>The <code class="literal">dynamic</code> parameter can also be set to <code class="literal">strict</code>, meaning that not
only will new fields not be introduced into the mapping, but also that parsing
(indexing) docs with such new fields will fail.</p><h4><a id="_enabled_3"></a>enabled</h4><p>The <code class="literal">enabled</code> flag allows to disable parsing and indexing a named object
completely. This is handy when a portion of the JSON document contains
arbitrary JSON which should not be indexed, nor added to the mapping.
For example:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "properties" : {
            "person" : {
                "type" : "object",
                "properties" : {
                    "name" : {
                        "type" : "object",
                        "enabled" : false
                    },
                    "sid" : {"type" : "string", "index" : "not_analyzed"}
                }
            },
            "message" : {"type" : "string"}
        }
    }
}</pre><p>In the above, <code class="literal">name</code> and its content will not be indexed at all.</p><h4><a id="_include_in_all_2"></a>include_in_all</h4><p><code class="literal">include_in_all</code> can be set on the <code class="literal">object</code> type level. When set, it
propagates down to all the inner mappings defined within the <code class="literal">object</code>
that do no explicitly set it.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-root-object-type"></a>Root Object Type</h2></div></div></div><p>The root object mapping is an
<a class="link" href="#mapping-object-type" title="Object Type">object type mapping</a> that
maps the root object (the type itself). On top of all the different
mappings that can be set using the
<a class="link" href="#mapping-object-type" title="Object Type">object type mapping</a>, it
allows for additional, type level mapping definitions.</p><p>The root object mapping allows to index a JSON document that either
starts with the actual mapping type, or only contains its fields. For
example, the following <code class="literal">tweet</code> JSON can be indexed:</p><pre class="programlisting prettyprint lang-js">{
    "message" : "This is a tweet!"
}</pre><p>But, also the following JSON can be indexed:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "message" : "This is a tweet!"
    }
}</pre><p>Out of the two, it is preferable to use the document <span class="strong"><strong>without</strong></span> the type
explicitly set.</p><h4><a id="_index_search_analyzers"></a>Index / Search Analyzers</h4><p>The root object allows to define type mapping level analyzers for index
and search that will be used with all different fields that do not
explicitly set analyzers on their own. Here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "index_analyzer" : "standard",
        "search_analyzer" : "standard"
    }
}</pre><p>The above simply explicitly defines both the <code class="literal">index_analyzer</code> and
<code class="literal">search_analyzer</code> that will be used. There is also an option to use the
<code class="literal">analyzer</code> attribute to set both the <code class="literal">search_analyzer</code> and
<code class="literal">index_analyzer</code>.</p><h4><a id="_dynamic_date_formats"></a>dynamic_date_formats</h4><p><code class="literal">dynamic_date_formats</code> (old setting called <code class="literal">date_formats</code> still works)
is the ability to set one or more date formats that will be used to
detect <code class="literal">date</code> fields. For example:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "dynamic_date_formats" : ["yyyy-MM-dd", "dd-MM-yyyy"],
        "properties" : {
            "message" : {"type" : "string"}
        }
    }
}</pre><p>In the above mapping, if a new JSON field of type string is detected,
the date formats specified will be used in order to check if its a date.
If it passes parsing, then the field will be declared with <code class="literal">date</code> type,
and will use the matching format as its format attribute. The date
format itself is explained
<a class="link" href="#mapping-date-format" title="Date Format">here</a>.</p><p>The default formats are: <code class="literal">dateOptionalTime</code> (ISO) and
<code class="literal">yyyy/MM/dd HH:mm:ss Z||yyyy/MM/dd Z</code>.</p><p><span class="strong"><strong>Note:</strong></span> <code class="literal">dynamic_date_formats</code> are used <span class="strong"><strong>only</strong></span> for dynamically added
date fields, not for <code class="literal">date</code> fields that you specify in your mapping.</p><h4><a id="_date_detection"></a>date_detection</h4><p>Allows to disable automatic date type detection (if a new field is introduced
and matches the provided format), for example:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "date_detection" : false,
        "properties" : {
            "message" : {"type" : "string"}
        }
    }
}</pre><h4><a id="_numeric_detection"></a>numeric_detection</h4><p>Sometimes, even though json has support for native numeric types,
numeric values are still provided as strings. In order to try and
automatically detect numeric values from string, the <code class="literal">numeric_detection</code>
can be set to <code class="literal">true</code>. For example:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "numeric_detection" : true,
        "properties" : {
            "message" : {"type" : "string"}
        }
    }
}</pre><h4><a id="_dynamic_templates"></a>dynamic_templates</h4><p>Dynamic templates allow to define mapping templates that will be applied
when dynamic introduction of fields / objects happens.</p><p>For example, we might want to have all fields to be stored by default,
or all <code class="literal">string</code> fields to be stored, or have <code class="literal">string</code> fields to always
be indexed with multi fields syntax, once analyzed and once not_analyzed.
Here is a simple example:</p><pre class="programlisting prettyprint lang-js">{
    "person" : {
        "dynamic_templates" : [
            {
                "template_1" : {
                    "match" : "multi*",
                    "mapping" : {
                        "type" : "{dynamic_type}",
                        "index" : "analyzed",
                        "fields" : {
                            "org" : {"type": "{dynamic_type}", "index" : "not_analyzed"}
                        }
                    }
                }
            },
            {
                "template_2" : {
                    "match" : "*",
                    "match_mapping_type" : "string",
                    "mapping" : {
                        "type" : "string",
                        "index" : "not_analyzed"
                    }
                }
            }
        ]
    }
}</pre><p>The above mapping will create a field with multi fields for all field
names starting with multi, and will map all <code class="literal">string</code> types to be
<code class="literal">not_analyzed</code>.</p><p>Dynamic templates are named to allow for simple merge behavior. A new
mapping, just with a new template can be "put" and that template will be
added, or if it has the same name, the template will be replaced.</p><p>The <code class="literal">match</code> allow to define matching on the field name. An <code class="literal">unmatch</code>
option is also available to exclude fields if they do match on <code class="literal">match</code>.
The <code class="literal">match_mapping_type</code> controls if this template will be applied only
for dynamic fields of the specified type (as guessed by the json
format).</p><p>Another option is to use <code class="literal">path_match</code>, which allows to match the dynamic
template against the "full" dot notation name of the field (for example
<code class="literal">obj1.*.value</code> or <code class="literal">obj1.obj2.*</code>), with the respective <code class="literal">path_unmatch</code>.</p><p>The format of all the matching is simple format, allowing to use * as a
matching element supporting simple patterns such as xxx*, *xxx, xxx*yyy
(with arbitrary number of pattern types), as well as direct equality.
The <code class="literal">match_pattern</code> can be set to <code class="literal">regex</code> to allow for regular
expression based matching.</p><p>The <code class="literal">mapping</code> element provides the actual mapping definition. The
<code class="literal">{name}</code> keyword can be used and will be replaced with the actual
dynamic field name being introduced. The <code class="literal">{dynamic_type}</code> (or
<code class="literal">{dynamicType}</code>) can be used and will be replaced with the mapping
derived based on the field type (or the derived type, like <code class="literal">date</code>).</p><p>Complete generic settings can also be applied, for example, to have all
mappings be stored, just set:</p><pre class="programlisting prettyprint lang-js">{
    "person" : {
        "dynamic_templates" : [
            {
                "store_generic" : {
                    "match" : "*",
                    "mapping" : {
                        "store" : true
                    }
                }
            }
        ]
    }
}</pre><p>Such generic templates should be placed at the end of the
<code class="literal">dynamic_templates</code> list because when two or more dynamic templates
match a field, only the first matching one from the list is used.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-nested-type"></a>Nested Type</h2></div></div></div><p>Nested objects/documents allow to map certain sections in the document
indexed as nested allowing to query them as if they are separate docs
joining with the parent owning doc.</p><p>One of the problems when indexing inner objects that occur several times
in a doc is that "cross object" search match will occur, for example:</p><pre class="programlisting prettyprint lang-js">{
    "obj1" : [
        {
            "name" : "blue",
            "count" : 4
        },
        {
            "name" : "green",
            "count" : 6
        }
    ]
}</pre><p>Searching for name set to blue and count higher than 5 will match the
doc, because in the first element the name matches blue, and in the
second element, count matches "higher than 5".</p><p>Nested mapping allows mapping certain inner objects (usually multi
instance ones), for example:</p><pre class="programlisting prettyprint lang-js">{
    "type1" : {
        "properties" : {
            "obj1" : {
                "type" : "nested",
                "properties": {
                    "name" : {"type": "string", "index": "not_analyzed"},
                    "count" : {"type": "integer"}
                }
            }
        }
    }
}</pre><p>The above will cause all <code class="literal">obj1</code> to be indexed as a nested doc. The
mapping is similar in nature to setting <code class="literal">type</code> to <code class="literal">object</code>, except that
itâs <code class="literal">nested</code>. Nested object fields can be defined explicitly as in the
example above or added dynamically in the same way as for the root object.</p><p>Note: changing an object type to nested type requires reindexing.</p><p>The <code class="literal">nested</code> object fields can also be automatically added to the
immediate parent by setting <code class="literal">include_in_parent</code> to true, and also
included in the root object by setting <code class="literal">include_in_root</code> to true.</p><p>Nested docs will also automatically use the root doc <code class="literal">_all</code> field.</p><p>Searching on nested docs can be done using either the
<a class="link" href="#query-dsl-nested-query" title="Nested Query">nested query</a> or
<a class="link" href="#query-dsl-nested-filter" title="Nested Filter">nested filter</a>.</p><h4><a id="_internal_implementation"></a>Internal Implementation</h4><p>Internally, nested objects are indexed as additional documents, but,
since they can be guaranteed to be indexed within the same "block", it
allows for extremely fast joining with parent docs.</p><p>Those internal nested documents are automatically masked away when doing
operations against the index (like searching with a match_all query),
and they bubble out when using the nested query.</p><p>Because nested docs are always masked to the parent doc, the nested docs
can never be accessed outside the scope of the <code class="literal">nested</code> query. For example
stored fields can be enabled on fields inside nested objects, but there is
no way of retrieving them, since stored fields are fetched outside of
the <code class="literal">nested</code> query scope.</p><p>The <code class="literal">_source</code> field is always associated with the parent document and
because of that field values via the source can be fetched for nested object.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-ip-type"></a>IP Type</h2></div></div></div><p>An <code class="literal">ip</code> mapping type allows to store <span class="emphasis"><em>ipv4</em></span> addresses in a numeric form
allowing to easily sort, and range query it (using ip values).</p><p>The following table lists all the attributes that can be used with an ip
type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">index_name</code></p></td><td align="left" valign="top"><p>The name of the field that will be stored in the index.
Defaults to the property/field name.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">store</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to store actual field in the index, <code class="literal">false</code> to not
store it. Defaults to <code class="literal">false</code> (note, the JSON document itself is stored,
and it can be retrieved from it).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">index</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">no</code> if the value should not be indexed. In this case,
<code class="literal">store</code> should be set to <code class="literal">true</code>, since if itâs not indexed and not
stored, there is nothing to do with it.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">precision_step</code></p></td><td align="left" valign="top"><p>The precision step (number of terms generated for
each number value). Defaults to <code class="literal">4</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">boost</code></p></td><td align="left" valign="top"><p>The boost value. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">null_value</code></p></td><td align="left" valign="top"><p>When there is a (JSON) null value for the field, use the
<code class="literal">null_value</code> as the field value. Defaults to not adding the field at
all.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">include_in_all</code></p></td><td align="left" valign="top"><p>Should the field be included in the <code class="literal">_all</code> field (if
enabled). Defaults to <code class="literal">true</code> or to the parent <code class="literal">object</code> type setting.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-geo-point-type"></a>Geo Point Type</h2></div></div></div><p>Mapper type called <code class="literal">geo_point</code> to support geo based points. The
declaration looks as follows:</p><pre class="programlisting prettyprint lang-js">{
    "pin" : {
        "properties" : {
            "location" : {
                "type" : "geo_point"
            }
        }
    }
}</pre><h4><a id="_indexed_fields"></a>Indexed Fields</h4><p>The <code class="literal">geo_point</code> mapping will index a single field with the format of
<code class="literal">lat,lon</code>. The <code class="literal">lat_lon</code> option can be set to also index the <code class="literal">.lat</code> and
<code class="literal">.lon</code> as numeric fields, and <code class="literal">geohash</code> can be set to <code class="literal">true</code> to also
index <code class="literal">.geohash</code> value.</p><p>A good practice is to enable indexing <code class="literal">lat_lon</code> as well, since both the
geo distance and bounding box filters can either be executed using in
memory checks, or using the indexed lat lon values, and it really
depends on the data set which one performs better. Note though, that
indexed lat lon only make sense when there is a single geo point value
for the field, and not multi values.</p><h4><a id="_geohashes"></a>Geohashes</h4><p>Geohashes are a form of lat/lon encoding which divides the earth up into
a grid. Each cell in this grid is represented by a geohash string. Each
cell in turn can be further subdivided into smaller cells which are
represented by a longer string. So the longer the geohash, the smaller
(and thus more accurate) the cell is.</p><p>Because geohashes are just strings, they can be stored in an inverted
index like any other string, which makes querying them very efficient.</p><p>If you enable the <code class="literal">geohash</code> option, a <code class="literal">geohash</code> âsub-fieldâ will be
indexed as, eg <code class="literal">pin.geohash</code>. The length of the geohash is controlled by
the <code class="literal">geohash_precision</code> parameter, which can either be set to an absolute
length (eg <code class="literal">12</code>, the default) or to a distance (eg <code class="literal">1km</code>).</p><p>More usefully, set the <code class="literal">geohash_prefix</code> option to <code class="literal">true</code> to not only index
the geohash value, but all the enclosing cells as well.  For instance, a
geohash of <code class="literal">u30</code> will be indexed as <code class="literal">[u,u3,u30]</code>. This option can be used
by the <a class="xref" href="#query-dsl-geohash-cell-filter" title="Geohash Cell Filter">Geohash Cell Filter</a> to find geopoints within a
particular cell very efficiently.</p><h4><a id="_input_structure"></a>Input Structure</h4><p>The above mapping defines a <code class="literal">geo_point</code>, which accepts different
formats. The following formats are supported:</p><h5><a id="_lat_lon_as_properties_5"></a>Lat Lon as Properties</h5><pre class="programlisting prettyprint lang-js">{
    "pin" : {
        "location" : {
            "lat" : 41.12,
            "lon" : -71.34
        }
    }
}</pre><h5><a id="_lat_lon_as_string_6"></a>Lat Lon as String</h5><p>Format in <code class="literal">lat,lon</code>.</p><pre class="programlisting prettyprint lang-js">{
    "pin" : {
        "location" : "41.12,-71.34"
    }
}</pre><h5><a id="_geohash_6"></a>Geohash</h5><pre class="programlisting prettyprint lang-js">{
    "pin" : {
        "location" : "drm3btev3e86"
    }
}</pre><h5><a id="_lat_lon_as_array_5"></a>Lat Lon as Array</h5><p>Format in <code class="literal">[lon, lat]</code>, note, the order of lon/lat here in order to
conform with <a class="ulink" href="http://geojson.org/" target="_top">GeoJSON</a>.</p><pre class="programlisting prettyprint lang-js">{
    "pin" : {
        "location" : [-71.34, 41.12]
    }
}</pre><h4><a id="_mapping_options"></a>Mapping Options</h4><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Option </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">lat_lon</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to also index the <code class="literal">.lat</code> and <code class="literal">.lon</code> as fields.
Defaults to <code class="literal">false</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">geohash</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to also index the <code class="literal">.geohash</code> as a field.
Defaults to <code class="literal">false</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">geohash_precision</code></p></td><td align="left" valign="top"><p>Sets the geohash precision. It can be set to an
absolute geohash length or a distance value (eg 1km, 1m, 1ml) defining
the size of the smallest cell. Defaults to an absolute length of 12.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">geohash_prefix</code></p></td><td align="left" valign="top"><p>If this option is set to <code class="literal">true</code>, not only the geohash
but also all its parent cells (true prefixes) will be indexed as well. The
number of terms that will be indexed depends on the <code class="literal">geohash_precision</code>.
Defaults to <code class="literal">false</code>. <span class="strong"><strong>Note</strong></span>: This option implicitly enables <code class="literal">geohash</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">validate</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to reject geo points with invalid latitude or
longitude (default is <code class="literal">false</code>). <span class="strong"><strong>Note</strong></span>: Validation only works when
normalization has been disabled.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">validate_lat</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to reject geo points with an invalid
latitude.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">validate_lon</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to reject geo points with an invalid
longitude.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">normalize</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to normalize latitude and longitude (default
is <code class="literal">true</code>).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">normalize_lat</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to normalize latitude.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">normalize_lon</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to normalize longitude.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">precision_step</code></p></td><td align="left" valign="top"><p>The precision step (number of terms generated for
each number value) for <code class="literal">.lat</code> and <code class="literal">.lon</code> fields if <code class="literal">lat_lon</code> is set to <code class="literal">true</code>.
Defaults to <code class="literal">4</code>.</p></td></tr></tbody></table></div><h4><a id="_field_data"></a>Field data</h4><p>By default, geo points use the <code class="literal">array</code> format which loads geo points into two
parallel double arrays, making sure there is no precision loss. However, this
can require a non-negligible amount of memory (16 bytes per document) which is
why Elasticsearch also provides a field data implementation with lossy
compression called <code class="literal">compressed</code>:</p><pre class="programlisting prettyprint lang-js">{
    "pin" : {
        "properties" : {
            "location" : {
                "type" : "geo_point",
                "fielddata" : {
                    "format" : "compressed",
                    "precision" : "1cm"
                }
            }
        }
    }
}</pre><p>This field data format comes with a <code class="literal">precision</code> option which allows to
configure how much precision can be traded for memory. The default value is
<code class="literal">1cm</code>. The following table presents values of the memory savings given various
precisions:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /></colgroup><tbody><tr><td align="left" valign="top"><p>Precision</p></td><td align="left" valign="top"><p>Bytes per point</p></td><td align="left" valign="top"><p>Size reduction</p></td></tr><tr><td align="left" valign="top"><p>1km</p></td><td align="left" valign="top"><p>4</p></td><td align="left" valign="top"><p>75%</p></td></tr><tr><td align="left" valign="top"><p>3m</p></td><td align="left" valign="top"><p>6</p></td><td align="left" valign="top"><p>62.5%</p></td></tr><tr><td align="left" valign="top"><p>1cm</p></td><td align="left" valign="top"><p>8</p></td><td align="left" valign="top"><p>50%</p></td></tr><tr><td align="left" valign="top"><p>1mm</p></td><td align="left" valign="top"><p>10</p></td><td align="left" valign="top"><p>37.5%</p></td></tr></tbody></table></div><p>Precision can be changed on a live index by using the update mapping API.</p><h4><a id="_usage_in_scripts"></a>Usage in Scripts</h4><p>When using <code class="literal">doc[geo_field_name]</code> (in the above mapping,
<code class="literal">doc['location']</code>), the <code class="literal">doc[...].value</code> returns a <code class="literal">GeoPoint</code>, which
then allows access to <code class="literal">lat</code> and <code class="literal">lon</code> (for example,
<code class="literal">doc[...].value.lat</code>). For performance, it is better to access the <code class="literal">lat</code>
and <code class="literal">lon</code> directly using <code class="literal">doc[...].lat</code> and <code class="literal">doc[...].lon</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-geo-shape-type"></a>Geo Shape Type</h2></div></div></div><p>The <code class="literal">geo_shape</code> mapping type facilitates the indexing of and searching
with arbitrary geo shapes such as rectangles and polygons. It should be
used when either the data being indexed or the queries being executed
contain shapes other than just points.</p><p>You can query documents using this type using
<a class="link" href="#query-dsl-geo-shape-filter" title="GeoShape Filter">geo_shape Filter</a>
or <a class="link" href="#query-dsl-geo-shape-query" title="GeoShape Query">geo_shape Query</a>.</p><p>Note, the <code class="literal">geo_shape</code> type uses
<a class="ulink" href="https://github.com/spatial4j/spatial4j" target="_top">Spatial4J</a> and
<a class="ulink" href="http://www.vividsolutions.com/jts/jtshome.htm" target="_top">JTS</a>, both of which are
optional dependencies. Consequently you must add Spatial4J v0.3 and JTS
v1.12 to your classpath in order to use this type.</p><h4><a id="_mapping_options_2"></a>Mapping Options</h4><p>The geo_shape mapping maps geo_json geometry objects to the geo_shape
type. To enable it, users must explicitly map fields to the geo_shape
type.</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Option </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">tree</code></p></td><td align="left" valign="top"><p>Name of the PrefixTree implementation to be used: <code class="literal">geohash</code> for
GeohashPrefixTree and <code class="literal">quadtree</code> for QuadPrefixTree. Defaults to
<code class="literal">geohash</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">precision</code></p></td><td align="left" valign="top"><p>This parameter may be used instead of <code class="literal">tree_levels</code> to set
an appropriate value for the <code class="literal">tree_levels</code> parameter. The value
specifies the desired precision and Elasticsearch will calculate the
best tree_levels value to honor this precision. The value should be a
number followed by an optional distance unit. Valid distance units
include: <code class="literal">in</code>, <code class="literal">inch</code>, <code class="literal">yd</code>, <code class="literal">yard</code>, <code class="literal">mi</code>, <code class="literal">miles</code>, <code class="literal">km</code>, <code class="literal">kilometers</code>,
<code class="literal">m</code>,<code class="literal">meters</code> (default), <code class="literal">cm</code>,<code class="literal">centimeters</code>, <code class="literal">mm</code>, <code class="literal">millimeters</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">tree_levels</code></p></td><td align="left" valign="top"><p>Maximum number of layers to be used by the PrefixTree.
This can be used to control the precision of shape representations and
therefore how many terms are indexed. Defaults to the default value of
the chosen PrefixTree implementation. Since this parameter requires a
certain level of understanding of the underlying implementation, users
may use the <code class="literal">precision</code> parameter instead. However, Elasticsearch only
uses the tree_levels parameter internally and this is what is returned
via the mapping API even if you use the precision parameter.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">distance_error_pct</code></p></td><td align="left" valign="top"><p>Used as a hint to the PrefixTree about how
precise it should be. Defaults to 0.025 (2.5%) with 0.5 as the maximum
supported value.</p></td></tr></tbody></table></div><h4><a id="_prefix_trees"></a>Prefix trees</h4><p>To efficiently represent shapes in the index, Shapes are converted into
a series of hashes representing grid squares using implementations of a
PrefixTree. The tree notion comes from the fact that the PrefixTree uses
multiple grid layers, each with an increasing level of precision to
represent the Earth.</p><p>Multiple PrefixTree implementations are provided:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
GeohashPrefixTree - Uses
<a class="ulink" href="http://en.wikipedia.org/wiki/Geohash" target="_top">geohashes</a> for grid squares.
Geohashes are base32 encoded strings of the bits of the latitude and
longitude interleaved. So the longer the hash, the more precise it is.
Each character added to the geohash represents another tree level and
adds 5 bits of precision to the geohash. A geohash represents a
rectangular area and has 32 sub rectangles. The maximum amount of levels
in Elasticsearch is 24.
</li><li class="listitem">
QuadPrefixTree - Uses a
<a class="ulink" href="http://en.wikipedia.org/wiki/Quadtree" target="_top">quadtree</a> for grid squares.
Similar to geohash, quad trees interleave the bits of the latitude and
longitude the resulting hash is a bit set. A tree level in a quad tree
represents 2 bits in this bit set, one for each coordinate. The maximum
amount of levels for the quad trees in Elasticsearch is 50.
</li></ul></div><h5><a id="_accuracy"></a>Accuracy</h5><p>Geo_shape does not provide 100% accuracy and depending on how it is
configured it may return some false positives or false negatives for
certain queries. To mitigate this, it is important to select an
appropriate value for the tree_levels parameter and to adjust
expectations accordingly. For example, a point may be near the border of
a particular grid cell and may thus not match a query that only matches the
cell right next to itâââeven though the shape is very close to the point.</p><h5><a id="_example_4"></a>Example</h5><pre class="programlisting prettyprint lang-js">{
    "properties": {
        "location": {
            "type": "geo_shape",
            "tree": "quadtree",
            "precision": "1m"
        }
    }
}</pre><p>This mapping maps the location field to the geo_shape type using the
quad_tree implementation and a precision of 1m. Elasticsearch translates
this into a tree_levels setting of 26.</p><h5><a id="_performance_considerations"></a>Performance considerations</h5><p>Elasticsearch uses the paths in the prefix tree as terms in the index
and in queries. The higher the levels is (and thus the precision), the
more terms are generated. Of course, calculating the terms, keeping them in
memory, and storing them on disk all have a price. Especially with higher
tree levels, indices can become extremely large even with a modest
amount of data. Additionally, the size of the features also matters.
Big, complex polygons can take up a lot of space at higher tree levels.
Which setting is right depends on the use case. Generally one trades off
accuracy against index size and query performance.</p><p>The defaults in Elasticsearch for both implementations are a compromise
between index size and a reasonable level of precision of 50m at the
equator. This allows for indexing tens of millions of shapes without
overly bloating the resulting index too much relative to the input size.</p><h4><a id="_input_structure_2"></a>Input Structure</h4><p>The <a class="ulink" href="http://www.geojson.org" target="_top">GeoJSON</a> format is used to represent Shapes
as input as follows:</p><pre class="programlisting prettyprint lang-js">{
    "location" : {
        "type" : "point",
        "coordinates" : [45.0, -45.0]
    }
}</pre><p>Note, both the <code class="literal">type</code> and <code class="literal">coordinates</code> fields are required.</p><p>The supported <code class="literal">types</code> are <code class="literal">point</code>, <code class="literal">linestring</code>, <code class="literal">polygon</code>, <code class="literal">multipoint</code>
and <code class="literal">multipolygon</code>.</p><p>Note, in geojson the correct order is longitude, latitude coordinate
arrays. This differs from some APIs such as e.g. Google Maps that
generally use latitude, longitude.</p><h5><a id="_envelope"></a>Envelope</h5><p>Elasticsearch supports an <code class="literal">envelope</code> type which consists of coordinates
for upper left and lower right points of the shape:</p><pre class="programlisting prettyprint lang-js">{
    "location" : {
        "type" : "envelope",
        "coordinates" : [[-45.0, 45.0], [45.0, -45.0]]
    }
}</pre><h5><a id="_ulink_url_http_www_geojson_org_geojson_spec_html_id4_polygon_ulink"></a><a class="ulink" href="http://www.geojson.org/geojson-spec.html#id4" target="_top">Polygon</a></h5><p>A polygon is defined by a list of a list of points. The first and last
points in each (outer) list must be the same (the polygon must be closed).</p><pre class="programlisting prettyprint lang-js">{
    "location" : {
        "type" : "polygon",
        "coordinates" : [
            [ [100.0, 0.0], [101.0, 0.0], [101.0, 1.0], [100.0, 1.0], [100.0, 0.0] ]
        ]
    }
}</pre><p>The first array represents the outer boundary of the polygon, the other
arrays represent the interior shapes ("holes"):</p><pre class="programlisting prettyprint lang-js">{
    "location" : {
        "type" : "polygon",
        "coordinates" : [
            [ [100.0, 0.0], [101.0, 0.0], [101.0, 1.0], [100.0, 1.0], [100.0, 0.0] ],
            [ [100.2, 0.2], [100.8, 0.2], [100.8, 0.8], [100.2, 0.8], [100.2, 0.2] ]
        ]
    }
}</pre><h5><a id="_ulink_url_http_www_geojson_org_geojson_spec_html_id7_multipolygon_ulink"></a><a class="ulink" href="http://www.geojson.org/geojson-spec.html#id7" target="_top">MultiPolygon</a></h5><p>A list of geojson polygons.</p><pre class="programlisting prettyprint lang-js">{
    "location" : {
        "type" : "multipolygon",
        "coordinates" : [
            [[[102.0, 2.0], [103.0, 2.0], [103.0, 3.0], [102.0, 3.0], [102.0, 2.0]]],
            [[[100.0, 0.0], [101.0, 0.0], [101.0, 1.0], [100.0, 1.0], [100.0, 0.0]],
            [[100.2, 0.2], [100.8, 0.2], [100.8, 0.8], [100.2, 0.8], [100.2, 0.2]]]
        ]
    }
}</pre><h4><a id="_sorting_and_retrieving_index_shapes"></a>Sorting and Retrieving index Shapes</h4><p>Due to the complex input structure and index representation of shapes,
it is not currently possible to sort shapes or retrieve their fields
directly. The geo_shape value is only retrievable through the <code class="literal">_source</code>
field.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-attachment-type"></a>Attachment Type</h2></div></div></div><p>The <code class="literal">attachment</code> type allows to index different "attachment" type field
(encoded as <code class="literal">base64</code>), for example, Microsoft Office formats, open
document formats, ePub, HTML, and so on (full list can be found
<a class="ulink" href="http://lucene.apache.org/tika/0.10/formats.html" target="_top">here</a>).</p><p>The <code class="literal">attachment</code> type is provided as a
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-mapper-attachments" target="_top">plugin
extension</a>. The plugin is a simple zip file that can be downloaded and
placed under <code class="literal">$ES_HOME/plugins</code> location. It will be automatically
detected and the <code class="literal">attachment</code> type will be added.</p><p>Note, the <code class="literal">attachment</code> type is experimental.</p><p>Using the attachment type is simple, in your mapping JSON, simply set a
certain JSON element as attachment, for example:</p><pre class="programlisting prettyprint lang-js">{
    "person" : {
        "properties" : {
            "my_attachment" : { "type" : "attachment" }
        }
    }
}</pre><p>In this case, the JSON to index can be:</p><pre class="programlisting prettyprint lang-js">{
    "my_attachment" : "... base64 encoded attachment ..."
}</pre><p>Or it is possible to use more elaborated JSON if content type or
resource name need to be set explicitly:</p><pre class="programlisting prettyprint lang-js">{
    "my_attachment" : {
        "_content_type" : "application/pdf",
        "_name" : "resource/name/of/my.pdf",
        "content" : "... base64 encoded attachment ..."
    }
}</pre><p>The <code class="literal">attachment</code> type not only indexes the content of the doc, but also
automatically adds meta data on the attachment as well (when available).
The metadata supported are: <code class="literal">date</code>, <code class="literal">title</code>, <code class="literal">author</code>, and <code class="literal">keywords</code>.
They can be queried using the "dot notation", for example:
<code class="literal">my_attachment.author</code>.</p><p>Both the meta data and the actual content are simple core type mappers
(string, date, â¦), thus, they can be controlled in the mappings. For
example:</p><pre class="programlisting prettyprint lang-js">{
    "person" : {
        "properties" : {
            "file" : {
                "type" : "attachment",
                "fields" : {
                    "file" : {"index" : "no"},
                    "date" : {"store" : true},
                    "author" : {"analyzer" : "myAnalyzer"}
                }
            }
        }
    }
}</pre><p>In the above example, the actual content indexed is mapped under
<code class="literal">fields</code> name <code class="literal">file</code>, and we decide not to index it, so it will only be
available in the <code class="literal">_all</code> field. The other fields map to their respective
metadata names, but there is no need to specify the <code class="literal">type</code> (like
<code class="literal">string</code> or <code class="literal">date</code>) since it is already known.</p><p>The plugin uses <a class="ulink" href="http://lucene.apache.org/tika/" target="_top">Apache Tika</a> to parse
attachments, so many formats are supported, listed
<a class="ulink" href="http://lucene.apache.org/tika/0.10/formats.html" target="_top">here</a>.</p></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-date-format"></a>Date Format</h2></div></div></div><p>In JSON documents, dates are represented as strings. Elasticsearch uses a set
of pre-configured format to recognize and convert those, but you can change the
defaults by specifying the <code class="literal">format</code> option when defining a <code class="literal">date</code> type, or by
specifying <code class="literal">dynamic_date_formats</code> in the <code class="literal">root object</code> mapping (which will
be used unless explicitly overridden by a <code class="literal">date</code> type). There are built in
formats supported, as well as complete custom one.</p><p>The parsing of dates uses <a class="ulink" href="http://joda-time.sourceforge.net/" target="_top">Joda</a>. The
default date parsing used if no format is specified is
<a class="ulink" href="http://joda-time.sourceforge.net/api-release/org/joda/time/format/ISODateTimeFormat.html#dateOptionalTimeParser()" target="_top">ISODateTimeFormat.dateOptionalTimeParser</a>.</p><p>An extension to the format allow to define several formats using <code class="literal">||</code>
separator. This allows to define less strict formats that can be used,
for example, the <code class="literal">yyyy/MM/dd HH:mm:ss||yyyy/MM/dd</code> format will parse
both <code class="literal">yyyy/MM/dd HH:mm:ss</code> and <code class="literal">yyyy/MM/dd</code>. The first format will also
act as the one that converts back from milliseconds to a string
representation.</p><h3><a id="date-math"></a>Date Math</h3><p>The <code class="literal">date</code> type supports using date math expression when using it in a
query/filter (mainly make sense in <code class="literal">range</code> query/filter).</p><p>The expression starts with an "anchor" date, which can be either <code class="literal">now</code>
or a date string (in the applicable format) ending with <code class="literal">||</code>. It can
then follow by a math expression, supporting <code class="literal">+</code>, <code class="literal">-</code> and <code class="literal">/</code>
(rounding). The units supported are <code class="literal">y</code> (year), <code class="literal">M</code> (month), <code class="literal">w</code> (week), <code class="literal">h</code> (hour),
<code class="literal">m</code> (minute), and <code class="literal">s</code> (second).</p><p>Here are some samples: <code class="literal">now+1h</code>, <code class="literal">now+1h+1m</code>, <code class="literal">now+1h/d</code>,
<code class="literal">2012-01-01||+1M/d</code>.</p><p>Note, when doing <code class="literal">range</code> type searches, and the upper value is
inclusive, the rounding will properly be rounded to the ceiling instead
of flooring it.</p><p>To change this behavior, set
<code class="literal">"mapping.date.round_ceil": false</code>.</p><h3><a id="built-in"></a>Built In Formats</h3><p>The following tables lists all the defaults ISO formats supported:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Name </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">basic_date</code></p></td><td align="left" valign="top"><p>A basic formatter for a full date as four digit year, two
digit month of year, and two digit day of month (yyyyMMdd).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">basic_date_time</code></p></td><td align="left" valign="top"><p>A basic formatter that combines a basic date and time,
separated by a <span class="emphasis"><em>T</em></span> (yyyyMMddâT'HHmmss.SSSZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">basic_date_time_no_millis</code></p></td><td align="left" valign="top"><p>A basic formatter that combines a basic date
and time without millis, separated by a <span class="emphasis"><em>T</em></span> (yyyyMMddâT'HHmmssZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">basic_ordinal_date</code></p></td><td align="left" valign="top"><p>A formatter for a full ordinal date, using a four
digit year and three digit dayOfYear (yyyyDDD).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">basic_ordinal_date_time</code></p></td><td align="left" valign="top"><p>A formatter for a full ordinal date and time,
using a four digit year and three digit dayOfYear
(yyyyDDDâT'HHmmss.SSSZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">basic_ordinal_date_time_no_millis</code></p></td><td align="left" valign="top"><p>A formatter for a full ordinal date
and time without millis, using a four digit year and three digit
dayOfYear (yyyyDDDâT'HHmmssZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">basic_time</code></p></td><td align="left" valign="top"><p>A basic formatter for a two digit hour of day, two digit
minute of hour, two digit second of minute, three digit millis, and time
zone offset (HHmmss.SSSZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">basic_time_no_millis</code></p></td><td align="left" valign="top"><p>A basic formatter for a two digit hour of day,
two digit minute of hour, two digit second of minute, and time zone
offset (HHmmssZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">basic_t_time</code></p></td><td align="left" valign="top"><p>A basic formatter for a two digit hour of day, two digit
minute of hour, two digit second of minute, three digit millis, and time
zone off set prefixed by <span class="emphasis"><em>T</em></span> ('TâHHmmss.SSSZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">basic_t_time_no_millis</code></p></td><td align="left" valign="top"><p>A basic formatter for a two digit hour of day,
two digit minute of hour, two digit second of minute, and time zone
offset prefixed by <span class="emphasis"><em>T</em></span> ('TâHHmmssZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">basic_week_date</code></p></td><td align="left" valign="top"><p>A basic formatter for a full date as four digit
weekyear, two digit week of weekyear, and one digit day of week
(xxxxâW'wwe).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">basic_week_date_time</code></p></td><td align="left" valign="top"><p>A basic formatter that combines a basic weekyear
date and time, separated by a <span class="emphasis"><em>T</em></span> (xxxxâW'wweâT'HHmmss.SSSZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">basic_week_date_time_no_millis</code></p></td><td align="left" valign="top"><p>A basic formatter that combines a basic
weekyear date and time without millis, separated by a <span class="emphasis"><em>T</em></span>
(xxxxâW'wweâT'HHmmssZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">date</code></p></td><td align="left" valign="top"><p>A formatter for a full date as four digit year, two digit month
of year, and two digit day of month (yyyy-MM-dd).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">date_hour</code></p></td><td align="left" valign="top"><p>A formatter that combines a full date and two digit hour of
day.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">date_hour_minute</code></p></td><td align="left" valign="top"><p>A formatter that combines a full date, two digit hour
of day, and two digit minute of hour.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">date_hour_minute_second</code></p></td><td align="left" valign="top"><p>A formatter that combines a full date, two
digit hour of day, two digit minute of hour, and two digit second of
minute.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">date_hour_minute_second_fraction</code></p></td><td align="left" valign="top"><p>A formatter that combines a full
date, two digit hour of day, two digit minute of hour, two digit second
of minute, and three digit fraction of second
(yyyy-MM-ddâT'HH:mm:ss.SSS).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">date_hour_minute_second_millis</code></p></td><td align="left" valign="top"><p>A formatter that combines a full date,
two digit hour of day, two digit minute of hour, two digit second of
minute, and three digit fraction of second (yyyy-MM-ddâT'HH:mm:ss.SSS).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">date_optional_time</code></p></td><td align="left" valign="top"><p>a generic ISO datetime parser where the date is
mandatory and the time is optional.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">date_time</code></p></td><td align="left" valign="top"><p>A formatter that combines a full date and time, separated by
a <span class="emphasis"><em>T</em></span> (yyyy-MM-ddâT'HH:mm:ss.SSSZZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">date_time_no_millis</code></p></td><td align="left" valign="top"><p>A formatter that combines a full date and time
without millis, separated by a <span class="emphasis"><em>T</em></span> (yyyy-MM-ddâT'HH:mm:ssZZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">hour</code></p></td><td align="left" valign="top"><p>A formatter for a two digit hour of day.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">hour_minute</code></p></td><td align="left" valign="top"><p>A formatter for a two digit hour of day and two digit
minute of hour.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">hour_minute_second</code></p></td><td align="left" valign="top"><p>A formatter for a two digit hour of day, two digit
minute of hour, and two digit second of minute.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">hour_minute_second_fraction</code></p></td><td align="left" valign="top"><p>A formatter for a two digit hour of day,
two digit minute of hour, two digit second of minute, and three digit
fraction of second (HH:mm:ss.SSS).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">hour_minute_second_millis</code></p></td><td align="left" valign="top"><p>A formatter for a two digit hour of day, two
digit minute of hour, two digit second of minute, and three digit
fraction of second (HH:mm:ss.SSS).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ordinal_date</code></p></td><td align="left" valign="top"><p>A formatter for a full ordinal date, using a four digit
year and three digit dayOfYear (yyyy-DDD).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ordinal_date_time</code></p></td><td align="left" valign="top"><p>A formatter for a full ordinal date and time, using
a four digit year and three digit dayOfYear (yyyy-DDDâT'HH:mm:ss.SSSZZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ordinal_date_time_no_millis</code></p></td><td align="left" valign="top"><p>A formatter for a full ordinal date and
time without millis, using a four digit year and three digit dayOfYear
(yyyy-DDDâT'HH:mm:ssZZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">time</code></p></td><td align="left" valign="top"><p>A formatter for a two digit hour of day, two digit minute of
hour, two digit second of minute, three digit fraction of second, and
time zone offset (HH:mm:ss.SSSZZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">time_no_millis</code></p></td><td align="left" valign="top"><p>A formatter for a two digit hour of day, two digit
minute of hour, two digit second of minute, and time zone offset
(HH:mm:ssZZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">t_time</code></p></td><td align="left" valign="top"><p>A formatter for a two digit hour of day, two digit minute of
hour, two digit second of minute, three digit fraction of second, and
time zone offset prefixed by <span class="emphasis"><em>T</em></span> ('TâHH:mm:ss.SSSZZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">t_time_no_millis</code></p></td><td align="left" valign="top"><p>A formatter for a two digit hour of day, two digit
minute of hour, two digit second of minute, and time zone offset
prefixed by <span class="emphasis"><em>T</em></span> ('TâHH:mm:ssZZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">week_date</code></p></td><td align="left" valign="top"><p>A formatter for a full date as four digit weekyear, two
digit week of weekyear, and one digit day of week (xxxx-'Wâww-e).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">week_date_time</code></p></td><td align="left" valign="top"><p>A formatter that combines a full weekyear date and
time, separated by a <span class="emphasis"><em>T</em></span> (xxxx-'Wâww-eâT'HH:mm:ss.SSSZZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">weekDateTimeNoMillis</code></p></td><td align="left" valign="top"><p>A formatter that combines a full weekyear date
and time without millis, separated by a <span class="emphasis"><em>T</em></span> (xxxx-'Wâww-eâT'HH:mm:ssZZ).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">week_year</code></p></td><td align="left" valign="top"><p>A formatter for a four digit weekyear.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">weekyearWeek</code></p></td><td align="left" valign="top"><p>A formatter for a four digit weekyear and two digit week
of weekyear.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">weekyearWeekDay</code></p></td><td align="left" valign="top"><p>A formatter for a four digit weekyear, two digit week
of weekyear, and one digit day of week.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">year</code></p></td><td align="left" valign="top"><p>A formatter for a four digit year.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">year_month</code></p></td><td align="left" valign="top"><p>A formatter for a four digit year and two digit month of
year.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">year_month_day</code></p></td><td align="left" valign="top"><p>A formatter for a four digit year, two digit month of
year, and two digit day of month.</p></td></tr></tbody></table></div><h3><a id="custom"></a>Custom Format</h3><p>Allows for a completely customizable date format explained
<a class="ulink" href="http://joda-time.sourceforge.net/api-release/org/joda/time/format/DateTimeFormat.html" target="_top">here</a>.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-dynamic-mapping"></a>Dynamic Mapping</h2></div></div></div><p>Default mappings allow to automatically apply generic mapping definitions
to types that do not have mappings predefined. This is mainly done
thanks to the fact that the
<a class="link" href="#mapping-object-type" title="Object Type">object mapping</a> and
namely the <a class="link" href="#mapping-root-object-type" title="Root Object Type">root object mapping</a> allow for schema-less dynamic addition of unmapped
fields.</p><p>The default mapping definition is a plain mapping definition that is
embedded within the distribution:</p><pre class="programlisting prettyprint lang-js">{
    "_default_" : {
    }
}</pre><p>Pretty short, isnât it? Basically, everything is defaulted, especially the
dynamic nature of the root object mapping. The default mapping
definition can be overridden in several manners. The simplest manner is
to simply define a file called <code class="literal">default-mapping.json</code> and to place it
under the <code class="literal">config</code> directory (which can be configured to exist in a
different location). It can also be explicitly set using the
<code class="literal">index.mapper.default_mapping_location</code> setting.</p><p>The dynamic creation of mappings for unmapped types can be completely
disabled by setting <code class="literal">index.mapper.dynamic</code> to <code class="literal">false</code>.</p><p>The dynamic creation of fields within a type can be completely
disabled by setting the <code class="literal">dynamic</code> property of the type to <code class="literal">strict</code>.</p><p>Here is a <a class="link" href="#indices-put-mapping" title="Put Mapping">Put Mapping</a> example that
disables dynamic field creation for a <code class="literal">tweet</code>:</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT 'http://localhost:9200/twitter/tweet/_mapping' -d '
{
    "tweet" : {
        "dynamic": "strict",
        "properties" : {
            "message" : {"type" : "string", "store" : true }
        }
    }
}
'</pre><p>Here is how we can change the default
<a class="link" href="#mapping-date-format" title="Date Format">date_formats</a> used in the
root and inner object types:</p><pre class="programlisting prettyprint lang-js">{
    "_default_" : {
        "date_formats" : ["yyyy-MM-dd", "dd-MM-yyyy", "date_optional_time"]
    }
}</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-conf-mappings"></a>Config Mappings</h2></div></div></div><p>Creating new mappings can be done using the
<a class="link" href="#indices-put-mapping" title="Put Mapping">Put Mapping</a>
API. When a document is indexed with no mapping associated with it in
the specific index, the
<a class="link" href="#mapping-dynamic-mapping" title="Dynamic Mapping">dynamic / default mapping</a> feature will kick in and automatically create mapping
definition for it.</p><p>Mappings can also be provided on the node level, meaning that each index
created will automatically be started with all the mappings defined
within a certain location.</p><p>Mappings can be defined within files called <code class="literal">[mapping_name].json</code> and be
placed either under <code class="literal">config/mappings/_default</code> location, or under
<code class="literal">config/mappings/[index_name]</code> (for mappings that should be associated
only with a specific index).</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-meta"></a>Meta</h2></div></div></div><p>Each mapping can have custom meta data associated with it. These are
simple storage elements that are simply persisted along with the mapping
and can be retrieved when fetching the mapping definition. The meta is
defined under the <code class="literal">_meta</code> element, for example:</p><pre class="programlisting prettyprint lang-js">{
    "tweet" : {
        "_meta" : {
            "attr1" : "value1",
            "attr2" : {
                "attr3" : "value3"
            }
        }
    }
}</pre><p>Meta can be handy for example for client libraries that perform
serialization and deserialization to store its meta model (for example,
the class the document maps to).</p></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="analysis"></a>Analysis</h1></div></div></div><div class="partintro"><div></div><p>The index analysis module acts as a configurable registry of Analyzers
that can be used in order to both break indexed (analyzed) fields when a
document is indexed and process query strings. It maps to the Lucene
<code class="literal">Analyzer</code>.</p><p>Analyzers are composed of a single <a class="link" href="#analysis-tokenizers" title="Tokenizers">Tokenizer</a>
and zero or more <a class="link" href="#analysis-tokenfilters" title="Token Filters">TokenFilters</a>. The tokenizer may
be preceded by one or more <a class="link" href="#analysis-charfilters" title="Character Filters">CharFilters</a>. The
analysis module allows one to register <code class="literal">TokenFilters</code>, <code class="literal">Tokenizers</code> and
<code class="literal">Analyzers</code> under logical names that can then be referenced either in
mapping definitions or in certain APIs. The Analysis module
automatically registers (<span class="strong"><strong>if not explicitly defined</strong></span>) built in
analyzers, token filters, and tokenizers.</p><p>Here is a sample configuration:</p><pre class="programlisting prettyprint lang-js">index :
    analysis :
        analyzer :
            standard :
                type : standard
                stopwords : [stop1, stop2]
            myAnalyzer1 :
                type : standard
                stopwords : [stop1, stop2, stop3]
                max_token_length : 500
            # configure a custom analyzer which is
            # exactly like the default standard analyzer
            myAnalyzer2 :
                tokenizer : standard
                filter : [standard, lowercase, stop]
        tokenizer :
            myTokenizer1 :
                type : standard
                max_token_length : 900
            myTokenizer2 :
                type : keyword
                buffer_size : 512
        filter :
            myTokenFilter1 :
                type : stop
                stopwords : [stop1, stop2, stop3, stop4]
            myTokenFilter2 :
                type : length
                min : 0
                max : 2000</pre><h3><a id="backwards-compatibility"></a>Backwards compatibility</h3><p>All analyzers, tokenizers, and token filters can be configured with a
<code class="literal">version</code> parameter to control which Lucene version behavior they should
use. Possible values are: <code class="literal">3.0</code> - <code class="literal">3.6</code>, <code class="literal">4.0</code> - <code class="literal">4.3</code> (the highest
version number is the default option).</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-analyzers"></a>Analyzers</h2></div></div></div><p>Analyzers are composed of a single <a class="link" href="#analysis-tokenizers" title="Tokenizers">Tokenizer</a>
and zero or more <a class="link" href="#analysis-tokenfilters" title="Token Filters">TokenFilters</a>. The tokenizer may
be preceded by one or more <a class="link" href="#analysis-charfilters" title="Character Filters">CharFilters</a>.
The analysis module allows you to register <code class="literal">Analyzers</code> under logical
names which can then be referenced either in mapping definitions or in
certain APIs.</p><p>Elasticsearch comes with a number of prebuilt analyzers which are
ready to use.  Alternatively, you can combine the built in
character filters, tokenizers and token filters to create
<a class="link" href="#analysis-custom-analyzer" title="Custom Analyzer">custom analyzers</a>.</p><h3><a id="default-analyzers"></a>Default Analyzers</h3><p>An analyzer is registered under a logical name. It can then be
referenced from mapping definitions or certain APIs. When none are
defined, defaults are used. There is an option to define which analyzers
will be used by default when none can be derived.</p><p>The <code class="literal">default</code> logical name allows one to configure an analyzer that will
be used both for indexing and for searching APIs. The <code class="literal">default_index</code>
logical name can be used to configure a default analyzer that will be
used just when indexing, and the <code class="literal">default_search</code> can be used to
configure a default analyzer that will be used just when searching.</p><h3><a id="aliasing-analyzers"></a>Aliasing Analyzers</h3><p>Analyzers can be aliased to have several registered lookup names
associated with them. For example, the following will allow
the <code class="literal">standard</code> analyzer to also be referenced with <code class="literal">alias1</code>
and <code class="literal">alias2</code> values.</p><pre class="programlisting prettyprint lang-js">index :
  analysis :
    analyzer :
      standard :
        alias: [alias1, alias2]
        type : standard
        stopwords : [test1, test2, test3]</pre><p>Below is a list of the built in analyzers.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-standard-analyzer"></a>Standard Analyzer</h2></div></div></div><p>An analyzer of type <code class="literal">standard</code> is built using the
<a class="link" href="#analysis-standard-tokenizer" title="Standard Tokenizer">Standard Tokenizer</a> with the
<a class="link" href="#analysis-standard-tokenfilter" title="Standard Token Filter">Standard Token Filter</a>,
<a class="link" href="#analysis-lowercase-tokenfilter" title="Lowercase Token Filter">Lower Case Token Filter</a>, and
<a class="link" href="#analysis-stop-tokenfilter" title="Stop Token Filter">Stop Token Filter</a>.</p><p>The following are settings that can be set for a <code class="literal">standard</code> analyzer
type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">stopwords</code></p></td><td align="left" valign="top"><p>A list of stopwords to initialize the stop filter with.
Defaults to an <span class="emphasis"><em>empty</em></span> stopword list <span class="added">
      [<span class="version">1.0.0.Beta1</span>]
      <span class="detail">Added in 1.0.0.Beta1. Previously defaulted to the English stopwords list.</span></span>. Check
<a class="link" href="#analysis-stop-analyzer" title="Stop Analyzer">Stop Analyzer</a> for more details.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_token_length</code></p></td><td align="left" valign="top"><p>The maximum token length. If a token is seen that
exceeds this length then it is discarded. Defaults to <code class="literal">255</code>.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-simple-analyzer"></a>Simple Analyzer</h2></div></div></div><p>An analyzer of type <code class="literal">simple</code> that is built using a
<a class="link" href="#analysis-lowercase-tokenizer" title="Lowercase Tokenizer">Lower Case Tokenizer</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-whitespace-analyzer"></a>Whitespace Analyzer</h2></div></div></div><p>An analyzer of type <code class="literal">whitespace</code> that is built using a
<a class="link" href="#analysis-whitespace-tokenizer" title="Whitespace Tokenizer">Whitespace Tokenizer</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-stop-analyzer"></a>Stop Analyzer</h2></div></div></div><p>An analyzer of type <code class="literal">stop</code> that is built using a
<a class="link" href="#analysis-lowercase-tokenizer" title="Lowercase Tokenizer">Lower Case Tokenizer</a>, with
<a class="link" href="#analysis-stop-tokenfilter" title="Stop Token Filter">Stop Token Filter</a>.</p><p>The following are settings that can be set for a <code class="literal">stop</code> analyzer type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">stopwords</code></p></td><td align="left" valign="top"><p>A list of stopwords to initialize the stop filter with.
Defaults to the english stop words.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">stopwords_path</code></p></td><td align="left" valign="top"><p>A path (either relative to <code class="literal">config</code> location, or
absolute) to a stopwords file configuration.</p></td></tr></tbody></table></div><p>Use <code class="literal">stopwords: _none_</code> to explicitly specify an <span class="emphasis"><em>empty</em></span> stopword list.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-keyword-analyzer"></a>Keyword Analyzer</h2></div></div></div><p>An analyzer of type <code class="literal">keyword</code> that "tokenizes" an entire stream as a
single token. This is useful for data like zip codes, ids and so on.
Note, when using mapping definitions, it might make more sense to simply
mark the field as <code class="literal">not_analyzed</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-pattern-analyzer"></a>Pattern Analyzer</h2></div></div></div><p>An analyzer of type <code class="literal">pattern</code> that can flexibly separate text into terms
via a regular expression. Accepts the following settings:</p><p>The following are settings that can be set for a <code class="literal">pattern</code> analyzer
type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">lowercase</code></p></td><td align="left" valign="top"><p>Should terms be lowercased or not. Defaults to <code class="literal">true</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">pattern</code></p></td><td align="left" valign="top"><p>The regular expression pattern, defaults to <code class="literal">\W+</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">flags</code></p></td><td align="left" valign="top"><p>The regular expression flags.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">stopwords</code></p></td><td align="left" valign="top"><p>A list of stopwords to initialize the stop filter with.
Defaults to an <span class="emphasis"><em>empty</em></span> stopword list <span class="added">
      [<span class="version">1.0.0.RC1</span>]
      <span class="detail">Added in 1.0.0.RC1. Previously defaulted to the English stopwords list.</span></span>. Check
<a class="link" href="#analysis-stop-analyzer" title="Stop Analyzer">Stop Analyzer</a> for more details.</p></td></tr></tbody></table></div><p><span class="strong"><strong>IMPORTANT</strong></span>: The regular expression should match the <span class="strong"><strong>token separators</strong></span>,
not the tokens themselves.</p><p>Flags should be pipe-separated, eg <code class="literal">"CASE_INSENSITIVE|COMMENTS"</code>. Check
<a class="ulink" href="http://download.oracle.com/javase/6/docs/api/java/util/regex/Pattern.html#field_summary" target="_top">Java
Pattern API</a> for more details about <code class="literal">flags</code> options.</p><h4><a id="_pattern_analyzer_examples"></a>Pattern Analyzer Examples</h4><p>In order to try out these examples, you should delete the <code class="literal">test</code> index
before running each example:</p><pre class="programlisting prettyprint lang-js">    curl -XDELETE localhost:9200/test</pre><h5><a id="_whitespace_tokenizer"></a>Whitespace tokenizer</h5><pre class="programlisting prettyprint lang-js">    curl -XPUT 'localhost:9200/test' -d '
    {
        "settings":{
            "analysis": {
                "analyzer": {
                    "whitespace":{
                        "type": "pattern",
                        "pattern":"\\\\s+"
                    }
                }
            }
        }
    }'

    curl 'localhost:9200/test/_analyze?pretty=1&amp;analyzer=whitespace' -d 'foo,bar baz'
    # "foo,bar", "baz"</pre><h5><a id="_non_word_character_tokenizer"></a>Non-word character tokenizer</h5><pre class="programlisting prettyprint lang-js">    curl -XPUT 'localhost:9200/test' -d '
    {
        "settings":{
            "analysis": {
                "analyzer": {
                    "nonword":{
                        "type": "pattern",
                        "pattern":"[^\\\\w]+"
                    }
                }
            }
        }
    }'

    curl 'localhost:9200/test/_analyze?pretty=1&amp;analyzer=nonword' -d 'foo,bar baz'
    # "foo,bar baz" becomes "foo", "bar", "baz"

    curl 'localhost:9200/test/_analyze?pretty=1&amp;analyzer=nonword' -d 'type_1-type_4'
    # "type_1","type_4"</pre><h5><a id="_camelcase_tokenizer"></a>CamelCase tokenizer</h5><pre class="programlisting prettyprint lang-js">    curl -XPUT 'localhost:9200/test?pretty=1' -d '
    {
        "settings":{
            "analysis": {
                "analyzer": {
                    "camel":{
                        "type": "pattern",
                        "pattern":"([^\\\\p{L}\\\\d]+)|(?&lt;=\\\\D)(?=\\\\d)|(?&lt;=\\\\d)(?=\\\\D)|(?&lt;=[\\\\p{L}&amp;&amp;[^\\\\p{Lu}]])(?=\\\\p{Lu})|(?&lt;=\\\\p{Lu})(?=\\\\p{Lu}[\\\\p{L}&amp;&amp;[^\\\\p{Lu}]])"
                    }
                }
            }
        }
    }'

    curl 'localhost:9200/test/_analyze?pretty=1&amp;analyzer=camel' -d '
        MooseX::FTPClass2_beta
    '
    # "moose","x","ftp","class","2","beta"</pre><p>The regex above is easier to understand as:</p><pre class="programlisting prettyprint lang-js">      ([^\\p{L}\\d]+)                 # swallow non letters and numbers,
    | (?&lt;=\\D)(?=\\d)                 # or non-number followed by number,
    | (?&lt;=\\d)(?=\\D)                 # or number followed by non-number,
    | (?&lt;=[ \\p{L} &amp;&amp; [^\\p{Lu}]])    # or lower case
      (?=\\p{Lu})                    #   followed by upper case,
    | (?&lt;=\\p{Lu})                   # or upper case
      (?=\\p{Lu}                     #   followed by upper case
        [\\p{L}&amp;&amp;[^\\p{Lu}]]          #   then lower case
      )</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-lang-analyzer"></a>Language Analyzers</h2></div></div></div><p>A set of analyzers aimed at analyzing specific language text. The
following types are supported: <code class="literal">arabic</code>, <code class="literal">armenian</code>, <code class="literal">basque</code>,
<code class="literal">brazilian</code>, <code class="literal">bulgarian</code>, <code class="literal">catalan</code>, <code class="literal">chinese</code>, <code class="literal">cjk</code>, <code class="literal">czech</code>,
<code class="literal">danish</code>, <code class="literal">dutch</code>, <code class="literal">english</code>, <code class="literal">finnish</code>, <code class="literal">french</code>, <code class="literal">galician</code>, <code class="literal">german</code>,
<code class="literal">greek</code>, <code class="literal">hindi</code>, <code class="literal">hungarian</code>, <code class="literal">indonesian</code>, <code class="literal">italian</code>, <code class="literal">norwegian</code>,
<code class="literal">persian</code>, <code class="literal">portuguese</code>, <code class="literal">romanian</code>, <code class="literal">russian</code>, <code class="literal">spanish</code>, <code class="literal">swedish</code>,
<code class="literal">turkish</code>, <code class="literal">thai</code>.</p><p>All analyzers support setting custom <code class="literal">stopwords</code> either internally in
the config, or by using an external stopwords file by setting
<code class="literal">stopwords_path</code>. Check <a class="link" href="#analysis-stop-analyzer" title="Stop Analyzer">Stop Analyzer</a> for
more details.</p><p>The following analyzers support setting custom <code class="literal">stem_exclusion</code> list:
<code class="literal">arabic</code>, <code class="literal">armenian</code>, <code class="literal">basque</code>, <code class="literal">brazilian</code>, <code class="literal">bulgarian</code>, <code class="literal">catalan</code>,
<code class="literal">czech</code>, <code class="literal">danish</code>, <code class="literal">dutch</code>, <code class="literal">english</code>, <code class="literal">finnish</code>, <code class="literal">french</code>, <code class="literal">galician</code>,
<code class="literal">german</code>, <code class="literal">hindi</code>, <code class="literal">hungarian</code>, <code class="literal">indonesian</code>, <code class="literal">italian</code>, <code class="literal">norwegian</code>,
<code class="literal">portuguese</code>, <code class="literal">romanian</code>, <code class="literal">russian</code>, <code class="literal">spanish</code>, <code class="literal">swedish</code>, <code class="literal">turkish</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-snowball-analyzer"></a>Snowball Analyzer</h2></div></div></div><p>An analyzer of type <code class="literal">snowball</code> that uses the
<a class="link" href="#analysis-standard-tokenizer" title="Standard Tokenizer">standard tokenizer</a>, with
<a class="link" href="#analysis-standard-tokenfilter" title="Standard Token Filter">standard filter</a>,
<a class="link" href="#analysis-lowercase-tokenfilter" title="Lowercase Token Filter">lowercase filter</a>,
<a class="link" href="#analysis-stop-tokenfilter" title="Stop Token Filter">stop filter</a>, and
<a class="link" href="#analysis-snowball-tokenfilter" title="Snowball Token Filter">snowball filter</a>.</p><p>The Snowball Analyzer is a stemming analyzer from Lucene that is
originally based on the snowball project from
<a class="ulink" href="http://snowball.tartarus.org" target="_top">snowball.tartarus.org</a>.</p><p>Sample usage:</p><pre class="programlisting prettyprint lang-js">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "my_analyzer" : {
                    "type" : "snowball",
                    "language" : "English"
                }
            }
        }
    }
}</pre><p>The <code class="literal">language</code> parameter can have the same values as the
<a class="link" href="#analysis-snowball-tokenfilter" title="Snowball Token Filter">snowball filter</a> and defaults to <code class="literal">English</code>. Note that not all the language
analyzers have a default set of stopwords provided.</p><p>The <code class="literal">stopwords</code> parameter can be used to provide stopwords for the
languages that have no defaults, or to simply replace the default set
with your custom list. Check <a class="link" href="#analysis-stop-analyzer" title="Stop Analyzer">Stop Analyzer</a>
for more details. A default set of stopwords for many of these
languages is available from for instance
<a class="ulink" href="https://github.com/apache/lucene-solr/tree/trunk/lucene/analysis/common/src/resources/org/apache/lucene/analysis/" target="_top">here</a>
and
<a class="ulink" href="https://github.com/apache/lucene-solr/tree/trunk/lucene/analysis/common/src/resources/org/apache/lucene/analysis/snowball" target="_top">here.</a></p><p>A sample configuration (in YAML format) specifying Swedish with
stopwords:</p><pre class="programlisting prettyprint lang-js">index :
    analysis :
        analyzer :
           my_analyzer:
                type: snowball
                language: Swedish
                stopwords: "och,det,att,i,en,jag,hon,som,han,pÃ¥,den,med,var,sig,fÃ¶r,sÃ¥,till,Ã¤r,men,ett,om,hade,de,av,icke,mig,du,henne,dÃ¥,sin,nu,har,inte,hans,honom,skulle,hennes,dÃ¤r,min,man,ej,vid,kunde,nÃ¥got,frÃ¥n,ut,nÃ¤r,efter,upp,vi,dem,vara,vad,Ã¶ver,Ã¤n,dig,kan,sina,hÃ¤r,ha,mot,alla,under,nÃ¥gon,allt,mycket,sedan,ju,denna,sjÃ¤lv,detta,Ã¥t,utan,varit,hur,ingen,mitt,ni,bli,blev,oss,din,dessa,nÃ¥gra,deras,blir,mina,samma,vilken,er,sÃ¥dan,vÃ¥r,blivit,dess,inom,mellan,sÃ¥dant,varfÃ¶r,varje,vilka,ditt,vem,vilket,sitta,sÃ¥dana,vart,dina,vars,vÃ¥rt,vÃ¥ra,ert,era,vilkas"</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-custom-analyzer"></a>Custom Analyzer</h2></div></div></div><p>An analyzer of type <code class="literal">custom</code> that allows to combine a <code class="literal">Tokenizer</code> with
zero or more <code class="literal">Token Filters</code>, and zero or more <code class="literal">Char Filters</code>. The
custom analyzer accepts a logical/registered name of the tokenizer to
use, and a list of logical/registered names of token filters.</p><p>The following are settings that can be set for a <code class="literal">custom</code> analyzer type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">tokenizer</code></p></td><td align="left" valign="top"><p>The logical / registered name of the tokenizer to use.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">filter</code></p></td><td align="left" valign="top"><p>An optional list of logical / registered name of token
filters.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">char_filter</code></p></td><td align="left" valign="top"><p>An optional list of logical / registered name of char
filters.</p></td></tr></tbody></table></div><p>Here is an example:</p><pre class="programlisting prettyprint lang-js">index :
    analysis :
        analyzer :
            myAnalyzer2 :
                type : custom
                tokenizer : myTokenizer1
                filter : [myTokenFilter1, myTokenFilter2]
                char_filter : [my_html]
        tokenizer :
            myTokenizer1 :
                type : standard
                max_token_length : 900
        filter :
            myTokenFilter1 :
                type : stop
                stopwords : [stop1, stop2, stop3, stop4]
            myTokenFilter2 :
                type : length
                min : 0
                max : 2000
        char_filter :
              my_html :
                type : html_strip
                escaped_tags : [xxx, yyy]
                read_ahead : 1024</pre></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-tokenizers"></a>Tokenizers</h2></div></div></div><p>Tokenizers are used to break a string down into a stream of terms
or tokens. A simple tokenizer might split the string up into terms
wherever it encounters whitespace or punctuation.</p><p>Elasticsearch has a number of built in tokenizers which can be
used to build <a class="link" href="#analysis-custom-analyzer" title="Custom Analyzer">custom analyzers</a>.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-standard-tokenizer"></a>Standard Tokenizer</h2></div></div></div><p>A tokenizer of type <code class="literal">standard</code> providing grammar based tokenizer that is
a good tokenizer for most European language documents. The tokenizer
implements the Unicode Text Segmentation algorithm, as specified in
<a class="ulink" href="http://unicode.org/reports/tr29/" target="_top">Unicode Standard Annex #29</a>.</p><p>The following are settings that can be set for a <code class="literal">standard</code> tokenizer
type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">max_token_length</code></p></td><td align="left" valign="top"><p>The maximum token length. If a token is seen that
exceeds this length then it is discarded. Defaults to <code class="literal">255</code>.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-edgengram-tokenizer"></a>Edge NGram Tokenizer</h2></div></div></div><p>A tokenizer of type <code class="literal">edgeNGram</code>.</p><p>This tokenizer is very similar to <code class="literal">nGram</code> but only keeps n-grams which
start at the beginning of a token.</p><p>The following are settings that can be set for a <code class="literal">edgeNGram</code> tokenizer
type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description </th><th align="left" valign="top">Default value</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">min_gram</code></p></td><td align="left" valign="top"><p>Minimum size in codepoints of a single n-gram</p></td><td align="left" valign="top"><p><code class="literal">1</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_gram</code></p></td><td align="left" valign="top"><p>Maximum size in codepoints of a single n-gram</p></td><td align="left" valign="top"><p><code class="literal">2</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">token_chars</code></p></td><td align="left" valign="top"><p>Characters classes to keep in the
tokens, Elasticsearch will split on characters that donât belong to any
of these classes.</p></td><td align="left" valign="top"><p><code class="literal">[]</code> (Keep all characters)</p></td></tr></tbody></table></div><p><code class="literal">token_chars</code> accepts the following character classes:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">letter</code>
</p>
</td><td valign="top">
<p>
for example <code class="literal">a</code>, <code class="literal">b</code>, <code class="literal">Ã¯</code> or <code class="literal">äº¬</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">digit</code>
</p>
</td><td valign="top">
<p>
for example <code class="literal">3</code> or <code class="literal">7</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">whitespace</code>
</p>
</td><td valign="top">
<p>
for example <code class="literal">" "</code> or <code class="literal">"\n"</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">punctuation</code>
</p>
</td><td valign="top">
<p>
for example <code class="literal">!</code> or <code class="literal">"</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">symbol</code>
</p>
</td><td valign="top">
<p>
for example <code class="literal">$</code> or <code class="literal">â</code>
</p>
</td></tr></tbody></table></div><h4><a id="_example_5"></a>Example</h4><pre class="programlisting prettyprint lang-js">    curl -XPUT 'localhost:9200/test' -d '
    {
        "settings" : {
            "analysis" : {
                "analyzer" : {
                    "my_edge_ngram_analyzer" : {
                        "tokenizer" : "my_edge_ngram_tokenizer"
                    }
                },
                "tokenizer" : {
                    "my_edge_ngram_tokenizer" : {
                        "type" : "edgeNGram",
                        "min_gram" : "2",
                        "max_gram" : "5",
                        "token_chars": [ "letter", "digit" ]
                    }
                }
            }
        }
    }'

    curl 'localhost:9200/test/_analyze?pretty=1&amp;analyzer=my_edge_ngram_analyzer' -d 'FC Schalke 04'
    # FC, Sc, Sch, Scha, Schal, 04</pre><h4><a id="_literal_side_literal_deprecated"></a><code class="literal">side</code> deprecated</h4><p>There used to be a <code class="literal">side</code> parameter up to <code class="literal">0.90.1</code> but it is now deprecated. In
order to emulate the behavior of <code class="literal">"side" : "BACK"</code> a
<a class="link" href="#analysis-reverse-tokenfilter" title="Reverse Token Filter"><code class="literal">reverse</code> token filter</a>  should be used together
with the <a class="link" href="#analysis-edgengram-tokenfilter" title="Edge NGram Token Filter"><code class="literal">edgeNGram</code> token filter</a>. The
<code class="literal">edgeNGram</code> filter must be enclosed in <code class="literal">reverse</code> filters like this:</p><pre class="programlisting prettyprint lang-js">    "filter" : ["reverse", "edgeNGram", "reverse"]</pre><p>which essentially reverses the token, builds front <code class="literal">EdgeNGrams</code> and reverses
the ngram again. This has the same effect as the previous <code class="literal">"side" : "BACK"</code> setting.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-keyword-tokenizer"></a>Keyword Tokenizer</h2></div></div></div><p>A tokenizer of type <code class="literal">keyword</code> that emits the entire input as a single
input.</p><p>The following are settings that can be set for a <code class="literal">keyword</code> tokenizer
type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">buffer_size</code></p></td><td align="left" valign="top"><p>The term buffer size. Defaults to <code class="literal">256</code>.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-letter-tokenizer"></a>Letter Tokenizer</h2></div></div></div><p>A tokenizer of type <code class="literal">letter</code> that divides text at non-letters. Thatâs to
say, it defines tokens as maximal strings of adjacent letters. Note,
this does a decent job for most European languages, but does a terrible
job for some Asian languages, where words are not separated by spaces.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-lowercase-tokenizer"></a>Lowercase Tokenizer</h2></div></div></div><p>A tokenizer of type <code class="literal">lowercase</code> that performs the function of
<a class="link" href="#analysis-letter-tokenizer" title="Letter Tokenizer">Letter Tokenizer</a> and
<a class="link" href="#analysis-lowercase-tokenfilter" title="Lowercase Token Filter">Lower Case Token Filter</a> together. It divides text at non-letters and converts
them to lower case. While it is functionally equivalent to the
combination of
<a class="link" href="#analysis-letter-tokenizer" title="Letter Tokenizer">Letter Tokenizer</a> and
<a class="link" href="#analysis-lowercase-tokenfilter" title="Lowercase Token Filter">Lower Case Token Filter</a>, there is a performance advantage to doing the two
tasks at once, hence this (redundant) implementation.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-ngram-tokenizer"></a>NGram Tokenizer</h2></div></div></div><p>A tokenizer of type <code class="literal">nGram</code>.</p><p>The following are settings that can be set for a <code class="literal">nGram</code> tokenizer type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description </th><th align="left" valign="top">Default value</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">min_gram</code></p></td><td align="left" valign="top"><p>Minimum size in codepoints of a single n-gram</p></td><td align="left" valign="top"><p><code class="literal">1</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_gram</code></p></td><td align="left" valign="top"><p>Maximum size in codepoints of a single n-gram</p></td><td align="left" valign="top"><p><code class="literal">2</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">token_chars</code></p></td><td align="left" valign="top"><p>Characters classes to keep in the
tokens, Elasticsearch will split on characters that donât belong to any
of these classes.</p></td><td align="left" valign="top"><p><code class="literal">[]</code> (Keep all characters)</p></td></tr></tbody></table></div><p><code class="literal">token_chars</code> accepts the following character classes:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">letter</code>
</p>
</td><td valign="top">
<p>
for example <code class="literal">a</code>, <code class="literal">b</code>, <code class="literal">Ã¯</code> or <code class="literal">äº¬</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">digit</code>
</p>
</td><td valign="top">
<p>
for example <code class="literal">3</code> or <code class="literal">7</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">whitespace</code>
</p>
</td><td valign="top">
<p>
for example <code class="literal">" "</code> or <code class="literal">"\n"</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">punctuation</code>
</p>
</td><td valign="top">
<p>
for example <code class="literal">!</code> or <code class="literal">"</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">symbol</code>
</p>
</td><td valign="top">
<p>
for example <code class="literal">$</code> or <code class="literal">â</code>
</p>
</td></tr></tbody></table></div><h4><a id="_example_6"></a>Example</h4><pre class="programlisting prettyprint lang-js">    curl -XPUT 'localhost:9200/test' -d '
    {
        "settings" : {
            "analysis" : {
                "analyzer" : {
                    "my_ngram_analyzer" : {
                        "tokenizer" : "my_ngram_tokenizer"
                    }
                },
                "tokenizer" : {
                    "my_ngram_tokenizer" : {
                        "type" : "nGram",
                        "min_gram" : "2",
                        "max_gram" : "3",
                        "token_chars": [ "letter", "digit" ]
                    }
                }
            }
        }
    }'

    curl 'localhost:9200/test/_analyze?pretty=1&amp;analyzer=my_ngram_analyzer' -d 'FC Schalke 04'
    # FC, Sc, Sch, ch, cha, ha, hal, al, alk, lk, lke, ke, 04</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-whitespace-tokenizer"></a>Whitespace Tokenizer</h2></div></div></div><p>A tokenizer of type <code class="literal">whitespace</code> that divides text at whitespace.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-pattern-tokenizer"></a>Pattern Tokenizer</h2></div></div></div><p>A tokenizer of type <code class="literal">pattern</code> that can flexibly separate text into terms
via a regular expression. Accepts the following settings:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">pattern</code></p></td><td align="left" valign="top"><p>The regular expression pattern, defaults to <code class="literal">\\W+</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">flags</code></p></td><td align="left" valign="top"><p>The regular expression flags.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">group</code></p></td><td align="left" valign="top"><p>Which group to extract into tokens. Defaults to <code class="literal">-1</code> (split).</p></td></tr></tbody></table></div><p><span class="strong"><strong>IMPORTANT</strong></span>: The regular expression should match the <span class="strong"><strong>token separators</strong></span>,
not the tokens themselves.</p><p><code class="literal">group</code> set to <code class="literal">-1</code> (the default) is equivalent to "split". Using group
&gt;= 0 selects the matching group as the token. For example, if you have:</p><pre class="screen">pattern = \\'([^\']+)\\'
group   = 0
input   = aaa 'bbb' 'ccc'</pre><p>the output will be two tokens: <span class="emphasis"><em>bbb</em></span> and <span class="emphasis"><em>ccc</em></span> (including the ' marks).
With the same input but using group=1, the output would be: bbb and ccc
(no ' marks).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-uaxurlemail-tokenizer"></a>UAX Email URL Tokenizer</h2></div></div></div><p>A tokenizer of type <code class="literal">uax_url_email</code> which works exactly like the
<code class="literal">standard</code> tokenizer, but tokenizes emails and urls as single tokens.</p><p>The following are settings that can be set for a <code class="literal">uax_url_email</code>
tokenizer type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">max_token_length</code></p></td><td align="left" valign="top"><p>The maximum token length. If a token is seen that
exceeds this length then it is discarded. Defaults to <code class="literal">255</code>.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-pathhierarchy-tokenizer"></a>Path Hierarchy Tokenizer</h2></div></div></div><p>The <code class="literal">path_hierarchy</code> tokenizer takes something like this:</p><pre class="screen">/something/something/else</pre><p>And produces tokens:</p><pre class="screen">/something
/something/something
/something/something/else</pre><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">delimiter</code></p></td><td align="left" valign="top"><p>The character delimiter to use, defaults to <code class="literal">/</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">replacement</code></p></td><td align="left" valign="top"><p>An optional replacement character to use. Defaults to
the <code class="literal">delimiter</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">buffer_size</code></p></td><td align="left" valign="top"><p>The buffer size to use, defaults to <code class="literal">1024</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">reverse</code></p></td><td align="left" valign="top"><p>Generates tokens in reverse order, defaults to <code class="literal">false</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">skip</code></p></td><td align="left" valign="top"><p>Controls initial tokens to skip, defaults to <code class="literal">0</code>.</p></td></tr></tbody></table></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-tokenfilters"></a>Token Filters</h2></div></div></div><p>Token filters accept a stream of tokens from a
<a class="link" href="#analysis-tokenizers" title="Tokenizers">tokenizer</a> and can modify tokens
(eg lowercasing), delete tokens (eg remove stopwords)
or add tokens (eg synonyms).</p><p>Elasticsearch has a number of built in token filters which can be
used to build <a class="link" href="#analysis-custom-analyzer" title="Custom Analyzer">custom analyzers</a>.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-standard-tokenfilter"></a>Standard Token Filter</h2></div></div></div><p>A token filter of type <code class="literal">standard</code> that normalizes tokens extracted with
the
<a class="link" href="#analysis-standard-tokenizer" title="Standard Tokenizer">Standard Tokenizer</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-asciifolding-tokenfilter"></a>ASCII Folding Token Filter</h2></div></div></div><p>A token filter of type <code class="literal">asciifolding</code> that converts alphabetic, numeric,
and symbolic Unicode characters which are not in the first 127 ASCII
characters (the "Basic Latin" Unicode block) into their ASCII
equivalents, if one exists.  Example:</p><pre class="programlisting prettyprint lang-js">"index" : {
    "analysis" : {
        "analyzer" : {
            "default" : {
                "tokenizer" : "standard",
                "filter" : ["standard", "asciifolding"]
            }
        }
    }
}</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.1.0.</p></div></div><p>Accepts <code class="literal">preserve_original</code> setting which defaults to false but if true
will keep the oringal token as well as emit the folded token.  For
example:</p><pre class="programlisting prettyprint lang-js">"index" : {
    "analysis" : {
        "analyzer" : {
            "default" : {
                "tokenizer" : "standard",
                "filter" : ["standard", "my_ascii_folding"]
            }
        },
        "filter" : {
            "my_ascii_folding" : {
                "type" : "asciifolding",
                "preserve_original" : true
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-length-tokenfilter"></a>Length Token Filter</h2></div></div></div><p>A token filter of type <code class="literal">length</code> that removes words that are too long or
too short for the stream.</p><p>The following are settings that can be set for a <code class="literal">length</code> token filter
type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">min</code></p></td><td align="left" valign="top"><p>The minimum number. Defaults to <code class="literal">0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max</code></p></td><td align="left" valign="top"><p>The maximum number. Defaults to <code class="literal">Integer.MAX_VALUE</code>.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-lowercase-tokenfilter"></a>Lowercase Token Filter</h2></div></div></div><p>A token filter of type <code class="literal">lowercase</code> that normalizes token text to lower
case.</p><p>Lowercase token filter supports Greek and Turkish lowercase token
filters through the <code class="literal">language</code> parameter. Below is a usage example in a
custom analyzer</p><pre class="programlisting prettyprint lang-js">index :
    analysis :
        analyzer :
            myAnalyzer2 :
                type : custom
                tokenizer : myTokenizer1
                filter : [myTokenFilter1, myGreekLowerCaseFilter]
                char_filter : [my_html]
        tokenizer :
            myTokenizer1 :
                type : standard
                max_token_length : 900
        filter :
            myTokenFilter1 :
                type : stop
                stopwords : [stop1, stop2, stop3, stop4]
            myGreekLowerCaseFilter :
                type : lowercase
                language : greek
        char_filter :
              my_html :
                type : html_strip
                escaped_tags : [xxx, yyy]
                read_ahead : 1024</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-uppercase-tokenfilter"></a>Uppercase Token Filter</h2></div></div></div><p>A token filter of type <code class="literal">uppercase</code> that normalizes token text to upper
case.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-ngram-tokenfilter"></a>NGram Token Filter</h2></div></div></div><p>A token filter of type <code class="literal">nGram</code>.</p><p>The following are settings that can be set for a <code class="literal">nGram</code> token filter
type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">min_gram</code></p></td><td align="left" valign="top"><p>Defaults to <code class="literal">1</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_gram</code></p></td><td align="left" valign="top"><p>Defaults to <code class="literal">2</code>.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-edgengram-tokenfilter"></a>Edge NGram Token Filter</h2></div></div></div><p>A token filter of type <code class="literal">edgeNGram</code>.</p><p>The following are settings that can be set for a <code class="literal">edgeNGram</code> token
filter type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">min_gram</code></p></td><td align="left" valign="top"><p>Defaults to <code class="literal">1</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_gram</code></p></td><td align="left" valign="top"><p>Defaults to <code class="literal">2</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">side</code></p></td><td align="left" valign="top"><p>Either <code class="literal">front</code> or <code class="literal">back</code>. Defaults to <code class="literal">front</code>.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-porterstem-tokenfilter"></a>Porter Stem Token Filter</h2></div></div></div><p>A token filter of type <code class="literal">porter_stem</code> that transforms the token stream as
per the Porter stemming algorithm.</p><p>Note, the input to the stemming filter must already be in lower case, so
you will need to use
<a class="link" href="#analysis-lowercase-tokenfilter" title="Lowercase Token Filter">Lower Case Token Filter</a> or
<a class="link" href="#analysis-lowercase-tokenizer" title="Lowercase Tokenizer">Lower Case Tokenizer</a> farther down the Tokenizer chain in order for this to
work properly!. For example, when using custom analyzer, make sure the
<code class="literal">lowercase</code> filter comes before the <code class="literal">porter_stem</code> filter in the list of
filters.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-shingle-tokenfilter"></a>Shingle Token Filter</h2></div></div></div><p>A token filter of type <code class="literal">shingle</code> that constructs shingles (token
n-grams) from a token stream. In other words, it creates combinations of
tokens as a single token. For example, the sentence "please divide this
sentence into shingles" might be tokenized into shingles "please
divide", "divide this", "this sentence", "sentence into", and "into
shingles".</p><p>This filter handles position increments &gt; 1 by inserting filler tokens
(tokens with termtext "_"). It does not handle a position increment of
0.</p><p>The following are settings that can be set for a <code class="literal">shingle</code> token filter
type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">max_shingle_size</code></p></td><td align="left" valign="top"><p>The maximum shingle size. Defaults to <code class="literal">2</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">min_shingle_size</code></p></td><td align="left" valign="top"><p>The minimum shingle size. Defaults to <code class="literal">2</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">output_unigrams</code></p></td><td align="left" valign="top"><p>If <code class="literal">true</code> the output will contain the input tokens
(unigrams) as well as the shingles. Defaults to <code class="literal">true</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">output_unigrams_if_no_shingles</code></p></td><td align="left" valign="top"><p>If <code class="literal">output_unigrams</code> is <code class="literal">false</code> the
output will contain the input tokens (unigrams) if no shingles are
available. Note if <code class="literal">output_unigrams</code> is set to <code class="literal">true</code> this setting has
no effect. Defaults to <code class="literal">false</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">token_separator</code></p></td><td align="left" valign="top"><p>The string to use when joining adjacent tokens to
form a shingle. Defaults to <code class="literal">" "</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">filler_token</code></p></td><td align="left" valign="top"><p>The string to use as a replacement for each position
at which there is no actual token in the stream. For instance this string is
used if the position increment is greater than one when a <code class="literal">stop</code> filter is used
together with the <code class="literal">shingle</code> filter. Defaults to <code class="literal">"_"</code></p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-stop-tokenfilter"></a>Stop Token Filter</h2></div></div></div><p>A token filter of type <code class="literal">stop</code> that removes stop words from token
streams.</p><p>The following are settings that can be set for a <code class="literal">stop</code> token filter
type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">stopwords</code></p></td><td align="left" valign="top"><p>A list of stop words to use. Defaults to english stop
words.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">stopwords_path</code></p></td><td align="left" valign="top"><p>A path (either relative to <code class="literal">config</code> location, or
absolute) to a stopwords file configuration. Each stop word should be in
its own "line" (separated by a line break). The file must be UTF-8
encoded.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ignore_case</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to lower case all words first. Defaults to
<code class="literal">false</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">remove_trailing</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">false</code> in order to not ignore the last term of
a search if it is a stop word. This is very useful for the completion
suggester as a query like <code class="literal">green a</code> can be extended to <code class="literal">green apple</code> even
though you remove stop words in general. Defaults to <code class="literal">true</code>.</p></td></tr></tbody></table></div><p>stopwords allow for custom language specific expansion of default
stopwords. It follows the <code class="literal">_lang_</code> notation and supports: arabic,
armenian, basque, brazilian, bulgarian, catalan, czech, danish, dutch,
english, finnish, french, galician, german, greek, hindi, hungarian,
indonesian, italian, norwegian, persian, portuguese, romanian, russian,
spanish, swedish, turkish.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-word-delimiter-tokenfilter"></a>Word Delimiter Token Filter</h2></div></div></div><p>Named <code class="literal">word_delimiter</code>, it Splits words into subwords and performs
optional transformations on subword groups. Words are split into
subwords with the following rules:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
split on intra-word delimiters (by default, all non alpha-numeric
characters).
</li><li class="listitem">
"Wi-Fi" â "Wi", "Fi"
</li><li class="listitem">
split on case transitions: "PowerShot" â "Power", "Shot"
</li><li class="listitem">
split on letter-number transitions: "SD500" â "SD", "500"
</li><li class="listitem">
leading and trailing intra-word delimiters on each subword are
ignored: "//hello---there, <span class="emphasis"><em>dude</em></span>" â "hello", "there", "dude"
</li><li class="listitem">
trailing "'s" are removed for each subword: "OâNeilâs" â "O", "Neil"
</li></ul></div><p>Parameters include:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">generate_word_parts</code>
</span></dt><dd>
    If <code class="literal">true</code> causes parts of words to be
    generated: "PowerShot" â "Power" "Shot". Defaults to <code class="literal">true</code>.
</dd><dt><span class="term">
<code class="literal">generate_number_parts</code>
</span></dt><dd>
    If <code class="literal">true</code> causes number subwords to be
    generated: "500-42" â "500" "42". Defaults to <code class="literal">true</code>.
</dd><dt><span class="term">
<code class="literal">catenate_words</code>
</span></dt><dd>
    If <code class="literal">true</code> causes maximum runs of word parts to be
    catenated: "wi-fi" â "wifi". Defaults to <code class="literal">false</code>.
</dd><dt><span class="term">
<code class="literal">catenate_numbers</code>
</span></dt><dd>
    If <code class="literal">true</code> causes maximum runs of number parts to
    be catenated: "500-42" â "50042". Defaults to <code class="literal">false</code>.
</dd><dt><span class="term">
<code class="literal">catenate_all</code>
</span></dt><dd>
    If <code class="literal">true</code> causes all subword parts to be catenated:
    "wi-fi-4000" â "wifi4000". Defaults to <code class="literal">false</code>.
</dd><dt><span class="term">
<code class="literal">split_on_case_change</code>
</span></dt><dd>
    If <code class="literal">true</code> causes "PowerShot" to be two tokens;
    ("Power-Shot" remains two parts regards). Defaults to <code class="literal">true</code>.
</dd><dt><span class="term">
<code class="literal">preserve_original</code>
</span></dt><dd>
    If <code class="literal">true</code> includes original words in subwords:
    "500-42" â "500-42" "500" "42". Defaults to <code class="literal">false</code>.
</dd><dt><span class="term">
<code class="literal">split_on_numerics</code>
</span></dt><dd>
    If <code class="literal">true</code> causes "j2se" to be three tokens; "j"
    "2" "se". Defaults to <code class="literal">true</code>.
</dd><dt><span class="term">
<code class="literal">stem_english_possessive</code>
</span></dt><dd>
    If <code class="literal">true</code> causes trailing "'s" to be
    removed for each subword: "OâNeilâs" â "O", "Neil". Defaults to <code class="literal">true</code>.
</dd></dl></div><p>Advance settings include:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">protected_words</code>
</span></dt><dd>
    A list of protected words from being delimiter.
    Either an array, or also can set <code class="literal">protected_words_path</code> which resolved
    to a file configured with protected words (one on each line).
    Automatically resolves to <code class="literal">config/</code> based location if exists.
</dd><dt><span class="term">
<code class="literal">type_table</code>
</span></dt><dd>
    A custom type mapping table, for example (when configured
    using <code class="literal">type_table_path</code>):
</dd></dl></div><pre class="programlisting prettyprint lang-js">    # Map the $, %, '.', and ',' characters to DIGIT
    # This might be useful for financial data.
    $ =&gt; DIGIT
    % =&gt; DIGIT
    . =&gt; DIGIT
    \\u002C =&gt; DIGIT

    # in some cases you might not want to split on ZWJ
    # this also tests the case where we need a bigger byte[]
    # see http://en.wikipedia.org/wiki/Zero-width_joiner
    \\u200D =&gt; ALPHANUM</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-stemmer-tokenfilter"></a>Stemmer Token Filter</h2></div></div></div><p>A filter that stems words (similar to <code class="literal">snowball</code>, but with more
options). The <code class="literal">language</code>/<code class="literal">name</code> parameter controls the stemmer with the
following available values:</p><p><a class="ulink" href="http://lucene.apache.org/core/4_3_0/analyzers-common/index.html?org%2Fapache%2Flucene%2Fanalysis%2Far%2FArabicStemmer.html" target="_top">arabic</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/armenian/stemmer.html" target="_top">armenian</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/basque/stemmer.html" target="_top">basque</a>,
<a class="ulink" href="http://lucene.apache.org/core/4_3_0/analyzers-common/index.html?org%2Fapache%2Flucene%2Fanalysis%2Fbr%2FBrazilianStemmer.html" target="_top">brazilian</a>,
<a class="ulink" href="http://members.unine.ch/jacques.savoy/Papers/BUIR.pdf" target="_top">bulgarian</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/catalan/stemmer.html" target="_top">catalan</a>,
<a class="ulink" href="http://portal.acm.org/citation.cfm?id=1598600" target="_top">czech</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/danish/stemmer.html" target="_top">danish</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/dutch/stemmer.html" target="_top">dutch</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/english/stemmer.html" target="_top">english</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/finnish/stemmer.html" target="_top">finnish</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/french/stemmer.html" target="_top">french</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/german/stemmer.html" target="_top">german</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/german2/stemmer.html" target="_top">german2</a>,
<a class="ulink" href="http://sais.se/mthprize/2007/ntais2007.pdf" target="_top">greek</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/hungarian/stemmer.html" target="_top">hungarian</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/italian/stemmer.html" target="_top">italian</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/kraaij_pohlmann/stemmer.html" target="_top">kp</a>,
<a class="ulink" href="http://ciir.cs.umass.edu/pubfiles/ir-35.pdf" target="_top">kstem</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/lovins/stemmer.html" target="_top">lovins</a>,
<a class="ulink" href="http://lucene.apache.org/core/4_3_0/analyzers-common/index.html?org%2Fapache%2Flucene%2Fanalysis%2Flv%2FLatvianStemmer.html" target="_top">latvian</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/norwegian/stemmer.html" target="_top">norwegian</a>,
<a class="ulink" href="http://lucene.apache.org/core/4_3_0/analyzers-common/index.html?org%2Fapache%2Flucene%2Fanalysis%2Fno%2FNorwegianMinimalStemFilter.html" target="_top">minimal_norwegian</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/porter/stemmer.html" target="_top">porter</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/portuguese/stemmer.html" target="_top">portuguese</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/romanian/stemmer.html" target="_top">romanian</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/russian/stemmer.html" target="_top">russian</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/spanish/stemmer.html" target="_top">spanish</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/swedish/stemmer.html" target="_top">swedish</a>,
<a class="ulink" href="http://snowball.tartarus.org/algorithms/turkish/stemmer.html" target="_top">turkish</a>,
<a class="ulink" href="http://www.medialab.tfe.umu.se/courses/mdm0506a/material/fulltext_ID%3D10049387%26PLACEBO%3DIE.pdf" target="_top">minimal_english</a>,
<a class="ulink" href="http://lucene.apache.org/core/4_3_0/analyzers-common/index.html?org%2Fapache%2Flucene%2Fanalysis%2Fen%2FEnglishPossessiveFilter.html" target="_top">possessive_english</a>,
<a class="ulink" href="http://clef.isti.cnr.it/2003/WN_web/22.pdf" target="_top">light_finnish</a>,
<a class="ulink" href="http://dl.acm.org/citation.cfm?id=1141523" target="_top">light_french</a>,
<a class="ulink" href="http://dl.acm.org/citation.cfm?id=318984" target="_top">minimal_french</a>,
<a class="ulink" href="http://dl.acm.org/citation.cfm?id=1141523" target="_top">light_german</a>,
<a class="ulink" href="http://members.unine.ch/jacques.savoy/clef/morpho.pdf" target="_top">minimal_german</a>,
<a class="ulink" href="http://computing.open.ac.uk/Sites/EACLSouthAsia/Papers/p6-Ramanathan.pdf" target="_top">hindi</a>,
<a class="ulink" href="http://dl.acm.org/citation.cfm?id=1141523&amp;dl=ACM&amp;coll=DL&amp;CFID=179095584&amp;CFTOKEN=80067181" target="_top">light_hungarian</a>,
<a class="ulink" href="http://www.illc.uva.nl/Publications/ResearchReports/MoL-2003-02.text.pdf" target="_top">indonesian</a>,
<a class="ulink" href="http://www.ercim.eu/publication/ws-proceedings/CLEF2/savoy.pdf" target="_top">light_italian</a>,
<a class="ulink" href="http://dl.acm.org/citation.cfm?id=1141523&amp;dl=ACM&amp;coll=DL&amp;CFID=179095584&amp;CFTOKEN=80067181" target="_top">light_portuguese</a>,
<a class="ulink" href="http://www.inf.ufrgs.br/~buriol/papers/Orengo_CLEF07.pdf" target="_top">minimal_portuguese</a>,
<a class="ulink" href="http://www.inf.ufrgs.br/\~viviane/rslp/index.htm" target="_top">portuguese</a>,
<a class="ulink" href="http://doc.rero.ch/lm.php?url=1000%2C43%2C4%2C20091209094227-CA%2FDolamic_Ljiljana_-_Indexing_and_Searching_Strategies_for_the_Russian_20091209.pdf" target="_top">light_russian</a>,
<a class="ulink" href="http://www.ercim.eu/publication/ws-proceedings/CLEF2/savoy.pdf" target="_top">light_spanish</a>,
<a class="ulink" href="http://clef.isti.cnr.it/2003/WN_web/22.pdf" target="_top">light_swedish</a>.</p><p>For example:</p><pre class="programlisting prettyprint lang-js">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "my_analyzer" : {
                    "tokenizer" : "standard",
                    "filter" : ["standard", "lowercase", "my_stemmer"]
                }
            },
            "filter" : {
                "my_stemmer" : {
                    "type" : "stemmer",
                    "name" : "light_german"
                }
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-stemmer-override-tokenfilter"></a>Stemmer Override Token Filter</h2></div></div></div><p>Overrides stemming algorithms, by applying a custom mapping, then
protecting these terms from being modified by stemmers. Must be placed
before any stemming filters.</p><p>Rules are separated by "â"</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">rules</code></p></td><td align="left" valign="top"><p>A list of mapping rules to use.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">rules_path</code></p></td><td align="left" valign="top"><p>A path (either relative to <code class="literal">config</code> location, or
absolute) to a list of mappings.</p></td></tr></tbody></table></div><p>Here is an example:</p><pre class="programlisting prettyprint lang-js">index :
    analysis :
        analyzer :
            myAnalyzer :
                type : custom
                tokenizer : standard
                filter : [lowercase, custom_stems, porter_stem]
        filter:
            custom_stems:
                type: stemmer_override
                rules_path : analysis/custom_stems.txt</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-keyword-marker-tokenfilter"></a>Keyword Marker Token Filter</h2></div></div></div><p>Protects words from being modified by stemmers. Must be placed before
any stemming filters.</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">keywords</code></p></td><td align="left" valign="top"><p>A list of words to use.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">keywords_path</code></p></td><td align="left" valign="top"><p>A path (either relative to <code class="literal">config</code> location, or
absolute) to a list of words.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ignore_case</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to lower case all words first. Defaults to
<code class="literal">false</code>.</p></td></tr></tbody></table></div><p>Here is an example:</p><pre class="programlisting prettyprint lang-js">index :
    analysis :
        analyzer :
            myAnalyzer :
                type : custom
                tokenizer : standard
                filter : [lowercase, protwods, porter_stem]
        filter :
            protwods :
                type : keyword_marker
                keywords_path : analysis/protwords.txt</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-keyword-repeat-tokenfilter"></a>Keyword Repeat Token Filter</h2></div></div></div><p>The <code class="literal">keyword_repeat</code> token filter Emits each incoming token twice once
as keyword and once as a non-keyword to allow an un-stemmed version of a
term to be indexed side by site to the stemmed version of the term.
Given the nature of this filter each token that isnât transformed by a
subsequent stemmer will be indexed twice. Therefore, consider adding a
<code class="literal">unique</code> filter with <code class="literal">only_on_same_position</code> set to <code class="literal">true</code> to drop
unnecessary duplicates.</p><p>Here is an example:</p><pre class="programlisting prettyprint lang-js">index :
    analysis :
        analyzer :
            myAnalyzer :
                type : custom
                tokenizer : standard
                filter : [lowercase, keyword_repeat, porter_stem, unique_stem]
            unique_stem:
                type: unique
                only_on_same_position : true</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-kstem-tokenfilter"></a>KStem Token Filter</h2></div></div></div><p>The <code class="literal">kstem</code> token filter is a high performance filter for english. All
terms must already be lowercased (use <code class="literal">lowercase</code> filter) for this
filter to work correctly.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-snowball-tokenfilter"></a>Snowball Token Filter</h2></div></div></div><p>A filter that stems words using a Snowball-generated stemmer. The
<code class="literal">language</code> parameter controls the stemmer with the following available
values: <code class="literal">Armenian</code>, <code class="literal">Basque</code>, <code class="literal">Catalan</code>, <code class="literal">Danish</code>, <code class="literal">Dutch</code>, <code class="literal">English</code>,
<code class="literal">Finnish</code>, <code class="literal">French</code>, <code class="literal">German</code>, <code class="literal">German2</code>, <code class="literal">Hungarian</code>, <code class="literal">Italian</code>, <code class="literal">Kp</code>,
<code class="literal">Lovins</code>, <code class="literal">Norwegian</code>, <code class="literal">Porter</code>, <code class="literal">Portuguese</code>, <code class="literal">Romanian</code>, <code class="literal">Russian</code>,
<code class="literal">Spanish</code>, <code class="literal">Swedish</code>, <code class="literal">Turkish</code>.</p><p>For example:</p><pre class="programlisting prettyprint lang-js">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "my_analyzer" : {
                    "tokenizer" : "standard",
                    "filter" : ["standard", "lowercase", "my_snow"]
                }
            },
            "filter" : {
                "my_snow" : {
                    "type" : "snowball",
                    "language" : "Lovins"
                }
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-phonetic-tokenfilter"></a>Phonetic Token Filter</h2></div></div></div><p>The <code class="literal">phonetic</code> token filter is provided as a plugin and located
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-analysis-phonetic" target="_top">here</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-synonym-tokenfilter"></a>Synonym Token Filter</h2></div></div></div><p>The <code class="literal">synonym</code> token filter allows to easily handle synonyms during the
analysis process. Synonyms are configured using a configuration file.
Here is an example:</p><pre class="programlisting prettyprint lang-js">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "synonym" : {
                    "tokenizer" : "whitespace",
                    "filter" : ["synonym"]
                }
            },
            "filter" : {
                "synonym" : {
                    "type" : "synonym",
                    "synonyms_path" : "analysis/synonym.txt"
                }
            }
        }
    }
}</pre><p>The above configures a <code class="literal">synonym</code> filter, with a path of
<code class="literal">analysis/synonym.txt</code> (relative to the <code class="literal">config</code> location). The
<code class="literal">synonym</code> analyzer is then configured with the filter. Additional
settings are: <code class="literal">ignore_case</code> (defaults to <code class="literal">false</code>), and <code class="literal">expand</code>
(defaults to <code class="literal">true</code>).</p><p>The <code class="literal">tokenizer</code> parameter controls the tokenizers that will be used to
tokenize the synonym, and defaults to the <code class="literal">whitespace</code> tokenizer.</p><p>Two synonym formats are supported: Solr, WordNet.</p><h4><a id="_solr_synonyms"></a>Solr synonyms</h4><p>The following is a sample format of the file:</p><pre class="programlisting prettyprint lang-js"># blank lines and lines starting with pound are comments.

#Explicit mappings match any token sequence on the LHS of "=&gt;"
#and replace with all alternatives on the RHS.  These types of mappings
#ignore the expand parameter in the schema.
#Examples:
i-pod, i pod =&gt; ipod,
sea biscuit, sea biscit =&gt; seabiscuit

#Equivalent synonyms may be separated with commas and give
#no explicit mapping.  In this case the mapping behavior will
#be taken from the expand parameter in the schema.  This allows
#the same synonym file to be used in different synonym handling strategies.
#Examples:
ipod, i-pod, i pod
foozball , foosball
universe , cosmos

# If expand==true, "ipod, i-pod, i pod" is equivalent to the explicit mapping:
ipod, i-pod, i pod =&gt; ipod, i-pod, i pod
# If expand==false, "ipod, i-pod, i pod" is equivalent to the explicit mapping:
ipod, i-pod, i pod =&gt; ipod

#multiple synonym mapping entries are merged.
foo =&gt; foo bar
foo =&gt; baz
#is equivalent to
foo =&gt; foo bar, baz</pre><p>You can also define synonyms for the filter directly in the
configuration file (note use of <code class="literal">synonyms</code> instead of <code class="literal">synonyms_path</code>):</p><pre class="programlisting prettyprint lang-js">{
    "filter" : {
        "synonym" : {
            "type" : "synonym",
            "synonyms" : [
                "i-pod, i pod =&gt; ipod",
                "universe, cosmos"
            ]
        }
    }
}</pre><p>However, it is recommended to define large synonyms set in a file using
<code class="literal">synonyms_path</code>.</p><h4><a id="_wordnet_synonyms"></a>WordNet synonyms</h4><p>Synonyms based on <a class="ulink" href="http://wordnet.princeton.edu/" target="_top">WordNet</a> format can be
declared using <code class="literal">format</code>:</p><pre class="programlisting prettyprint lang-js">{
    "filter" : {
        "synonym" : {
            "type" : "synonym",
            "format" : "wordnet",
            "synonyms" : [
                "s(100000001,1,'abstain',v,1,0).",
                "s(100000001,2,'refrain',v,1,0).",
                "s(100000001,3,'desist',v,1,0)."
            ]
        }
    }
}</pre><p>Using <code class="literal">synonyms_path</code> to define WordNet synonyms in a file is supported
as well.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-compound-word-tokenfilter"></a>Compound Word Token Filter</h2></div></div></div><p>Token filters that allow to decompose compound words. There are two
types available: <code class="literal">dictionary_decompounder</code> and
<code class="literal">hyphenation_decompounder</code>.</p><p>The following are settings that can be set for a compound word token
filter type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">word_list</code></p></td><td align="left" valign="top"><p>A list of words to use.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">word_list_path</code></p></td><td align="left" valign="top"><p>A path (either relative to <code class="literal">config</code> location, or
absolute) to a list of words.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">min_word_size</code></p></td><td align="left" valign="top"><p>Minimum word size(Integer). Defaults to 5.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">min_subword_size</code></p></td><td align="left" valign="top"><p>Minimum subword size(Integer). Defaults to 2.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_subword_size</code></p></td><td align="left" valign="top"><p>Maximum subword size(Integer). Defaults to 15.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">only_longest_match</code></p></td><td align="left" valign="top"><p>Only matching the longest(Boolean). Defaults to
<code class="literal">false</code></p></td></tr></tbody></table></div><p>Here is an example:</p><pre class="programlisting prettyprint lang-js">index :
    analysis :
        analyzer :
            myAnalyzer2 :
                type : custom
                tokenizer : standard
                filter : [myTokenFilter1, myTokenFilter2]
        filter :
            myTokenFilter1 :
                type : dictionary_decompounder
                word_list: [one, two, three]
            myTokenFilter2 :
                type : hyphenation_decompounder
                word_list_path: path/to/words.txt
                max_subword_size : 22</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-reverse-tokenfilter"></a>Reverse Token Filter</h2></div></div></div><p>A token filter of type <code class="literal">reverse</code> that simply reverses each token.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-elision-tokenfilter"></a>Elision Token Filter</h2></div></div></div><p>A token filter which removes elisions. For example, "lâavion" (the
plane) will tokenized as "avion" (plane).</p><p>Accepts <code class="literal">articles</code> setting which is a set of stop words articles. For
example:</p><pre class="programlisting prettyprint lang-js">"index" : {
    "analysis" : {
        "analyzer" : {
            "default" : {
                "tokenizer" : "standard",
                "filter" : ["standard", "elision"]
            }
        },
        "filter" : {
            "elision" : {
                "type" : "elision",
                "articles" : ["l", "m", "t", "qu", "n", "s", "j"]
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-truncate-tokenfilter"></a>Truncate Token Filter</h2></div></div></div><p>The <code class="literal">truncate</code> token filter can be used to truncate tokens into a
specific length. This can come in handy with keyword (single token)
based mapped fields that are used for sorting in order to reduce memory
usage.</p><p>It accepts a <code class="literal">length</code> parameter which control the number of characters
to truncate to, defaults to <code class="literal">10</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-unique-tokenfilter"></a>Unique Token Filter</h2></div></div></div><p>The <code class="literal">unique</code> token filter can be used to only index unique tokens during
analysis. By default it is applied on all the token stream. If
<code class="literal">only_on_same_position</code> is set to <code class="literal">true</code>, it will only remove duplicate
tokens on the same position.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-pattern-capture-tokenfilter"></a>Pattern Capture Token Filter</h2></div></div></div><p>The <code class="literal">pattern_capture</code> token filter, unlike the <code class="literal">pattern</code> tokenizer,
emits a token for every capture group in the regular expression.
Patterns are not anchored to the beginning and end of the string, so
each pattern can match multiple times, and matches are allowed to
overlap.</p><p>For instance a pattern like :</p><pre class="programlisting prettyprint lang-js">"(([a-z]+)(\d*))"</pre><p>when matched against:</p><pre class="programlisting prettyprint lang-js">"abc123def456"</pre><p>would produce the tokens: [ <code class="literal">abc123</code>, <code class="literal">abc</code>, <code class="literal">123</code>, <code class="literal">def456</code>, <code class="literal">def</code>,
<code class="literal">456</code> ]</p><p>If <code class="literal">preserve_original</code> is set to <code class="literal">true</code> (the default) then it would also
emit the original token: <code class="literal">abc123def456</code>.</p><p>This is particularly useful for indexing text like camel-case code, eg
<code class="literal">stripHTML</code> where a user may search for <code class="literal">"strip html"</code> or <code class="literal">"striphtml"</code>:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test/  -d '
{
   "settings" : {
      "analysis" : {
         "filter" : {
            "code" : {
               "type" : "pattern_capture",
               "preserve_original" : 1,
               "patterns" : [
                  "(\\p{Ll}+|\\p{Lu}\\p{Ll}+|\\p{Lu}+)",
                  "(\\d+)"
               ]
            }
         },
         "analyzer" : {
            "code" : {
               "tokenizer" : "pattern",
               "filter" : [ "code", "lowercase" ]
            }
         }
      }
   }
}
'</pre><p>When used to analyze the text</p><pre class="programlisting prettyprint lang-js">import static org.apache.commons.lang.StringEscapeUtils.escapeHtml</pre><p>this emits the tokens: [ <code class="literal">import</code>, <code class="literal">static</code>, <code class="literal">org</code>, <code class="literal">apache</code>, <code class="literal">commons</code>,
<code class="literal">lang</code>, <code class="literal">stringescapeutils</code>, <code class="literal">string</code>, <code class="literal">escape</code>, <code class="literal">utils</code>, <code class="literal">escapehtml</code>,
<code class="literal">escape</code>, <code class="literal">html</code> ]</p><p>Another example is analyzing email addresses:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test/  -d '
{
   "settings" : {
      "analysis" : {
         "filter" : {
            "email" : {
               "type" : "pattern_capture",
               "preserve_original" : 1,
               "patterns" : [
                  "(\\w+)",
                  "(\\p{L}+)",
                  "(\\d+)",
                  "@(.+)"
               ]
            }
         },
         "analyzer" : {
            "email" : {
               "tokenizer" : "uax_url_email",
               "filter" : [ "email", "lowercase",  "unique" ]
            }
         }
      }
   }
}
'</pre><p>When the above analyzer is used on an email address like:</p><pre class="programlisting prettyprint lang-js">john-smith_123@foo-bar.com</pre><p>it would produce the following tokens: [ <code class="literal">john-smith_123</code>,
<code class="literal">foo-bar.com</code>, <code class="literal">john</code>, <code class="literal">smith_123</code>, <code class="literal">smith</code>, <code class="literal">123</code>, <code class="literal">foo</code>,
<code class="literal">foo-bar.com</code>, <code class="literal">bar</code>, <code class="literal">com</code> ]</p><p>Multiple patterns are required to allow overlapping captures, but also
means that patterns are less dense and easier to understand.</p><p><span class="strong"><strong>Note:</strong></span> All tokens are emitted in the same position, and with the same
character offsets, so when combined with highlighting, the whole
original token will be highlighted, not just the matching subset. For
instance, querying the above email address for <code class="literal">"smith"</code> would
highlight:</p><pre class="programlisting prettyprint lang-js">  &lt;em&gt;john-smith_123@foo-bar.com&lt;/em&gt;</pre><p>not:</p><pre class="programlisting prettyprint lang-js">  john-&lt;em&gt;smith&lt;/em&gt;_123@foo-bar.com</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-pattern_replace-tokenfilter"></a>Pattern Replace Token Filter</h2></div></div></div><p>The <code class="literal">pattern_replace</code> token filter allows to easily handle string
replacements based on a regular expression. The regular expression is
defined using the <code class="literal">pattern</code> parameter, and the replacement string can be
provided using the <code class="literal">replacement</code> parameter (supporting referencing the
original text, as explained
<a class="ulink" href="http://docs.oracle.com/javase/6/docs/api/java/util/regex/Matcher.html#appendReplacement(java.lang.StringBuffer,%20java.lang.String)" target="_top">here</a>).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-trim-tokenfilter"></a>Trim Token Filter</h2></div></div></div><p>The <code class="literal">trim</code> token filter trims the whitespace surrounding a token.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-limit-token-count-tokenfilter"></a>Limit Token Count Token Filter</h2></div></div></div><p>Limits the number of tokens that are indexed per document and field.</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">max_token_count</code></p></td><td align="left" valign="top"><p>The maximum number of tokens that should be indexed
per document and field. The default is <code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">consume_all_tokens</code></p></td><td align="left" valign="top"><p>If set to <code class="literal">true</code> the filter exhaust the stream
even if <code class="literal">max_token_count</code> tokens have been consumed already. The default
is <code class="literal">false</code>.</p></td></tr></tbody></table></div><p>Here is an example:</p><pre class="programlisting prettyprint lang-js">index :
    analysis :
        analyzer :
            myAnalyzer :
                type : custom
                tokenizer : standard
                filter : [lowercase, five_token_limit]
        filter :
            five_token_limit :
                type : limit
                max_token_count : 5</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-hunspell-tokenfilter"></a>Hunspell Token Filter</h2></div></div></div><p>Basic support for hunspell stemming. Hunspell dictionaries will be
picked up from a dedicated hunspell directory on the filesystem
(defaults to <code class="literal">&lt;path.conf&gt;/hunspell</code>). Each dictionary is expected to
have its own directory named after its associated locale (language).
This dictionary directory is expected to hold both the *.aff and \*.dic
files (all of which will automatically be picked up). For example,
assuming the default hunspell location is used, the following directory
layout will define the <code class="literal">en_US</code> dictionary:</p><pre class="programlisting prettyprint lang-js">- conf
    |-- hunspell
    |    |-- en_US
    |    |    |-- en_US.dic
    |    |    |-- en_US.aff</pre><p>The location of the hunspell directory can be configured using the
<code class="literal">indices.analysis.hunspell.dictionary.location</code> settings in
<span class="emphasis"><em>elasticsearch.yml</em></span>.</p><p>Each dictionary can be configured with two settings:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">ignore_case</code>
</span></dt><dd>
    If true, dictionary matching will be case insensitive
    (defaults to <code class="literal">false</code>)
</dd><dt><span class="term">
<code class="literal">strict_affix_parsing</code>
</span></dt><dd>
    Determines whether errors while reading a
    affix rules file will cause exception or simple be ignored (defaults to
    <code class="literal">true</code>)
</dd></dl></div><p>These settings can be configured globally in <code class="literal">elasticsearch.yml</code> using</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">indices.analysis.hunspell.dictionary.ignore_case</code> and
</li><li class="listitem">
<code class="literal">indices.analysis.hunspell.dictionary.strict_affix_parsing</code>
</li></ul></div><p>or for specific dictionaries:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">indices.analysis.hunspell.dictionary.en_US.ignore_case</code> and
</li><li class="listitem">
<code class="literal">indices.analysis.hunspell.dictionary.en_US.strict_affix_parsing</code>.
</li></ul></div><p>It is also possible to add <code class="literal">settings.yml</code> file under the dictionary
directory which holds these settings (this will override any other
settings defined in the <code class="literal">elasticsearch.yml</code>).</p><p>One can use the hunspell stem filter by configuring it the analysis
settings:</p><pre class="programlisting prettyprint lang-js">{
    "analysis" : {
        "analyzer" : {
            "en" : {
                "tokenizer" : "standard",
                "filter" : [ "lowercase", "en_US" ]
            }
        },
        "filter" : {
            "en_US" : {
                "type" : "hunspell",
                "locale" : "en_US",
                "dedup" : true
            }
        }
    }
}</pre><p>The hunspell token filter accepts four options:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">locale</code>
</span></dt><dd>
    A locale for this filter. If this is unset, the <code class="literal">lang</code> or
    <code class="literal">language</code> are used instead - so one of these has to be set.
</dd><dt><span class="term">
<code class="literal">dictionary</code>
</span></dt><dd>
    The name of a dictionary. The path to your hunspell
    dictionaries should be configured via
    <code class="literal">indices.analysis.hunspell.dictionary.location</code> before.
</dd><dt><span class="term">
<code class="literal">dedup</code>
</span></dt><dd>
    If only unique terms should be returned, this needs to be
    set to <code class="literal">true</code>. Defaults to <code class="literal">true</code>.
</dd><dt><span class="term">
<code class="literal">recursion_level</code>
</span></dt><dd>
    Configures the recursion level a
    stemmer can go into. Defaults to <code class="literal">2</code>. Some languages (for example czech)
    give better results when set to <code class="literal">1</code> or <code class="literal">0</code>, so you should test it out.
</dd></dl></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>As opposed to the snowball stemmers (which are algorithm based)
this is a dictionary lookup based stemmer and therefore the quality of
the stemming is determined by the quality of the dictionary.</p></div></div><h4><a id="_references"></a>References</h4><p>Hunspell is a spell checker and morphological analyzer designed for
languages with rich morphology and complex word compounding and
character encoding.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Wikipedia, <a class="ulink" href="http://en.wikipedia.org/wiki/Hunspell" target="_top">http://en.wikipedia.org/wiki/Hunspell</a>
</li><li class="listitem">
Source code, <a class="ulink" href="http://hunspell.sourceforge.net/" target="_top">http://hunspell.sourceforge.net/</a>
</li><li class="listitem">
Open Office Hunspell dictionaries, <a class="ulink" href="http://wiki.openoffice.org/wiki/Dictionaries" target="_top">http://wiki.openoffice.org/wiki/Dictionaries</a>
</li><li class="listitem">
Mozilla Hunspell dictionaries, <a class="ulink" href="https://addons.mozilla.org/en-US/firefox/language-tools/" target="_top">https://addons.mozilla.org/en-US/firefox/language-tools/</a>
</li><li class="listitem">
Chromium Hunspell dictionaries,
   <a class="ulink" href="http://src.chromium.org/viewvc/chrome/trunk/deps/third_party/hunspell_dictionaries/" target="_top">http://src.chromium.org/viewvc/chrome/trunk/deps/third_party/hunspell_dictionaries/</a>
</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-common-grams-tokenfilter"></a>Common Grams Token Filter</h2></div></div></div><p>Token filter that generates bigrams for frequently occuring terms.
Single terms are still indexed. It can be used as an alternative to the
<a class="link" href="#analysis-stop-tokenfilter" title="Stop Token Filter">Stop Token Filter</a> when we donât want to completely ignore common terms.</p><p>For example, the text "the quick brown is a fox" will be tokenized as
"the", "the_quick", "quick", "brown", "brown_is", "is_a", "a_fox",
"fox". Assuming "the", "is" and "a" are common words.</p><p>When <code class="literal">query_mode</code> is enabled, the token filter removes common words and
single terms followed by a common word. This parameter should be enabled
in the search analyzer.</p><p>For example, the query "the quick brown is a fox" will be tokenized as
"the_quick", "quick", "brown_is", "is_a", "a_fox", "fox".</p><p>The following are settings that can be set:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">common_words</code></p></td><td align="left" valign="top"><p>A list of common words to use.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">common_words_path</code></p></td><td align="left" valign="top"><p>A path (either relative to <code class="literal">config</code> location, or
absolute) to a list of common words. Each word should be in its own
"line" (separated by a line break). The file must be UTF-8 encoded.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ignore_case</code></p></td><td align="left" valign="top"><p>If true, common words matching will be case insensitive
(defaults to <code class="literal">false</code>).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">query_mode</code></p></td><td align="left" valign="top"><p>Generates bigrams then removes common words and single
terms followed by a common word (defaults to <code class="literal">false</code>).</p></td></tr></tbody></table></div><p>Note, <code class="literal">common_words</code> or <code class="literal">common_words_path</code> field is required.</p><p>Here is an example:</p><pre class="programlisting prettyprint lang-js">index :
    analysis :
        analyzer :
            index_grams :
                tokenizer : whitespace
                filter : [common_grams]
            search_grams :
                tokenizer : whitespace
                filter : [common_grams_query]
        filter :
            common_grams :
                type : common_grams
                common_words: [a, an, the]
            common_grams_query :
                type : common_grams
                query_mode: true
                common_words: [a, an, the]</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-normalization-tokenfilter"></a>Normalization Token Filter</h2></div></div></div><p>There are several token filters available which try to normalize special
characters of a certain language.</p><p>You can currently choose between <code class="literal">arabic_normalization</code> and
<code class="literal">persian_normalization</code> normalization in your token filter
configuration. For more information check the
<a class="ulink" href="http://lucene.apache.org/core/4_3_1/analyzers-common/org/apache/lucene/analysis/ar/ArabicNormalizer.html" target="_top">ArabicNormalizer</a>
or the
<a class="ulink" href="http://lucene.apache.org/core/4_3_1/analyzers-common/org/apache/lucene/analysis/fa/PersianNormalizer.html" target="_top">PersianNormalizer</a>
documentation.</p><p><span class="strong"><strong>Note:</strong></span> These filters are available since <code class="literal">0.90.2</code></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-delimited-payload-tokenfilter"></a>Delimited Payload Token Filter</h2></div></div></div><p>Named <code class="literal">delimited_payload_filter</code>. Splits tokens into tokens and payload whenever a delimiter character is found.</p><p>Example: "the|1 quick|2 fox|3" is split per default int to tokens <code class="literal">fox</code>, <code class="literal">quick</code> and <code class="literal">the</code> with payloads <code class="literal">1</code>, <code class="literal">2</code> and <code class="literal">3</code> respectively.</p><p>Parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">delimiter</code>
</span></dt><dd>
    Character used for splitting the tokens. Default is <code class="literal">|</code>.
</dd><dt><span class="term">
<code class="literal">encoding</code>
</span></dt><dd>
    The type of the payload. <code class="literal">int</code> for integer, <code class="literal">float</code> for float and <code class="literal">identity</code> for characters. Default is <code class="literal">float</code>.
</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-keep-words-tokenfilter"></a>Keep Words Token Filter</h2></div></div></div><p>A token filter of type <code class="literal">keep</code> that only keeps tokens with text contained in a
predefined set of words. The set of words can be defined in the settings or
loaded from a text file containing one word per line.</p><h3><a id="_options_4"></a>Options</h3><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
keep_words
</p>
</td><td valign="top">
<p>
a list of words to keep
</p>
</td></tr><tr><td valign="top">
<p>
keep_words_path
</p>
</td><td valign="top">
<p>
a path to a words file
</p>
</td></tr><tr><td valign="top">
<p>
keep_words_case
</p>
</td><td valign="top">
<p>
a boolean indicating whether to lower case the words (defaults to <code class="literal">false</code>)
</p>
</td></tr></tbody></table></div><h3><a id="_settings_example"></a>Settings example</h3><pre class="programlisting prettyprint lang-js">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "my_analyzer" : {
                    "tokenizer" : "standard",
                    "filter" : ["standard", "lowercase", "words_till_three"]
                },
                "my_analyzer1" : {
                    "tokenizer" : "standard",
                    "filter" : ["standard", "lowercase", "words_on_file"]
                }
            },
            "filter" : {
                "words_till_three" : {
                    "type" : "keep",
                    "keep_words" : [ "one", "two", "three"]
                },
                "words_on_file" : {
                    "type" : "keep",
                    "keep_words_path" : "/path/to/word/file"
                }
            }
        }
    }
}</pre></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-charfilters"></a>Character Filters</h2></div></div></div><p>Character filters are used to preprocess the string of
characters before it is passed to the <a class="link" href="#analysis-tokenizers" title="Tokenizers">tokenizer</a>.
A character filter may be used to strip out HTML markup, , or to convert
<code class="literal">"&amp;"</code> characters to the word <code class="literal">"and"</code>.</p><p>Elasticsearch has built in characters filters which can be
used to build <a class="link" href="#analysis-custom-analyzer" title="Custom Analyzer">custom analyzers</a>.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-mapping-charfilter"></a>Mapping Char Filter</h2></div></div></div><p>A char filter of type <code class="literal">mapping</code> replacing characters of an analyzed text
with given mapping.</p><p>Here is a sample configuration:</p><pre class="programlisting prettyprint lang-js">{
    "index" : {
        "analysis" : {
            "char_filter" : {
                "my_mapping" : {
                    "type" : "mapping",
                    "mappings" : ["ph=&gt;f", "qu=&gt;q"]
                }
            },
            "analyzer" : {
                "custom_with_char_filter" : {
                    "tokenizer" : "standard",
                    "char_filter" : ["my_mapping"]
                },
            }
        }
    }
}</pre><p>Otherwise the setting <code class="literal">mappings_path</code> can specify a file where you can
put the list of char mapping :</p><pre class="programlisting prettyprint lang-js">ph =&gt; f
qu =&gt; k</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-htmlstrip-charfilter"></a>HTML Strip Char Filter</h2></div></div></div><p>A char filter of type <code class="literal">html_strip</code> stripping out HTML elements from an
analyzed text.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-pattern-replace-charfilter"></a>Pattern Replace Char Filter</h2></div></div></div><p>The <code class="literal">pattern_replace</code> char filter allows the use of a regex to
manipulate the characters in a string before analysis. The regular
expression is defined using the <code class="literal">pattern</code> parameter, and the replacement
string can be provided using the <code class="literal">replacement</code> parameter (supporting
referencing the original text, as explained
<a class="ulink" href="http://docs.oracle.com/javase/6/docs/api/java/util/regex/Matcher.html#appendReplacement(java.lang.StringBuffer,%20java.lang.String)" target="_top">here</a>).
For more information check the
<a class="ulink" href="http://lucene.apache.org/core/4_3_1/analyzers-common/org/apache/lucene/analysis/pattern/PatternReplaceCharFilter.html" target="_top">lucene
documentation</a></p><p>Here is a sample configuration:</p><pre class="programlisting prettyprint lang-js">{
    "index" : {
        "analysis" : {
            "char_filter" : {
                "my_pattern":{
                    "type":"pattern_replace",
                    "pattern":"sample(.*)",
                    "replacement":"replacedSample $1"
                }
            },
            "analyzer" : {
                "custom_with_char_filter" : {
                    "tokenizer" : "standard",
                    "char_filter" : ["my_pattern"]
                },
            }
        }
    }
}</pre></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-icu-plugin"></a>ICU Analysis Plugin</h2></div></div></div><p>The <a class="ulink" href="http://icu-project.org/" target="_top">ICU</a> analysis plugin allows for unicode
normalization, collation and folding. The plugin is called
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-analysis-icu" target="_top">elasticsearch-analysis-icu</a>.</p><p>The plugin includes the following analysis components:</p><h3><a id="icu-normalization"></a>ICU Normalization</h3><p>Normalizes characters as explained
<a class="ulink" href="http://userguide.icu-project.org/transforms/normalization" target="_top">here</a>. It
registers itself by default under <code class="literal">icu_normalizer</code> or <code class="literal">icuNormalizer</code>
using the default settings. Allows for the name parameter to be provided
which can include the following values: <code class="literal">nfc</code>, <code class="literal">nfkc</code>, and <code class="literal">nfkc_cf</code>.
Here is a sample settings:</p><pre class="programlisting prettyprint lang-js">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "normalization" : {
                    "tokenizer" : "keyword",
                    "filter" : ["icu_normalizer"]
                }
            }
        }
    }
}</pre><h3><a id="icu-folding"></a>ICU Folding</h3><p>Folding of unicode characters based on <code class="literal">UTR#30</code>. It registers itself
under <code class="literal">icu_folding</code> and <code class="literal">icuFolding</code> names.
The filter also does lowercasing, which means the lowercase filter can
normally be left out. Sample setting:</p><pre class="programlisting prettyprint lang-js">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "folding" : {
                    "tokenizer" : "keyword",
                    "filter" : ["icu_folding"]
                }
            }
        }
    }
}</pre><h4><a id="icu-filtering"></a>Filtering</h4><p>The folding can be filtered by a set of unicode characters with the
parameter <code class="literal">unicodeSetFilter</code>. This is useful for a non-internationalized
search engine where retaining a set of national characters which are
primary letters in a specific language is wanted. See syntax for the
UnicodeSet
<a class="ulink" href="http://icu-project.org/apiref/icu4j/com/ibm/icu/text/UnicodeSet.html" target="_top">here</a>.</p><p>The Following example exempts Swedish characters from the folding. Note
that the filtered characters are NOT lowercased which is why we add that
filter below.</p><pre class="programlisting prettyprint lang-js">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "folding" : {
                    "tokenizer" : "standard",
                    "filter" : ["my_icu_folding", "lowercase"]
                }
            }
            "filter" : {
                "my_icu_folding" : {
                    "type" : "icu_folding"
                    "unicodeSetFilter" : "[^Ã¥Ã¤Ã¶ÃÃÃ]"
                }
            }
        }
    }
}</pre><h3><a id="icu-collation"></a>ICU Collation</h3><p>Uses collation token filter. Allows to either specify the rules for
collation (defined
<a class="ulink" href="http://www.icu-project.org/userguide/Collate_Customization.html" target="_top">here</a>)
using the <code class="literal">rules</code> parameter (can point to a location or expressed in the
settings, location can be relative to config location), or using the
<code class="literal">language</code> parameter (further specialized by country and variant). By
default registers under <code class="literal">icu_collation</code> or <code class="literal">icuCollation</code> and uses the
default locale.</p><p>Here is a sample settings:</p><pre class="programlisting prettyprint lang-js">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "collation" : {
                    "tokenizer" : "keyword",
                    "filter" : ["icu_collation"]
                }
            }
        }
    }
}</pre><p>And here is a sample of custom collation:</p><pre class="programlisting prettyprint lang-js">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "collation" : {
                    "tokenizer" : "keyword",
                    "filter" : ["myCollator"]
                }
            },
            "filter" : {
                "myCollator" : {
                    "type" : "icu_collation",
                    "language" : "en"
                }
            }
        }
    }
}</pre><h4><a id="_options_5"></a>Options</h4><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">strength</code>
</p>
</td><td valign="top">
<p>
    The strength property determines the minimum level of difference considered significant during comparison.
     The default strength for the Collator is <code class="literal">tertiary</code>, unless specified otherwise by the locale used to create the Collator.
     Possible values: <code class="literal">primary</code>, <code class="literal">secondary</code>, <code class="literal">tertiary</code>, <code class="literal">quaternary</code> or <code class="literal">identical</code>.

 See <a class="ulink" href="http://icu-project.org/apiref/icu4j/com/ibm/icu/text/Collator.html" target="_top">ICU Collation</a> documentation for a more detailed
 explanation for the specific values.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">decomposition</code>
</p>
</td><td valign="top">
<p>
    Possible values: <code class="literal">no</code> or <code class="literal">canonical</code>. Defaults to <code class="literal">no</code>. Setting this decomposition property with
    <code class="literal">canonical</code> allows the Collator to handle un-normalized text properly, producing the same results as if the text were
    normalized. If <code class="literal">no</code> is set, it is the userâs responsibility to insure that all text is already in the appropriate form
    before a comparison or before getting a CollationKey. Adjusting decomposition mode allows the user to select between
    faster and more complete collation behavior. Since a great many of the worldâs languages do not require text
    normalization, most locales set <code class="literal">no</code> as the default decomposition mode.
</p>
</td></tr></tbody></table></div><h4><a id="_expert_options"></a>Expert options:</h4><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">alternate</code>
</p>
</td><td valign="top">
<p>
     Possible values: <code class="literal">shifted</code> or <code class="literal">non-ignorable</code>. Sets the alternate handling for strength <code class="literal">quaternary</code>
     to be either shifted or non-ignorable. What boils down to ignoring punctuation and whitespace.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">caseLevel</code>
</p>
</td><td valign="top">
<p>
    Possible values: <code class="literal">true</code> or <code class="literal">false</code>. Default is <code class="literal">false</code>. Whether case level sorting is required. When
     strength is set to <code class="literal">primary</code> this will ignore accent differences.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">caseFirst</code>
</p>
</td><td valign="top">
<p>
    Possible values: <code class="literal">lower</code> or <code class="literal">upper</code>. Useful to control which case is sorted first when case is not ignored
    for strength <code class="literal">tertiary</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">numeric</code>
</p>
</td><td valign="top">
<p>
    Possible values: <code class="literal">true</code> or <code class="literal">false</code>. Whether digits are sorted according to numeric representation. For
    example the value <code class="literal">egg-9</code> is sorted before the value <code class="literal">egg-21</code>. Defaults to <code class="literal">false</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">variableTop</code>
</p>
</td><td valign="top">
<p>
    Single character or contraction. Controls what is variable for <code class="literal">alternate</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">hiraganaQuaternaryMode</code>
</p>
</td><td valign="top">
<p>
    Possible values: <code class="literal">true</code> or <code class="literal">false</code>. Defaults to <code class="literal">false</code>. Distinguishing between Katakana and
    Hiragana characters in <code class="literal">quaternary</code> strength .
</p>
</td></tr></tbody></table></div><h3><a id="_icu_tokenizer"></a>ICU Tokenizer</h3><p>Breaks text into words according to UAX #29: Unicode Text Segmentation <a id="id-1.12.7.25.1" class="indexterm"></a><a class="ulink" href="http://www.unicode.org/reports/tr29/" target="_top">http://www.unicode.org/reports/tr29/</a>.</p><pre class="programlisting prettyprint lang-js">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "collation" : {
                    "tokenizer" : "icu_tokenizer",
                }
            }
        }
    }
}</pre></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="modules"></a>Modules</h1></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-cluster"></a>Cluster</h2></div></div></div><h3><a id="shards-allocation"></a>Shards Allocation</h3><p>Shards allocation is the process of allocating shards to nodes. This can
happen during initial recovery, replica allocation, rebalancing, or
handling nodes being added or removed.</p><p>The following settings may be used:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.routing.allocation.allow_rebalance</code>
</span></dt><dd>
        Allow to control when rebalancing will happen based on the total
        state of all the indices shards in the cluster. <code class="literal">always</code>,
        <code class="literal">indices_primaries_active</code>, and <code class="literal">indices_all_active</code> are allowed,
        defaulting to <code class="literal">indices_all_active</code> to reduce chatter during
        initial recovery.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.cluster_concurrent_rebalance</code>
</span></dt><dd>
      Allow to control how many concurrent rebalancing of shards are
      allowed cluster wide, and default it to <code class="literal">2</code>.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.node_initial_primaries_recoveries</code>
</span></dt><dd>
       Allow to control specifically the number of initial recoveries
       of primaries that are allowed per node. Since most times local
       gateway is used, those should be fast and we can handle more of
       those per node without creating load.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.node_concurrent_recoveries</code>
</span></dt><dd>
     How many concurrent recoveries are allowed to happen on a node.
     Defaults to <code class="literal">2</code>.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.enable</code>
</span></dt><dd><p class="simpara">
    Controls shard allocation for all indices, by allowing specific
    kinds of shard to be allocated.
    <span class="added">
      [<span class="version">1.0.0.RC1</span>]
      <span class="detail">Added in 1.0.0.RC1. Replaces <code class="literal">cluster.routing.allocation.disable*</code>.</span></span>
    Can be set to:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">all</code> (default) - Allows shard allocation for all kinds of shards.
</li><li class="listitem">
<code class="literal">primaries</code> - Allows shard allocation only for primary shards.
</li><li class="listitem">
<code class="literal">new_primaries</code> - Allows shard allocation only for primary shards for new indices.
</li><li class="listitem">
<code class="literal">none</code> - No shard allocations of any kind are allowed for all indices.
</li></ul></div></dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.disable_new_allocation</code>
</span></dt><dd>
    <span class="deprecated">
      [<span class="version">1.0.0.RC1</span>]
      <span class="detail">Deprecated in 1.0.0.RC1. Replaced by <code class="literal">cluster.routing.allocation.enable</code>.</span></span>
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.disable_allocation</code>
</span></dt><dd>
    <span class="deprecated">
      [<span class="version">1.0.0.RC1</span>]
      <span class="detail">Deprecated in 1.0.0.RC1. Replaced by <code class="literal">cluster.routing.allocation.enable</code>.</span></span>
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.disable_replica_allocation</code>
</span></dt><dd>
    <span class="deprecated">
      [<span class="version">1.0.0.RC1</span>]
      <span class="detail">Deprecated in 1.0.0.RC1. Replaced by <code class="literal">cluster.routing.allocation.enable</code>.</span></span>
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.same_shard.host</code>
</span></dt><dd>
      Allows to perform a check to prevent allocation of multiple instances
      of the same shard on a single host, based on host name and host address.
      Defaults to <code class="literal">false</code>, meaning that no check is performed by default. This
      setting only applies if multiple nodes are started on the same machine.
</dd><dt><span class="term">
<code class="literal">indices.recovery.concurrent_streams</code>
</span></dt><dd>
       The number of streams to open (on a <span class="strong"><strong>node</strong></span> level) to recover a
       shard from a peer shard. Defaults to <code class="literal">3</code>.
</dd></dl></div><h3><a id="allocation-awareness"></a>Shard Allocation Awareness</h3><p>Cluster allocation awareness allows to configure shard and replicas
allocation across generic attributes associated the nodes. Lets explain
it through an example:</p><p>Assume we have several racks. When we start a node, we can configure an
attribute called <code class="literal">rack_id</code> (any attribute name works), for example, here
is a sample config:</p><pre class="screen">node.rack_id: rack_one</pre><p>The above sets an attribute called <code class="literal">rack_id</code> for the relevant node with
a value of <code class="literal">rack_one</code>. Now, we need to configure the <code class="literal">rack_id</code> attribute
as one of the awareness allocation attributes (set it on <span class="strong"><strong>all</strong></span> (master
eligible) nodes config):</p><pre class="screen">cluster.routing.allocation.awareness.attributes: rack_id</pre><p>The above will mean that the <code class="literal">rack_id</code> attribute will be used to do
awareness based allocation of shard and its replicas. For example, lets
say we start 2 nodes with <code class="literal">node.rack_id</code> set to <code class="literal">rack_one</code>, and deploy a
single index with 5 shards and 1 replica. The index will be fully
deployed on the current nodes (5 shards and 1 replica each, total of 10
shards).</p><p>Now, if we start two more nodes, with <code class="literal">node.rack_id</code> set to <code class="literal">rack_two</code>,
shards will relocate to even the number of shards across the nodes, but,
a shard and its replica will not be allocated in the same <code class="literal">rack_id</code>
value.</p><p>The awareness attributes can hold several values, for example:</p><pre class="screen">cluster.routing.allocation.awareness.attributes: rack_id,zone</pre><p><span class="strong"><strong>NOTE</strong></span>: When using awareness attributes, shards will not be allocated to
nodes that donât have values set for those attributes.</p><h3><a id="forced-awareness"></a>Forced Awareness</h3><p>Sometimes, we know in advance the number of values an awareness
attribute can have, and more over, we would like never to have more
replicas then needed allocated on a specific group of nodes with the
same awareness attribute value. For that, we can force awareness on
specific attributes.</p><p>For example, lets say we have an awareness attribute called <code class="literal">zone</code>, and
we know we are going to have two zones, <code class="literal">zone1</code> and <code class="literal">zone2</code>. Here is how
we can force awareness on a node:</p><pre class="programlisting prettyprint lang-js">cluster.routing.allocation.awareness.force.zone.values: zone1,zone2
cluster.routing.allocation.awareness.attributes: zone</pre><p>Now, lets say we start 2 nodes with <code class="literal">node.zone</code> set to <code class="literal">zone1</code> and
create an index with 5 shards and 1 replica. The index will be created,
but only 5 shards will be allocated (with no replicas). Only when we
start more shards with <code class="literal">node.zone</code> set to <code class="literal">zone2</code> will the replicas be
allocated.</p><h4><a id="_automatic_preference_when_searching_geting"></a>Automatic Preference When Searching / GETing</h4><p>When executing a search, or doing a get, the node receiving the request
will prefer to execute the request on shards that exists on nodes that
have the same attribute values as the executing node.</p><h4><a id="_realtime_settings_update"></a>Realtime Settings Update</h4><p>The settings can be updated using the <a class="link" href="#cluster-update-settings" title="Cluster Update Settings">cluster update settings API</a> on a live cluster.</p><h3><a id="allocation-filtering"></a>Shard Allocation Filtering</h3><p>Allow to control allocation of indices on nodes based on include/exclude
filters. The filters can be set both on the index level and on the
cluster level. Lets start with an example of setting it on the cluster
level:</p><p>Lets say we have 4 nodes, each has specific attribute called <code class="literal">tag</code>
associated with it (the name of the attribute can be any name). Each
node has a specific value associated with <code class="literal">tag</code>. Node 1 has a setting
<code class="literal">node.tag: value1</code>, Node 2 a setting of <code class="literal">node.tag: value2</code>, and so on.</p><p>We can create an index that will only deploy on nodes that have <code class="literal">tag</code>
set to <code class="literal">value1</code> and <code class="literal">value2</code> by setting
<code class="literal">index.routing.allocation.include.tag</code> to <code class="literal">value1,value2</code>. For example:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test/_settings -d '{
      "index.routing.allocation.include.tag" : "value1,value2"
}'</pre><p>On the other hand, we can create an index that will be deployed on all
nodes except for nodes with a <code class="literal">tag</code> of value <code class="literal">value3</code> by setting
<code class="literal">index.routing.allocation.exclude.tag</code> to <code class="literal">value3</code>. For example:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test/_settings -d '{
      "index.routing.allocation.exclude.tag" : "value3"
}'</pre><p><code class="literal">index.routing.allocation.require.*</code> can be used to
specify a number of rules, all of which MUST match in order for a shard
to be  allocated to a node. This is in contrast to <code class="literal">include</code> which will
include a node if ANY rule matches.</p><p>The <code class="literal">include</code>, <code class="literal">exclude</code> and <code class="literal">require</code> values can have generic simple
matching wildcards, for example, <code class="literal">value1*</code>. A special attribute name
called <code class="literal">_ip</code> can be used to match on node ip values. In addition <code class="literal">_host</code>
attribute can be used to match on either the nodeâs hostname or its ip
address. Similarly <code class="literal">_name</code> and <code class="literal">_id</code> attributes can be used to match on
node name and node id accordingly.</p><p>Obviously a node can have several attributes associated with it, and
both the attribute name and value are controlled in the setting. For
example, here is a sample of several node configurations:</p><pre class="programlisting prettyprint lang-js">node.group1: group1_value1
node.group2: group2_value4</pre><p>In the same manner, <code class="literal">include</code>, <code class="literal">exclude</code> and <code class="literal">require</code> can work against
several attributes, for example:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test/_settings -d '{
    "index.routing.allocation.include.group1" : "xxx"
    "index.routing.allocation.include.group2" : "yyy",
    "index.routing.allocation.exclude.group3" : "zzz",
    "index.routing.allocation.require.group4" : "aaa"
}'</pre><p>The provided settings can also be updated in real time using the update
settings API, allowing to "move" indices (shards) around in realtime.</p><p>Cluster wide filtering can also be defined, and be updated in real time
using the cluster update settings API. This setting can come in handy
for things like decommissioning nodes (even if the replica count is set
to 0). Here is a sample of how to decommission a node based on <code class="literal">_ip</code>
address:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/_cluster/settings -d '{
    "transient" : {
        "cluster.routing.allocation.exclude._ip" : "10.0.0.1"
    }
}'</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-discovery"></a>Discovery</h2></div></div></div><p>The discovery module is responsible for discovering nodes within a
cluster, as well as electing a master node.</p><p>Note, Elasticsearch is a peer to peer based system, nodes communicate
with one another directly if operations are delegated / broadcast. All
the main APIs (index, delete, search) do not communicate with the master
node. The responsibility of the master node is to maintain the global
cluster state, and act if nodes join or leave the cluster by reassigning
shards. Each time a cluster state is changed, the state is made known to
the other nodes in the cluster (the manner depends on the actual
discovery implementation).</p><h3><a id="_settings"></a>Settings</h3><p>The <code class="literal">cluster.name</code> allows to create separated clusters from one another.
The default value for the cluster name is <code class="literal">elasticsearch</code>, though it is
recommended to change this to reflect the logical group name of the
cluster running.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="modules-discovery-azure"></a>Azure Discovery</h2></div></div></div><p>Azure discovery allows to use the Azure APIs to perform automatic discovery (similar to multicast).
Please check the <a class="ulink" href="https://github.com/elasticsearch/elasticsearch-cloud-azure" target="_top">plugin website</a>
to find the full documentation.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="modules-discovery-ec2"></a>EC2 Discovery</h2></div></div></div><p>EC2 discovery allows to use the EC2 APIs to perform automatic discovery (similar to multicast).
Please check the <a class="ulink" href="https://github.com/elasticsearch/elasticsearch-cloud-aws" target="_top">plugin website</a>
to find the full documentation.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="modules-discovery-gce"></a>Google Compute Engine Discovery</h2></div></div></div><p>Google Compute Engine (GCE) discovery allows to use the GCE APIs to perform automatic discovery (similar to multicast).
Please check the <a class="ulink" href="https://github.com/elasticsearch/elasticsearch-cloud-gce" target="_top">plugin website</a>
to find the full documentation.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="modules-discovery-zen"></a>Zen Discovery</h2></div></div></div><p>The zen discovery is the built in discovery module for elasticsearch and
the default. It provides both multicast and unicast discovery as well
being easily extended to support cloud environments.</p><p>The zen discovery is integrated with other modules, for example, all
communication between nodes is done using the
<a class="link" href="#modules-transport" title="Transport">transport</a> module.</p><p>It is separated into several sub modules, which are explained below:</p><h4><a id="ping"></a>Ping</h4><p>This is the process where a node uses the discovery mechanisms to find
other nodes. There is support for both multicast and unicast based
discovery (can be used in conjunction as well).</p><h5><a id="multicast"></a>Multicast</h5><p>Multicast ping discovery of other nodes is done by sending one or more
multicast requests where existing nodes that exists will receive and
respond to. It provides the following settings with the
<code class="literal">discovery.zen.ping.multicast</code> prefix:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">group</code></p></td><td align="left" valign="top"><p>The group address to use. Defaults to <code class="literal">224.2.2.4</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">port</code></p></td><td align="left" valign="top"><p>The port to use. Defaults to <code class="literal">54328</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ttl</code></p></td><td align="left" valign="top"><p>The ttl of the multicast message. Defaults to <code class="literal">3</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">address</code></p></td><td align="left" valign="top"><p>The address to bind to, defaults to <code class="literal">null</code> which means it
will bind to all available network interfaces.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">enabled</code></p></td><td align="left" valign="top"><p>Whether multicast ping discovery is enabled. Defaults to <code class="literal">true</code>.</p></td></tr></tbody></table></div><h5><a id="unicast"></a>Unicast</h5><p>The unicast discovery allows to perform the discovery when multicast is
not enabled. It basically requires a list of hosts to use that will act
as gossip routers. It provides the following settings with the
<code class="literal">discovery.zen.ping.unicast</code> prefix:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">hosts</code></p></td><td align="left" valign="top"><p>Either an array setting or a comma delimited setting. Each
value is either in the form of <code class="literal">host:port</code>, or in the form of
<code class="literal">host[port1-port2]</code>.</p></td></tr></tbody></table></div><p>The unicast discovery uses the
<a class="link" href="#modules-transport" title="Transport">transport</a> module to
perform the discovery.</p><h4><a id="master-election"></a>Master Election</h4><p>As part of the initial ping process a master of the cluster is either
elected or joined to. This is done automatically. The
<code class="literal">discovery.zen.ping_timeout</code> (which defaults to <code class="literal">3s</code>) allows to
configure the election to handle cases of slow or congested networks
(higher values assure less chance of failure).</p><p>Nodes can be excluded from becoming a master by setting <code class="literal">node.master</code> to
<code class="literal">false</code>. Note, once a node is a client node (<code class="literal">node.client</code> set to
<code class="literal">true</code>), it will not be allowed to become a master (<code class="literal">node.master</code> is
automatically set to <code class="literal">false</code>).</p><p>The <code class="literal">discovery.zen.minimum_master_nodes</code> allows to control the minimum
number of master eligible nodes a node should "see" in order to operate
within the cluster. Its recommended to set it to a higher value than 1
when running more than 2 nodes in the cluster.</p><h4><a id="fault-detection"></a>Fault Detection</h4><p>There are two fault detection processes running. The first is by the
master, to ping all the other nodes in the cluster and verify that they
are alive. And on the other end, each node pings to master to verify if
its still alive or an election process needs to be initiated.</p><p>The following settings control the fault detection process using the
<code class="literal">discovery.zen.fd</code> prefix:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">ping_interval</code></p></td><td align="left" valign="top"><p>How often a node gets pinged. Defaults to <code class="literal">1s</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ping_timeout</code></p></td><td align="left" valign="top"><p>How long to wait for a ping response, defaults to
<code class="literal">30s</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ping_retries</code></p></td><td align="left" valign="top"><p>How many ping failures / timeouts cause a node to be
considered failed. Defaults to <code class="literal">3</code>.</p></td></tr></tbody></table></div><h4><a id="_external_multicast"></a>External Multicast</h4><p>The multicast discovery also supports external multicast requests to
discover nodes. The external client can send a request to the multicast
IP/group and port, in the form of:</p><pre class="programlisting prettyprint lang-js">{
    "request" : {
        "cluster_name": "test_cluster"
    }
}</pre><p>And the response will be similar to node info response (with node level
information only, including transport/http addresses, and node
attributes):</p><pre class="programlisting prettyprint lang-js">{
    "response" : {
        "cluster_name" : "test_cluster",
        "transport_address" : "...",
        "http_address" : "...",
        "attributes" : {
            "..."
        }
    }
}</pre><p>Note, it can still be enabled, with disabled internal multicast
discovery, but still have external discovery working by keeping
<code class="literal">discovery.zen.ping.multicast.enabled</code> set to <code class="literal">true</code> (the default), but,
setting <code class="literal">discovery.zen.ping.multicast.ping.enabled</code> to <code class="literal">false</code>.</p><h4><a id="_cluster_state_updates"></a>Cluster state updates</h4><p>The master node is the only node in a cluster that can make changes to the
cluster state. The master node processes one cluster state update at a time,
applies the required changes and publishes the updated cluster state to all
the other nodes in the cluster. Each node receives the publish message,
updates its own cluster state and replies to the master node, which waits for
all nodes to respond, up to a timeout, before going ahead processing the next
updates in the queue. The <code class="literal">discovery.zen.publish_timeout</code> is set by default
to 30 seconds and can be changed dynamically through the
<a class="link" href="#cluster-update-settings" title="Cluster Update Settings">cluster update settings api</a> <span class="added">
      [<span class="version">1.1.0</span>]
      <span class="detail">Added in 1.1.0. The setting existed before but wasnât dynamic.</span></span>.</p></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-gateway"></a>Gateway</h2></div></div></div><p>The gateway module allows one to store the state of the cluster meta
data across full cluster restarts. The cluster meta data mainly holds
all the indices created with their respective (index level) settings and
explicit type mappings.</p><p>Each time the cluster meta data changes (for example, when an index is
added or deleted), those changes will be persisted using the gateway.
When the cluster first starts up, the state will be read from the
gateway and applied.</p><p>The gateway set on the node level will automatically control the index
gateway that will be used. For example, if the <code class="literal">fs</code> gateway is used,
then automatically, each index created on the node will also use its own
respective index level <code class="literal">fs</code> gateway. In this case, if an index should
not persist its state, it should be explicitly set to <code class="literal">none</code> (which is
the only other value it can be set to).</p><p>The default gateway used is the
<a class="link" href="#modules-gateway-local" title="Local Gateway">local</a> gateway.</p><h3><a id="recover-after"></a>Recovery After Nodes / Time</h3><p>In many cases, the actual cluster meta data should only be recovered
after specific nodes have started in the cluster, or a timeout has
passed. This is handy when restarting the cluster, and each node local
index storage still exists to be reused and not recovered from the
gateway (which reduces the time it takes to recover from the gateway).</p><p>The <code class="literal">gateway.recover_after_nodes</code> setting (which accepts a number)
controls after how many data and master eligible nodes within the
cluster recovery will start. The <code class="literal">gateway.recover_after_data_nodes</code> and
<code class="literal">gateway.recover_after_master_nodes</code> setting work in a similar fashion,
except they consider only the number of data nodes and only the number
of master nodes respectively. The <code class="literal">gateway.recover_after_time</code> setting
(which accepts a time value) sets the time to wait till recovery happens
once all <code class="literal">gateway.recover_after...nodes</code> conditions are met.</p><p>The <code class="literal">gateway.expected_nodes</code> allows to set how many data and master
eligible nodes are expected to be in the cluster, and once met, the
<code class="literal">recover_after_time</code> is ignored and recovery starts. The
<code class="literal">gateway.expected_data_nodes</code> and <code class="literal">gateway.expected_master_nodes</code>
settings are also supported. For example setting:</p><pre class="programlisting prettyprint lang-js">gateway:
    recover_after_nodes: 1
    recover_after_time: 5m
    expected_nodes: 2</pre><p>In an expected 2 nodes cluster will cause recovery to start 5 minutes
after the first node is up, but once there are 2 nodes in the cluster,
recovery will begin immediately (without waiting).</p><p>Note, once the meta data has been recovered from the gateway (which
indices to create, mappings and so on), then this setting is no longer
effective until the next full restart of the cluster.</p><p>Operations are blocked while the cluster meta data has not been
recovered in order not to mix with the actual cluster meta data that
will be recovered once the settings has been reached.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="modules-gateway-local"></a>Local Gateway</h2></div></div></div><p>The local gateway allows for recovery of the full cluster state and
indices from the local storage of each node, and does not require a
common node level shared storage.</p><p>Note, different from shared gateway types, the persistency to the local
gateway is <span class="strong"><strong>not</strong></span> done in an async manner. Once an operation is
performed, the data is there for the local gateway to recover it in case
of full cluster failure.</p><p>It is important to configure the <code class="literal">gateway.recover_after_nodes</code> setting
to include most of the expected nodes to be started after a full cluster
restart. This will insure that the latest cluster state is recovered.
For example:</p><pre class="programlisting prettyprint lang-js">gateway:
    recover_after_nodes: 1
    recover_after_time: 5m
    expected_nodes: 2</pre><h4><a id="_dangling_indices"></a>Dangling indices</h4><p>When a node joins the cluster, any shards/indices stored in its  local <code class="literal">data/</code>
directory which do not already exist in the cluster will be imported into the
cluster by default.  This functionality has two purposes:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
If a new master node is started which is unaware of the other indices in
   the cluster, adding the old nodes will cause the old indices to be
   imported, instead of being deleted.
</li><li class="listitem">
An old index can be added to an existing cluster by copying it to the
   <code class="literal">data/</code> directory of a new node, starting the node and letting it join
   the cluster. Once the index has been replicated to other nodes in the
   cluster, the new node can be shut down and removed.
</li></ol></div><p>The import of dangling indices can be controlled with the
<code class="literal">gateway.local.auto_import_dangled</code> which accepts:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">yes</code>
</p>
</td><td valign="top">
<p>
    Import dangling indices into the cluster (default).
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">close</code>
</p>
</td><td valign="top">
<p>
    Import dangling indices into the cluster state, but leave them closed.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">no</code>
</p>
</td><td valign="top">
<p>
    Delete dangling indices after <code class="literal">gateway.local.dangling_timeout</code>, which
    defaults to 2 hours.
</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="modules-gateway-fs"></a>Shared FS Gateway</h2></div></div></div><p><span class="strong"><strong>The shared FS gateway is deprecated and will be removed in a future
version. Please use the
<a class="link" href="#modules-gateway-local" title="Local Gateway">local gateway</a>
instead.</strong></span></p><p>The file system based gateway stores the cluster meta data and indices
in a <span class="strong"><strong>shared</strong></span> file system. Note, since it is a distributed system, the
file system should be shared between all different nodes. Here is an
example config to enable it:</p><pre class="programlisting prettyprint lang-js">gateway:
    type: fs</pre><h4><a id="_location"></a>location</h4><p>The location where the gateway stores the cluster state can be set using
the <code class="literal">gateway.fs.location</code> setting. By default, it will be stored under
the <code class="literal">work</code> directory. Note, the <code class="literal">work</code> directory is considered a
temporal directory with Elasticsearch (meaning it is safe to <code class="literal">rm -rf</code>
it), the default location of the persistent gateway in work intentional,
<span class="strong"><strong>it should be changed</strong></span>.</p><p>When explicitly specifying the <code class="literal">gateway.fs.location</code>, each node will
append its <code class="literal">cluster.name</code> to the provided location. It means that the
location provided can safely support several clusters.</p><h4><a id="_concurrent_streams"></a>concurrent_streams</h4><p>The <code class="literal">gateway.fs.concurrent_streams</code> allow to throttle the number of
streams (per node) opened against the shared gateway performing the
snapshot operation. It defaults to <code class="literal">5</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="modules-gateway-hadoop"></a>Hadoop Gateway</h2></div></div></div><p><span class="strong"><strong>The hadoop gateway is deprecated and will be removed in a future
version. Please use the
<a class="link" href="#modules-gateway-local" title="Local Gateway">local gateway</a>
instead.</strong></span></p><p>The hadoop (HDFS) based gateway stores the cluster meta and indices data
in hadoop. Hadoop support is provided as a plugin and installing is
explained <a class="ulink" href="https://github.com/elasticsearch/elasticsearch-hadoop" target="_top">here</a> or
downloading the hadoop plugin and placing it under the <code class="literal">plugins</code>
directory. Here is an example config to enable it:</p><pre class="programlisting prettyprint lang-js">gateway:
    type: hdfs
    hdfs:
        uri: hdfs://myhost:8022</pre><h4><a id="_settings_2"></a>Settings</h4><p>The hadoop gateway requires two simple settings. The <code class="literal">gateway.hdfs.uri</code>
controls the URI to connect to the hadoop cluster, for example:
<code class="literal">hdfs://myhost:8022</code>. The <code class="literal">gateway.hdfs.path</code> controls the path under
which the gateway will store the data.</p><h4><a id="_concurrent_streams_2"></a>concurrent_streams</h4><p>The <code class="literal">gateway.hdfs.concurrent_streams</code> allow to throttle the number of
streams (per node) opened against the shared gateway performing the
snapshot operation. It defaults to <code class="literal">5</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="modules-gateway-s3"></a>S3 Gateway</h2></div></div></div><p><span class="strong"><strong>The S3 gateway is deprecated and will be removed in a future version.
Please use the <a class="link" href="#modules-gateway-local" title="Local Gateway">local gateway</a> instead.</strong></span></p><p>S3 based gateway allows to do long term reliable async persistency of
the cluster state and indices directly to Amazon S3. Here is how it can
be configured:</p><pre class="programlisting prettyprint lang-js">cloud:
    aws:
        access_key: AKVAIQBF2RECL7FJWGJQ
        secret_key: vExyMThREXeRMm/b/LRzEB8jWwvzQeXgjqMX+6br


gateway:
    type: s3
    s3:
        bucket: bucket_name</pre><p>YouÃ¢â¬â¢ll need to install the <code class="literal">cloud-aws</code> plugin, by running
<code class="literal">bin/plugin install cloud-aws</code> before (re)starting elasticsearch.</p><p>The following are a list of settings (prefixed with <code class="literal">gateway.s3</code>) that
can further control the S3 gateway:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">chunk_size</code></p></td><td align="left" valign="top"><p>Big files are broken down into chunks (to overcome AWS 5g
limit and use concurrent snapshotting). Default set to <code class="literal">100m</code>.</p></td></tr></tbody></table></div><h4><a id="_concurrent_streams_3"></a>concurrent_streams</h4><p>The <code class="literal">gateway.s3.concurrent_streams</code> allow to throttle the number of
streams (per node) opened against the shared gateway performing the
snapshot operation. It defaults to <code class="literal">5</code>.</p><h4><a id="_region"></a>Region</h4><p>The <code class="literal">cloud.aws.region</code> can be set to a region and will automatically use
the relevant settings for both <code class="literal">ec2</code> and <code class="literal">s3</code>. The available values are:
<code class="literal">us-east-1</code>, <code class="literal">us-west-1</code>, <code class="literal">ap-southeast-1</code>, <code class="literal">eu-west-1</code>.</p></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-http"></a>HTTP</h2></div></div></div><p>The http module allows to expose <span class="strong"><strong>elasticsearch</strong></span> APIs
over HTTP.</p><p>The http mechanism is completely asynchronous in nature, meaning that
there is no blocking thread waiting for a response. The benefit of using
asynchronous communication for HTTP is solving the
<a class="ulink" href="http://en.wikipedia.org/wiki/C10k_problem" target="_top">C10k problem</a>.</p><p>When possible, consider using
<a class="ulink" href="http://en.wikipedia.org/wiki/Keepalive#HTTP_Keepalive" target="_top">HTTP keep alive</a>
when connecting for better performance and try to get your favorite
client not to do
<a class="ulink" href="http://en.wikipedia.org/wiki/Chunked_transfer_encoding" target="_top">HTTP chunking</a>.</p><h3><a id="_settings_3"></a>Settings</h3><p>The following are the settings the can be configured for HTTP:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">http.port</code></p></td><td align="left" valign="top"><p>A bind port range. Defaults to <code class="literal">9200-9300</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">http.max_content_length</code></p></td><td align="left" valign="top"><p>The max content of an HTTP request. Defaults
to <code class="literal">100mb</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">http.max_initial_line_length</code></p></td><td align="left" valign="top"><p>The max length of an HTTP URL. Defaults
to <code class="literal">4kb</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">http.compression</code></p></td><td align="left" valign="top"><p>Support for compression when possible (with
Accept-Encoding). Defaults to <code class="literal">false</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">http.compression_level</code></p></td><td align="left" valign="top"><p>Defines the compression level to use.
Defaults to <code class="literal">6</code>.</p></td></tr></tbody></table></div><p>It also uses the common
<a class="link" href="#modules-network" title="Network Settings">network settings</a>.</p><h3><a id="_disable_http"></a>Disable HTTP</h3><p>The http module can be completely disabled and not started by setting
<code class="literal">http.enabled</code> to <code class="literal">false</code>. This make sense when creating non
<a class="link" href="#modules-node" title="Node">data nodes</a> which accept HTTP
requests, and communicate with data nodes using the internal
<a class="link" href="#modules-transport" title="Transport">transport</a>.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-indices"></a>Indices</h2></div></div></div><p>The indices module allow to control settings that are globally managed
for all indices.</p><h3><a id="buffer"></a>Indexing Buffer</h3><p>The indexing buffer setting allows to control how much memory will be
allocated for the indexing process. It is a global setting that bubbles
down to all the different shards allocated on a specific node.</p><p>The <code class="literal">indices.memory.index_buffer_size</code> accepts either a percentage or a
byte size value. It defaults to <code class="literal">10%</code>, meaning that <code class="literal">10%</code> of the total
memory allocated to a node will be used as the indexing buffer size.
This amount is then divided between all the different shards. Also, if
percentage is used, it is possible to set <code class="literal">min_index_buffer_size</code> (defaults to
<code class="literal">48mb</code>) and <code class="literal">max_index_buffer_size</code> (defaults to unbounded).</p><p>The <code class="literal">indices.memory.min_shard_index_buffer_size</code> allows to set a hard
lower limit for the memory allocated per shard for its own indexing
buffer. It defaults to <code class="literal">4mb</code>.</p><h3><a id="indices-ttl"></a>TTL interval</h3><p>You can dynamically set the <code class="literal">indices.ttl.interval</code>, which allows to set how
often expired documents will be automatically deleted. The default value
is 60s.</p><p>The deletion orders are processed by bulk. You can set
<code class="literal">indices.ttl.bulk_size</code> to fit your needs. The default value is 10000.</p><p>See also <a class="xref" href="#mapping-ttl-field" title="_ttl"><code class="literal">_ttl</code></a>.</p><h3><a id="recovery"></a>Recovery</h3><p>The following settings can be set to manage the recovery policy:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">indices.recovery.concurrent_streams</code>
</p>
</td><td valign="top">
<p>
    defaults to <code class="literal">3</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">indices.recovery.file_chunk_size</code>
</p>
</td><td valign="top">
<p>
    defaults to <code class="literal">512kb</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">indices.recovery.translog_ops</code>
</p>
</td><td valign="top">
<p>
    defaults to <code class="literal">1000</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">indices.recovery.translog_size</code>
</p>
</td><td valign="top">
<p>
    defaults to <code class="literal">512kb</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">indices.recovery.compress</code>
</p>
</td><td valign="top">
<p>
    defaults to <code class="literal">true</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">indices.recovery.max_bytes_per_sec</code>
</p>
</td><td valign="top">
<p>
    defaults to <code class="literal">20mb</code>.
</p>
</td></tr></tbody></table></div><h3><a id="throttling"></a>Store level throttling</h3><p>The following settings can be set to control the store throttling:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">indices.store.throttle.type</code>
</p>
</td><td valign="top">
<p>
    could be <code class="literal">merge</code> (default), <code class="literal">not</code> or <code class="literal">all</code>. See <a class="xref" href="#index-modules-store" title="Store"><em>Store</em></a>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">indices.store.throttle.max_bytes_per_sec</code>
</p>
</td><td valign="top">
<p>
    defaults to <code class="literal">20mb</code>.
</p>
</td></tr></tbody></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-memcached"></a>memcached</h2></div></div></div><p>The memcached module allows to expose <span class="strong"><strong>elasticsearch</strong></span>
APIs over the memcached protocol (as closely
as possible).</p><p>It is provided as a plugin called <code class="literal">transport-memcached</code> and installing
is explained
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-transport-memcached" target="_top">here</a>
. Another option is to download the memcached plugin and placing it
under the <code class="literal">plugins</code> directory.</p><p>The memcached protocol supports both the binary and the text protocol,
automatically detecting the correct one to use.</p><h3><a id="_mapping_rest_to_memcached_protocol"></a>Mapping REST to Memcached Protocol</h3><p>Memcached commands are mapped to REST and handled by the same generic
REST layer in elasticsearch. Here is a list of the memcached commands
supported:</p><h4><a id="_get"></a>GET</h4><p>The memcached <code class="literal">GET</code> command maps to a REST <code class="literal">GET</code>. The key used is the
URI (with parameters). The main downside is the fact that the memcached
<code class="literal">GET</code> does not allow body in the request (and <code class="literal">SET</code> does not allow to
return a resultâ¦). For this reason, most REST APIs (like search) allow
to accept the "source" as a URI parameter as well.</p><h4><a id="_set"></a>SET</h4><p>The memcached <code class="literal">SET</code> command maps to a REST <code class="literal">POST</code>. The key used is the
URI (with parameters), and the body maps to the REST body.</p><h4><a id="_delete"></a>DELETE</h4><p>The memcached <code class="literal">DELETE</code> command maps to a REST <code class="literal">DELETE</code>. The key used is
the URI (with parameters).</p><h4><a id="_quit"></a>QUIT</h4><p>The memcached <code class="literal">QUIT</code> command is supported and disconnects the client.</p><h3><a id="_settings_4"></a>Settings</h3><p>The following are the settings the can be configured for memcached:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">memcached.port</code></p></td><td align="left" valign="top"><p>A bind port range. Defaults to <code class="literal">11211-11311</code>.</p></td></tr></tbody></table></div><p>It also uses the common
<a class="link" href="#modules-network" title="Network Settings">network settings</a>.</p><h3><a id="_disable_memcached"></a>Disable memcached</h3><p>The memcached module can be completely disabled and not started using by
setting <code class="literal">memcached.enabled</code> to <code class="literal">false</code>. By default it is enabled once it
is detected as a plugin.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-network"></a>Network Settings</h2></div></div></div><p>There are several modules within a Node that use network based
configuration, for example, the
<a class="link" href="#modules-transport" title="Transport">transport</a> and
<a class="link" href="#modules-http" title="HTTP">http</a> modules. Node level
network settings allows to set common settings that will be shared among
all network based modules (unless explicitly overridden in each module).</p><p>The <code class="literal">network.bind_host</code> setting allows to control the host different
network components will bind on. By default, the bind host will be
<code class="literal">anyLocalAddress</code> (typically <code class="literal">0.0.0.0</code> or <code class="literal">::0</code>).</p><p>The <code class="literal">network.publish_host</code> setting allows to control the host the node
will publish itself within the cluster so other nodes will be able to
connect to it. Of course, this canât be the <code class="literal">anyLocalAddress</code>, and by
default, it will be the first non loopback address (if possible), or the
local address.</p><p>The <code class="literal">network.host</code> setting is a simple setting to automatically set both
<code class="literal">network.bind_host</code> and <code class="literal">network.publish_host</code> to the same host value.</p><p>Both settings allows to be configured with either explicit host address
or host name. The settings also accept logical setting values explained
in the following table:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Logical Host Setting Value </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">_local_</code></p></td><td align="left" valign="top"><p>Will be resolved to the local ip address.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_non_loopback_</code></p></td><td align="left" valign="top"><p>The first non loopback address.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_non_loopback:ipv4_</code></p></td><td align="left" valign="top"><p>The first non loopback IPv4 address.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_non_loopback:ipv6_</code></p></td><td align="left" valign="top"><p>The first non loopback IPv6 address.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_[networkInterface]_</code></p></td><td align="left" valign="top"><p>Resolves to the ip address of the provided
network interface. For example <code class="literal">_en0_</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_[networkInterface]:ipv4_</code></p></td><td align="left" valign="top"><p>Resolves to the ipv4 address of the
provided network interface. For example <code class="literal">_en0:ipv4_</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_[networkInterface]:ipv6_</code></p></td><td align="left" valign="top"><p>Resolves to the ipv6 address of the
provided network interface. For example <code class="literal">_en0:ipv6_</code>.</p></td></tr></tbody></table></div><p>When the <code class="literal">cloud-aws</code> plugin is installed, the following are also allowed
as valid network host settings:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">EC2 Host Value </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">_ec2:privateIpv4_</code></p></td><td align="left" valign="top"><p>The private IP address (ipv4) of the machine.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_ec2:privateDns_</code></p></td><td align="left" valign="top"><p>The private host of the machine.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_ec2:publicIpv4_</code></p></td><td align="left" valign="top"><p>The public IP address (ipv4) of the machine.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_ec2:publicDns_</code></p></td><td align="left" valign="top"><p>The public host of the machine.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_ec2_</code></p></td><td align="left" valign="top"><p>Less verbose option for the private ip address.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_ec2:privateIp_</code></p></td><td align="left" valign="top"><p>Less verbose option for the private ip address.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_ec2:publicIp_</code></p></td><td align="left" valign="top"><p>Less verbose option for the public ip address.</p></td></tr></tbody></table></div><h3><a id="tcp-settings"></a>TCP Settings</h3><p>Any component that uses TCP (like the HTTP, Transport and Memcached)
share the following allowed settings:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">network.tcp.no_delay</code></p></td><td align="left" valign="top"><p>Enable or disable tcp no delay setting.
Defaults to <code class="literal">true</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">network.tcp.keep_alive</code></p></td><td align="left" valign="top"><p>Enable or disable tcp keep alive. By default
not explicitly set.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">network.tcp.reuse_address</code></p></td><td align="left" valign="top"><p>Should an address be reused or not.
Defaults to <code class="literal">true</code> on none windows machines.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">network.tcp.send_buffer_size</code></p></td><td align="left" valign="top"><p>The size of the tcp send buffer size
(in size setting format). By default not explicitly set.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">network.tcp.receive_buffer_size</code></p></td><td align="left" valign="top"><p>The size of the tcp receive buffer
size (in size setting format). By default not explicitly set.</p></td></tr></tbody></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-node"></a>Node</h2></div></div></div><p><span class="strong"><strong>elasticsearch</strong></span> allows to configure a node to either be allowed to store
data locally or not. Storing data locally basically means that shards of
different indices are allowed to be allocated on that node. By default,
each node is considered to be a data node, and it can be turned off by
setting <code class="literal">node.data</code> to <code class="literal">false</code>.</p><p>This is a powerful setting allowing to simply create smart load
balancers that take part in some of different API processing. Lets take
an example:</p><p>We can start a whole cluster of data nodes which do not even start an
HTTP transport by setting <code class="literal">http.enabled</code> to <code class="literal">false</code>. Such nodes will
communicate with one another using the
<a class="link" href="#modules-transport" title="Transport">transport</a> module. In front
of the cluster we can start one or more "non data" nodes which will
start with HTTP enabled. All HTTP communication will be performed
through these "non data" nodes.</p><p>The benefit of using that is first the ability to create smart load
balancers. These "non data" nodes are still part of the cluster, and
they redirect operations exactly to the node that holds the relevant
data. The other benefit is the fact that for scatter / gather based
operations (such as search), these nodes will take part of the
processing since they will start the scatter process, and perform the
actual gather processing.</p><p>This relieves the data nodes to do the heavy duty of indexing and
searching, without needing to process HTTP requests (parsing), overload
the network, or perform the gather processing.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-tribe"></a>Tribe node</h2></div></div></div><p>The <span class="emphasis"><em>tribes</em></span> feature allows a <span class="emphasis"><em>tribe node</em></span> to act as a federated client across
multiple clusters.</p><p>The tribe node works by retrieving the cluster state from all connected
clusters and merging them into a global cluster state. With this information
at hand, it is able to perform read and write operations against the nodes in
all clusters as if they were local.</p><p>The <code class="literal">elasticsearch.yml</code> config file for a tribe node just needs to list the
clusters that should be joined, for instance:</p><pre class="programlisting prettyprint lang-yaml">tribe:
    t1: <a id="CO33-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        cluster.name:   cluster_one
    t2: <a id="CO33-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        cluster.name:   cluster_two</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> <a href="#CO33-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">t1</code> and <code class="literal">t2</code> are aribitrary names representing the connection to each
    cluster.
</p></td></tr></table></div><p>The example above configures connections to two clusters, name <code class="literal">t1</code> and <code class="literal">t2</code>
respectively.  The tribe node will create a <a class="link" href="#modules-node" title="Node">node client</a> to
connect each cluster using <a class="link" href="#multicast" title="Multicast">multicast discovery</a> by default. Any
other settings for the connection can be configured under <code class="literal">tribe.{name}</code>, just
like the <code class="literal">cluster.name</code> in the example.</p><p>The merged global cluster state means that almost all operations work in the
same way as a single cluster: distributed search, suggest, percolation,
indexing, etc.</p><p>However, there are a few exceptions:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The merged view cannot handle indices with the same name in multiple
  clusters. It will pick one of them and discard the other.
</li><li class="listitem">
Master level read operations (eg <a class="xref" href="#cluster-state" title="Cluster State"><em>Cluster State</em></a>, <a class="xref" href="#cluster-health" title="Cluster Health"><em>Cluster Health</em></a>)
  will automatically execute with a local flag set to true since there is
  no master.
</li><li class="listitem">
Master level write operations (eg <a class="xref" href="#indices-create-index" title="Create Index"><em>Create Index</em></a>) are not
  allowed. These should be performed on a single cluster.
</li></ul></div><p>The tribe node can be configured to block all write operations and all
metadata operations with:</p><pre class="programlisting prettyprint lang-yaml">tribe:
    blocks:
        write:    true
        metadata: true</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-plugins"></a>Plugins</h2></div></div></div><h3><a id="_plugins"></a>Plugins</h3><p>Plugins are a way to enhance the basic elasticsearch functionality in a
custom manner. They range from adding custom mapping types, custom
analyzers (in a more built in fashion), native scripts, custom discovery
and more.</p><h4><a id="installing"></a>Installing plugins</h4><p>Installing plugins can either be done manually by placing them under the
<code class="literal">plugins</code> directory, or using the <code class="literal">plugin</code> script. Several plugins can
be found under the <a class="ulink" href="https://github.com/elasticsearch" target="_top">elasticsearch</a>
organization in GitHub, starting with <code class="literal">elasticsearch-</code>.</p><p>Installing plugins typically take the following form:</p><pre class="programlisting prettyprint lang-shell">plugin --install &lt;org&gt;/&lt;user/component&gt;/&lt;version&gt;</pre><p>The plugins will be
automatically downloaded in this case from <code class="literal">download.elasticsearch.org</code>,
and in case they donât exist there, from maven (central and sonatype).</p><p>Note that when the plugin is located in maven central or sonatype
repository, <code class="literal">&lt;org&gt;</code> is the artifact <code class="literal">groupId</code> and <code class="literal">&lt;user/component&gt;</code> is
the <code class="literal">artifactId</code>.</p><p>A plugin can also be installed directly by specifying the URL for it,
for example:</p><pre class="programlisting prettyprint lang-shell">bin/plugin --url file:///path/to/plugin --install plugin-name</pre><p>You can run <code class="literal">bin/plugin -h</code>.</p><h4><a id="site-plugins"></a>Site Plugins</h4><p>Plugins can have "sites" in them, any plugin that exists under the
<code class="literal">plugins</code> directory with a <code class="literal">_site</code> directory, its content will be
statically served when hitting <code class="literal">/_plugin/[plugin_name]/</code> url. Those can
be added even after the process has started.</p><p>Installed plugins that do not contain any java related content, will
automatically be detected as site plugins, and their content will be
moved under <code class="literal">_site</code>.</p><p>The ability to install plugins from Github allows to easily install site
plugins hosted there by downloading the actual repo, for example,
running:</p><pre class="programlisting prettyprint lang-js">bin/plugin --install mobz/elasticsearch-head
bin/plugin --install lukas-vlcek/bigdesk</pre><p>Will install both of those site plugins, with <code class="literal">elasticsearch-head</code>
available under <code class="literal">http://localhost:9200/_plugin/head/</code> and <code class="literal">bigdesk</code>
available under <code class="literal">http://localhost:9200/_plugin/bigdesk/</code>.</p><h4><a id="_mandatory_plugins"></a>Mandatory Plugins</h4><p>If you rely on some plugins, you can define mandatory plugins using the
<code class="literal">plugin.mandatory</code> attribute, for example, here is a sample config:</p><pre class="programlisting prettyprint lang-js">plugin.mandatory: mapper-attachments,lang-groovy</pre><p>For safety reasons, if a mandatory plugin is not installed, the node
will not start.</p><h4><a id="_installed_plugins"></a>Installed Plugins</h4><p>A list of the currently loaded plugins can be retrieved using the
<a class="link" href="#cluster-nodes-info" title="Nodes Info">Node Info API</a>.</p><h4><a id="_removing_plugins"></a>Removing plugins</h4><p>Removing plugins can either be done manually by removing them under the
<code class="literal">plugins</code> directory, or using the <code class="literal">plugin</code> script.</p><p>Removing plugins typically take the following form:</p><pre class="programlisting prettyprint lang-shell">plugin --remove &lt;pluginname&gt;</pre><h4><a id="_silent_verbose_mode"></a>Silent/Verbose mode</h4><p>When running the <code class="literal">plugin</code> script, you can get more information (debug mode) using <code class="literal">--verbose</code>.
On the opposite, if you want <code class="literal">plugin</code> script to be silent, use <code class="literal">--silent</code> option.</p><p>Note that exit codes could be:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">0</code>: everything was OK
</li><li class="listitem">
<code class="literal">64</code>: unknown command or incorrect option parameter
</li><li class="listitem">
<code class="literal">74</code>: IO error
</li><li class="listitem">
<code class="literal">70</code>: other errors
</li></ul></div><pre class="programlisting prettyprint lang-shell">bin/plugin --install mobz/elasticsearch-head --verbose
plugin --remove head --silent</pre><h4><a id="_timeout_settings"></a>Timeout settings</h4><p>By default, the <code class="literal">plugin</code> script will wait indefinitely when downloading before failing.
The timeout parameter can be used to explicitly specify how long it waits. Here is some examples of setting it to
different values:</p><pre class="programlisting prettyprint lang-shell"># Wait for 30 seconds before failing
bin/plugin --install mobz/elasticsearch-head --timeout 30s

# Wait for 1 minute before failing
bin/plugin --install mobz/elasticsearch-head --timeout 1m

# Wait forever (default)
bin/plugin --install mobz/elasticsearch-head --timeout 0</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.1.0.</p></div></div><h4><a id="_plugins_isolation"></a>Plugins isolation</h4><p>Since Elasticsearch 1.1, by default, each plugin is loaded in <span class="emphasis"><em>isolation</em></span> (in its dedicated <code class="literal">ClassLoader</code>) to avoid class clashes between the various plugins and their associated libraries. The default can be changed through the <code class="literal">plugins.isolation</code> property in <code class="literal">elasticsearch.yml</code>, by setting it to <code class="literal">false</code>:</p><pre class="programlisting prettyprint lang-js">plugins.isolation: false</pre><p>Do note that each plugin can specify its <span class="emphasis"><em>mandatory</em></span> isolation through the <code class="literal">isolation</code> property in its <code class="literal">es-plugin.properties</code> configuration. In this (rare) case, the plugin setting is used, overwriting whatever default used by Elasticsearch.</p><h3><a id="known-plugins"></a>Known Plugins</h3><h4><a id="analysis-plugins"></a>Analysis Plugins</h4><div class="itemizedlist"><p class="title"><strong>Supported by Elasticsearch</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-analysis-icu" target="_top">ICU Analysis plugin</a>
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-analysis-kuromoji" target="_top">Japanese (Kuromoji) Analysis plugin</a>.
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-analysis-smartcn" target="_top">Smart Chinese Analysis Plugin</a>
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-analysis-stempel" target="_top">Stempel (Polish) Analysis plugin</a>
</li></ul></div><div class="itemizedlist"><p class="title"><strong>Supported by the community</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="ulink" href="https://github.com/barminator/elasticsearch-analysis-annotation" target="_top">Annotation Analysis Plugin</a> (by Michal Samek)
</li><li class="listitem">
<a class="ulink" href="https://github.com/yakaz/elasticsearch-analysis-combo/" target="_top">Combo Analysis Plugin</a> (by Olivier Favre, Yakaz)
</li><li class="listitem">
<a class="ulink" href="https://github.com/jprante/elasticsearch-analysis-hunspell" target="_top">Hunspell Analysis Plugin</a> (by JÃ¶rg Prante)
</li><li class="listitem">
<a class="ulink" href="https://github.com/medcl/elasticsearch-analysis-ik" target="_top">IK Analysis Plugin</a> (by Medcl)
</li><li class="listitem">
<a class="ulink" href="https://github.com/suguru/elasticsearch-analysis-japanese" target="_top">Japanese Analysis plugin</a> (by suguru).
</li><li class="listitem">
<a class="ulink" href="https://github.com/medcl/elasticsearch-analysis-mmseg" target="_top">Mmseg Analysis Plugin</a> (by Medcl)
</li><li class="listitem">
<a class="ulink" href="https://github.com/chytreg/elasticsearch-analysis-morfologik" target="_top">Morfologik (Polish) Analysis plugin</a> (by chytreg)
</li><li class="listitem">
<a class="ulink" href="https://github.com/imotov/elasticsearch-analysis-morphology" target="_top">Russian and English Morphological Analysis Plugin</a> (by Igor Motov)
</li><li class="listitem">
<a class="ulink" href="https://github.com/medcl/elasticsearch-analysis-pinyin" target="_top">Pinyin Analysis Plugin</a> (by Medcl)
</li><li class="listitem">
<a class="ulink" href="https://github.com/medcl/elasticsearch-analysis-string2int" target="_top">String2Integer Analysis Plugin</a> (by Medcl)
</li></ul></div><h4><a id="discovery-plugins"></a>Discovery Plugins</h4><div class="itemizedlist"><p class="title"><strong>Supported by Elasticsearch</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-cloud-aws" target="_top">AWS Cloud Plugin</a> - EC2 discovery and S3 Repository
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-cloud-azure" target="_top">Azure Cloud Plugin</a> - Azure discovery
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-cloud-gce" target="_top">Google Compute Engine Cloud Plugin</a> - GCE discovery
</li></ul></div><h4><a id="river"></a>River Plugins</h4><div class="itemizedlist"><p class="title"><strong>Supported by Elasticsearch</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-river-couchdb" target="_top">CouchDB River Plugin</a>
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-river-rabbitmq" target="_top">RabbitMQ River Plugin</a>
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-river-twitter" target="_top">Twitter River Plugin</a>
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-river-wikipedia" target="_top">Wikipedia River Plugin</a>
</li></ul></div><div class="itemizedlist"><p class="title"><strong>Supported by the community</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="ulink" href="https://github.com/domdorn/elasticsearch-river-activemq/" target="_top">ActiveMQ River Plugin</a> (by Dominik Dorn)
</li><li class="listitem">
<a class="ulink" href="https://github.com/albogdano/elasticsearch-river-amazonsqs" target="_top">Amazon SQS River Plugin</a> (by Alex Bogdanovski)
</li><li class="listitem">
<a class="ulink" href="https://github.com/xxBedy/elasticsearch-river-csv" target="_top">CSV River Plugin</a> (by Martin Bednar)
</li><li class="listitem">
<a class="ulink" href="http://www.pilato.fr/dropbox/" target="_top">Dropbox River Plugin</a> (by David Pilato)
</li><li class="listitem">
<a class="ulink" href="http://www.pilato.fr/fsriver/" target="_top">FileSystem River Plugin</a> (by David Pilato)
</li><li class="listitem">
<a class="ulink" href="https://github.com/obazoud/elasticsearch-river-git" target="_top">Git River Plugin</a> (by Olivier Bazoud)
</li><li class="listitem">
<a class="ulink" href="https://github.com/uberVU/elasticsearch-river-github" target="_top">GitHub River Plugin</a> (by uberVU)
</li><li class="listitem">
<a class="ulink" href="https://github.com/sksamuel/elasticsearch-river-hazelcast" target="_top">Hazelcast River Plugin</a> (by Steve Samuel)
</li><li class="listitem">
<a class="ulink" href="https://github.com/jprante/elasticsearch-river-jdbc" target="_top">JDBC River Plugin</a> (by JÃ¶rg Prante)
</li><li class="listitem">
<a class="ulink" href="https://github.com/qotho/elasticsearch-river-jms" target="_top">JMS River Plugin</a> (by Steve Sarandos)
</li><li class="listitem">
<a class="ulink" href="https://github.com/endgameinc/elasticsearch-river-kafka" target="_top">Kafka River Plugin</a> (by Endgame Inc.)
</li><li class="listitem">
<a class="ulink" href="https://github.com/tlrx/elasticsearch-river-ldap" target="_top">LDAP River Plugin</a> (by Tanguy Leroux)
</li><li class="listitem">
<a class="ulink" href="https://github.com/richardwilly98/elasticsearch-river-mongodb/" target="_top">MongoDB River Plugin</a> (by Richard Louapre)
</li><li class="listitem">
<a class="ulink" href="https://github.com/sksamuel/elasticsearch-river-neo4j" target="_top">Neo4j River Plugin</a> (by Steve Samuel)
</li><li class="listitem">
<a class="ulink" href="https://github.com/jprante/elasticsearch-river-oai/" target="_top">Open Archives Initiative (OAI) River Plugin</a> (by JÃ¶rg Prante)
</li><li class="listitem">
<a class="ulink" href="https://github.com/sksamuel/elasticsearch-river-redis" target="_top">Redis River Plugin</a> (by Steve Samuel)
</li><li class="listitem">
<a class="ulink" href="http://dadoonet.github.com/rssriver/" target="_top">RSS River Plugin</a> (by David Pilato)
</li><li class="listitem">
<a class="ulink" href="https://github.com/adamlofts/elasticsearch-river-sofa" target="_top">Sofa River Plugin</a> (by adamlofts)
</li><li class="listitem">
<a class="ulink" href="https://github.com/javanna/elasticsearch-river-solr/" target="_top">Solr River Plugin</a> (by Luca Cavanna)
</li><li class="listitem">
<a class="ulink" href="https://github.com/sunnygleason/elasticsearch-river-st9" target="_top">St9 River Plugin</a> (by Sunny Gleason)
</li><li class="listitem">
<a class="ulink" href="https://github.com/plombard/SubversionRiver" target="_top">Subversion River Plugin</a> (by Pascal Lombard)
</li><li class="listitem">
<a class="ulink" href="https://github.com/kzwang/elasticsearch-river-dynamodb" target="_top">DynamoDB River Plugin</a> (by Kevin Wang)
</li></ul></div><h4><a id="transport"></a>Transport Plugins</h4><div class="itemizedlist"><p class="title"><strong>Supported by Elasticsearch</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-transport-memcached" target="_top">Memcached transport plugin</a>
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-transport-thrift" target="_top">Thrift Transport</a>
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-transport-wares" target="_top">Servlet transport</a>
</li></ul></div><div class="itemizedlist"><p class="title"><strong>Supported by the community</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="ulink" href="https://github.com/tlrx/transport-zeromq" target="_top">ZeroMQ transport layer plugin</a> (by Tanguy Leroux)
</li><li class="listitem">
<a class="ulink" href="https://github.com/sonian/elasticsearch-jetty" target="_top">Jetty HTTP transport plugin</a> (by Sonian Inc.)
</li><li class="listitem">
<a class="ulink" href="https://github.com/kzwang/elasticsearch-transport-redis" target="_top">Redis transport plugin</a> (by Kevin Wang)
</li></ul></div><h4><a id="scripting"></a>Scripting Plugins</h4><div class="itemizedlist"><p class="title"><strong>Supported by Elasticsearch</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="ulink" href="https://github.com/hiredman/elasticsearch-lang-clojure" target="_top">Clojure Language Plugin</a> (by Kevin Downey)
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-lang-groovy" target="_top">Groovy lang Plugin</a>
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-lang-javascript" target="_top">JavaScript language Plugin</a>
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-lang-python" target="_top">Python language Plugin</a>
</li></ul></div><h4><a id="site"></a>Site Plugins</h4><div class="itemizedlist"><p class="title"><strong>Supported by the community</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="ulink" href="https://github.com/lukas-vlcek/bigdesk" target="_top">BigDesk Plugin</a> (by LukÃ¡Å¡ VlÄek)
</li><li class="listitem">
<a class="ulink" href="https://github.com/mobz/elasticsearch-head" target="_top">Elasticsearch Head Plugin</a> (by Ben Birch)
</li><li class="listitem">
<a class="ulink" href="https://github.com/royrusso/elasticsearch-HQ" target="_top">Elasticsearch HQ</a> (by Roy Russo)
</li><li class="listitem">
<a class="ulink" href="https://github.com/andrewvc/elastic-hammer" target="_top">Hammer Plugin</a> (by Andrew Cholakian)
</li><li class="listitem">
<a class="ulink" href="https://github.com/polyfractal/elasticsearch-inquisitor" target="_top">Inquisitor Plugin</a> (by Zachary Tong)
</li><li class="listitem">
<a class="ulink" href="https://github.com/karmi/elasticsearch-paramedic" target="_top">Paramedic Plugin</a> (by Karel MinaÅÃ­k)
</li><li class="listitem">
<a class="ulink" href="https://github.com/polyfractal/elasticsearch-segmentspy" target="_top">SegmentSpy Plugin</a> (by Zachary Tong)
</li></ul></div><h4><a id="repository-plugins"></a>Snapshot/Restore Repository Plugins</h4><div class="itemizedlist"><p class="title"><strong>Supported by Elasticsearch</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-hadoop/tree/master/repository-hdfs" target="_top">Hadoop HDFS</a> Repository
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-cloud-aws#s3-repository" target="_top">AWS S3</a> Repository
</li></ul></div><div class="itemizedlist"><p class="title"><strong>Supported by the community</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="ulink" href="https://github.com/kzwang/elasticsearch-repository-gridfs" target="_top">GridFS</a> Repository (by Kevin Wang)
</li></ul></div><h4><a id="misc"></a>Misc Plugins</h4><div class="itemizedlist"><p class="title"><strong>Supported by Elasticsearch</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-mapper-attachments" target="_top">Mapper Attachments Type plugin</a>
</li></ul></div><div class="itemizedlist"><p class="title"><strong>Supported by the community</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="ulink" href="https://github.com/carrot2/elasticsearch-carrot2" target="_top">carrot2 Plugin</a>: Results clustering with carrot2 (by Dawid Weiss)
</li><li class="listitem">
<a class="ulink" href="https://github.com/derryx/elasticsearch-changes-plugin" target="_top">Elasticsearch Changes Plugin</a> (by Thomas Peuss)
</li><li class="listitem">
<a class="ulink" href="https://github.com/johtani/elasticsearch-extended-analyze" target="_top">Extended Analyze Plugin</a> (by Jun Ohtani)
</li><li class="listitem">
<a class="ulink" href="https://github.com/spinscale/elasticsearch-graphite-plugin" target="_top">Elasticsearch Graphite Plugin</a> (by Alexander Reelsen)
</li><li class="listitem">
<a class="ulink" href="https://github.com/mattweber/elasticsearch-mocksolrplugin" target="_top">Elasticsearch Mock Solr Plugin</a> (by Matt Weber)
</li><li class="listitem">
<a class="ulink" href="https://github.com/viniciusccarvalho/elasticsearch-newrelic" target="_top">Elasticsearch New Relic Plugin</a> (by Vinicius Carvalho)
</li><li class="listitem">
<a class="ulink" href="https://github.com/swoop-inc/elasticsearch-statsd-plugin" target="_top">Elasticsearch Statsd Plugin</a> (by Swoop Inc.)
</li><li class="listitem">
<a class="ulink" href="https://github.com/endgameinc/elasticsearch-term-plugin" target="_top">Terms Component Plugin</a> (by Endgame Inc.)
</li><li class="listitem">
<a class="ulink" href="http://tlrx.github.com/elasticsearch-view-plugin" target="_top">Elasticsearch View Plugin</a> (by Tanguy Leroux)
</li><li class="listitem">
<a class="ulink" href="https://github.com/sonian/elasticsearch-zookeeper" target="_top">ZooKeeper Discovery Plugin</a> (by Sonian Inc.)
</li><li class="listitem">
<a class="ulink" href="https://github.com/kzwang/elasticsearch-image" target="_top">Elasticsearch Image Plugin</a> (by Kevin Wang)
</li></ul></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-scripting"></a>Scripting</h2></div></div></div><p>The scripting module allows to use scripts in order to evaluate custom
expressions. For example, scripts can be used to return "script fields"
as part of a search request, or can be used to evaluate a custom score
for a query and so on.</p><p>The scripting module uses by default <a class="ulink" href="http://mvel.codehaus.org/" target="_top">mvel</a> as
the scripting language with some extensions. mvel is used since it is
extremely fast and very simple to use, and in most cases, simple
expressions are needed (for example, mathematical equations).</p><p>Additional <code class="literal">lang</code> plugins are provided to allow to execute scripts in
different languages. Currently supported plugins are <code class="literal">lang-javascript</code>
for JavaScript, <code class="literal">lang-groovy</code> for Groovy, and <code class="literal">lang-python</code> for Python.
All places where a <code class="literal">script</code> parameter can be used, a <code class="literal">lang</code> parameter
(on the same level) can be provided to define the language of the
script. The <code class="literal">lang</code> options are <code class="literal">mvel</code>, <code class="literal">js</code>, <code class="literal">groovy</code>, <code class="literal">python</code>, and
<code class="literal">native</code>.</p><h3><a id="_default_scripting_language"></a>Default Scripting Language</h3><p>The default scripting language (assuming no <code class="literal">lang</code> parameter is
provided) is <code class="literal">mvel</code>. In order to change it set the <code class="literal">script.default_lang</code>
to the appropriate language.</p><h3><a id="_preloaded_scripts"></a>Preloaded Scripts</h3><p>Scripts can always be provided as part of the relevant API, but they can
also be preloaded by placing them under <code class="literal">config/scripts</code> and then
referencing them by the script name (instead of providing the full
script). This helps reduce the amount of data passed between the client
and the nodes.</p><p>The name of the script is derived from the hierarchy of directories it
exists under, and the file name without the lang extension. For example,
a script placed under <code class="literal">config/scripts/group1/group2/test.py</code> will be
named <code class="literal">group1_group2_test</code>.</p><h3><a id="_disabling_dynamic_scripts"></a>Disabling dynamic scripts</h3><p>We recommend running Elasticsearch behind an application or proxy,
which protects Elasticsearch from the outside world. If users are
allowed to run dynamic scripts (even in a search request), then they
have the same access to your box as the user that Elasticsearch is
running as.</p><p>First, you should not run Elasticsearch as the <code class="literal">root</code> user, as this
would allow a script to access or do <span class="strong"><strong>anything</strong></span> on your server, without
limitations. Second, you should not expose Elasticsearch directly to
users, but instead have a proxy application inbetween.  If you <span class="strong"><strong>do</strong></span>
intend to expose Elasticsearch directly to your users, then you have
to decide whether you trust them enough to run scripts on your box or
not. If not, then even if you have a proxy which only allows <code class="literal">GET</code>
requests, you should disable dynamic scripting by adding the following
setting to the <code class="literal">config/elasticsearch.yml</code> file on every node:</p><pre class="programlisting prettyprint lang-yaml">script.disable_dynamic: true</pre><p>This will still allow execution of named scripts provided in the config, or
<span class="emphasis"><em>native</em></span> Java scripts registered through plugins, however it will prevent
users from running arbitrary scripts via the API.</p><h3><a id="_automatic_script_reloading"></a>Automatic Script Reloading</h3><p>The <code class="literal">config/scripts</code> directory is scanned periodically for changes.
New and changed scripts are reloaded and deleted script are removed
from preloaded scripts cache. The reload frequency can be specified
using <code class="literal">watcher.interval</code> setting, which defaults to <code class="literal">60s</code>.
To disable script reloading completely set <code class="literal">script.auto_reload_enabled</code>
to <code class="literal">false</code>.</p><h3><a id="_native_java_scripts"></a>Native (Java) Scripts</h3><p>Even though <code class="literal">mvel</code> is pretty fast, this allows to register native Java based
scripts for faster execution.</p><p>In order to allow for scripts, the <code class="literal">NativeScriptFactory</code> needs to be
implemented that constructs the script that will be executed. There are
two main types, one that extends <code class="literal">AbstractExecutableScript</code> and one that
extends <code class="literal">AbstractSearchScript</code> (probably the one most users will extend,
with additional helper classes in <code class="literal">AbstractLongSearchScript</code>,
<code class="literal">AbstractDoubleSearchScript</code>, and <code class="literal">AbstractFloatSearchScript</code>).</p><p>Registering them can either be done by settings, for example:
<code class="literal">script.native.my.type</code> set to <code class="literal">sample.MyNativeScriptFactory</code> will
register a script named <code class="literal">my</code>. Another option is in a plugin, access
<code class="literal">ScriptModule</code> and call <code class="literal">registerScript</code> on it.</p><p>Executing the script is done by specifying the <code class="literal">lang</code> as <code class="literal">native</code>, and
the name of the script as the <code class="literal">script</code>.</p><p>Note, the scripts need to be in the classpath of elasticsearch. One
simple way to do it is to create a directory under plugins (choose a
descriptive name), and place the jar / classes files there, they will be
automatically loaded.</p><h3><a id="_score"></a>Score</h3><p>In all scripts that can be used in facets, allow to access the current
doc score using <code class="literal">doc.score</code>.</p><h3><a id="_computing_scores_based_on_terms_in_scripts"></a>Computing scores based on terms in scripts</h3><p>see <a class="link" href="#modules-advanced-scripting" title="Text scoring in scripts">advanced scripting documentation</a></p><h3><a id="_document_fields"></a>Document Fields</h3><p>Most scripting revolve around the use of specific document fields data.
The <code class="literal">doc['field_name']</code> can be used to access specific field data within
a document (the document in question is usually derived by the context
the script is used). Document fields are very fast to access since they
end up being loaded into memory (all the relevant field values/tokens
are loaded to memory).</p><p>The following data can be extracted from a field:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Expression </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].value</code></p></td><td align="left" valign="top"><p>The native value of the field. For example,
if its a short type, it will be short.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].values</code></p></td><td align="left" valign="top"><p>The native array values of the field. For
example, if its a short type, it will be short[]. Remember, a field can
have several values within a single doc. Returns an empty array if the
field has no values.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].empty</code></p></td><td align="left" valign="top"><p>A boolean indicating if the field has no
values within the doc.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].multiValued</code></p></td><td align="left" valign="top"><p>A boolean indicating that the field
has several values within the corpus.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].lat</code></p></td><td align="left" valign="top"><p>The latitude of a geo point type.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].lon</code></p></td><td align="left" valign="top"><p>The longitude of a geo point type.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].lats</code></p></td><td align="left" valign="top"><p>The latitudes of a geo point type.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].lons</code></p></td><td align="left" valign="top"><p>The longitudes of a geo point type.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].distance(lat, lon)</code></p></td><td align="left" valign="top"><p>The <code class="literal">plane</code> distance (in meters)
of this geo point field from the provided lat/lon.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].distanceWithDefault(lat, lon, default)</code></p></td><td align="left" valign="top"><p>The <code class="literal">plane</code> distance (in meters)
of this geo point field from the provided lat/lon with a default value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].distanceInMiles(lat, lon)</code></p></td><td align="left" valign="top"><p>The <code class="literal">plane</code> distance (in
miles) of this geo point field from the provided lat/lon.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].distanceInMilesWithDefault(lat, lon, default)</code></p></td><td align="left" valign="top"><p>The <code class="literal">plane</code> distance (in
miles) of this geo point field from the provided lat/lon with a default value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].distanceInKm(lat, lon)</code></p></td><td align="left" valign="top"><p>The <code class="literal">plane</code> distance (in
km) of this geo point field from the provided lat/lon.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].distanceInKmWithDefault(lat, lon, default)</code></p></td><td align="left" valign="top"><p>The <code class="literal">plane</code> distance (in
km) of this geo point field from the provided lat/lon with a default value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].arcDistance(lat, lon)</code></p></td><td align="left" valign="top"><p>The <code class="literal">arc</code> distance (in
meters) of this geo point field from the provided lat/lon.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].arcDistanceWithDefault(lat, lon, default)</code></p></td><td align="left" valign="top"><p>The <code class="literal">arc</code> distance (in
meters) of this geo point field from the provided lat/lon with a default value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].arcDistanceInMiles(lat, lon)</code></p></td><td align="left" valign="top"><p>The <code class="literal">arc</code> distance (in
miles) of this geo point field from the provided lat/lon.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].arcDistanceInMilesWithDefault(lat, lon, default)</code></p></td><td align="left" valign="top"><p>The <code class="literal">arc</code> distance (in
miles) of this geo point field from the provided lat/lon with a default value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].arcDistanceInKm(lat, lon)</code></p></td><td align="left" valign="top"><p>The <code class="literal">arc</code> distance (in
km) of this geo point field from the provided lat/lon.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].arcDistanceInKmWithDefault(lat, lon, default)</code></p></td><td align="left" valign="top"><p>The <code class="literal">arc</code> distance (in
km) of this geo point field from the provided lat/lon with a default value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].factorDistance(lat, lon)</code></p></td><td align="left" valign="top"><p>The distance factor of this geo point field from the provided lat/lon.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].factorDistance(lat, lon, default)</code></p></td><td align="left" valign="top"><p>The distance factor of this geo point field from the provided lat/lon with a default value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].geohashDistance(geohash)</code></p></td><td align="left" valign="top"><p>The <code class="literal">arc</code> distance (in meters)
of this geo point field from the provided geohash.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].geohashDistanceInKm(geohash)</code></p></td><td align="left" valign="top"><p>The <code class="literal">arc</code> distance (in km)
of this geo point field from the provided geohash.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].geohashDistanceInMiles(geohash)</code></p></td><td align="left" valign="top"><p>The <code class="literal">arc</code> distance (in
miles) of this geo point field from the provided geohash.</p></td></tr></tbody></table></div><h3><a id="_stored_fields"></a>Stored Fields</h3><p>Stored fields can also be accessed when executing a script. Note, they
are much slower to access compared with document fields, but are not
loaded into memory. They can be simply accessed using
<code class="literal">_fields['my_field_name'].value</code> or <code class="literal">_fields['my_field_name'].values</code>.</p><h3><a id="_source_field"></a>Source Field</h3><p>The source field can also be accessed when executing a script. The
source field is loaded per doc, parsed, and then provided to the script
for evaluation. The <code class="literal">_source</code> forms the context under which the source
field can be accessed, for example <code class="literal">_source.obj2.obj1.field3</code>.</p><p>Accessing <code class="literal">_source</code> is much slower compared to using <code class="literal">_doc</code>
but the data is not loaded into memory. For a single field access <code class="literal">_fields</code> may be
faster than using <code class="literal">_source</code> due to the extra overhead of potentially parsing large documents.
However, <code class="literal">_source</code> may be faster if you access multiple fields or if the source has already been
loaded for other purposes.</p><h3><a id="_mvel_built_in_functions"></a>mvel Built In Functions</h3><p>There are several built in functions that can be used within scripts.
They include:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Function </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">time()</code></p></td><td align="left" valign="top"><p>The current time in milliseconds.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">sin(a)</code></p></td><td align="left" valign="top"><p>Returns the trigonometric sine of an angle.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">cos(a)</code></p></td><td align="left" valign="top"><p>Returns the trigonometric cosine of an angle.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">tan(a)</code></p></td><td align="left" valign="top"><p>Returns the trigonometric tangent of an angle.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">asin(a)</code></p></td><td align="left" valign="top"><p>Returns the arc sine of a value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">acos(a)</code></p></td><td align="left" valign="top"><p>Returns the arc cosine of a value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">atan(a)</code></p></td><td align="left" valign="top"><p>Returns the arc tangent of a value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">toRadians(angdeg)</code></p></td><td align="left" valign="top"><p>Converts an angle measured in degrees to an
approximately equivalent angle measured in radians</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">toDegrees(angrad)</code></p></td><td align="left" valign="top"><p>Converts an angle measured in radians to an
approximately equivalent angle measured in degrees.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">exp(a)</code></p></td><td align="left" valign="top"><p>Returns Eulerâs number <span class="emphasis"><em>e</em></span> raised to the power of value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">log(a)</code></p></td><td align="left" valign="top"><p>Returns the natural logarithm (base <span class="emphasis"><em>e</em></span>) of a value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">log10(a)</code></p></td><td align="left" valign="top"><p>Returns the base 10 logarithm of a value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">sqrt(a)</code></p></td><td align="left" valign="top"><p>Returns the correctly rounded positive square root of a
value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">cbrt(a)</code></p></td><td align="left" valign="top"><p>Returns the cube root of a double value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">IEEEremainder(f1, f2)</code></p></td><td align="left" valign="top"><p>Computes the remainder operation on two
arguments as prescribed by the IEEE 754 standard.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ceil(a)</code></p></td><td align="left" valign="top"><p>Returns the smallest (closest to negative infinity) value
that is greater than or equal to the argument and is equal to a
mathematical integer.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">floor(a)</code></p></td><td align="left" valign="top"><p>Returns the largest (closest to positive infinity) value
that is less than or equal to the argument and is equal to a
mathematical integer.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">rint(a)</code></p></td><td align="left" valign="top"><p>Returns the value that is closest in value to the argument
and is equal to a mathematical integer.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">atan2(y, x)</code></p></td><td align="left" valign="top"><p>Returns the angle <span class="emphasis"><em>theta</em></span> from the conversion of
rectangular coordinates (<span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>y</em></span>) to polar coordinates (r,<span class="emphasis"><em>theta</em></span>).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">pow(a, b)</code></p></td><td align="left" valign="top"><p>Returns the value of the first argument raised to the
power of the second argument.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">round(a)</code></p></td><td align="left" valign="top"><p>Returns the closest <span class="emphasis"><em>int</em></span> to the argument.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">random()</code></p></td><td align="left" valign="top"><p>Returns a random <span class="emphasis"><em>double</em></span> value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">abs(a)</code></p></td><td align="left" valign="top"><p>Returns the absolute value of a value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max(a, b)</code></p></td><td align="left" valign="top"><p>Returns the greater of two values.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">min(a, b)</code></p></td><td align="left" valign="top"><p>Returns the smaller of two values.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ulp(d)</code></p></td><td align="left" valign="top"><p>Returns the size of an ulp of the argument.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">signum(d)</code></p></td><td align="left" valign="top"><p>Returns the signum function of the argument.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">sinh(x)</code></p></td><td align="left" valign="top"><p>Returns the hyperbolic sine of a value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">cosh(x)</code></p></td><td align="left" valign="top"><p>Returns the hyperbolic cosine of a value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">tanh(x)</code></p></td><td align="left" valign="top"><p>Returns the hyperbolic tangent of a value.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">hypot(x, y)</code></p></td><td align="left" valign="top"><p>Returns sqrt(<span class="emphasis"><em>x2</em></span> + <span class="emphasis"><em>y2</em></span>) without intermediate overflow
or underflow.</p></td></tr></tbody></table></div><h3><a id="_arithmetic_precision_in_mvel"></a>Arithmetic precision in MVEL</h3><p>When dividing two numbers using MVEL based scripts, the engine tries to
be smart and adheres to the default behaviour of java. This means if you
divide two integers (you might have configured the fields as integer in
the mapping), the result will also be an integer. This means, if a
calculation like <code class="literal">1/num</code> is happening in your scripts and <code class="literal">num</code> is an
integer with the value of <code class="literal">8</code>, the result is <code class="literal">0</code> even though you were
expecting it to be <code class="literal">0.125</code>. You may need to enforce precision by
explicitly using a double like <code class="literal">1.0/num</code> in order to get the expected
result.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-advanced-scripting"></a>Text scoring in scripts</h2></div></div></div><p>Text features, such as term or document frequency for a specific term can be accessed in scripts (see <a class="link" href="#modules-scripting" title="Scripting">scripting documentation</a> ) with the <code class="literal">_index</code> variable. This can be useful if, for example, you want to implement your own scoring model using for example a script inside a <a class="link" href="#query-dsl-function-score-query" title="Function Score Query">function score query</a>.
Statistics over the document collection are computed <span class="strong"><strong>per shard</strong></span>, not per
index.</p><h3><a id="_nomenclature"></a>Nomenclature:</h3><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">df</code>
</p>
</td><td valign="top">
<p>
    document frequency. The number of documents a term appears in. Computed
    per field.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">tf</code>
</p>
</td><td valign="top">
<p>
    term frequency. The number times a term appears in a field in one specific
    document.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">ttf</code>
</p>
</td><td valign="top">
<p>
    total term frequency. The number of times this term appears in all
    documents, that is, the sum of <code class="literal">tf</code> over all documents.  Computed per
    field.
</p>
</td></tr></tbody></table></div><p><code class="literal">df</code> and <code class="literal">ttf</code> are computed per shard and therefore these numbers can vary
depending on the shard the current document resides in.</p><h3><a id="_shard_statistics"></a>Shard statistics:</h3><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">_index.numDocs()</code>
</span></dt><dd>
    Number of documents in shard.
</dd><dt><span class="term">
<code class="literal">_index.maxDoc()</code>
</span></dt><dd>
    Maximal document number in shard.
</dd><dt><span class="term">
<code class="literal">_index.numDeletedDocs()</code>
</span></dt><dd>
    Number of deleted documents in shard.
</dd></dl></div><h3><a id="_field_statistics_2"></a>Field statistics:</h3><p>Field statistics can be accessed with a subscript operator like this:
<code class="literal">_index['FIELD']</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">_index['FIELD'].docCount()</code>
</span></dt><dd>
    Number of documents containing the field <code class="literal">FIELD</code>. Does not take deleted documents into account.
</dd><dt><span class="term">
<code class="literal">_index['FIELD'].sumttf()</code>
</span></dt><dd>
    Sum of <code class="literal">ttf</code> over all terms that appear in field <code class="literal">FIELD</code> in all documents.
</dd><dt><span class="term">
<code class="literal">_index['FIELD'].sumdf()</code>
</span></dt><dd>
    The sum of <code class="literal">df</code> s over all terms that appear in field <code class="literal">FIELD</code> in all
    documents.
</dd></dl></div><p>Field statistics are computed per shard and therfore these numbers can vary
depending on the shard the current document resides in.
The number of terms in a field cannot be accessed using the <code class="literal">_index</code> variable. See <a class="link" href="#mapping-core-types" title="Core Types">word count mapping type</a> on how to do that.</p><h3><a id="_term_statistics_2"></a>Term statistics:</h3><p>Term statistics for a field can be accessed with a subscript operator like
this: <code class="literal">_index['FIELD']['TERM']</code>. This will never return null, even if term or field does not exist.
If you do not need the term frequency, call <code class="literal">_index['FIELD'].get('TERM', 0)</code>
to avoid uneccesary initialization of the frequencies. The flag will have only
affect is your set the <code class="literal">index_options</code> to <code class="literal">docs</code> (see <a class="link" href="#mapping-core-types" title="Core Types">mapping documentation</a>).</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">_index['FIELD']['TERM'].df()</code>
</span></dt><dd>
    <code class="literal">df</code> of term <code class="literal">TERM</code> in field <code class="literal">FIELD</code>. Will be returned, even if the term
    is not present in the current document.
</dd><dt><span class="term">
<code class="literal">_index['FIELD']['TERM'].ttf()</code>
</span></dt><dd>
    The sum of term frequencys of term <code class="literal">TERM</code> in field <code class="literal">FIELD</code> over all
    documents. Will be returned, even if the term is not present in the
    current document.
</dd><dt><span class="term">
<code class="literal">_index['FIELD']['TERM'].tf()</code>
</span></dt><dd>
    <code class="literal">tf</code> of term <code class="literal">TERM</code> in field <code class="literal">FIELD</code>. Will be 0 if the term is not present
    in the current document.
</dd></dl></div><h3><a id="_term_positions_offsets_and_payloads"></a>Term positions, offsets and payloads:</h3><p>If you need information on the positions of terms in a field, call
<code class="literal">_index['FIELD'].get('TERM', flag)</code> where flag can be</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">_POSITIONS</code>
</p>
</td><td valign="top">
<p>
if you need the positions of the term
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">_OFFSETS</code>
</p>
</td><td valign="top">
<p>
if you need the offests of the term
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">_PAYLOADS</code>
</p>
</td><td valign="top">
<p>
if you need the payloads of the term
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">_CACHE</code>
</p>
</td><td valign="top">
<p>
if you need to iterate over all positions several times
</p>
</td></tr></tbody></table></div><p>The iterator uses the underlying lucene classes to iterate over positions. For efficiency reasons, you can only iterate over positions once. If you need to iterate over the positions several times, set the <code class="literal">_CACHE</code> flag.</p><p>You can combine the operators with a <code class="literal">|</code> if you need more than one info. For
example, the following will return an object holding the positions and payloads,
as well as all statistics:</p><pre class="literallayout">`_index['FIELD'].get('TERM', _POSITIONS | _PAYLOADS)`</pre><p>Positions can be accessed with an iterator that returns an object
(<code class="literal">POS_OBJECT</code>) holding position, offsets and payload for each term position.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">POS_OBJECT.position</code>
</span></dt><dd>
    The position of the term.
</dd><dt><span class="term">
<code class="literal">POS_OBJECT.startOffset</code>
</span></dt><dd>
    The start offset of the term.
</dd><dt><span class="term">
<code class="literal">POS_OBJECT.endOffset</code>
</span></dt><dd>
    The end offset of the term.
</dd><dt><span class="term">
<code class="literal">POS_OBJECT.payload</code>
</span></dt><dd>
    The payload of the term.
</dd><dt><span class="term">
<code class="literal">POS_OBJECT.payloadAsInt(missingValue)</code>
</span></dt><dd>
    The payload of the term converted to integer. If the current position has
    no payload, the <code class="literal">missingValue</code> will be returned. Call this only if you
    know that your payloads are integers.
</dd><dt><span class="term">
<code class="literal">POS_OBJECT.payloadAsFloat(missingValue)</code>
</span></dt><dd>
    The payload of the term converted to float. If the current position has no
    payload, the <code class="literal">missingValue</code> will be returned. Call this only if you know
    that your payloads are floats.
</dd><dt><span class="term">
<code class="literal">POS_OBJECT.payloadAsString()</code>
</span></dt><dd>
    The payload of the term converted to string. If the current position has
    no payload, <code class="literal">null</code> will be returned. Call this only if you know that your
    payloads are strings.
</dd></dl></div><p>Example: sums up all payloads for the term <code class="literal">foo</code>.</p><pre class="programlisting prettyprint lang-mvel">termInfo = _index['my_field'].get('foo',_PAYLOADS);
score = 0;
for (pos : termInfo) {
    score = score + pos.payloadAsInt(0);
}
return score;</pre><h3><a id="_term_vectors"></a>Term vectors:</h3><p>The <code class="literal">_index</code> variable can only be used to gather statistics for single terms. If you want to use information on all terms in a field, you must store the term vectors (set <code class="literal">term_vector</code> in the mapping as described in the <a class="link" href="#mapping-core-types" title="Core Types">mapping documentation</a>). To access them, call
<code class="literal">_index.getTermVectors()</code> to get a
<a class="ulink" href="https://lucene.apache.org/core/4_0_0/core/org/apache/lucene/index/Fields.html" target="_top">Fields</a>
instance. This object can then be used as described in <a class="ulink" href="https://lucene.apache.org/core/4_0_0/core/org/apache/lucene/index/Fields.html" target="_top">lucene doc</a> to iterate over fields and then for each field iterate over each term in the field.
The method will return null if the term vectors were not stored.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-threadpool"></a>Thread Pool</h2></div></div></div><p>A node holds several thread pools in order to improve how threads are
managed and memory consumption within a node. There are several thread
pools, but the important ones include:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">index</code>
</p>
</td><td valign="top">
<p>
    For index/delete operations, defaults to <code class="literal">fixed</code>,
    size <code class="literal"># of available processors</code>.
    queue_size <code class="literal">200</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">search</code>
</p>
</td><td valign="top">
<p>
    For count/search operations, defaults to <code class="literal">fixed</code>,
    size <code class="literal">3x # of available processors</code>.
    queue_size <code class="literal">1000</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">suggest</code>
</p>
</td><td valign="top">
<p>
    For suggest operations, defaults to <code class="literal">fixed</code>,
    size <code class="literal"># of available processors</code>.
    queue_size <code class="literal">1000</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">get</code>
</p>
</td><td valign="top">
<p>
    For get operations, defaults to <code class="literal">fixed</code>
    size <code class="literal"># of available processors</code>.
    queue_size <code class="literal">1000</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">bulk</code>
</p>
</td><td valign="top">
<p>
    For bulk operations, defaults to <code class="literal">fixed</code>
    size <code class="literal"># of available processors</code>.
    queue_size <code class="literal">50</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">percolate</code>
</p>
</td><td valign="top">
<p>
    For percolate operations, defaults to <code class="literal">fixed</code>
    size <code class="literal"># of available processors</code>.
    queue_size <code class="literal">1000</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">warmer</code>
</p>
</td><td valign="top">
<p>
    For segment warm-up operations, defaults to <code class="literal">scaling</code>
    with a <code class="literal">5m</code> keep-alive.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">refresh</code>
</p>
</td><td valign="top">
<p>
    For refresh operations, defaults to <code class="literal">scaling</code>
    with a <code class="literal">5m</code> keep-alive.
</p>
</td></tr></tbody></table></div><p>Changing a specific thread pool can be done by setting its type and
specific type parameters, for example, changing the <code class="literal">index</code> thread pool
to have more threads:</p><pre class="programlisting prettyprint lang-js">threadpool:
    index:
        type: fixed
        size: 30</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>you can update threadpool settings live using
      <a class="xref" href="#cluster-update-settings" title="Cluster Update Settings"><em>Cluster Update Settings</em></a>.</p></div></div><h3><a id="types"></a>Thread pool types</h3><p>The following are the types of thread pools that can be used and their
respective parameters:</p><h4><a id="_literal_cache_literal"></a><code class="literal">cache</code></h4><p>The <code class="literal">cache</code> thread pool is an unbounded thread pool that will spawn a
thread if there are pending requests. Here is an example of how to set
it:</p><pre class="programlisting prettyprint lang-js">threadpool:
    index:
        type: cached</pre><h4><a id="_literal_fixed_literal"></a><code class="literal">fixed</code></h4><p>The <code class="literal">fixed</code> thread pool holds a fixed size of threads to handle the
requests with a queue (optionally bounded) for pending requests that
have no threads to service them.</p><p>The <code class="literal">size</code> parameter controls the number of threads, and defaults to the
number of cores times 5.</p><p>The <code class="literal">queue_size</code> allows to control the size of the queue of pending
requests that have no threads to execute them. By default, it is set to
<code class="literal">-1</code> which means its unbounded. When a request comes in and the queue is
full, it will abort the request.</p><pre class="programlisting prettyprint lang-js">threadpool:
    index:
        type: fixed
        size: 30
        queue_size: 1000</pre><h3><a id="processors"></a>Processors setting</h3><p>The number of processors is automatically detected, and the thread pool
settings are automatically set based on it. Sometimes, the number of processors
are wrongly detected, in such cases, the number of processors can be
explicitly set using the <code class="literal">processors</code> setting.</p><p>In order to check the number of processors detected, use the nodes info
API with the <code class="literal">os</code> flag.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-thrift"></a>Thrift</h2></div></div></div><p>The thrift transport module allows to expose the REST interface of
elasticsearch using thrift. Thrift should provide better performance
over http. Since thrift provides both the wire protocol and the
transport, it should make using it simpler (thought its lacking on
docsâ¦).</p><p>Using thrift requires installing the <code class="literal">transport-thrift</code> plugin, located
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-transport-thrift" target="_top">here</a>.</p><p>The thrift
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-transport-thrift/blob/master/elasticsearch.thrift" target="_top">schema</a>
can be used to generate thrift clients.</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">thrift.port</code></p></td><td align="left" valign="top"><p>The port to bind to. Defaults to 9500-9600</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">thrift.frame</code></p></td><td align="left" valign="top"><p>Defaults to <code class="literal">-1</code>, which means no framing. Set to a
higher value to specify the frame size (like <code class="literal">15mb</code>).</p></td></tr></tbody></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-transport"></a>Transport</h2></div></div></div><p>The transport module is used for internal communication between nodes
within the cluster. Each call that goes from one node to the other uses
the transport module (for example, when an HTTP GET request is processed
by one node, and should actually be processed by another node that holds
the data).</p><p>The transport mechanism is completely asynchronous in nature, meaning
that there is no blocking thread waiting for a response. The benefit of
using asynchronous communication is first solving the
<a class="ulink" href="http://en.wikipedia.org/wiki/C10k_problem" target="_top">C10k problem</a>, as well as
being the ideal solution for scatter (broadcast) / gather operations such
as search in ElasticSearch.</p><h3><a id="_tcp_transport"></a>TCP Transport</h3><p>The TCP transport is an implementation of the transport module using
TCP. It allows for the following settings:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">transport.tcp.port</code></p></td><td align="left" valign="top"><p>A bind port range. Defaults to <code class="literal">9300-9400</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">transport.publish_port</code></p></td><td align="left" valign="top"><p>The port that other nodes in the cluster
should use when communicating with this node. Useful when a cluster node
is behind a proxy or firewall and the <code class="literal">transport.tcp.port</code> is not directly
addressable from the outside. Defaults to the actual port assigned via
<code class="literal">transport.tcp.port</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">transport.tcp.connect_timeout</code></p></td><td align="left" valign="top"><p>The socket connect timeout setting (in
time setting format). Defaults to <code class="literal">30s</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">transport.tcp.compress</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to enable compression (LZF)
between all nodes. Defaults to <code class="literal">false</code>.</p></td></tr></tbody></table></div><p>It also uses the common
<a class="link" href="#modules-network" title="Network Settings">network settings</a>.</p><h3><a id="_local_transport"></a>Local Transport</h3><p>This is a handy transport to use when running integration tests within
the JVM. It is automatically enabled when using
<code class="literal">NodeBuilder#local(true)</code>.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-snapshots"></a>Snapshot And Restore</h2></div></div></div><p>The snapshot and restore module allows to create snapshots of individual indices or an entire cluster into a remote
repository. At the time of the initial release only shared file system repository is supported.</p><h3><a id="_repositories"></a>Repositories</h3><p>Before any snapshot or restore operation can be performed a snapshot repository should be registered in
Elasticsearch. The following command registers a shared file system repository with the name <code class="literal">my_backup</code> that
will use location <code class="literal">/mount/backups/my_backup</code> to store snapshots.</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT 'http://localhost:9200/_snapshot/my_backup' -d '{
    "type": "fs",
    "settings": {
        "location": "/mount/backups/my_backup",
        "compress": true
    }
}'</pre><p>Once repository is registered, its information can be obtained using the following command:</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_snapshot/my_backup?pretty'</pre><pre class="programlisting prettyprint lang-js">{
  "my_backup" : {
    "type" : "fs",
    "settings" : {
      "compress" : "false",
      "location" : "/mount/backups/my_backup"
    }
  }
}</pre><p>If a repository name is not specified, or <code class="literal">_all</code> is used as repository name Elasticsearch will return information about
all repositories currently registered in the cluster:</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_snapshot'</pre><p>or</p><pre class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_snapshot/_all'</pre><h5><a id="_shared_file_system_repository"></a>Shared File System Repository</h5><p>The shared file system repository (<code class="literal">"type": "fs"</code>) is using shared file system to store snapshot. The path
specified in the <code class="literal">location</code> parameter should point to the same location in the shared filesystem and be accessible
on all data and master nodes. The following settings are supported:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">location</code>
</p>
</td><td valign="top">
<p>
Location of the snapshots. Mandatory.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">compress</code>
</p>
</td><td valign="top">
<p>
Turns on compression of the snapshot files. Defaults to <code class="literal">true</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">concurrent_streams</code>
</p>
</td><td valign="top">
<p>
Throttles the number of streams (per node) preforming snapshot operation. Defaults to <code class="literal">5</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">chunk_size</code>
</p>
</td><td valign="top">
<p>
Big files can be broken down into chunks during snapshotting if needed. The chunk size can be specified in bytes or by
 using size value notation, i.e. 1g, 10m, 5k. Defaults to <code class="literal">null</code> (unlimited chunk size).
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max_restore_bytes_per_sec</code>
</p>
</td><td valign="top">
<p>
Throttles per node restore rate. Defaults to <code class="literal">20mb</code> per second.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max_snapshot_bytes_per_sec</code>
</p>
</td><td valign="top">
<p>
Throttles per node snapshot rate. Defaults to <code class="literal">20mb</code> per second.
</p>
</td></tr></tbody></table></div><h5><a id="_read_only_url_repository"></a>Read-only URL Repository</h5><p>The URL repository (<code class="literal">"type": "url"</code>) can be used as an alternative read-only way to access data created by shared file
system repository  is using shared file system to store snapshot. The URL specified in the <code class="literal">url</code> parameter should
point to the root of the shared filesystem repository. The following settings are supported:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">url</code>
</p>
</td><td valign="top">
<p>
Location of the snapshots. Mandatory.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">concurrent_streams</code>
</p>
</td><td valign="top">
<p>
Throttles the number of streams (per node) preforming snapshot operation. Defaults to <code class="literal">5</code>
</p>
</td></tr></tbody></table></div><h5><a id="_repository_plugins"></a>Repository plugins</h5><p>Other repository backends are available in these official plugins:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-cloud-aws#s3-repository" target="_top">AWS Cloud Plugin</a> for S3 repositories
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-hadoop/tree/master/repository-hdfs" target="_top">HDFS Plugin</a> for Hadoop environments
</li><li class="listitem">
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-cloud-azure#azure-repository" target="_top">Azure Cloud Plugin</a> for Azure storage repositories
</li></ul></div><h3><a id="_snapshot"></a>Snapshot</h3><p>A repository can contain multiple snapshots of the same cluster. Snapshot are identified by unique names within the
cluster. A snapshot with the name <code class="literal">snapshot_1</code> in the repository <code class="literal">my_backup</code> can be created by executing the following
command:</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT "localhost:9200/_snapshot/my_backup/snapshot_1?wait_for_completion=true"</pre><p>The <code class="literal">wait_for_completion</code> parameter specifies whether or not the request should return immediately or wait for snapshot
completion. By default snapshot of all open and started indices in the cluster is created. This behavior can be changed
by specifying the list of indices in the body of the snapshot request.</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT "localhost:9200/_snapshot/my_backup/snapshot_1" -d '{
    "indices": "index_1,index_2",
    "ignore_unavailable": "true",
    "include_global_state": false
}'</pre><p>The list of indices that should be included into the snapshot can be specified using the <code class="literal">indices</code> parameter that
supports <a class="link" href="#search-multi-index-type" title="Multi-Index, Multi-Type">multi index syntax</a>. The snapshot request also supports the
<code class="literal">ignore_unavailable</code> option. Setting it to <code class="literal">true</code> will cause indices that do not exists to be ignored during snapshot
creation. By default, when <code class="literal">ignore_unavailable</code> option is not set and an index is missing the snapshot request will fail.
By setting <code class="literal">include_global_state</code> to false itâs possible to prevent the cluster global state to be stored as part of
the snapshot. By default, entire snapshot will fail if one or more indices participating in the snapshot donât have
all primary shards available. This behaviour can be changed by setting <code class="literal">partial</code> to <code class="literal">true</code>.</p><p>The index snapshot process is incremental. In the process of making the index snapshot Elasticsearch analyses
the list of the index files that are already stored in the repository and copies only files that were created or
changed since the last snapshot. That allows multiple snapshots to be preserved in the repository in a compact form.
Snapshotting process is executed in non-blocking fashion. All indexing and searching operation can continue to be
executed against the index that is being snapshotted. However, a snapshot represents the point-in-time view of the index
at the moment when snapshot was created, so no records that were added to the index after snapshot process had started
will be present in the snapshot.</p><p>Besides creating a copy of each index the snapshot process can also store global cluster metadata, which includes persistent
cluster settings and templates. The transient settings and registered snapshot repositories are not stored as part of
the snapshot.</p><p>Only one snapshot process can be executed in the cluster at any time. While snapshot of a particular shard is being
created this shard cannot be moved to another node, which can interfere with rebalancing process and allocation
filtering. Once snapshot of the shard is finished Elasticsearch will be able to move shard to another node according
to the current allocation filtering settings and rebalancing algorithm.</p><p>Once a snapshot is created information about this snapshot can be obtained using the following command:</p><pre class="programlisting prettyprint lang-shell">$ curl -XGET "localhost:9200/_snapshot/my_backup/snapshot_1"</pre><p>All snapshots currently stored in the repository can be listed using the following command:</p><pre class="programlisting prettyprint lang-shell">$ curl -XGET "localhost:9200/_snapshot/my_backup/_all"</pre><p>A snapshot can be deleted from the repository using the following command:</p><pre class="programlisting prettyprint lang-shell">$ curl -XDELETE "localhost:9200/_snapshot/my_backup/snapshot_1"</pre><p>When a snapshot is deleted from a repository, Elasticsearch deletes all files that are associated with the deleted
snapshot and not used by any other snapshots. If the deleted snapshot operation is executed while the snapshot is being
created the snapshotting process will be aborted and all files created as part of the snapshotting process will be
cleaned. Therefore, the delete snapshot operation can be used to cancel long running snapshot operations that were
started by mistake.</p><h3><a id="_restore"></a>Restore</h3><p>A snapshot can be restored using the following command:</p><pre class="programlisting prettyprint lang-shell">$ curl -XPOST "localhost:9200/_snapshot/my_backup/snapshot_1/_restore"</pre><p>By default, all indices in the snapshot as well as cluster state are restored. Itâs possible to select indices that
should be restored as well as prevent global cluster state from being restored by using <code class="literal">indices</code> and
<code class="literal">include_global_state</code> options in the restore request body. The list of indices supports
<a class="link" href="#search-multi-index-type" title="Multi-Index, Multi-Type">multi index syntax</a>. The <code class="literal">rename_pattern</code> and <code class="literal">rename_replacement</code> options can be also used to
rename index on restore using regular expression that supports referencing the original text as explained
<a class="ulink" href="http://docs.oracle.com/javase/6/docs/api/java/util/regex/Matcher.html#appendReplacement(java.lang.StringBuffer,%20java.lang.String)" target="_top">here</a>.</p><pre class="programlisting prettyprint lang-js">$ curl -XPOST "localhost:9200/_snapshot/my_backup/snapshot_1/_restore" -d '{
    "indices": "index_1,index_2",
    "ignore_unavailable": "true",
    "include_global_state": false,
    "rename_pattern": "index_(.+)",
    "rename_replacement": "restored_index_$1"
}'</pre><p>The restore operation can be performed on a functioning cluster. However, an existing index can be only restored if itâs
closed. The restore operation automatically opens restored indices if they were closed and creates new indices if they
didnât exist in the cluster. If cluster state is restored, the restored templates that donât currently exist in the
cluster are added and existing templates with the same name are replaced by the restored templates. The restored
persistent settings are added to the existing persistent settings.</p><h3><a id="_snapshot_status"></a>Snapshot status</h3><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Coming in 1.1.0.</p></div></div><p>A list of currently running snapshots with their detailed status information can be obtained using the following command:</p><pre class="programlisting prettyprint lang-shell">$ curl -XGET "localhost:9200/_snapshot/_status"</pre><p>In this format, the command will return information about all currently running snapshots. By specifying a repository name, itâs possible
to limit the results to a particular repository:</p><pre class="programlisting prettyprint lang-shell">$ curl -XGET "localhost:9200/_snapshot/my_backup/_status"</pre><p>If both repository name and snapshot id are specified, this command will return detailed status information for the given snapshot even
if itâs not currently running:</p><pre class="programlisting prettyprint lang-shell">$ curl -XGET "localhost:9200/_snapshot/my_backup/snapshot_1/_status"</pre><p>Multiple ids are also supported:</p><pre class="programlisting prettyprint lang-shell">$ curl -XGET "localhost:9200/_snapshot/my_backup/snapshot_1,snapshot_2/_status"</pre></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="index-modules"></a>Index Modules</h1></div></div></div><div class="partintro"><div></div><p>Index Modules are modules created per index and control all aspects
related to an index. Since those modules lifecycle are tied to an index,
all the relevant modules settings can be provided when creating an index
(and it is actually the recommended way to configure an index).</p><h2><a id="index-modules-settings"></a>Index Settings</h2><p>There are specific index level settings that are not associated with any
specific module. These include:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<a id="index-compound-format"></a><code class="literal">index.compound_format</code>
</span></dt><dd><p class="simpara">
        Should the compound file format be used (boolean setting).
        The compound format was created to reduce the number of open
        file handles when using file based storage. However, by default it is set
        to <code class="literal">false</code> as the non-compound format gives better performance. It is important
        that OS is configured to give Elasticsearch âenoughâ file handles.
    See <a class="xref" href="#file-descriptors" title="File Descriptors">the section called âFile Descriptorsâ</a>.
</p><p class="simpara">Alternatively, <code class="literal">compound_format</code> can be set to a number between <code class="literal">0</code> and
<code class="literal">1</code>, where <code class="literal">0</code> means <code class="literal">false</code>, <code class="literal">1</code> means <code class="literal">true</code> and a number inbetween
represents a percentage: if the merged segment is less than this
percentage of the total index, then it is written in compound format,
otherwise it is written in non-compound format.</p></dd><dt><span class="term">
<a id="index-compound-on-flush"></a><code class="literal">index.compound_on_flush</code>
</span></dt><dd>
    Should a new segment (create by indexing, not by merging) be written
    in compound format or non-compound format? Defaults to <code class="literal">true</code>.
    This is a dynamic setting.
</dd><dt><span class="term">
<code class="literal">index.refresh_interval</code>
</span></dt><dd>
        A time setting controlling how often the
        refresh operation will be executed. Defaults to <code class="literal">1s</code>. Can be set to <code class="literal">-1</code>
        in order to disable it.
</dd><dt><span class="term">
<code class="literal">index.shard.check_on_startup</code>
</span></dt><dd>
        Should shard consistency be checked upon opening.
        When <code class="literal">true</code>, the shard will be checked, preventing it from being open in
        case some segments appear to be corrupted.
        When <code class="literal">fix</code>, the shard will also be checked but segments that were reported
        as corrupted will be automatically removed.
        Default value is <code class="literal">false</code>, which doesnât check shards.
</dd></dl></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Checking shards may take a lot of time on large indices.</p></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>Setting <code class="literal">index.shard.check_on_startup</code> to <code class="literal">fix</code> may result in data loss,
         use with caution.</p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="index-modules-analysis"></a>Analysis</h2></div></div></div><p>The index analysis module acts as a configurable registry of Analyzers
that can be used in order to break down indexed (analyzed) fields when a
document is indexed as well as to process query strings. It maps to the Lucene
<code class="literal">Analyzer</code>.</p><p>Analyzers are (generally) composed of a single <code class="literal">Tokenizer</code> and zero or
more <code class="literal">TokenFilters</code>. A set of <code class="literal">CharFilters</code> can be associated with an
analyzer to process the characters prior to other analysis steps. The
analysis module allows one to register <code class="literal">TokenFilters</code>, <code class="literal">Tokenizers</code> and
<code class="literal">Analyzers</code> under logical names that can then be referenced either in
mapping definitions or in certain APIs. The Analysis module
automatically registers (<span class="strong"><strong>if not explicitly defined</strong></span>) built in
analyzers, token filters, and tokenizers.</p><p>See <a class="xref" href="#analysis" title="Analysis">Analysis</a> for configuration details.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="index-modules-allocation"></a>Index Shard Allocation</h2></div></div></div><h3><a id="shard-allocation-filtering"></a>Shard Allocation Filtering</h3><p>Allows to control the allocation of indices on nodes based on include/exclude
filters. The filters can be set both on the index level and on the
cluster level. Lets start with an example of setting it on the cluster
level:</p><p>Lets say we have 4 nodes, each has specific attribute called <code class="literal">tag</code>
associated with it (the name of the attribute can be any name). Each
node has a specific value associated with <code class="literal">tag</code>. Node 1 has a setting
<code class="literal">node.tag: value1</code>, Node 2 a setting of <code class="literal">node.tag: value2</code>, and so on.</p><p>We can create an index that will only deploy on nodes that have <code class="literal">tag</code>
set to <code class="literal">value1</code> and <code class="literal">value2</code> by setting
<code class="literal">index.routing.allocation.include.tag</code> to <code class="literal">value1,value2</code>. For example:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test/_settings -d '{
    "index.routing.allocation.include.tag" : "value1,value2"
}'</pre><p>On the other hand, we can create an index that will be deployed on all
nodes except for nodes with a <code class="literal">tag</code> of value <code class="literal">value3</code> by setting
<code class="literal">index.routing.allocation.exclude.tag</code> to <code class="literal">value3</code>. For example:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test/_settings -d '{
    "index.routing.allocation.exclude.tag" : "value3"
}'</pre><p><code class="literal">index.routing.allocation.require.*</code> can be used to
specify a number of rules, all of which MUST match in order for a shard
to be allocated to a node. This is in contrast to <code class="literal">include</code> which will
include a node if ANY rule matches.</p><p>The <code class="literal">include</code>, <code class="literal">exclude</code> and <code class="literal">require</code> values can have generic simple
matching wildcards, for example, <code class="literal">value1*</code>. A special attribute name
called <code class="literal">_ip</code> can be used to match on node ip values.</p><p>Obviously a node can have several attributes associated with it, and
both the attribute name and value are controlled in the setting. For
example, here is a sample of several node configurations:</p><pre class="programlisting prettyprint lang-js">node.group1: group1_value1
node.group2: group2_value4</pre><p>In the same manner, <code class="literal">include</code>, <code class="literal">exclude</code> and <code class="literal">require</code> can work against
several attributes, for example:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/test/_settings -d '{
    "index.routing.allocation.include.group1" : "xxx"
    "index.routing.allocation.include.group2" : "yyy",
    "index.routing.allocation.exclude.group3" : "zzz",
    "index.routing.allocation.require.group4" : "aaa",
}'</pre><p>The provided settings can also be updated in real time using the update
settings API, allowing to "move" indices (shards) around in realtime.</p><p>Cluster wide filtering can also be defined, and be updated in real time
using the cluster update settings API. This setting can come in handy
for things like decommissioning nodes (even if the replica count is set
to 0). Here is a sample of how to decommission a node based on <code class="literal">_ip</code>
address:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/_cluster/settings -d '{
    "transient" : {
        "cluster.routing.allocation.exclude._ip" : "10.0.0.1"
    }
}'</pre><h3><a id="_total_shards_per_node"></a>Total Shards Per Node</h3><p>The <code class="literal">index.routing.allocation.total_shards_per_node</code> setting allows to
control how many total shards for an index will be allocated per node.
It can be dynamically set on a live index using the update index
settings API.</p><h3><a id="disk"></a>Disk-based Shard Allocation</h3><p>Elasticsearch con be configured to prevent shard
allocation on nodes depending on disk usage for the node. This
functionality is disabled by default, and can be changed either in the
configuration file, or dynamically using:</p><pre class="programlisting prettyprint lang-js">curl -XPUT localhost:9200/_cluster/settings -d '{
    "transient" : {
        "cluster.routing.allocation.disk.threshold_enabled" : true
    }
}'</pre><p>Once enabled, Elasticsearch uses two watermarks to decide whether
shards should be allocated or can remain on the node.</p><p><code class="literal">cluster.routing.allocation.disk.watermark.low</code> controls the low
watermark for disk usage. It defaults to 0.70, meaning ES will not
allocate new shards to nodes once they have more than 70% disk
used. It can also be set to an absolute byte value (like 500mb) to
prevent ES from allocating shards if less than the configured amount
of space is available.</p><p><code class="literal">cluster.routing.allocation.disk.watermark.high</code> controls the high
watermark. It defaults to 0.85, meaning ES will attempt to relocate
shards to another node if the node disk usage rises above 85%. It can
also be set to an absolute byte value (similar to the low watermark)
to relocate shards once less than the configured amount of space is
available on the node.</p><p>Both watermark settings can be changed dynamically using the cluster
settings API. By default, Elasticsearch will retrieve information
about the disk usage of the nodes every 30 seconds. This can also be
changed by setting the <code class="literal">cluster.info.update.interval</code> setting.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="index-modules-slowlog"></a>Index Slow Log</h2></div></div></div><h3><a id="search-slow-log"></a>Search Slow Log</h3><p>Shard level slow search log allows to log slow search (query and fetch
executions) into a dedicated log file.</p><p>Thresholds can be set for both the query phase of the execution, and
fetch phase, here is a sample:</p><pre class="programlisting prettyprint lang-js">#index.search.slowlog.threshold.query.warn: 10s
#index.search.slowlog.threshold.query.info: 5s
#index.search.slowlog.threshold.query.debug: 2s
#index.search.slowlog.threshold.query.trace: 500ms

#index.search.slowlog.threshold.fetch.warn: 1s
#index.search.slowlog.threshold.fetch.info: 800ms
#index.search.slowlog.threshold.fetch.debug: 500ms
#index.search.slowlog.threshold.fetch.trace: 200ms</pre><p>By default, none are enabled (set to <code class="literal">-1</code>). Levels (<code class="literal">warn</code>, <code class="literal">info</code>,
<code class="literal">debug</code>, <code class="literal">trace</code>) allow to control under which logging level the log
will be logged. Not all are required to be configured (for example, only
<code class="literal">warn</code> threshold can be set). The benefit of several levels is the
ability to quickly "grep" for specific thresholds breached.</p><p>The logging is done on the shard level scope, meaning the execution of a
search request within a specific shard. It does not encompass the whole
search request, which can be broadcast to several shards in order to
execute. Some of the benefits of shard level logging is the association
of the actual execution on the specific machine, compared with request
level.</p><p>All settings are index level settings (and each index can have different
values for it), and can be changed in runtime using the index update
settings API.</p><p>The logging file is configured by default using the following
configuration (found in <code class="literal">logging.yml</code>):</p><pre class="programlisting prettyprint lang-js">index_search_slow_log_file:
  type: dailyRollingFile
  file: ${path.logs}/${cluster.name}_index_search_slowlog.log
  datePattern: "'.'yyyy-MM-dd"
  layout:
    type: pattern
    conversionPattern: "[%d{ISO8601}][%-5p][%-25c] %m%n"</pre><h3><a id="index-slow-log"></a>Index Slow log</h3><p>p.The indexing slow log, similar in functionality to the search slow
log. The log file is ends with <code class="literal">_index_indexing_slowlog.log</code>. Log and
the thresholds are configured in the elasticsearch.yml file in the same
way as the search slowlog. Index slowlog sample:</p><pre class="programlisting prettyprint lang-js">#index.indexing.slowlog.threshold.index.warn: 10s
#index.indexing.slowlog.threshold.index.info: 5s
#index.indexing.slowlog.threshold.index.debug: 2s
#index.indexing.slowlog.threshold.index.trace: 500ms</pre><p>The index slow log file is configured by default in the <code class="literal">logging.yml</code>
file:</p><pre class="programlisting prettyprint lang-js">index_indexing_slow_log_file:
    type: dailyRollingFile
    file: ${path.logs}/${cluster.name}_index_indexing_slowlog.log
    datePattern: "'.'yyyy-MM-dd"
    layout:
      type: pattern
      conversionPattern: "[%d{ISO8601}][%-5p][%-25c] %m%n"</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="index-modules-merge"></a>Merge</h2></div></div></div><p>A shard in elasticsearch is a Lucene index, and a Lucene index is broken
down into segments. Segments are internal storage elements in the index
where the index data is stored, and are immutable up to delete markers.
Segments are, periodically, merged into larger segments to keep the
index size at bay and expunge deletes.</p><p>The more segments one has in the Lucene index means slower searches and
more memory used. Segment merging is used to reduce the number of segments,
however merges can be expensive to perform, especially on low IO environments.
Merges can be throttled using <a class="link" href="#store-throttling" title="Store Level Throttling">store level throttling</a>.</p><h3><a id="policy"></a>Policy</h3><p>The index merge policy module allows one to control which segments of a
shard index are to be merged. There are several types of policies with
the default set to <code class="literal">tiered</code>.</p><h4><a id="tiered"></a>tiered</h4><p>Merges segments of approximately equal size, subject to an allowed
number of segments per tier. This is similar to <code class="literal">log_bytes_size</code> merge
policy, except this merge policy is able to merge non-adjacent segment,
and separates how many segments are merged at once from how many
segments are allowed per tier. This merge policy also does not
over-merge (i.e., cascade merges).</p><p>This policy has the following settings:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">index.merge.policy.expunge_deletes_allowed</code>
</span></dt><dd>
        When expungeDeletes is called, we only merge away a segment if its delete
        percentage is over this threshold. Default is <code class="literal">10</code>.
</dd><dt><span class="term">
<code class="literal">index.merge.policy.floor_segment</code>
</span></dt><dd>
        Segments smaller than this are "rounded up" to this size, i.e. treated as
        equal (floor) size for merge selection. This is to prevent frequent
        flushing of tiny segments, thus preventing a long tail in the index. Default
        is <code class="literal">2mb</code>.
</dd><dt><span class="term">
<code class="literal">index.merge.policy.max_merge_at_once</code>
</span></dt><dd>
        Maximum number of segments to be merged at a time during "normal" merging.
        Default is <code class="literal">10</code>.
</dd><dt><span class="term">
<code class="literal">index.merge.policy.max_merge_at_once_explicit</code>
</span></dt><dd>
        Maximum number of segments to be merged at a time, during optimize or
        expungeDeletes. Default is <code class="literal">30</code>.
</dd><dt><span class="term">
<code class="literal">index.merge.policy.max_merged_segment</code>
</span></dt><dd>
        Maximum sized segment to produce during normal merging (not explicit
        optimize). This setting is approximate: the estimate of the merged segment
        size is made by summing sizes of to-be-merged segments (compensating for
        percent deleted docs). Default is <code class="literal">5gb</code>.
</dd><dt><span class="term">
<code class="literal">index.merge.policy.segments_per_tier</code>
</span></dt><dd>
        Sets the allowed number of segments per tier. Smaller values mean more
        merging but fewer segments. Default is <code class="literal">10</code>. Note, this value needs to be
        &gt;= than the <code class="literal">max_merge_at_once</code> otherwise youâll force too many merges to
        occur.
</dd><dt><span class="term">
<code class="literal">index.reclaim_deletes_weight</code>
</span></dt><dd>
        Controls how aggressively merges that reclaim more deletions are favored.
        Higher values favor selecting merges that reclaim deletions. A value of
        <code class="literal">0.0</code> means deletions donât impact merge selection. Defaults to <code class="literal">2.0</code>.
</dd><dt><span class="term">
<code class="literal">index.compound_format</code>
</span></dt><dd>
        Should the index be stored in compound format or not. Defaults to <code class="literal">false</code>.
        See <a class="link" href="#index-compound-format"><code class="literal">index.compound_format</code></a> in
        <a class="xref" href="#index-modules-settings" title="Index Settings">the section called âIndex Settingsâ</a>.
</dd></dl></div><p>For normal merging, this policy first computes a "budget" of how many
segments are allowed to be in the index. If the index is over-budget,
then the policy sorts segments by decreasing size (proportionally considering percent
deletes), and then finds the least-cost merge. Merge cost is measured by
a combination of the "skew" of the merge (size of largest seg divided by
smallest seg), total merge size and pct deletes reclaimed, so that
merges with lower skew, smaller size and those reclaiming more deletes,
are favored.</p><p>If a merge will produce a segment thatâs larger than
<code class="literal">max_merged_segment</code> then the policy will merge fewer segments (down to
1 at once, if that one has deletions) to keep the segment size under
budget.</p><p>Note, this can mean that for large shards that holds many gigabytes of
data, the default of <code class="literal">max_merged_segment</code> (<code class="literal">5gb</code>) can cause for many
segments to be in an index, and causing searches to be slower. Use the
indices segments API to see the segments that an index has, and
possibly either increase the <code class="literal">max_merged_segment</code> or issue an optimize
call for the index (try and aim to issue it on a low traffic time).</p><h4><a id="log-byte-size"></a>log_byte_size</h4><p>A merge policy that merges segments into levels of exponentially
increasing <span class="strong"><strong>byte size</strong></span>, where each level has fewer segments than the
value of the merge factor. Whenever extra segments (beyond the merge
factor upper bound) are encountered, all segments within the level are
merged.</p><p>This policy has the following settings:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>index.merge.policy.merge_factor</p></td><td align="left" valign="top"><p>Determines how often segment indices
are merged by index operation. With smaller values, less RAM is used
while indexing, and searches on unoptimized indices are faster, but
indexing speed is slower. With larger values, more RAM is used during
indexing, and while searches on unoptimized indices are slower, indexing
is faster. Thus larger values (greater than 10) are best for batch index
creation, and smaller values (lower than 10) for indices that are
interactively maintained. Defaults to <code class="literal">10</code>.</p></td></tr><tr><td align="left" valign="top"><p>index.merge.policy.min_merge_size</p></td><td align="left" valign="top"><p>A size setting type which sets the
minimum size for the lowest level segments. Any segments below this size
are considered to be on the same level (even if they vary drastically in
size) and will be merged whenever there are mergeFactor of them. This
effectively truncates the "long tail" of small segments that would
otherwise be created into a single level. If you set this too large, it
could greatly increase the merging cost during indexing (if you flush
many small segments). Defaults to <code class="literal">1.6mb</code></p></td></tr><tr><td align="left" valign="top"><p>index.merge.policy.max_merge_size</p></td><td align="left" valign="top"><p>A size setting type which sets the
largest segment (measured by total byte size of the segmentâs files)
that may be merged with other segments. Defaults to unbounded.</p></td></tr><tr><td align="left" valign="top"><p>index.merge.policy.max_merge_docs</p></td><td align="left" valign="top"><p>Determines the largest segment
(measured by document count) that may be merged with other segments.
Defaults to unbounded.</p></td></tr></tbody></table></div><h4><a id="log-doc"></a>log_doc</h4><p>A merge policy that tries to merge segments into levels of exponentially
increasing <span class="strong"><strong>document count</strong></span>, where each level has fewer segments than
the value of the merge factor. Whenever extra segments (beyond the merge
factor upper bound) are encountered, all segments within the level are
merged.</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>index.merge.policy.merge_factor</p></td><td align="left" valign="top"><p>Determines how often segment indices
are merged by index operation. With smaller values, less RAM is used
while indexing, and searches on unoptimized indices are faster, but
indexing speed is slower. With larger values, more RAM is used during
indexing, and while searches on unoptimized indices are slower, indexing
is faster. Thus larger values (greater than 10) are best for batch index
creation, and smaller values (lower than 10) for indices that are
interactively maintained. Defaults to <code class="literal">10</code>.</p></td></tr><tr><td align="left" valign="top"><p>index.merge.policy.min_merge_docs</p></td><td align="left" valign="top"><p>Sets the minimum size for the lowest
level segments. Any segments below this size are considered to be on the
same level (even if they vary drastically in size) and will be merged
whenever there are mergeFactor of them. This effectively truncates the
"long tail" of small segments that would otherwise be created into a
single level. If you set this too large, it could greatly increase the
merging cost during indexing (if you flush many small segments).
Defaults to <code class="literal">1000</code>.</p></td></tr><tr><td align="left" valign="top"><p>index.merge.policy.max_merge_docs</p></td><td align="left" valign="top"><p>Determines the largest segment
(measured by document count) that may be merged with other segments.
Defaults to unbounded.</p></td></tr></tbody></table></div><h3><a id="scheduling"></a>Scheduling</h3><p>The merge schedule controls the execution of merge operations once they
are needed (according to the merge policy). The following types are
supported, with the default being the <code class="literal">SerialMergeScheduler</code>.</p><p>Note, the default is the serial merge scheduler since there is a merge
thread pool that explicitly schedules merges, and it makes sure that
merges are serial within a shard, yet concurrent across multiple shards.</p><h4><a id="_concurrentmergescheduler"></a>ConcurrentMergeScheduler</h4><p>A merge scheduler that runs merges using a separate thread. When the maximum
number of threads is reached, further merges will wait until a merge thread
becomes available.</p><p>The scheduler supports the following settings:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">index.merge.scheduler.max_thread_count</code>
</span></dt><dd>
The maximum number of threads to perform the merge operation. Defaults to
<code class="literal">Math.max(1, Math.min(3, Runtime.getRuntime().availableProcessors() / 2))</code>.
</dd></dl></div><h4><a id="_serialmergescheduler"></a>SerialMergeScheduler</h4><p>A merge scheduler that simply does each merge sequentially using the
calling thread (blocking the operations that triggered the merge or the
index operation).</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="index-modules-store"></a>Store</h2></div></div></div><p>The store module allows you to control how index data is stored.</p><p>The index can either be stored in-memory (no persistence) or on-disk
(the default). In-memory indices provide better performance at the cost
of limiting the index size to the amount of available physical memory.</p><p>When using a local gateway (the default), file system storage with <span class="strong"><strong>no</strong></span>
in memory storage is required to maintain index consistency. This is
required since the local gateway constructs its state from the local
index state of each node.</p><p>Another important aspect of memory based storage is the fact that
Elasticsearch supports storing the index in memory <span class="strong"><strong>outside of the JVM
heap space</strong></span> using the "Memory" (see below) storage type. It translates
to the fact that there is no need for extra large JVM heaps (with their
own consequences) for storing the index in memory.</p><h3><a id="store-throttling"></a>Store Level Throttling</h3><p>The way Lucene, the IR library elasticsearch uses under the covers,
works is by creating immutable segments (up to deletes) and constantly
merging them (the merge policy settings allow to control how those
merges happen). The merge process happens in an asynchronous manner
without affecting the indexing / search speed. The problem though,
especially on systems with low IO, is that the merge process can be
expensive and affect search / index operation simply by the fact that
the box is now taxed with more IO happening.</p><p>The store module allows to have throttling configured for merges (or
all) either on the node level, or on the index level. The node level
throttling will make sure that out of all the shards allocated on that
node, the merge process wonât pass the specific setting bytes per
second. It can be set by setting <code class="literal">indices.store.throttle.type</code> to
<code class="literal">merge</code>, and setting <code class="literal">indices.store.throttle.max_bytes_per_sec</code> to
something like <code class="literal">5mb</code>. The node level settings can be changed dynamically
using the cluster update settings API. The default is set
to <code class="literal">20mb</code> with type <code class="literal">merge</code>.</p><p>If specific index level configuration is needed, regardless of the node
level settings, it can be set as well using the
<code class="literal">index.store.throttle.type</code>, and
<code class="literal">index.store.throttle.max_bytes_per_sec</code>. The default value for the type
is <code class="literal">node</code>, meaning it will throttle based on the node level settings and
participate in the global throttling happening. Both settings can be set
using the index update settings API dynamically.</p><p>The following sections lists all the different storage types supported.</p><h3><a id="file-system"></a>File System</h3><p>File system based storage is the default storage used. There are
different implementations or storage types. The best one for the
operating environment will be automatically chosen: <code class="literal">mmapfs</code> on
Solaris/Linux/Windows 64bit, <code class="literal">simplefs</code> on Windows 32bit, and
<code class="literal">niofs</code> for the rest.</p><p>The following are the different file system based storage types:</p><h4><a id="_simple_fs"></a>Simple FS</h4><p>The <code class="literal">simplefs</code> type is a straightforward implementation of file system
storage (maps to Lucene <code class="literal">SimpleFsDirectory</code>) using a random access file.
This implementation has poor concurrent performance (multiple threads
will bottleneck). It is usually better to use the <code class="literal">niofs</code> when you need
index persistence.</p><h4><a id="_nio_fs"></a>NIO FS</h4><p>The <code class="literal">niofs</code> type stores the shard index on the file system (maps to
Lucene <code class="literal">NIOFSDirectory</code>) using NIO. It allows multiple threads to read
from the same file concurrently. It is not recommended on Windows
because of a bug in the SUN Java implementation.</p><h4><a id="mmapfs"></a>MMap FS</h4><p>The <code class="literal">mmapfs</code> type stores the shard index on the file system (maps to
Lucene <code class="literal">MMapDirectory</code>) by mapping a file into memory (mmap). Memory
mapping uses up a portion of the virtual memory address space in your
process equal to the size of the file being mapped. Before using this
class, be sure your have plenty of virtual address space.</p><h3><a id="store-memory"></a>Memory</h3><p>The <code class="literal">memory</code> type stores the index in main memory.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="index-modules-mapper"></a>Mapper</h2></div></div></div><p>The mapper module acts as a registry for the type mapping definitions
added to an index either when creating it or by using the put mapping
api. It also handles the dynamic mapping support for types that have no
explicit mappings pre defined. For more information about mapping
definitions, check out the <a class="link" href="#mapping" title="Mapping">mapping section</a>.</p><h3><a id="_dynamic_mappings"></a>Dynamic Mappings</h3><p>New types and new fields within types can be added dynamically just
by indexing a document.  When Elasticsearch encounters a new type,
it creates the type using the <code class="literal">_default_</code> mapping (see below).</p><p>When it encounters a new field within a type, it autodetects the
datatype that the field contains and adds it to the type mapping
automatically.</p><p>See <a class="xref" href="#mapping-dynamic-mapping" title="Dynamic Mapping"><em>Dynamic Mapping</em></a> for details of how to control and
configure dynamic mapping.</p><h3><a id="_default_mapping"></a>Default Mapping</h3><p>When a new type is created (at <a class="link" href="#indices-create-index" title="Create Index">index creation</a> time,
using the  <a class="link" href="#indices-put-mapping" title="Put Mapping"><code class="literal">put-mapping</code> API</a> or just by indexing a
document into it), the type uses the <code class="literal">_default_</code> mapping as its basis.  Any
mapping specified in the  <a class="link" href="#indices-create-index" title="Create Index"><code class="literal">create-index</code></a> or
<a class="link" href="#indices-put-mapping" title="Put Mapping"><code class="literal">put-mapping</code></a> request override values set in the
<code class="literal">_default_</code> mapping.</p><p>The default mapping definition is a plain mapping definition that is
embedded within ElasticSearch:</p><pre class="programlisting prettyprint lang-js">{
    _default_ : {
    }
}</pre><p>Pretty short, isnât it? Basically, everything is `<span class="emphasis"><em>default</em></span>`ed, including the
dynamic nature of the root object mapping which allows new fields to be added
automatically.</p><p>The built-in default mapping definition can be overridden in several ways. A
<code class="literal">_default_</code> mapping can be specified when creating a new index, or the global
<code class="literal">_default_</code> mapping (for all indices) can be configured by creating a file
called <code class="literal">config/default-mapping.json</code>. (This location can be changed with
the <code class="literal">index.mapper.default_mapping_location</code> setting.)</p><p>Dynamic creation of mappings for unmapped types can be completely
disabled by setting <code class="literal">index.mapper.dynamic</code> to <code class="literal">false</code>.</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="index-modules-translog"></a>Translog</h2></div></div></div><p>Each shard has a transaction log or write ahead log associated with it.
It allows to guarantee that when an index/delete operation occurs, it is
applied atomically, while not "committing" the internal Lucene index for
each request. A flush ("commit") still happens based on several
parameters:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>index.translog.flush_threshold_ops</p></td><td align="left" valign="top"><p>After how many operations to flush.
Defaults to <code class="literal">5000</code>.</p></td></tr><tr><td align="left" valign="top"><p>index.translog.flush_threshold_size</p></td><td align="left" valign="top"><p>Once the translog hits this size,
a flush will happen. Defaults to <code class="literal">200mb</code>.</p></td></tr><tr><td align="left" valign="top"><p>index.translog.flush_threshold_period</p></td><td align="left" valign="top"><p>The period with no flush
happening to force a flush. Defaults to <code class="literal">30m</code>.</p></td></tr><tr><td align="left" valign="top"><p>index.translog.interval</p></td><td align="left" valign="top"><p>How often to check if a flush is needed, randomized
between the interval value and 2x the interval value. Defaults to <code class="literal">5s</code>.</p></td></tr></tbody></table></div><p>Note: these parameters can be updated at runtime using the Index
Settings Update API (for example, these number can be increased when
executing bulk updates to support higher TPS)</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="index-modules-cache"></a>Cache</h2></div></div></div><p>There are different caching inner modules associated with an index. They
include <code class="literal">filter</code> and others.</p><h3><a id="filter"></a>Filter Cache</h3><p>The filter cache is responsible for caching the results of filters (used
in the query). The default implementation of a filter cache (and the one
recommended to use in almost all cases) is the <code class="literal">node</code> filter cache type.</p><h4><a id="node-filter"></a>Node Filter Cache</h4><p>The <code class="literal">node</code> filter cache may be configured to use either a percentage of
the total memory allocated to the process or an specific amount of
memory. All shards present on a node share a single node cache (thats
why its called <code class="literal">node`</code>). The cache implements an LRU eviction policy:
when a cache becomes full, the least recently used data is evicted to
make way for new data.</p><p>The setting that allows one to control the memory size for the filter
cache is <code class="literal">indices.cache.filter.size</code>, which defaults to <code class="literal">20%</code>. <span class="strong"><strong>Note</strong></span>,
this is <span class="strong"><strong>not</strong></span> an index level setting but a node level setting (can be
configured in the node configuration).</p><p><code class="literal">indices.cache.filter.size</code> can accept either a percentage value, like
<code class="literal">30%</code>, or an exact value, like <code class="literal">512mb</code>.</p><h4><a id="index-filter"></a>Index Filter Cache</h4><p>A filter cache that exists on the index level (on each node). Generally,
not recommended for use since its memory usage depends on which shards
are allocated on each node and its hard to predict it. The types are:
<code class="literal">resident</code>, <code class="literal">soft</code> and <code class="literal">weak</code>.</p><p>All types support the following settings:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">index.cache.filter.max_size</code></p></td><td align="left" valign="top"><p>The max size (count, not byte size) of
the cache (per search segment in a shard). Defaults to not set (<code class="literal">-1</code>),
which is usually fine with <code class="literal">soft</code> cache and proper cacheable filters.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">index.cache.filter.expire</code></p></td><td align="left" valign="top"><p>A time based setting that expires filters
after a certain time of inactivity. Defaults to <code class="literal">-1</code>. For example, can
be set to <code class="literal">5m</code> for a 5 minute expiry.</p></td></tr></tbody></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="index-modules-fielddata"></a>Field data</h2></div></div></div><p>The field data cache is used mainly when sorting on or faceting on a
field. It loads all the field values to memory in order to provide fast
document based access to those values. The field data cache can be
expensive to build for a field, so its recommended to have enough memory
to allocate it, and to keep it loaded.</p><p>The amount of memory used for the field
data cache can be controlled using <code class="literal">indices.fielddata.cache.size</code>. Note:
reloading  the field data which does not fit into your cache will be expensive
and  perform poorly.</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">indices.fielddata.cache.size</code></p></td><td align="left" valign="top"><p>The max size of the field data cache,
eg <code class="literal">30%</code> of node heap space, or an absolute value, eg <code class="literal">12GB</code>. Defaults
to unbounded.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">indices.fielddata.cache.expire</code></p></td><td align="left" valign="top"><p>A time based setting that expires
field data after a certain time of inactivity. Defaults to <code class="literal">-1</code>. For
example, can be set to <code class="literal">5m</code> for a 5 minute expiry.</p></td></tr></tbody></table></div><h3><a id="fielddata-circuit-breaker"></a>Field data circuit breaker</h3><p>The field data circuit breaker allows Elasticsearch to estimate the amount of
memory a field will required to be loaded into memory. It can then prevent the
field data loading by raising and exception. By default the limit is configured
to 80% of the maximum JVM heap. It can be configured with the following
parameters:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Setting </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">indices.fielddata.breaker.limit</code></p></td><td align="left" valign="top"><p>Maximum size of estimated field data
to allow loading. Defaults to 80% of the maximum JVM heap.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">indices.fielddata.breaker.overhead</code></p></td><td align="left" valign="top"><p>A constant that all field data
estimations are multiplied with to determine a final estimation. Defaults to
1.03</p></td></tr></tbody></table></div><p>Both the <code class="literal">indices.fielddata.breaker.limit</code> and
<code class="literal">indices.fielddata.breaker.overhead</code> can be changed dynamically using the
cluster update settings API.</p><h3><a id="fielddata-monitoring"></a>Monitoring field data</h3><p>You can monitor memory usage for field data as well as the field data circuit
breaker using
<a class="link" href="#cluster-nodes-stats" title="Nodes Stats">Nodes Stats API</a></p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="fielddata-formats"></a>Field data formats</h2></div></div></div><p>The field data format controls how field data should be stored.</p><p>Depending on the field type, there might be several field data types
available. In particular, string and numeric types support the <code class="literal">doc_values</code>
format which allows for computing the field data data-structures at indexing
time and storing them on disk. Although it will make the index larger and may
be slightly slower, this implementation will be more near-realtime-friendly
and will require much less memory from the JVM than other implementations.</p><p>Here is an example of how to configure the <code class="literal">tag</code> field to use the <code class="literal">fst</code> field
data format.</p><pre class="programlisting prettyprint lang-js">{
    tag: {
        type:      "string",
        fielddata: {
            format: "fst"
        }
    }
}</pre><p>It is possible to change the field data format (and the field data settings
in general) on a live index by using the update mapping API. When doing so,
field data which had already been loaded for existing segments will remain
alive while new segments will use the new field data configuration. Thanks to
the background merging process, all segments will eventually use the new
field data format.</p><h4><a id="_string_field_data_types"></a>String field data types</h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">paged_bytes</code> (default)
</span></dt><dd>
    Stores unique terms sequentially in a large buffer and maps documents to
    the indices of the terms they contain in this large buffer.
</dd><dt><span class="term">
<code class="literal">fst</code>
</span></dt><dd>
    Stores terms in a FST. Slower to build than <code class="literal">paged_bytes</code> but can help lower
    memory usage if many terms share common prefixes and/or suffixes.
</dd><dt><span class="term">
<code class="literal">doc_values</code>
</span></dt><dd>
    Computes and stores field data data-structures on disk at indexing time.
    Lowers memory usage but only works on non-analyzed strings (<code class="literal">index</code>: <code class="literal">no</code> or
    <code class="literal">not_analyzed</code>) and doesnât support filtering.
</dd></dl></div><h4><a id="_numeric_field_data_types"></a>Numeric field data types</h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">array</code> (default)
</span></dt><dd>
    Stores field values in memory using arrays.
</dd><dt><span class="term">
<code class="literal">doc_values</code>
</span></dt><dd>
    Computes and stores field data data-structures on disk at indexing time.
    Doesnât support filtering.
</dd></dl></div><h4><a id="_geo_point_field_data_types"></a>Geo point field data types</h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">array</code> (default)
</span></dt><dd>
    Stores latitudes and longitudes in arrays.
</dd><dt><span class="term">
<code class="literal">doc_values</code>
</span></dt><dd>
    Computes and stores field data data-structures on disk at indexing time.
</dd></dl></div><h3><a id="_fielddata_loading"></a>Fielddata loading</h3><p>By default, field data is loaded lazily, ie. the first time that a query that
requires them is executed. However, this can make the first requests that
follow a merge operation quite slow since fielddata loading is a heavy
operation.</p><p>It is possible to force field data to be loaded and cached eagerly through the
<code class="literal">loading</code> setting of fielddata:</p><pre class="programlisting prettyprint lang-js">{
    category: {
        type:      "string",
        fielddata: {
            loading: "eager"
        }
    }
}</pre><h4><a id="_disabling_field_data_loading"></a>Disabling field data loading</h4><p>Field data can take a lot of RAM so it makes sense to disable field data
loading on the fields that donât need field data, for example those that are
used for full-text search only. In order to disable field data loading, just
change the field data format to <code class="literal">disabled</code>. When disabled, all requests that
will try to load field data, e.g. when they include aggregations and/or sorting,
will return an error.</p><pre class="programlisting prettyprint lang-js">{
    text: {
        type:      "string",
        fielddata: {
            format: "disabled"
        }
    }
}</pre><p>The <code class="literal">disabled</code> format is supported by all field types.</p><h3><a id="field-data-filtering"></a>Filtering fielddata</h3><p>It is possible to control which field values are loaded into memory,
which is particularly useful for string fields. When specifying the
<a class="link" href="#mapping-core-types" title="Core Types">mapping</a> for a field, you
can also specify a fielddata filter.</p><p>Fielddata filters can be changed using the
<a class="link" href="#indices-put-mapping" title="Put Mapping">PUT mapping</a>
API. After changing the filters, use the
<a class="link" href="#indices-clearcache" title="Clear Cache">Clear Cache</a> API
to reload the fielddata using the new filters.</p><h4><a id="_filtering_by_frequency"></a>Filtering by frequency:</h4><p>The frequency filter allows you to only load terms whose frequency falls
between a <code class="literal">min</code> and <code class="literal">max</code> value, which can be expressed an absolute
number or as a percentage (eg <code class="literal">0.01</code> is <code class="literal">1%</code>). Frequency is calculated
<span class="strong"><strong>per segment</strong></span>. Percentages are based on the number of docs which have a
value for the field, as opposed to all docs in the segment.</p><p>Small segments can be excluded completely by specifying the minimum
number of docs that the segment should contain with <code class="literal">min_segment_size</code>:</p><pre class="programlisting prettyprint lang-js">{
    tag: {
        type:      "string",
        fielddata: {
            filter: {
                frequency: {
                    min:              0.001,
                    max:              0.1,
                    min_segment_size: 500
                }
            }
        }
    }
}</pre><h4><a id="_filtering_by_regex"></a>Filtering by regex</h4><p>Terms can also be filtered by regular expression - only values which
match the regular expression are loaded. Note: the regular expression is
applied to each term in the field, not to the whole field value. For
instance, to only load hashtags from a tweet, we can use a regular
expression which matches terms beginning with <code class="literal">#</code>:</p><pre class="programlisting prettyprint lang-js">{
    tweet: {
        type:      "string",
        analyzer:  "whitespace"
        fielddata: {
            filter: {
                regex: {
                    pattern: "^#.*"
                }
            }
        }
    }
}</pre><h4><a id="_combining_filters"></a>Combining filters</h4><p>The <code class="literal">frequency</code> and <code class="literal">regex</code> filters can be combined:</p><pre class="programlisting prettyprint lang-js">{
    tweet: {
        type:      "string",
        analyzer:  "whitespace"
        fielddata: {
            filter: {
                regex: {
                    pattern:          "^#.*",
                },
                frequency: {
                    min:              0.001,
                    max:              0.1,
                    min_segment_size: 500
                }
            }
        }
    }
}</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="index-modules-codec"></a>Codec module</h2></div></div></div><p>Codecs define how documents are written to disk and read from disk. The
postings format is the part of the codec that is responsible for reading
and writing the term dictionary, postings lists and positions, as well as the payloads
and offsets stored in the postings list. The doc values format is
responsible for reading column-stride storage for a field and is typically
used for sorting or faceting. When a field doesnât have doc values enabled,
it is still possible to sort or facet by loading field values from the
inverted index into main memory.</p><p>Configuring custom postings or doc values formats is an expert feature and
most likely using the builtin formats will suit your needs as is described
in the <a class="link" href="#mapping-core-types" title="Core Types">mapping section</a>.</p><div class="sidebar"><div class="titlepage"></div><p>Only the default codec, postings format and doc values format are supported:
other formats may break backward compatibility between minor versions of
Elasticsearch, requiring data to be reindexed.</p></div><h3><a id="custom-postings"></a>Configuring a custom postings format</h3><p>A custom postings format can be defined in the index settings in the
<code class="literal">codec</code> part. The <code class="literal">codec</code> part can be configured when creating an index
or updating index settings. An example on how to define your custom
postings format:</p><pre class="programlisting prettyprint lang-js">curl -XPUT 'http://localhost:9200/twitter/' -d '{
    "settings" : {
        "index" : {
            "codec" : {
          "postings_format" : {
             "my_format" : {
                "type" : "pulsing",
                "freq_cut_off" : "5"
             }
          }
       }
        }
    }
}'</pre><p>Then when defining your mapping you can use the <code class="literal">my_format</code> name in the
<code class="literal">postings_format</code> option as the example below illustrates:</p><pre class="programlisting prettyprint lang-js">{
  "person" : {
     "properties" : {
         "second_person_id" : {"type" : "string", "postings_format" : "my_format"}
     }
  }
}</pre><h3><a id="_available_postings_formats"></a>Available postings formats</h3><h4><a id="direct-postings"></a>Direct postings format</h4><p>Wraps the default postings format for on-disk storage, but then at read
time loads and stores all terms &amp; postings directly in RAM. This
postings format makes no effort to compress the terms and posting list
and therefore is memory intensive, but because of this it gives a
substantial increase in search performance. Because this holds all term
bytes as a single byte[], you cannot have more than 2.1GB worth of terms
in a single segment.</p><p>This postings format offers the following parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">min_skip_count</code>
</span></dt><dd>
    The minimum number terms with a shared prefix to
    allow a skip pointer to be written. The default is <span class="strong"><strong>8</strong></span>.
</dd><dt><span class="term">
<code class="literal">low_freq_cutoff</code>
</span></dt><dd>
    Terms with a lower document frequency use a
    single array object representation for postings and positions. The
    default is <span class="strong"><strong>32</strong></span>.
</dd></dl></div><p>Type name: <code class="literal">direct</code></p><h4><a id="memory-postings"></a>Memory postings format</h4><p>A postings format that stores terms &amp; postings (docs, positions,
payloads) in RAM, using an FST. This postings format does write to disk,
but loads everything into memory. The memory postings format has the
following options:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">pack_fst</code>
</span></dt><dd>
    A boolean option that defines if the in memory structure
    should be packed once its build. Packed will reduce the size for the
    data-structure in memory but requires more memory during building.
    Default is <span class="strong"><strong>false</strong></span>.
</dd><dt><span class="term">
<code class="literal">acceptable_overhead_ratio</code>
</span></dt><dd>
    The compression ratio specified as a
    float, that is used to compress internal structures. Example ratios <code class="literal">0</code>
    (Compact, no memory overhead at all, but the returned implementation may
    be slow), <code class="literal">0.5</code> (Fast, at most 50% memory overhead, always select a
    reasonably fast implementation), <code class="literal">7</code> (Fastest, at most 700% memory
    overhead, no compression). Default is <code class="literal">0.2</code>.
</dd></dl></div><p>Type name: <code class="literal">memory</code></p><h4><a id="bloom-postings"></a>Bloom filter posting format</h4><p>The bloom filter postings format wraps a delegate postings format and on
top of this creates a bloom filter that is written to disk. During
opening this bloom filter is loaded into memory and used to offer
"fast-fail" reads. This postings format is useful for low doc-frequency
fields such as primary keys. The bloom filter postings format has the
following options:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">delegate</code>
</span></dt><dd>
    The name of the configured postings format that the
    bloom filter postings format will wrap.
</dd><dt><span class="term">
<code class="literal">fpp</code>
</span></dt><dd>
    The desired false positive probability specified as a
    floating point number between 0 and 1.0. The <code class="literal">fpp</code> can be configured for
    multiple expected insertions. Example expression: <span class="strong"><strong>10k=0.01,1m=0.03</strong></span>. If
    number docs per index segment is larger than <span class="strong"><strong>1m</strong></span> then use <span class="strong"><strong>0.03</strong></span> as fpp
    and if number of docs per segment is larger than <span class="strong"><strong>10k</strong></span> use <span class="strong"><strong>0.01</strong></span> as
    fpp. The last fallback value is always <span class="strong"><strong>0.03</strong></span>. This example expression
    is also the default.
</dd></dl></div><p>Type name: <code class="literal">bloom</code></p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><a id="codec-bloom-load"></a><p>It can sometime make sense to disable bloom filters. For instance, if you are
logging into an index per day, and you have thousands of indices, the bloom
filters can take up a sizable amount of memory. For most queries you are only
interested in recent indices, so you donât mind CRUD operations on older
indices taking slightly longer.</p><p>In these cases you can disable loading of the bloom filter on  a per-index
basis by updating the index settings:</p><pre class="programlisting prettyprint lang-js">PUT /old_index/_settings?index.codec.bloom.load=false</pre><p>This setting, which defaults to <code class="literal">true</code>, can be updated on a live index. Note,
however, that changing the value will cause the index to be reopened, which
will invalidate any existing caches.</p></div></div><h4><a id="pulsing-postings"></a>Pulsing postings format</h4><p>The pulsing implementation in-lines the posting lists for very low
frequent terms in the term dictionary. This is useful to improve lookup
performance for low-frequent terms. This postings format offers the
following parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">min_block_size</code>
</span></dt><dd>
    The minimum block size the default Lucene term
    dictionary uses to encode on-disk blocks. Defaults to <span class="strong"><strong>25</strong></span>.
</dd><dt><span class="term">
<code class="literal">max_block_size</code>
</span></dt><dd>
    The maximum block size the default Lucene term
    dictionary uses to encode on-disk blocks. Defaults to <span class="strong"><strong>48</strong></span>.
</dd><dt><span class="term">
<code class="literal">freq_cut_off</code>
</span></dt><dd>
    The document frequency cut off where pulsing
    in-lines posting lists into the term dictionary. Terms with a document
    frequency less or equal to the cutoff will be in-lined. The default is
    <span class="strong"><strong>1</strong></span>.
</dd></dl></div><p>Type name: <code class="literal">pulsing</code></p><h4><a id="default-postings"></a>Default postings format</h4><p>The default postings format has the following options:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">min_block_size</code>
</span></dt><dd>
    The minimum block size the default Lucene term
    dictionary uses to encode on-disk blocks. Defaults to <span class="strong"><strong>25</strong></span>.
</dd><dt><span class="term">
<code class="literal">max_block_size</code>
</span></dt><dd>
    The maximum block size the default Lucene term
    dictionary uses to encode on-disk blocks. Defaults to <span class="strong"><strong>48</strong></span>.
</dd></dl></div><p>Type name: <code class="literal">default</code></p><h3><a id="_configuring_a_custom_doc_values_format"></a>Configuring a custom doc values format</h3><p>Custom doc values format can be defined in the index settings in the
<code class="literal">codec</code> part. The <code class="literal">codec</code> part can be configured when creating an index
or updating index settings. An example on how to define your custom
doc values format:</p><pre class="programlisting prettyprint lang-js">curl -XPUT 'http://localhost:9200/twitter/' -d '{
    "settings" : {
        "index" : {
            "codec" : {
                "doc_values_format" : {
                    "my_format" : {
                        "type" : "disk"
                    }
                }
            }
        }
    }
}'</pre><p>Then we defining your mapping your can use the <code class="literal">my_format</code> name in the
<code class="literal">doc_values_format</code> option as the example below illustrates:</p><pre class="programlisting prettyprint lang-js">{
  "product" : {
     "properties" : {
         "price" : {"type" : "integer", "doc_values_format" : "my_format"}
     }
  }
}</pre><h3><a id="_available_doc_values_formats"></a>Available doc values formats</h3><h4><a id="_memory_doc_values_format"></a>Memory doc values format</h4><p>A doc values format that stores all values in a FST in RAM. This format does
write to disk but the whole data-structure is loaded into memory when reading
the index. The memory postings format has no options.</p><p>Type name: <code class="literal">memory</code></p><h4><a id="_disk_doc_values_format"></a>Disk doc values format</h4><p>A doc values format that stores and reads everything from disk. Although it may
be slightly slower than the default doc values format, this doc values format
will require almost no memory from the JVM. The disk doc values format has no
options.</p><p>Type name: <code class="literal">disk</code></p><h4><a id="_default_doc_values_format"></a>Default doc values format</h4><p>The default doc values format tries to make a good compromise between speed and
memory usage by only loading into memory data-structures that matter for
performance. This makes this doc values format a good fit for most use-cases.
The default doc values format has no options.</p><p>Type name: <code class="literal">default</code></p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="index-modules-similarity"></a>Similarity module</h2></div></div></div><p>A similarity (scoring / ranking model) defines how matching documents
are scored. Similarity is per field, meaning that via the mapping one
can define a different similarity per field.</p><p>Configuring a custom similarity is considered a expert feature and the
builtin similarities are most likely sufficient as is described in the
<a class="link" href="#mapping-core-types" title="Core Types">mapping section</a></p><h3><a id="configuration"></a>Configuring a similarity</h3><p>Most existing or custom Similarities have configuration options which
can be configured via the index settings as shown below. The index
options can be provided when creating an index or updating index
settings.</p><pre class="programlisting prettyprint lang-js">"similarity" : {
  "my_similarity" : {
    "type" : "DFR",
    "basic_model" : "g",
    "after_effect" : "l",
    "normalization" : "h2",
    "normalization.h2.c" : "3.0"
  }
}</pre><p>Here we configure the DFRSimilarity so it can be referenced as
<code class="literal">my_similarity</code> in mappings as is illustrate in the below example:</p><pre class="programlisting prettyprint lang-js">{
  "book" : {
    "properties" : {
      "title" : { "type" : "string", "similarity" : "my_similarity" }
    }
}</pre><h3><a id="_available_similarities"></a>Available similarities</h3><h4><a id="default-similarity"></a>Default similarity</h4><p>The default similarity that is based on the TF/IDF model. This
similarity has the following option:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">discount_overlaps</code>
</span></dt><dd>
    Determines whether overlap tokens (Tokens with
    0 position increment) are ignored when computing norm. By default this
    is true, meaning overlap tokens do not count when computing norms.
</dd></dl></div><p>Type name: <code class="literal">default</code></p><h4><a id="bm25"></a>BM25 similarity</h4><p>Another TF/IDF based similarity that has built-in tf normalization and
is supposed to work better for short fields (like names). See
<a class="ulink" href="http://en.wikipedia.org/wiki/Okapi_BM25" target="_top">Okapi_BM25</a> for more details.
This similarity has the following options:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">k1</code>
</p>
</td><td valign="top">
<p>
    Controls non-linear term frequency normalization
    (saturation).
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">b</code>
</p>
</td><td valign="top">
<p>
    Controls to what degree document length normalizes tf values.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">discount_overlaps</code>
</p>
</td><td valign="top">
<p>
    Determines whether overlap tokens (Tokens with
    0 position increment) are ignored when computing norm. By default this
    is true, meaning overlap tokens do not count when computing norms.
</p>
</td></tr></tbody></table></div><p>Type name: <code class="literal">BM25</code></p><h4><a id="drf"></a>DFR similarity</h4><p>Similarity that implements the
<a class="ulink" href="http://lucene.apache.org/core/4_1_0/core/org/apache/lucene/search/similarities/DFRSimilarity.html" target="_top">divergence
from randomness</a> framework. This similarity has the following options:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">basic_model</code>
</p>
</td><td valign="top">
<p>
    Possible values: <code class="literal">be</code>, <code class="literal">d</code>, <code class="literal">g</code>, <code class="literal">if</code>, <code class="literal">in</code>, <code class="literal">ine</code> and <code class="literal">p</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">after_effect</code>
</p>
</td><td valign="top">
<p>
    Possible values: <code class="literal">no</code>, <code class="literal">b</code> and <code class="literal">l</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">normalization</code>
</p>
</td><td valign="top">
<p>
    Possible values: <code class="literal">no</code>, <code class="literal">h1</code>, <code class="literal">h2</code>, <code class="literal">h3</code> and <code class="literal">z</code>.
</p>
</td></tr></tbody></table></div><p>All options but the first option need a normalization value.</p><p>Type name: <code class="literal">DFR</code></p><h4><a id="ib"></a>IB similarity.</h4><p><a class="ulink" href="http://lucene.apache.org/core/4_1_0/core/org/apache/lucene/search/similarities/IBSimilarity.html" target="_top">Information
based model</a> . This similarity has the following options:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">distribution</code>
</p>
</td><td valign="top">
<p>
Possible values: <code class="literal">ll</code> and <code class="literal">spl</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">lambda</code>
</p>
</td><td valign="top">
<p>
Possible values: <code class="literal">df</code> and <code class="literal">ttf</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">normalization</code>
</p>
</td><td valign="top">
<p>
Same as in <code class="literal">DFR</code> similarity.
</p>
</td></tr></tbody></table></div><p>Type name: <code class="literal">IB</code></p><h4><a id="default-base"></a>Default and Base Similarities</h4><p>By default, Elasticsearch will use whatever similarity is configured as
<code class="literal">default</code>. However, the similarity functions <code class="literal">queryNorm()</code> and <code class="literal">coord()</code>
are not per-field. Consequently, for expert users wanting to change the
implementation used for these two methods, while not changing the
<code class="literal">default</code>, it is possible to configure a similarity with the name
<code class="literal">base</code>. This similarity will then be used for the two methods.</p><p>You can change the default similarity for all fields like this:</p><pre class="programlisting prettyprint lang-js">index.similarity.default.type: BM25</pre></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="testing"></a>Testing</h1></div></div></div><div class="partintro"><div></div><p>This section is about utilizing elasticsearch as part of your testing infrastructure.</p><h2><a id="testing-header"></a>Testing:</h2><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="#testing-framework" title="Java Testing Framework"><em>Java Testing Framework</em></a>
</li></ul></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="testing-framework"></a>Java Testing Framework</h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.0.0.RC1.</p></div></div><p><a id="testing-intro"></a>Testing is a crucial part of your application, and as information retrieval itself is already a complex topic, there should not be any additional complexity in setting up a testing infrastructure, which uses elasticsearch. This is the main reason why we decided to release an additional file to the release, which allows you to use the same testing infrastructure we do in the elasticsearch core. The testing framework allows you to setup clusters with multiple nodes in order to check if your code covers everything needed to run in a cluster. The framework prevents you from writing complex code yourself to start, stop or manage several test nodes in a cluster. In addition there is another very important feature called randomized testing, which you are getting for free as it is part of the elasticsearch infrastructure.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="why-randomized-testing"></a>why randomized testing?</h2></div></div></div><p>The key concept of randomized testing is not to use the same input values for every testcase, but still be able to reproduce it in case of a failure. This allows to test with vastly different input variables in order to make sure, that your implementation is actually independent from your provided test data.</p><p>If you are interested in the implementation being used, check out the <a class="ulink" href="http://labs.carrotsearch.com/randomizedtesting.html" target="_top">RandomizedTesting webpage</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using-elasticsearch-test-classes"></a>Using the elasticsearch test classes</h2></div></div></div><p>First, you need to include the testing dependency in your project. If you use maven and its <code class="literal">pom.xml</code> file, it looks like this</p><a id="source"></a><pre class="screen">&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt;
    &lt;artifactId&gt;lucene-test-framework&lt;/artifactId&gt;
    &lt;version&gt;${lucene.version}&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;
    &lt;artifactId&gt;elasticsearch&lt;/artifactId&gt;
    &lt;version&gt;${elasticsearch.version}&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
    &lt;type&gt;test-jar&lt;/type&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;
    &lt;artifactId&gt;elasticsearch&lt;/artifactId&gt;
    &lt;version&gt;${elasticsearch.version}&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</pre><p>Replace the elasticsearch version and the lucene versions with the current elasticsearch version and its accompanying lucene release.</p><p>There are already have a couple of classes, you can inherit from in your own test classes. The advantages of doing so is having already defined loggers, the whole randomized infrastructure is set up already.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="unit-tests"></a>unit tests</h2></div></div></div><p>In case you only need to execute a unit test, because your implementation can be isolated that good and does not require an up and running elasticsearch cluster, you can use the <code class="literal">ElasticsearchTestCase</code>. If you are testing lucene features, use <code class="literal">ElasticsearchLuceneTestCase</code> and if you are testing concrete token streams, use the <code class="literal">ElasticsearchTokenStreamTestCase</code> class. Those specific classes execute additional checks, which ensure that no resources leaks are happening, after the test has run.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="integration-tests"></a>integration tests</h2></div></div></div><p>These kind of tests require firing up a whole cluster of nodes, before the tests can actually be run. Compared to unit tests they are obviously way more time consuming, but the test infrastructure tries to minimize the time cost by only restarting the whole cluster, if this is configured explicitly.</p><p>The class your tests have to inherit from is <code class="literal">ElasticsearchIntegrationTest</code>. As soon as you inherit, there is no need for you to start any elasticsearch nodes manually in your test anymore, though you might need to ensure that at least a certain amount of nodes is up and running.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="number-of-shards"></a>number of shards</h3></div></div></div><p>The number of shards used for indices created during integration tests is randomized between <code class="literal">1</code> and <code class="literal">10</code> unless overwritten upon index creation via index settings.
Rule of thumb is not to specify the number of shards unless needed, so that each test will use a different one all the time.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="helper-methods"></a>generic helper methods</h3></div></div></div><p>There are a couple of helper methods in <code class="literal">ElasticsearchIntegrationTest</code>, which will make your tests shorter and more concise.</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">refresh()</code>
</p>
</td><td valign="top">
<p>
Refreshes all indices in a cluster
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">ensureGreen()</code>
</p>
</td><td valign="top">
<p>
Ensures a green health cluster state, waiting for relocations. Waits the default timeout of 30 seconds before failing.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">ensureYellow()</code>
</p>
</td><td valign="top">
<p>
Ensures a yellow health cluster state, also waits for 30 seconds before failing.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">createIndex(name)</code>
</p>
</td><td valign="top">
<p>
Creates an index with the specified name
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">flush()</code>
</p>
</td><td valign="top">
<p>
Flushes all indices in a cluster
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">flushAndRefresh()</code>
</p>
</td><td valign="top">
<p>
Combines <code class="literal">flush()</code> and <code class="literal">refresh()</code> calls
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">optimize()</code>
</p>
</td><td valign="top">
<p>
Waits for all relocations and optimized all indices in the cluster to one segment.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">indexExists(name)</code>
</p>
</td><td valign="top">
<p>
Checks if given index exists
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">admin()</code>
</p>
</td><td valign="top">
<p>
Returns an <code class="literal">AdminClient</code> for administrative tasks
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">clusterService()</code>
</p>
</td><td valign="top">
<p>
Returns the cluster service java class
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">cluster()</code>
</p>
</td><td valign="top">
<p>
Returns the test cluster class, which is explained in the next paragraphs
</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="test-cluster-methods"></a>test cluster methods</h3></div></div></div><p>The <code class="literal">TestCluster</code> class is the heart of the cluster functionality in a randomized test and allows you to configure a specific setting or replay certain types of outages to check, how your custom code reacts.</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">ensureAtLeastNumNodes(n)</code>
</p>
</td><td valign="top">
<p>
Ensure at least the specified number of nodes is running in the cluster
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">ensureAtMostNumNodes(n)</code>
</p>
</td><td valign="top">
<p>
Ensure at most the specified number of nodes is running in the cluster
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">getInstance()</code>
</p>
</td><td valign="top">
<p>
Get a guice instantiated instance of a class from a random node
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">getInstanceFromNode()</code>
</p>
</td><td valign="top">
<p>
Get a guice instantiated instance of a class from a specified node
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">stopRandomNode()</code>
</p>
</td><td valign="top">
<p>
Stop a random node in your cluster to mimic an outage
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">stopCurrentMasterNode()</code>
</p>
</td><td valign="top">
<p>
Stop the current master node to force a new election
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">stopRandomNonMaster()</code>
</p>
</td><td valign="top">
<p>
Stop a random non master node to mimic an outage
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">buildNode()</code>
</p>
</td><td valign="top">
<p>
Create a new elasticsearch node
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">startNode(settings)</code>
</p>
</td><td valign="top">
<p>
Create and start a new elasticsearch node
</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="accessing-clients"></a>Accessing clients</h3></div></div></div><p>In order to execute any actions, you have to use a client. You can use the <code class="literal">ElasticsearchIntegrationTest.client()</code> method to get back a random client. This client can be a <code class="literal">TransportClient</code> or a <code class="literal">NodeClient</code> - and usually you do not need to care as long as the action gets executed. There are several more methods for client selection inside of the <code class="literal">TestCluster</code> class, which can be accessed using the <code class="literal">ElasticsearchIntegrationTest.cluster()</code> method.</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">iterator()</code>
</p>
</td><td valign="top">
<p>
An iterator over all available clients
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">masterClient()</code>
</p>
</td><td valign="top">
<p>
Returns a client which is connected to the master node
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">nonMasterClient()</code>
</p>
</td><td valign="top">
<p>
Returns a client which is not connected to the master node
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">clientNodeClient()</code>
</p>
</td><td valign="top">
<p>
Returns a client, which is running on a client node
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">client(String nodeName)</code>
</p>
</td><td valign="top">
<p>
Returns a client to a given node
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">smartClient()</code>
</p>
</td><td valign="top">
<p>
Returns a smart client
</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="scoping"></a>Scoping</h3></div></div></div><p>By default the tests are run without restarting the cluster between tests or test classes in order to be as fast as possible. Of course all indices and templates are deleted between each test. However, sometimes you need to start a new cluster for each test or for a whole test suite - for example, if you load a certain plugin, but you do not want to load it for every test.</p><p>You can use the <code class="literal">@ClusterScope</code> annotation at class level to configure this behaviour</p><pre class="programlisting prettyprint lang-java">@ClusterScope(scope=SUITE, numNodes=1)
public class CustomSuggesterSearchTests extends ElasticsearchIntegrationTest {
  // ... tests go here
}</pre><p>The above sample configures an own cluster for this test suite, which is the class. Other values could be <code class="literal">GLOBAL</code> (the default) or <code class="literal">TEST</code> in order to spawn a new cluster for each test. The <code class="literal">numNodes</code> settings allows you to only start a certain number of nodes, which can speed up test execution, as starting a new node is a costly and time consuming operation and might not be needed for this test.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="changing-node-configuration"></a>Changing node configuration</h3></div></div></div><p>As elasticsearch is using JUnit 4, using the <code class="literal">@Before</code> and <code class="literal">@After</code> annotations is not a problem. However you should keep in mind, that this does not have any effect in your cluster setup, as the cluster is already up and running when those methods are run. So in case you want to configure settings - like loading a plugin on node startup - before the node is actually running, you should overwrite the <code class="literal">nodeSettings()</code> method from the <code class="literal">ElasticsearchIntegrationTest</code> class and change the cluster scope to <code class="literal">SUITE</code>.</p><pre class="programlisting prettyprint lang-java">@Override
protected Settings nodeSettings(int nodeOrdinal) {
  return ImmutableSettings.settingsBuilder()
           .put("plugin.types", CustomSuggesterPlugin.class.getName())
           .put(super.nodeSettings(nodeOrdinal)).build();
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="randomized-testing"></a>Randomized testing</h2></div></div></div><p>The code snippets you saw so far did not show any trace of randomized testing features, as they are carefully hidden under the hood. However when you are writing your own tests, you should make use of these features as well. Before starting with that, you should know, how to repeat a failed test with the same setup, how it failed. Luckily this is quite easy, as the whole mvn call is logged together with failed tests, which means you can simply copy and paste that line and run the test.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="generating-random-data"></a>Generating random data</h3></div></div></div><p>The next step is to convert your test using static test data into a test using randomized test data. The kind of data you could randomize varies a lot with the functionality you are testing against. Take a look at the following examples (note, that this list could go on for pages, as a distributed system has many, many moving parts):</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Searching for data using arbitrary UTF8 signs
</li><li class="listitem">
Changing your mapping configuration, index and field names with each run
</li><li class="listitem">
Changing your response sizes/configurable limits with each run
</li><li class="listitem">
Changing the number of shards/replicas when creating an index
</li></ul></div><p>So, how can you create random data. The most important thing to know is, that you never should instantiate your own <code class="literal">Random</code> instance, but use the one provided in the <code class="literal">RandomizedTest</code>, from which all elasticsearch dependent test classes inherit from.</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">getRandom()</code>
</p>
</td><td valign="top">
<p>
Returns the random instance, which can recreated when calling the test with specific parameters
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">randomBoolean()</code>
</p>
</td><td valign="top">
<p>
Returns a random boolean
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">randomByte()</code>
</p>
</td><td valign="top">
<p>
Returns a random byte
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">randomShort()</code>
</p>
</td><td valign="top">
<p>
Returns a random short
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">randomInt()</code>
</p>
</td><td valign="top">
<p>
Returns a random integer
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">randomLong()</code>
</p>
</td><td valign="top">
<p>
Returns a random long
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">randomFloat()</code>
</p>
</td><td valign="top">
<p>
Returns a random float
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">randomDouble()</code>
</p>
</td><td valign="top">
<p>
Returns a random double
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">randomInt(max)</code>
</p>
</td><td valign="top">
<p>
Returns a random integer between 0 and max
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">between()</code>
</p>
</td><td valign="top">
<p>
Returns a random between the supplied range
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">atLeast()</code>
</p>
</td><td valign="top">
<p>
Returns a random integer of at least the specified integer
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">atMost()</code>
</p>
</td><td valign="top">
<p>
Returns a random integer of at most the specified integer
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">randomLocale()</code>
</p>
</td><td valign="top">
<p>
Returns a random locale
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">randomTimeZone()</code>
</p>
</td><td valign="top">
<p>
Returns a random timezone
</p>
</td></tr></tbody></table></div><p>In addition, there are a couple of helper methods, allowing you to create random ASCII and Unicode strings, see methods beginning with <code class="literal">randomAscii</code>, <code class="literal">randomUnicode</code>, and <code class="literal">randomRealisticUnicode</code> in the random test class. The latter one tries to create more realistic unicode string by not being arbitrary random.</p><p>If you want to debug a specific problem with a specific random seed, you can use the <code class="literal">@Seed</code> annotation to configure a specific seed for a test. If you want to run a test more than once, instead of starting the whole test suite over and over again, you can use the <code class="literal">@Repeat</code> annotation with an arbitrary value. Each iteration than gets run with a different seed.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assertions"></a>Assertions</h2></div></div></div><p>As many elasticsearch tests are checking for a similar output, like the amount of hits or the first hit or special highlighting, a couple of predefined assertions have been created. Those have been put into the <code class="literal">ElasticsearchAssertions</code> class.</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">assertHitCount()</code>
</p>
</td><td valign="top">
<p>
Checks hit count of a search or count request
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">assertAcked()</code>
</p>
</td><td valign="top">
<p>
Ensure the a request has been acknowledged by the master
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">assertSearchHits()</code>
</p>
</td><td valign="top">
<p>
Asserts a search response contains specific ids
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">assertMatchCount()</code>
</p>
</td><td valign="top">
<p>
Asserts a matching count from a percolation response
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">assertFirstHit()</code>
</p>
</td><td valign="top">
<p>
Asserts the first hit hits the specified matcher
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">assertSecondHit()</code>
</p>
</td><td valign="top">
<p>
Asserts the second hit hits the specified matcher
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">assertThirdHit()</code>
</p>
</td><td valign="top">
<p>
Asserts the third hits hits the specified matcher
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">assertSearchHit()</code>
</p>
</td><td valign="top">
<p>
Assert a certain element in a search response hits the specified matcher
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">assertNoFailures()</code>
</p>
</td><td valign="top">
<p>
Asserts that no shard failures have occured in the response
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">assertFailures()</code>
</p>
</td><td valign="top">
<p>
Asserts that shard failures have happened during a search request
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">assertHighlight()</code>
</p>
</td><td valign="top">
<p>
Assert specific highlights matched
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">assertSuggestion()</code>
</p>
</td><td valign="top">
<p>
Assert for specific suggestions
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">assertSuggestionSize()</code>
</p>
</td><td valign="top">
<p>
Assert for specific suggestion count
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">assertThrows()</code>
</p>
</td><td valign="top">
<p>
Assert a specific exception has been thrown
</p>
</td></tr></tbody></table></div><p>Common matchers</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">hasId()</code>
</p>
</td><td valign="top">
<p>
Matcher to check for a search hit id
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">hasType()</code>
</p>
</td><td valign="top">
<p>
Matcher to check for a search hit type
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">hasIndex()</code>
</p>
</td><td valign="top">
<p>
Matcher to check for a search hit index
</p>
</td></tr></tbody></table></div><p>Usually, you would combine assertions and matchers in your test like this</p><pre class="programlisting prettyprint lang-java">SearchResponse seearchResponse = client().prepareSearch() ...;
assertHitCount(searchResponse, 4);
assertFirstHit(searchResponse, hasId("4"));
assertSearchHits(searchResponse, "1", "2", "3", "4");</pre></div></div></div><div class="glossary"><div class="titlepage"><div><div><h1 class="title"><a id="glossary"></a>Glossary of terms</h1></div></div></div><dl><dt><span class="glossterm">
<a id="glossary-analysis"></a> analysis 
</span></dt><dd class="glossdef"><p>
  Analysis is the process of converting <a class="link" href="#glossary-text">full text</a> to
  <a class="link" href="#glossary-term">terms</a>. Depending on which analyzer is used, these phrases:
  <code class="literal">FOO BAR</code>, <code class="literal">Foo-Bar</code>, <code class="literal">foo,bar</code> will probably all result in the
  terms <code class="literal">foo</code> and <code class="literal">bar</code>. These terms are what is actually stored in
  the index.
 
  A full text query (not a <a class="link" href="#glossary-term">term</a> query) for <code class="literal">FoO:bAR</code> will
  also be analyzed to the terms <code class="literal">foo</code>,<code class="literal">bar</code> and will thus match the
  terms stored in the index.
 
  It is this process of analysis (both at index time and at search time)
  that allows elasticsearch to perform full text queries.
 
  Also see <a class="link" href="#glossary-text">text</a> and <a class="link" href="#glossary-term">term</a>.
</p></dd><dt><span class="glossterm">
<a id="glossary-cluster"></a> cluster 
</span></dt><dd class="glossdef"><p>
  A cluster consists of one or more <a class="link" href="#glossary-node">nodes</a> which share the
  same cluster name. Each cluster has a single master node which is
  chosen automatically by the cluster and which can be replaced if the
  current master node fails.
</p></dd><dt><span class="glossterm">
<a id="glossary-document"></a> document 
</span></dt><dd class="glossdef"><p>
  A document is a JSON document which is stored in elasticsearch. It is
  like a row in a table in a relational database. Each document is
  stored in an <a class="link" href="#glossary-index">index</a> and has a <a class="link" href="#glossary-type">type</a> and an
  <a class="link" href="#glossary-id">id</a>.
 
  A document is a JSON object (also known in other languages as a hash /
  hashmap / associative array) which contains zero or more
  <a class="link" href="#glossary-field">fields</a>, or key-value pairs.
 
  The original JSON document that is indexed will be stored in the
  <a class="link" href="#glossary-source_field"><code class="literal">_source</code> field</a>, which is returned by default when
  getting or searching for a document.
</p></dd><dt><span class="glossterm">
<a id="glossary-id"></a> id 
</span></dt><dd class="glossdef"><p>
  The ID of a <a class="link" href="#glossary-document">document</a> identifies a document. The
  <code class="literal">index/type/id</code> of a document must be unique. If no ID is provided,
  then it will be auto-generated. (also see <a class="link" href="#glossary-routing">routing</a>)
</p></dd><dt><span class="glossterm">
<a id="glossary-field"></a> field 
</span></dt><dd class="glossdef"><p>
  A <a class="link" href="#glossary-document">document</a> contains a list of fields, or key-value
  pairs. The value can be a simple (scalar) value (eg a string, integer,
  date), or a nested structure like an array or an object. A field is
  similar to a column in a table in a relational database.
 
  The <a class="link" href="#glossary-mapping">mapping</a> for each field has a field <span class="emphasis"><em>type</em></span> (not to
  be confused with document <a class="link" href="#glossary-type">type</a>) which indicates the type
  of data that can be stored in that field, eg <code class="literal">integer</code>, <code class="literal">string</code>,
  <code class="literal">object</code>. The mapping also allows you to define (amongst other things)
  how the value for a field should be analyzed.
</p></dd><dt><span class="glossterm">
<a id="glossary-index"></a> index 
</span></dt><dd class="glossdef"><p>
  An index is like a <span class="emphasis"><em>database</em></span> in a relational database. It has a
  <a class="link" href="#glossary-mapping">mapping</a> which defines multiple <a class="link" href="#glossary-type">types</a>.
 
  An index is a logical namespace which maps to one or more
  <a class="link" href="#glossary-primary-shard">primary shards</a> and can have zero or more
  <a class="link" href="#glossary-replica-shard">replica shards</a>.
</p></dd><dt><span class="glossterm">
<a id="glossary-mapping"></a> mapping 
</span></dt><dd class="glossdef"><p>
  A mapping is like a <span class="emphasis"><em>schema definition</em></span> in a relational database. Each
  <a class="link" href="#glossary-index">index</a> has a mapping, which defines each <a class="link" href="#glossary-type">type</a>
  within the index, plus a number of index-wide settings.
 
  A mapping can either be defined explicitly, or it will be generated
  automatically when a document is indexed.
</p></dd><dt><span class="glossterm">
<a id="glossary-node"></a> node 
</span></dt><dd class="glossdef"><p>
  A node is a running instance of elasticsearch which belongs to a
  <a class="link" href="#glossary-cluster">cluster</a>. Multiple nodes can be started on a single
  server for testing purposes, but usually you should have one node per
  server.
 
  At startup, a node will use unicast (or multicast, if specified) to
  discover an existing cluster with the same cluster name and will try
  to join that cluster.
</p></dd><dt><span class="glossterm">
<a id="glossary-primary-shard"></a> primary shard 
</span></dt><dd class="glossdef"><p>
  Each document is stored in a single primary <a class="link" href="#glossary-shard">shard</a>. When
  you index a document, it is indexed first on the primary shard, then
  on all <a class="link" href="#glossary-replica-shard">replicas</a> of the primary shard.
 
  By default, an <a class="link" href="#glossary-index">index</a> has 5 primary shards. You can
  specify fewer or more primary shards to scale the number of
  <a class="link" href="#glossary-document">documents</a> that your index can handle.
 
  You cannot change the number of primary shards in an index, once the
  index is created.
 
  See also <a class="link" href="#glossary-routing">routing</a>
</p></dd><dt><span class="glossterm">
<a id="glossary-replica-shard"></a> replica shard 
</span></dt><dd class="glossdef"><p>
  Each <a class="link" href="#glossary-primary-shard">primary shard</a> can have zero or more
  replicas. A replica is a copy of the primary shard, and has two
  purposes:
 
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
increase failover: a replica shard can be promoted to a primary
  shard if the primary fails
</li><li class="listitem">
increase performance: get and search requests can be handled by
  primary or replica shards.
 
  By default, each primary shard has one replica, but the number of
  replicas can be changed dynamically on an existing index. A replica
  shard will never be started on the same node as its primary shard.
</li></ol></div></dd><dt><span class="glossterm">
<a id="glossary-routing"></a> routing 
</span></dt><dd class="glossdef"><p>
  When you index a document, it is stored on a single
  <a class="link" href="#glossary-primary-shard">primary shard</a>. That shard is chosen by hashing
  the <code class="literal">routing</code> value. By default, the <code class="literal">routing</code> value is derived from
  the ID of the document or, if the document has a specified parent
  document, from the ID of the parent document (to ensure that child and
  parent documents are stored on the same shard).
 
  This value can be overridden by specifying a <code class="literal">routing</code> value at index
  time, or a <a class="link" href="#mapping-routing-field" title="_routing">routing   field</a> in the <a class="link" href="#glossary-mapping">mapping</a>.
</p></dd><dt><span class="glossterm">
<a id="glossary-shard"></a> shard 
</span></dt><dd class="glossdef"><p>
  A shard is a single Lucene instance. It is a low-level âworkerâ unit
  which is managed automatically by elasticsearch. An index is a logical
  namespace which points to <a class="link" href="#glossary-primary-shard">primary</a> and
  <a class="link" href="#glossary-replica-shard">replica</a> shards.
 
  Other than defining the number of primary and replica shards that an
  index should have, you never need to refer to shards directly.
  Instead, your code should deal only with an index.
 
  Elasticsearch distributes shards amongst all <a class="link" href="#glossary-node">nodes</a> in the
  <a class="link" href="#glossary-cluster">cluster</a>, and can move shards automatically from one
  node to another in the case of node failure, or the addition of new
  nodes.
</p></dd><dt><span class="glossterm">
<a id="glossary-source_field"></a> source field 
</span></dt><dd class="glossdef"><p>
  By default, the JSON document that you index will be stored in the
  <code class="literal">_source</code> field and will be returned by all get and search requests.
  This allows you access to the original object directly from search
  results, rather than requiring a second step to retrieve the object
  from an ID.
 
  Note: the exact JSON string that you indexed will be returned to you,
  even if it contains invalid JSON. The contents of this field do not
  indicate anything about how the data in the object has been indexed.
</p></dd><dt><span class="glossterm">
<a id="glossary-term"></a> term 
</span></dt><dd class="glossdef"><p>
  A term is an exact value that is indexed in elasticsearch. The terms
  <code class="literal">foo</code>, <code class="literal">Foo</code>, <code class="literal">FOO</code> are NOT equivalent. Terms (i.e. exact values) can
  be searched for using <span class="emphasis"><em>term</em></span> queries.
   See also <a class="link" href="#glossary-text">text</a> and <a class="link" href="#glossary-analysis">analysis</a>.
</p></dd><dt><span class="glossterm">
<a id="glossary-text"></a> text 
</span></dt><dd class="glossdef"><p>
  Text (or full text) is ordinary unstructured text, such as this
  paragraph. By default, text will be <a class="link" href="#glossary-analysis">analyzed</a> into
  <a class="link" href="#glossary-term">terms</a>, which is what is actually stored in the index.
 
  Text <a class="link" href="#glossary-field">fields</a> need to be analyzed at index time in order to
  be searchable as full text, and keywords in full text queries must be
  analyzed at search time to produce (and search for) the same terms
  that were generated at index time.
 
  See also <a class="link" href="#glossary-term">term</a> and <a class="link" href="#glossary-analysis">analysis</a>.
</p></dd><dt><span class="glossterm">
<a id="glossary-type"></a> type 
</span></dt><dd class="glossdef"><p>
  A type is like a <span class="emphasis"><em>table</em></span> in a relational database. Each type has a
  list of <a class="link" href="#glossary-field">fields</a> that can be specified for
  <a class="link" href="#glossary-document">documents</a> of that type. The <a class="link" href="#glossary-mapping">mapping</a>
  defines how each field in the document is analyzed.
</p></dd></dl></div></div></article></section></div></div></div><footer><div id="drawer_container" class="full_wrapper"><div id="drawer_inner" class="container"><div class="block"><img class="creeper" src="http://www.elasticsearch.org/content/uploads/2013/03/training_icon.png" alt="" /><h3>Training</h3><p>Want to <span class="oomph">learn</span> from the creators and advance your data-driven <span class="oomph">superpowers?</span></p><a target="_blank" href="http://training.elasticsearch.com/" class="btn-expose">More</a></div><div class="block"><img class="creeper" src="http://www.elasticsearch.org/content/uploads/2013/03/dev_icon.png" alt="" /><h3>Dev Support</h3><p>
              Need help with
              <span class="oomph">architectural advice</span></p><p> or <span class="oomph">design validation</span>?</p><a target="_blank" href="http://elasticsearch.com/support/" class="btn-expose drawer_toggle">More</a><span class="arrow"></span><div class="block_content"><h1 style="text-align: center;">Get development help from our core team!</h1><p>Want more information about our Development Support? Let us know how to get a hold of you and weâll be in touch soon.</p><div class="gf_browser_gecko gform_wrapper" id="gform_wrapper_1"><a id="gf_1" name="gf_1" class="gform_anchor"></a><form method="post" enctype="multipart/form-data" target="gform_ajax_frame_1" id="gform_1" action="/resources/#gf_1"><div class="gform_body"><ul id="gform_fields_1" class="gform_fields top_label description_below"><li id="field_1_1" class="gfield    icon name           gfield_contains_required"><label class="gfield_label" for="input_1_1">
                          First Name
                          <span class="gfield_required">*</span></label><div class="ginput_container"><input name="input_1" id="input_1_1" type="text" value="" class="medium" tabindex="2" /></div></li><li id="field_1_7" class="gfield    icon name           gfield_contains_required"><label class="gfield_label" for="input_1_7">
                          Last Name
                          <span class="gfield_required">*</span></label><div class="ginput_container"><input name="input_7" id="input_1_7" type="text" value="" class="medium" tabindex="2" /></div></li><li id="field_1_2" class="gfield    icon company"><label class="gfield_label" for="input_1_2">Company</label><div class="ginput_container"><input name="input_2" id="input_1_2" type="text" value="" class="medium" tabindex="3" /></div></li><li id="field_1_3" class="gfield    icon email           gfield_contains_required"><label class="gfield_label" for="input_1_3">
                          Email
                          <span class="gfield_required">*</span></label><div class="ginput_container"><input name="input_3" id="input_1_3" type="email" value="" class="medium" tabindex="4" /></div></li><li id="field_1_4" class="gfield    icon job"><label class="gfield_label" for="input_1_4">Job Title</label><div class="ginput_container"><input name="input_4" id="input_1_4" type="text" value="" class="medium" tabindex="5" /></div></li><li id="field_1_5" class="gfield    icon phone"><label class="gfield_label" for="input_1_5">Phone</label><div class="ginput_container"><input name="input_5" id="input_1_5" type="text" value="" class="medium" tabindex="6" /></div></li><li id="field_1_6" class="gfield    full"><label class="gfield_label">I'm inquiring about...</label><div class="ginput_container"><ul class="gfield_checkbox" id="input_1_6"><li class="gchoice_6_1"><input name="input_6.1" type="checkbox" value="Interest_Dev_Support__c" checked="checked" id="choice_6_1" tabindex="7" /><label for="choice_6_1">Dev support</label></li><li class="gchoice_6_2"><input name="input_6.2" type="checkbox" value="Interest_Training__c" id="choice_6_2" tabindex="8" /><label for="choice_6_2">Training</label></li><li class="gchoice_6_3"><input name="input_6.3" type="checkbox" value="Interest_Product_Support__c" id="choice_6_3" tabindex="9" /><label for="choice_6_3">Production support</label></li><li class="gchoice_6_4"><input name="input_6.4" type="checkbox" value="Interest_Newsletter_Updates__c" checked="checked" id="choice_6_4" tabindex="10" /><label for="choice_6_4">Newsletter Updates</label></li></ul></div></li><li id="field_1_10" class="gfield    icon comments full"><label class="gfield_label" for="input_1_10">Comments</label><div class="ginput_container"><textarea name="input_10" id="input_1_10" class="textarea medium" tabindex="11" rows="10" cols="50"></textarea></div></li><li id="field_1_8" class="gfield     gform_hidden"><input name="input_8" id="input_1_8" type="hidden" class="gform_hidden" value="813-MAM-392" /></li><li id="field_1_9" class="gfield     gform_hidden"><input name="input_9" id="input_1_9" type="hidden" class="gform_hidden" value="WEB.org" /></li><li id="field_1_11" class="gfield     gform_hidden"><input name="input_11" id="input_1_11" type="hidden" class="gform_hidden" value="WEB.org - Home - Dev Support" /></li><li id="field_1_12" class="gfield     gform_hidden"><input name="input_12" id="input_1_12" type="hidden" class="gform_hidden" value="-1" /></li><li id="field_1_13" class="gfield     gform_hidden"><input name="input_13" id="input_1_13" type="hidden" class="gform_hidden" value="55" /></li><li id="field_1_14" class="gfield     gform_hidden"><input name="input_14" id="input_1_14" type="hidden" class="gform_hidden" value="1005" /></li></ul></div><div class="gform_footer top_label"><input type="submit" id="gform_submit_button_1" class="button gform_button" value="Submit" tabindex="12" /><input type="hidden" name="gform_ajax" value="form_id=1&amp;title=&amp;description=" /><input type="hidden" class="gform_hidden" name="is_submit_1" value="1" /><input type="hidden" class="gform_hidden" name="gform_submit" value="1" /><input type="hidden" class="gform_hidden" name="gform_unique_id" value="" /><input type="hidden" class="gform_hidden" name="state_1" value="WyJhOjA6e30iLCJmMjE2MmM2ZjUxYmQ4M2Q3ZmMzNzVlNmY2ODYyZTI2NCJd" /><input type="hidden" class="gform_hidden" name="gform_target_page_number_1" id="gform_target_page_number_1" value="0" /><input type="hidden" class="gform_hidden" name="gform_source_page_number_1" id="gform_source_page_number_1" value="1" /><input type="hidden" name="gform_field_values" value="" /></div></form></div><iframe style="display:none;width:0px; height:0px;" src="about:blank" name="gform_ajax_frame_1" id="gform_ajax_frame_1"></iframe><script type="text/javascript">//<![CDATA[
function gformInitSpinner_1(){jQuery('#gform_1').submit(function(){if(jQuery('#gform_ajax_spinner_1').length == 0){jQuery('#gform_submit_button_1, #gform_wrapper_1 .gform_previous_button, #gform_wrapper_1 .gform_next_button, #gform_wrapper_1 .gform_image_button').attr('disabled', true); jQuery('#gform_submit_button_1, #gform_wrapper_1 .gform_next_button, #gform_wrapper_1 .gform_image_button').after('<' + 'img id="gform_ajax_spinner_1"  class="gform_ajax_spinner" src="http://www.elasticsearch.org/content/plugins/gravityforms/images/spinner.gif" alt="" />'); }} );}jQuery(document).ready(function($){gformInitSpinner_1();jQuery('#gform_ajax_frame_1').load( function(){var contents = jQuery(this).contents().find('*').html();var is_postback = contents.indexOf('GF_AJAX_POSTBACK') >= 0;if(!is_postback){return;}var form_content = jQuery(this).contents().find('#gform_wrapper_1');var is_redirect = contents.indexOf('gformRedirect(){') >= 0;jQuery('#gform_submit_button_1').removeAttr('disabled');var is_form = !(form_content.length <= 0 || is_redirect);if(is_form){jQuery('#gform_wrapper_1').html(form_content.html());jQuery(document).scrollTop(jQuery('#gform_wrapper_1').offset().top);if(window['gformInitDatepicker']) {gformInitDatepicker();}if(window['gformInitPriceFields']) {gformInitPriceFields();}var current_page = jQuery('#gform_source_page_number_1').val();gformInitSpinner_1();jQuery(document).trigger('gform_page_loaded', [1, current_page]);}else if(!is_redirect){var confirmation_content = jQuery(this).contents().find('#gforms_confirmation_message').html();if(!confirmation_content){confirmation_content = contents;}setTimeout(function(){jQuery('#gform_wrapper_1').replaceWith('<' + 'div id=\'gforms_confirmation_message\' class=\'gform_confirmation_message_1\'' + '>' + confirmation_content + '<' + '/div' + '>');jQuery(document).scrollTop(jQuery('#gforms_confirmation_message').offset().top);jQuery(document).trigger('gform_confirmation_loaded', [1]);}, 50);}else{jQuery('#gform_1').append(contents);if(window['gformRedirect']) {gformRedirect();}}jQuery(document).trigger('gform_post_render', [1, current_page]);} );} );</script><script type='text/javascript'> jQuery(document).ready(function(){jQuery(document).trigger('gform_post_render', [1, 1]) } );
//]]></script></div></div><div class="block"><img class="creeper" src="http://www.elasticsearch.org/content/uploads/2013/03/prod_icon.png" alt="" /><h3>Production Support</h3><p>Have Elasticsearch live in production</p><p>and looking for <span class="oomph">SLA-based support</span>?</p><a target="_blank" href="http://elasticsearch.com/support/" class="btn-expose drawer_toggle">More</a><span class="arrow"></span><div class="block_content"><h1 style="text-align: center;">In production? Weâve got your back, 24/7</h1><p>Weâd love to talk to you about our Production Support. Let us know how to get a hold of you and weâll be in touch soon.</p><ul class="drawer_highlights"><li><div class="img"><img alt="clock" src="http://www.elasticsearch.org/content/uploads/2013/03/clock.png" /></div><p>24/7 response time available always</p></li><li class="wide"><div class="img"><img alt="flag" src="http://www.elasticsearch.org/content/uploads/2013/03/flag.png" /></div><p>Support from team that built Elasticsearch</p></li><li><div class="img"><img alt="star" src="http://www.elasticsearch.org/content/uploads/2013/03/star.png" /></div><p>Expert-level solutions</p></li></ul><div class="gf_browser_gecko gform_wrapper" id="gform_wrapper_2"><a id="gf_2" name="gf_2" class="gform_anchor"></a><form method="post" enctype="multipart/form-data" target="gform_ajax_frame_2" id="gform_2" action="/resources/#gf_2"><div class="gform_body"><ul id="gform_fields_2" class="gform_fields top_label description_below"><li id="field_2_1" class="gfield    icon name           gfield_contains_required"><label class="gfield_label" for="input_2_1">
                          First Name
                          <span class="gfield_required">*</span></label><div class="ginput_container"><input name="input_1" id="input_2_1" type="text" value="" class="medium" tabindex="1" /></div></li><li id="field_2_7" class="gfield    icon name           gfield_contains_required"><label class="gfield_label" for="input_2_7">
                          Last Name
                          <span class="gfield_required">*</span></label><div class="ginput_container"><input name="input_7" id="input_2_7" type="text" value="" class="medium" tabindex="2" /></div></li><li id="field_2_2" class="gfield    icon company"><label class="gfield_label" for="input_2_2">Company</label><div class="ginput_container"><input name="input_2" id="input_2_2" type="text" value="" class="medium" tabindex="3" /></div></li><li id="field_2_3" class="gfield    icon email           gfield_contains_required"><label class="gfield_label" for="input_2_3">
                          Email
                          <span class="gfield_required">*</span></label><div class="ginput_container"><input name="input_3" id="input_2_3" type="email" value="" class="medium" tabindex="4" /></div></li><li id="field_2_4" class="gfield    icon job"><label class="gfield_label" for="input_2_4">Job Title</label><div class="ginput_container"><input name="input_4" id="input_2_4" type="text" value="" class="medium" tabindex="5" /></div></li><li id="field_2_5" class="gfield    icon phone"><label class="gfield_label" for="input_2_5">Phone</label><div class="ginput_container"><input name="input_5" id="input_2_5" type="text" value="" class="medium" tabindex="6" /></div></li><li id="field_2_6" class="gfield    full"><label class="gfield_label">I'm inquiring about...</label><div class="ginput_container"><ul class="gfield_checkbox" id="input_2_6"><li class="gchoice_6_1"><input name="input_6.1" type="checkbox" value="Interest_Dev_Support__c" id="choice_6_1" tabindex="7" /><label for="choice_6_1">Dev support</label></li><li class="gchoice_6_2"><input name="input_6.2" type="checkbox" value="Interest_Training__c" id="choice_6_2" tabindex="8" /><label for="choice_6_2">Training</label></li><li class="gchoice_6_3"><input name="input_6.3" type="checkbox" value="Interest_Product_Support__c" checked="checked" id="choice_6_3" tabindex="9" /><label for="choice_6_3">Production support</label></li><li class="gchoice_6_4"><input name="input_6.4" type="checkbox" value="Interest_Newsletter_Updates__c" checked="checked" id="choice_6_4" tabindex="10" /><label for="choice_6_4">Newsletter Updates</label></li></ul></div></li><li id="field_2_10" class="gfield    icon comments full"><label class="gfield_label" for="input_2_10">Comments</label><div class="ginput_container"><textarea name="input_10" id="input_2_10" class="textarea medium" tabindex="11" rows="10" cols="50"></textarea></div></li><li id="field_2_8" class="gfield     gform_hidden"><input name="input_8" id="input_2_8" type="hidden" class="gform_hidden" value="813-MAM-392" /></li><li id="field_2_9" class="gfield     gform_hidden"><input name="input_9" id="input_2_9" type="hidden" class="gform_hidden" value="WEB.org" /></li><li id="field_2_11" class="gfield     gform_hidden"><input name="input_11" id="input_2_11" type="hidden" class="gform_hidden" value="WEB.org - Home - Production Support" /></li></ul></div><div class="gform_footer top_label"><input type="submit" id="gform_submit_button_2" class="button gform_button" value="Submit" tabindex="12" /><input type="hidden" name="gform_ajax" value="form_id=2&amp;title=&amp;description=" /><input type="hidden" class="gform_hidden" name="is_submit_2" value="1" /><input type="hidden" class="gform_hidden" name="gform_submit" value="2" /><input type="hidden" class="gform_hidden" name="gform_unique_id" value="" /><input type="hidden" class="gform_hidden" name="state_2" value="WyJhOjA6e30iLCJmMjE2MmM2ZjUxYmQ4M2Q3ZmMzNzVlNmY2ODYyZTI2NCJd" /><input type="hidden" class="gform_hidden" name="gform_target_page_number_2" id="gform_target_page_number_2" value="0" /><input type="hidden" class="gform_hidden" name="gform_source_page_number_2" id="gform_source_page_number_2" value="1" /><input type="hidden" name="gform_field_values" value="" /></div></form></div><iframe style="display:none;width:0px; height:0px;" src="about:blank" name="gform_ajax_frame_2" id="gform_ajax_frame_2"></iframe><script type="text/javascript">//<![CDATA[
function gformInitSpinner_2(){jQuery('#gform_2').submit(function(){if(jQuery('#gform_ajax_spinner_2').length == 0){jQuery('#gform_submit_button_2, #gform_wrapper_2 .gform_previous_button, #gform_wrapper_2 .gform_next_button, #gform_wrapper_2 .gform_image_button').attr('disabled', true); jQuery('#gform_submit_button_2, #gform_wrapper_2 .gform_next_button, #gform_wrapper_2 .gform_image_button').after('<' + 'img id="gform_ajax_spinner_2"  class="gform_ajax_spinner" src="http://www.elasticsearch.org/content/plugins/gravityforms/images/spinner.gif" alt="" />'); }} );}jQuery(document).ready(function($){gformInitSpinner_2();jQuery('#gform_ajax_frame_2').load( function(){var contents = jQuery(this).contents().find('*').html();var is_postback = contents.indexOf('GF_AJAX_POSTBACK') >= 0;if(!is_postback){return;}var form_content = jQuery(this).contents().find('#gform_wrapper_2');var is_redirect = contents.indexOf('gformRedirect(){') >= 0;jQuery('#gform_submit_button_2').removeAttr('disabled');var is_form = !(form_content.length <= 0 || is_redirect);if(is_form){jQuery('#gform_wrapper_2').html(form_content.html());jQuery(document).scrollTop(jQuery('#gform_wrapper_2').offset().top);if(window['gformInitDatepicker']) {gformInitDatepicker();}if(window['gformInitPriceFields']) {gformInitPriceFields();}var current_page = jQuery('#gform_source_page_number_2').val();gformInitSpinner_2();jQuery(document).trigger('gform_page_loaded', [2, current_page]);}else if(!is_redirect){var confirmation_content = jQuery(this).contents().find('#gforms_confirmation_message').html();if(!confirmation_content){confirmation_content = contents;}setTimeout(function(){jQuery('#gform_wrapper_2').replaceWith('<' + 'div id=\'gforms_confirmation_message\' class=\'gform_confirmation_message_2\'' + '>' + confirmation_content + '<' + '/div' + '>');jQuery(document).scrollTop(jQuery('#gforms_confirmation_message').offset().top);jQuery(document).trigger('gform_confirmation_loaded', [2]);}, 50);}else{jQuery('#gform_2').append(contents);if(window['gformRedirect']) {gformRedirect();}}jQuery(document).trigger('gform_post_render', [2, current_page]);} );} );</script><script type='text/javascript'> jQuery(document).ready(function(){jQuery(document).trigger('gform_post_render', [2, 1]) } );
//]]></script></div></div></div><div id="drawer_lower"><div id="support_details"><div class="container"><a href="#" class="close"><i class="icon-remove"></i></a><div class="drawer_content"></div></div></div></div></div><div id="mobile_learn_more"><div class="container"><div class="gf_browser_gecko gform_wrapper more_info_wrapper" id="gform_wrapper_3"><a id="gf_3" name="gf_3" class="gform_anchor"></a><form method="post" enctype="multipart/form-data" target="gform_ajax_frame_3" id="gform_3" class="more_info" action="/resources/#gf_3"><div class="gform_body"><ul id="gform_fields_3" class="gform_fields top_label description_below"><li id="field_3_2" class="gfield               gfield_contains_required"><label class="gfield_label" for="input_3_2">
                      Need more info? We'll email some more your way!
                      <span class="gfield_required">*</span></label><div class="ginput_container"><input name="input_2" id="input_3_2" type="email" value="" class="medium" tabindex="1" /></div></li><li id="field_3_3" class="gfield     gform_hidden"><input name="input_3" id="input_3_3" type="hidden" class="gform_hidden" value="813-MAM-392" /></li><li id="field_3_4" class="gfield     gform_hidden"><input name="input_4" id="input_3_4" type="hidden" class="gform_hidden" value="WEB.org" /></li><li id="field_3_5" class="gfield     gform_hidden"><input name="input_5" id="input_3_5" type="hidden" class="gform_hidden" value="WEB.org - Home - Mobile" /></li></ul></div><div class="gform_footer top_label"><input type="submit" id="gform_submit_button_3" class="button gform_button" value="Submit" tabindex="2" /><input type="hidden" name="gform_ajax" value="form_id=3&amp;title=&amp;description=" /><input type="hidden" class="gform_hidden" name="is_submit_3" value="1" /><input type="hidden" class="gform_hidden" name="gform_submit" value="3" /><input type="hidden" class="gform_hidden" name="gform_unique_id" value="" /><input type="hidden" class="gform_hidden" name="state_3" value="WyJhOjA6e30iLCJmMjE2MmM2ZjUxYmQ4M2Q3ZmMzNzVlNmY2ODYyZTI2NCJd" /><input type="hidden" class="gform_hidden" name="gform_target_page_number_3" id="gform_target_page_number_3" value="0" /><input type="hidden" class="gform_hidden" name="gform_source_page_number_3" id="gform_source_page_number_3" value="1" /><input type="hidden" name="gform_field_values" value="" /></div></form></div><iframe style="display:none;width:0px; height:0px;" src="about:blank" name="gform_ajax_frame_3" id="gform_ajax_frame_3"></iframe><script type="text/javascript">//<![CDATA[
function gformInitSpinner_3(){jQuery('#gform_3').submit(function(){if(jQuery('#gform_ajax_spinner_3').length == 0){jQuery('#gform_submit_button_3, #gform_wrapper_3 .gform_previous_button, #gform_wrapper_3 .gform_next_button, #gform_wrapper_3 .gform_image_button').attr('disabled', true); jQuery('#gform_submit_button_3, #gform_wrapper_3 .gform_next_button, #gform_wrapper_3 .gform_image_button').after('<' + 'img id="gform_ajax_spinner_3"  class="gform_ajax_spinner" src="http://www.elasticsearch.org/content/plugins/gravityforms/images/spinner.gif" alt="" />'); }} );}jQuery(document).ready(function($){gformInitSpinner_3();jQuery('#gform_ajax_frame_3').load( function(){var contents = jQuery(this).contents().find('*').html();var is_postback = contents.indexOf('GF_AJAX_POSTBACK') >= 0;if(!is_postback){return;}var form_content = jQuery(this).contents().find('#gform_wrapper_3');var is_redirect = contents.indexOf('gformRedirect(){') >= 0;jQuery('#gform_submit_button_3').removeAttr('disabled');var is_form = !(form_content.length <= 0 || is_redirect);if(is_form){jQuery('#gform_wrapper_3').html(form_content.html());jQuery(document).scrollTop(jQuery('#gform_wrapper_3').offset().top);if(window['gformInitDatepicker']) {gformInitDatepicker();}if(window['gformInitPriceFields']) {gformInitPriceFields();}var current_page = jQuery('#gform_source_page_number_3').val();gformInitSpinner_3();jQuery(document).trigger('gform_page_loaded', [3, current_page]);}else if(!is_redirect){var confirmation_content = jQuery(this).contents().find('#gforms_confirmation_message').html();if(!confirmation_content){confirmation_content = contents;}setTimeout(function(){jQuery('#gform_wrapper_3').replaceWith('<' + 'div id=\'gforms_confirmation_message\' class=\'gform_confirmation_message_3\'' + '>' + confirmation_content + '<' + '/div' + '>');jQuery(document).scrollTop(jQuery('#gforms_confirmation_message').offset().top);jQuery(document).trigger('gform_confirmation_loaded', [3]);}, 50);}else{jQuery('#gform_3').append(contents);if(window['gformRedirect']) {gformRedirect();}}jQuery(document).trigger('gform_post_render', [3, current_page]);} );} );</script><script type='text/javascript'> jQuery(document).ready(function(){jQuery(document).trigger('gform_post_render', [3, 1]) } );
//]]></script></div></div><div id="footer_container" class="full_wrapper"><div class="container"><nav role="navigation"><ul id="footer_nav" class="menu"><li id="menu-item-36" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-36"><a target="_blank" href="http://elasticsearch.com">Company</a></li><li id="menu-item-74989" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-53 current_page_item menu-item-74989"><a href="/resources/">Resources</a></li><li id="menu-item-3106" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3106"><a href="/terms-of-use/">Terms</a></li><li id="menu-item-3107" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3107"><a href="/privacy-and-cookie-policy/">Privacy</a></li><li id="menu-item-3105" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3105"><a href="/contact/">Contact</a></li><li id="menu-item-39" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-39"><a href="/blog/">Blog</a></li></ul></nav><div id="social"><a href="https://twitter.com/elasticsearch" class="social_icons" target="_blank"><i class="twitter"></i></a><a href="https://www.facebook.com/elasticsearch" class="social_icons" target="_blank"><i class="facebook"></i></a></div><div id="footer_form"><label class="form_label">Sign up for updates!</label><div class="gf_browser_gecko gform_wrapper" id="gform_wrapper_4"><a id="gf_4" name="gf_4" class="gform_anchor"></a><form method="post" enctype="multipart/form-data" target="gform_ajax_frame_4" id="gform_4" action="/resources/#gf_4"><div class="gform_body"><ul id="gform_fields_4" class="gform_fields top_label description_below"><li id="field_4_6" class="gfield               gfield_contains_required"><label class="gfield_label" for="input_4_6">
                        enter you email
                        <span class="gfield_required">*</span></label><div class="ginput_container"><input name="input_6" id="input_4_6" type="email" value="" class="medium" tabindex="50" /></div></li><li id="field_4_2" class="gfield     gform_hidden"><input name="input_2" id="input_4_2" type="hidden" class="gform_hidden" value="813-MAM-392" /></li><li id="field_4_3" class="gfield     gform_hidden"><input name="input_3" id="input_4_3" type="hidden" class="gform_hidden" value="WEB.org" /></li><li id="field_4_4" class="gfield     gform_hidden"><input name="input_4" id="input_4_4" type="hidden" class="gform_hidden" value="WEB.org - Footer - Updates" /></li></ul></div><div class="gform_footer top_label"><input type="submit" id="gform_submit_button_4" class="button gform_button" value="Submit" tabindex="51" /><input type="hidden" name="gform_ajax" value="form_id=4&amp;title=&amp;description=" /><input type="hidden" class="gform_hidden" name="is_submit_4" value="1" /><input type="hidden" class="gform_hidden" name="gform_submit" value="4" /><input type="hidden" class="gform_hidden" name="gform_unique_id" value="" /><input type="hidden" class="gform_hidden" name="state_4" value="WyJhOjA6e30iLCJmMjE2MmM2ZjUxYmQ4M2Q3ZmMzNzVlNmY2ODYyZTI2NCJd" /><input type="hidden" class="gform_hidden" name="gform_target_page_number_4" id="gform_target_page_number_4" value="0" /><input type="hidden" class="gform_hidden" name="gform_source_page_number_4" id="gform_source_page_number_4" value="1" /><input type="hidden" name="gform_field_values" value="" /></div></form></div><iframe style="display:none;width:0px; height:0px;" src="about:blank" name="gform_ajax_frame_4" id="gform_ajax_frame_4"></iframe><script type="text/javascript">//<![CDATA[
function gformInitSpinner_4(){jQuery('#gform_4').submit(function(){if(jQuery('#gform_ajax_spinner_4').length == 0){jQuery('#gform_submit_button_4, #gform_wrapper_4 .gform_previous_button, #gform_wrapper_4 .gform_next_button, #gform_wrapper_4 .gform_image_button').attr('disabled', true); jQuery('#gform_submit_button_4, #gform_wrapper_4 .gform_next_button, #gform_wrapper_4 .gform_image_button').after('<' + 'img id="gform_ajax_spinner_4"  class="gform_ajax_spinner" src="http://www.elasticsearch.org/content/plugins/gravityforms/images/spinner.gif" alt="" />'); }} );}jQuery(document).ready(function($){gformInitSpinner_4();jQuery('#gform_ajax_frame_4').load( function(){var contents = jQuery(this).contents().find('*').html();var is_postback = contents.indexOf('GF_AJAX_POSTBACK') >= 0;if(!is_postback){return;}var form_content = jQuery(this).contents().find('#gform_wrapper_4');var is_redirect = contents.indexOf('gformRedirect(){') >= 0;jQuery('#gform_submit_button_4').removeAttr('disabled');var is_form = !(form_content.length <= 0 || is_redirect);if(is_form){jQuery('#gform_wrapper_4').html(form_content.html());jQuery(document).scrollTop(jQuery('#gform_wrapper_4').offset().top);if(window['gformInitDatepicker']) {gformInitDatepicker();}if(window['gformInitPriceFields']) {gformInitPriceFields();}var current_page = jQuery('#gform_source_page_number_4').val();gformInitSpinner_4();jQuery(document).trigger('gform_page_loaded', [4, current_page]);}else if(!is_redirect){var confirmation_content = jQuery(this).contents().find('#gforms_confirmation_message').html();if(!confirmation_content){confirmation_content = contents;}setTimeout(function(){jQuery('#gform_wrapper_4').replaceWith('<' + 'div id=\'gforms_confirmation_message\' class=\'gform_confirmation_message_4\'' + '>' + confirmation_content + '<' + '/div' + '>');jQuery(document).scrollTop(jQuery('#gforms_confirmation_message').offset().top);jQuery(document).trigger('gform_confirmation_loaded', [4]);}, 50);}else{jQuery('#gform_4').append(contents);if(window['gformRedirect']) {gformRedirect();}}jQuery(document).trigger('gform_post_render', [4, current_page]);} );} );</script><script type='text/javascript'> jQuery(document).ready(function(){jQuery(document).trigger('gform_post_render', [4, 1]) } );
//]]></script></div><div class="legal"><p>Â© All Rights Reserved - Elasticsearch</p><p>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries | <a href="/trademarks/">Trademarks</a></p><p>Apache Lucene and Lucene are trademarks of the Apache Software Foundation</p></div></div></div></footer><section id="cookie"><div class="container"><div class="eu">
          Elasticsearch uses cookies to provide a better user experience to visitors of our website. Read more about our cookie policy
          <a href="/privacy-and-cookie-policy/">here.</a><a data-action="accept" class="cta">Accept cookies</a></div><div class="uk">
          Elasticsearch uses cookies to provide a better user experience to visitors of our website. Read more about our cookie policy
          <a href="/privacy-and-cookie-policy/">here.</a><a data-action="dismiss" class="cta dismiss">X</a></div></div></section><script type="text/javascript">
      if (window.aiModifyParent) aiModifyParent();
      (function ($, $a, $title, $list) {
        $a = $('[id^="js-api-method-index"]');
        if (!$a.size()) return;
        $('.guide_content').addClass('js-client-docs');
        $list = $a.siblings('.itemizedlist').detach();
        $title = $(document.createElement('h2')).text('api methods')
        $a.parent().remove();
        $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
      }(jQuery));
    </script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/main.min.js?ver=1386267463"></script></body></html>
